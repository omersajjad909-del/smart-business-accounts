[{"filePath":"D:\\projects\\smart-business-accounts\\app\\admin\\permissions\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[261,264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[261,264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[425,428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[425,428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`selectRole` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nD:\\projects\\smart-business-accounts\\app\\admin\\permissions\\page.tsx:70:11\n  68 |         setRoles(data || []);\n  69 |         if (data && data.length > 0) {\n> 70 |           selectRole(data[0].role);\n     |           ^^^^^^^^^^ `selectRole` accessed before it is declared\n  71 |         }\n  72 |       })\n  73 |       .catch(console.error);\n\nD:\\projects\\smart-business-accounts\\app\\admin\\permissions\\page.tsx:134:3\n  132 |   // ================= ROLES TAB ACTIONS =================\n  133 |\n> 134 |   const selectRole = (roleName: string) => {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 135 |     setSelectedRole(roleName);\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 136 |     const role = roles.find(r => r.role === roleName);\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 137 |     setRolePermissions(role?.permissions || []);\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 138 |   };\n      | ^^^^^ `selectRole` is declared here\n  139 |\n  140 |   const toggleRolePermission = (perm: string) => {\n  141 |     setRolePermissions(prev =>","line":70,"column":11,"nodeType":null,"endLine":70,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectRole'. Either include it or remove the dependency array.","line":74,"column":6,"nodeType":"ArrayExpression","endLine":74,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [ready, selectRole, user, userId]","fix":{"range":[1971,1992],"text":"[ready, selectRole, user, userId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2331,2334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2331,2334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\ninterface User {\r\n  id: string;\r\n  email: string;\r\n  name: string;\r\n  role: string;\r\n  permissions: any[];\r\n}\r\n\r\ninterface Role {\r\n  role: string;\r\n  permissions: string[];\r\n}\r\n\r\nexport default function AdminPermissionsPage() {\r\n  const [user, setUser] = useState<any | null>(null);\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const [ready, setReady] = useState(false);\r\n  const [activeTab, setActiveTab] = useState<\"users\" | \"roles\">(\"users\");\r\n\r\n  // Users Tab\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\r\n  const [userPermissions, setUserPermissions] = useState<string[]>([]);\r\n\r\n  // Roles Tab\r\n  const [roles, setRoles] = useState<Role[]>([]);\r\n  const [selectedRole, setSelectedRole] = useState<string>(\"ADMIN\");\r\n  const [rolePermissions, setRolePermissions] = useState<string[]>([]);\r\n\r\n  // 🔹 load user once (client only)\r\n  useEffect(() => {\r\n    const u = getCurrentUser();\r\n    setUser(u);\r\n    setUserId(u?.id ?? null);\r\n    setReady(true);\r\n  }, []);\r\n\r\n  // 🔹 fetch users and roles\r\n  useEffect(() => {\r\n    if (!ready || !user || user.role !== \"ADMIN\" || !userId) return;\r\n\r\n    // Fetch users\r\n    fetch(\"/api/admin/user-permissions\", {\r\n      headers: {\r\n        \"x-user-role\": user.role,\r\n        \"x-user-id\": userId,\r\n      },\r\n    })\r\n      .then(r => r.json())\r\n      .then(setUsers)\r\n      .catch(console.error);\r\n\r\n    // Fetch roles\r\n    fetch(\"/api/admin/roles\", {\r\n      headers: {\r\n        \"x-user-role\": user.role,\r\n        \"x-user-id\": userId,\r\n      },\r\n    })\r\n      .then(r => r.json())\r\n      .then(data => {\r\n        setRoles(data || []);\r\n        if (data && data.length > 0) {\r\n          selectRole(data[0].role);\r\n        }\r\n      })\r\n      .catch(console.error);\r\n  }, [ready, user, userId]);\r\n\r\n  // 🔒 hard guards\r\n  if (!ready) return null;\r\n\r\n  if (!user || !userId || user.role !== \"ADMIN\") {\r\n    return <div className=\"p-6\">Access denied</div>;\r\n  }\r\n\r\n  // ================= USERS TAB ACTIONS =================\r\n\r\n  const selectUser = (u: User) => {\r\n    setSelectedUser(u);\r\n    setUserPermissions(u.permissions.map((p: any) => p.permission));\r\n  };\r\n\r\n  const toggleUserPermission = (perm: string) => {\r\n    setUserPermissions(prev =>\r\n      prev.includes(perm)\r\n        ? prev.filter(p => p !== perm)\r\n        : [...prev, perm]\r\n    );\r\n  };\r\n\r\n  const saveUserPermissions = async () => {\r\n    if (!selectedUser) {\r\n      alert(\"Please select a user first\");\r\n      return;\r\n    }\r\n\r\n    const response = await fetch(\"/api/admin/user-permissions\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"x-user-role\": user.role,\r\n        \"x-user-id\": userId,\r\n      },\r\n      body: JSON.stringify({\r\n        userId: selectedUser.id,\r\n        permissions: userPermissions,\r\n      }),\r\n    });\r\n\r\n    if (response.ok) {\r\n      alert(\"User permissions saved successfully\");\r\n      // Refresh users list\r\n      const updated = await fetch(\"/api/admin/user-permissions\", {\r\n        headers: {\r\n          \"x-user-role\": user.role,\r\n          \"x-user-id\": userId,\r\n        },\r\n      }).then(r => r.json());\r\n      setUsers(updated);\r\n    } else {\r\n      alert(\"Failed to save permissions\");\r\n    }\r\n  };\r\n\r\n  // ================= ROLES TAB ACTIONS =================\r\n\r\n  const selectRole = (roleName: string) => {\r\n    setSelectedRole(roleName);\r\n    const role = roles.find(r => r.role === roleName);\r\n    setRolePermissions(role?.permissions || []);\r\n  };\r\n\r\n  const toggleRolePermission = (perm: string) => {\r\n    setRolePermissions(prev =>\r\n      prev.includes(perm)\r\n        ? prev.filter(p => p !== perm)\r\n        : [...prev, perm]\r\n    );\r\n  };\r\n\r\n  const saveRolePermissions = async () => {\r\n    const response = await fetch(\"/api/admin/roles\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"x-user-role\": user.role,\r\n        \"x-user-id\": userId,\r\n      },\r\n      body: JSON.stringify({\r\n        role: selectedRole,\r\n        permissions: rolePermissions,\r\n      }),\r\n    });\r\n\r\n    if (response.ok) {\r\n      alert(\"Role permissions saved successfully\");\r\n      // Refresh roles list\r\n      const updated = await fetch(\"/api/admin/roles\", {\r\n        headers: {\r\n          \"x-user-role\": user.role,\r\n          \"x-user-id\": userId,\r\n        },\r\n      }).then(r => r.json());\r\n      setRoles(updated);\r\n      selectRole(selectedRole);\r\n    } else {\r\n      alert(\"Failed to save role permissions\");\r\n    }\r\n  };\r\n\r\n  // ================= UI =================\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h1 className=\"text-3xl font-bold mb-6\">Roles & Permissions</h1>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"flex gap-4 mb-6 border-b\">\r\n        <button\r\n          onClick={() => setActiveTab(\"users\")}\r\n          className={`px-4 py-2 font-semibold ${\r\n            activeTab === \"users\"\r\n              ? \"text-blue-600 border-b-2 border-blue-600\"\r\n              : \"text-gray-600\"\r\n          }`}\r\n        >\r\n          👥 Users & Permissions\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab(\"roles\")}\r\n          className={`px-4 py-2 font-semibold ${\r\n            activeTab === \"roles\"\r\n              ? \"text-blue-600 border-b-2 border-blue-600\"\r\n              : \"text-gray-600\"\r\n          }`}\r\n        >\r\n          🎭 Roles\r\n        </button>\r\n      </div>\r\n\r\n      {/* USERS TAB */}\r\n      {activeTab === \"users\" && (\r\n        <div className=\"grid grid-cols-3 gap-6\">\r\n          <div>\r\n            <h2 className=\"font-bold text-lg mb-4\">Users</h2>\r\n            <div className=\"space-y-2\">\r\n              {users.map(u => (\r\n                <div\r\n                  key={u.id}\r\n                  onClick={() => selectUser(u)}\r\n                  className={`cursor-pointer p-3 border rounded transition ${\r\n                    selectedUser?.id === u.id\r\n                      ? \"bg-blue-100 border-blue-500\"\r\n                      : \"bg-white hover:bg-gray-50\"\r\n                  }`}\r\n                >\r\n                  <div className=\"font-semibold\">{u.name || u.email}</div>\r\n                  <div className=\"text-xs text-gray-600\">Role: {u.role}</div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"col-span-2\">\r\n            {selectedUser ? (\r\n              <div className=\"bg-white border rounded p-6\">\r\n                <h2 className=\"text-xl font-bold mb-4\">\r\n                  Permissions for {selectedUser.name || selectedUser.email}\r\n                </h2>\r\n\r\n                <div className=\"mb-4 p-3 bg-gray-50 rounded\">\r\n                  <span className=\"font-semibold\">Role:</span> {selectedUser.role}\r\n                </div>\r\n\r\n                <div className=\"space-y-2 mb-6\">\r\n                  {Object.values(PERMISSIONS).map(p => (\r\n                    <label key={p} className=\"flex items-center cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={userPermissions.includes(p)}\r\n                        onChange={() => toggleUserPermission(p)}\r\n                        className=\"w-4 h-4\"\r\n                      />\r\n                      <span className=\"ml-3 text-sm\">{p}</span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n\r\n                <button\r\n                  onClick={saveUserPermissions}\r\n                  className=\"px-6 py-2 bg-blue-600 text-white rounded font-semibold hover:bg-blue-700\"\r\n                >\r\n                  💾 Save Permissions\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"bg-gray-50 border rounded p-6 text-center text-gray-600\">\r\n                Select a user to manage permissions\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* ROLES TAB */}\r\n      {activeTab === \"roles\" && (\r\n        <div className=\"grid grid-cols-3 gap-6\">\r\n          <div>\r\n            <h2 className=\"font-bold text-lg mb-4\">Roles</h2>\r\n            <div className=\"space-y-2\">\r\n              {[\"ADMIN\", \"ACCOUNTANT\", \"VIEWER\"].map(roleName => (\r\n                <div\r\n                  key={roleName}\r\n                  onClick={() => selectRole(roleName)}\r\n                  className={`cursor-pointer p-3 border rounded transition ${\r\n                    selectedRole === roleName\r\n                      ? \"bg-blue-100 border-blue-500\"\r\n                      : \"bg-white hover:bg-gray-50\"\r\n                  }`}\r\n                >\r\n                  <div className=\"font-semibold\">{roleName}</div>\r\n                  <div className=\"text-xs text-gray-600\">\r\n                    {rolePermissions.length} permissions\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"col-span-2\">\r\n            <div className=\"bg-white border rounded p-6\">\r\n              <h2 className=\"text-xl font-bold mb-4\">\r\n                Permissions for {selectedRole} Role\r\n              </h2>\r\n\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded p-3 mb-6\">\r\n                <p className=\"text-sm text-blue-800\">\r\n                  Configure which permissions users with the <strong>{selectedRole}</strong> role will have.\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"space-y-2 mb-6\">\r\n                {Object.values(PERMISSIONS).map(p => (\r\n                  <label key={p} className=\"flex items-center cursor-pointer\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={rolePermissions.includes(p)}\r\n                      onChange={() => toggleRolePermission(p)}\r\n                      className=\"w-4 h-4\"\r\n                    />\r\n                    <span className=\"ml-3 text-sm\">{p}</span>\r\n                  </label>\r\n                ))}\r\n              </div>\r\n\r\n              <button\r\n                onClick={saveRolePermissions}\r\n                className=\"px-6 py-2 bg-green-600 text-white rounded font-semibold hover:bg-green-700\"\r\n              >\r\n                💾 Save Role Permissions\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\accounts\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[175,178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[175,178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[277,280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[277,280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\n// ✅ Prisma singleton (dev safe)\r\nconst prisma =\r\n  (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(\r\n  req: NextRequest,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const params = await context.params;\r\n    // ✅ ROLE FROM HEADER\r\n    const role = req.headers.get(\"x-user-role\");\r\n\r\n    // ✅ ACCOUNTS ACCESS\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json(\r\n        { error: \"Forbidden\" },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    const invoices = await prisma.salesInvoice.findMany({\r\n      where: { accountId: params.id },\r\n      orderBy: { date: \"desc\" },\r\n      select: {\r\n        id: true,\r\n        invoiceNo: true,\r\n        date: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(invoices);\r\n  } catch (err) {\r\n    console.error(\"❌ INVOICES ERROR:\", err);\r\n    return NextResponse.json(\r\n      { error: \"Failed to load invoices\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\accounts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":380,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11323,11326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11323,11326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":383,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11425,11428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11425,11428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":540,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":540,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":558,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":558,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// import { NextResponse } from \"next/server\";\r\n// import { PrismaClient } from \"@prisma/client\";\r\n\r\n// // Prisma singleton\r\n// const prisma =\r\n//   (globalThis as any).prisma || new PrismaClient();\r\n\r\n// if (process.env.NODE_ENV === \"development\") {\r\n//   (globalThis as any).prisma = prisma;\r\n// }\r\n\r\n// // const CATEGORY_TYPE_MAP: Record<string, string> = {\r\n// //   \"ACCOUNTS RECEIVABLE\": \"ASSET\",\r\n// //   \"ACCOUNTS PAYABLE\": \"LIABILITY\",\r\n// //   \"BANKS\": \"ASSET\",\r\n// //   \"CASH\": \"ASSET\",\r\n// //   \"FIXED ASSETS\": \"ASSET\",\r\n// //   \"ACCUMULATED DEPRECIATION\": \"CONTRA_ASSET\",\r\n// //   \"EXPENSE\": \"EXPENSE\",\r\n// //   \"INCOME\": \"INCOME\",\r\n// //   \"EQUITY\": \"EQUITY\",\r\n// //   \"LIABILITIES\": \"LIABILITY\",\r\n// //   \"STOCK\": \"ASSET\",\r\n// //   \"GENERAL\": \"ASSET\",\r\n// // };\r\n\r\n// /* ================= GET ================= */\r\n// export async function GET(req: Request) {\r\n//   const role = req.headers.get(\"x-user-role\");\r\n\r\n//   if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n//     return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n//   }\r\n\r\n//   const accounts = await prisma.account.findMany({\r\n//     orderBy: { name: \"asc\" },\r\n//   });\r\n\r\n//   return NextResponse.json(accounts);\r\n  \r\n// }\r\n\r\n// /* ================= POST ================= */\r\n// const CATEGORY_TYPE_MAP: Record<string, string> = {\r\n//   // ASSETS\r\n//   ASSETS: \"ASSET\",\r\n//   BANKS: \"ASSET\",\r\n//   VEHICLES: \"ASSET\",\r\n//   MACHINERY: \"ASSET\",\r\n//   BUILDING: \"ASSET\",\r\n//   FURNITURE: \"ASSET\",\r\n//   CUSTOMER: \"ASSET\", // Accounts Receivable\r\n\r\n//   // LIABILITIES\r\n//   SUPPLIER: \"LIABILITY\", // Accounts Payable\r\n//   LIABILITIES: \"LIABILITY\",\r\n//   LOAN: \"LIABILITY\",\r\n//   TAX: \"LIABILITY\",\r\n\r\n//   // EXPENSES\r\n//   EXPENSE: \"EXPENSE\",\r\n//   EMPLOYES: \"EXPENSE\",\r\n//   CARGO: \"EXPENSE\",\r\n\r\n//   // INCOME\r\n//   INCOME: \"INCOME\",\r\n\r\n//   // EQUITY\r\n//   EQUITY: \"EQUITY\",\r\n\r\n//   // CONTRA\r\n//   \"CONTRA ASSET\": \"CONTRA_ASSET\",\r\n\r\n//   // FALLBACK\r\n//   GENERAL: \"ASSET\",\r\n// };\r\n\r\n// export async function POST(req: Request) {\r\n//   try {\r\n//     const rawRole = req.headers.get(\"x-user-role\");\r\n//     const role = rawRole?.toUpperCase(); // 🔥 FIX\r\n\r\n//     if (role !== \"ADMIN\") {\r\n//       return NextResponse.json(\r\n//         { error: \"Only ADMIN can create accounts\" },\r\n//         { status: 403 }\r\n//       );\r\n//     }\r\n\r\n//     const body = await req.json();\r\n\r\n//     if (body && body.cleanupStandard === true) {\r\n//       const removableCodes = [\r\n//         \"BANK002\",\r\n//         \"FA001\",\r\n//         \"FA002\",\r\n//         \"FA003\",\r\n//         \"FA004\",\r\n//         \"FA005\",\r\n//         \"FA006\",\r\n//         \"AP001\",\r\n//         \"LOAN001\",\r\n//         \"LOAN002\",\r\n//         \"TAX001\",\r\n//         \"TAX002\",\r\n//         \"SALES001\",\r\n//         \"SALES002\",\r\n//         \"SALES003\",\r\n//         \"SALES004\",\r\n//         \"EXP001\",\r\n//         \"EXP002\",\r\n//         \"EXP003\",\r\n//         \"EXP004\",\r\n//         \"EXP005\",\r\n//         \"EXP006\",\r\n//         \"EXP007\",\r\n//         \"EXP008\",\r\n//         \"EXP009\",\r\n//         \"EXP010\",\r\n//         \"EXP011\",\r\n//         \"EXP012\",\r\n//         \"EXP013\",\r\n//         \"EXP014\",\r\n//         \"EXP015\",\r\n//         \"EXP016\",\r\n//         \"CONTRA001\",\r\n//         \"CONTRA002\",\r\n//         \"CONTRA003\",\r\n//         \"CONTRA004\",\r\n//       ];\r\n\r\n//       const result = await prisma.account.deleteMany({\r\n//         where: {\r\n//           code: { in: removableCodes },\r\n//           voucherEntries: { none: {} },\r\n//           salesInvoices: { none: {} },\r\n//           purchaseInvoices: { none: {} },\r\n//           purchaseOrders: { none: {} },\r\n//           saleReturns: { none: {} },\r\n//           bankAccounts: { none: {} },\r\n//           paymentReceipts: { none: {} },\r\n//           expenseVouchers: { none: {} },\r\n//           taxAccounts: { none: {} },\r\n//           budgets: { none: {} },\r\n//           recurringTransactions: { none: {} },\r\n//         },\r\n//       });\r\n\r\n//       return NextResponse.json({ cleaned: result.count });\r\n//     }\r\n\r\n//     if (body && body.autoType === true) {\r\n//       const accounts = await prisma.account.findMany();\r\n\r\n//       let updated = 0;\r\n\r\n//       for (const acc of accounts) {\r\n//         const currentType = acc.type || \"GENERAL\";\r\n//         if (currentType !== \"GENERAL\" && currentType !== \"BANK\") continue;\r\n\r\n//         const name = (acc.name || \"\").toLowerCase();\r\n//         const code = (acc.code || \"\").toUpperCase();\r\n//         const party = acc.partyType || \"\";\r\n\r\n//         let newType: string | null = null;\r\n\r\n//         if (party === \"CUSTOMER\") {\r\n//           newType = \"ASSET\";\r\n//         } else if (party === \"SUPPLIER\") {\r\n//           newType = \"LIABILITY\";\r\n//         } else if (party === \"BANKS\") {\r\n//           newType = \"ASSET\";\r\n//         } else if (party === \"EXPENSE\") {\r\n//           newType = \"EXPENSE\";\r\n//         } else if (code.startsWith(\"CASH\") || name.includes(\"cash\")) {\r\n//           newType = \"ASSET\";\r\n//         } else if (code.startsWith(\"BANK\") || name.includes(\"bank\")) {\r\n//           newType = \"ASSET\";\r\n//         } else if (name.includes(\"loan\")) {\r\n//           newType = \"LIABILITY\";\r\n//         } else if (name.includes(\"tax\")) {\r\n//           newType = \"LIABILITY\";\r\n//         } else if (\r\n//           name.includes(\"capital\") ||\r\n//           name.includes(\"equity\") ||\r\n//           name.includes(\"opening balance\")\r\n//         ) {\r\n//           newType = \"EQUITY\";\r\n//         } else if (\r\n//           name.includes(\"sales\") ||\r\n//           name.includes(\"revenue\") ||\r\n//           name.includes(\"income\")\r\n//         ) {\r\n//           newType = \"INCOME\";\r\n//         } else if (\r\n//           name.includes(\"expense\") ||\r\n//           name.includes(\"rent\") ||\r\n//           name.includes(\"salary\") ||\r\n//           name.includes(\"wages\")\r\n//         ) {\r\n//           newType = \"EXPENSE\";\r\n//         }\r\n\r\n//         if (newType && newType !== acc.type) {\r\n//           await prisma.account.update({\r\n//             where: { id: acc.id },\r\n//             data: { type: newType },\r\n//           });\r\n//           updated += 1;\r\n//         }\r\n//       }\r\n\r\n//       return NextResponse.json({ updated });\r\n//     }\r\n\r\n//     if (!body.code || !body.name) {\r\n//       return NextResponse.json(\r\n//         { error: \"Code and name required\" },\r\n//         { status: 400 }\r\n//       );\r\n//     }\r\n\r\n//     const fixedType =\r\n//   CATEGORY_TYPE_MAP[body.partyType] || \"ASSET\";\r\n\r\n// const account = await prisma.account.create({\r\n//   data: {\r\n//     code: body.code,\r\n//     name: body.name,\r\n//     type: fixedType,              // 🔥 FIXED HERE\r\n//     partyType: body.partyType || null,\r\n//     city: body.city || null,\r\n//     phone: body.phone || null,\r\n//     openDate: body.openDate\r\n//       ? new Date(body.openDate)\r\n//       : new Date(),\r\n//     openDebit: Number(body.openDebit || 0),\r\n//     openCredit: Number(body.openCredit || 0),\r\n//     creditDays: Number(body.creditDays || 0),\r\n//     creditLimit: Number(body.creditLimit || 0),\r\n//   },\r\n// });\r\n\r\n\r\n//     // 🔥 Agar partyType = \"BANKS\" hai to BankAccount table mein bhi entry banao\r\n//     if (body.partyType === \"BANKS\") {\r\n//       // Check if BankAccount already exists\r\n//       const existingBankAccount = await prisma.bankAccount.findFirst({\r\n//         where: { accountId: account.id },\r\n//       });\r\n\r\n//       if (!existingBankAccount) {\r\n//         // Extract bank name and account number from account name if possible\r\n//         // Format: \"BANK NAME - ACCOUNT NO\" or just \"BANK NAME\"\r\n//         const nameParts = account.name.split(\" - \");\r\n//         const bankName = nameParts[0] || account.name;\r\n//         const accountNo = nameParts[1] || account.code;\r\n\r\n//         await prisma.bankAccount.create({\r\n//           data: {\r\n//             accountNo: accountNo,\r\n//             bankName: bankName,\r\n//             accountName: account.name,\r\n//             accountId: account.id,\r\n//             balance: Number(body.openDebit || body.openCredit || 0),\r\n//           },\r\n//         });\r\n//       }\r\n//     }\r\n\r\n//     return NextResponse.json(account);\r\n//   } catch (e) {\r\n//     console.error(\"❌ ACCOUNT CREATE ERROR:\", e);\r\n//     return NextResponse.json(\r\n//       { error: \"Failed to create account\" },\r\n//       { status: 500 }\r\n//     );\r\n//   }\r\n// }\r\n\r\n          \r\n\r\n// /* ================= DELETE ================= */\r\n// export async function DELETE(req: Request) {\r\n//   try {\r\n//     const rawRole = req.headers.get(\"x-user-role\");\r\n//     const role = rawRole?.toUpperCase();\r\n    \r\n//     if (role !== \"ADMIN\") {\r\n//       return NextResponse.json(\r\n//         { error: \"Only ADMIN can delete accounts\" },\r\n//         { status: 403 }\r\n//       );\r\n//     }\r\n\r\n//     const { searchParams } = new URL(req.url);\r\n//     const id = searchParams.get(\"id\");\r\n\r\n//     if (!id) {\r\n//       return NextResponse.json(\r\n//         { error: \"Account ID is required\" },\r\n//         { status: 400 }\r\n//       );\r\n//     }\r\n\r\n//     // اکاؤنٹ ڈیلیٹ کرنا\r\n//     await prisma.account.delete({\r\n//       where: { id: id },\r\n//     });\r\n\r\n//     return NextResponse.json({ message: \"Account deleted successfully\" });\r\n//   } catch (e: any) {\r\n//     console.error(\"❌ ACCOUNT DELETE ERROR:\", e);\r\n    \r\n//     return NextResponse.json(\r\n//       { error: \"Cannot delete account. It might be in use.\" },\r\n//       { status: 500 }\r\n//     );\r\n//   }\r\n// }\r\n\r\n// /* ================= PUT (EDIT) ================= */\r\n// export async function PUT(req: Request) {\r\n//   try {\r\n//     const rawRole = req.headers.get(\"x-user-role\");\r\n//     const role = rawRole?.toUpperCase();\r\n\r\n//     if (role !== \"ADMIN\") {\r\n//       return NextResponse.json(\r\n//         { error: \"Only ADMIN can edit accounts\" },\r\n//         { status: 403 }\r\n//       );\r\n//     }\r\n\r\n//     const body = await req.json();\r\n//     const { id, ...updateData } = body;\r\n\r\n//     if (!id) {\r\n//       return NextResponse.json(\r\n//         { error: \"Account ID is required for updating\" },\r\n//         { status: 400 }\r\n//       );\r\n//     }\r\n\r\n//     // ڈیٹا کو فارمیٹ کرنا تاکہ پرزمہ ایرر نہ دے\r\n//     const fixedType =\r\n//   CATEGORY_TYPE_MAP[updateData.partyType] || undefined;\r\n\r\n//     const formattedData = {\r\n//   ...updateData,\r\n//   type: fixedType, // 🔥 AUTO FIX\r\n//   openDate: updateData.openDate ? new Date(updateData.openDate) : undefined,\r\n//   openDebit: updateData.openDebit !== undefined ? Number(updateData.openDebit) : undefined,\r\n//   openCredit: updateData.openCredit !== undefined ? Number(updateData.openCredit) : undefined,\r\n//   creditDays: updateData.creditDays !== undefined ? Number(updateData.creditDays) : undefined,\r\n//   creditLimit: updateData.creditLimit !== undefined ? Number(updateData.creditLimit) : undefined,\r\n// };\r\n\r\n\r\n//     const updatedAccount = await prisma.account.update({\r\n//       where: { id: id },\r\n//       data: formattedData,\r\n//     });\r\n\r\n//     return NextResponse.json(updatedAccount);\r\n//   } catch (e: any) {\r\n//     console.error(\"❌ ACCOUNT UPDATE ERROR:\", e);\r\n//     return NextResponse.json(\r\n//       { error: \"Failed to update account\" },\r\n//       { status: 500 }\r\n//     );\r\n//   }\r\n// }\r\n\r\n\r\nimport { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\n// Prisma singleton\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n/* ================= CATEGORY TO TYPE MAPPING ================= */\r\n// آپ کی لسٹ کے مطابق فنانشل ٹائپس\r\nconst CATEGORY_TYPE_MAP: Record<string, string> = {\r\n  \"CUSTOMER\": \"ASSET\",\r\n  \"SUPPLIER\": \"LIABILITY\",\r\n  \"BANKS\": \"ASSET\",\r\n  \"CASH\": \"ASSET\",\r\n  \"FIXED ASSETS\": \"ASSET\",\r\n  \"ACCUMULATED DEPRECIATION\": \"CONTRA_ASSET\",\r\n  \"EXPENSE\": \"EXPENSE\",\r\n  \"INCOME\": \"INCOME\",\r\n  \"EQUITY\": \"EQUITY\",\r\n  \"LIABILITIES\": \"LIABILITY\",\r\n  \"STOCK\": \"ASSET\",\r\n  \"GENERAL\": \"ASSET\",\r\n  \"CONTRA\": \"CONTRA_ASSET\",\r\n};\r\n\r\n/* ================= GET ================= */\r\nexport async function GET(req: Request) {\r\n  const role = req.headers.get(\"x-user-role\");\r\n  const { searchParams } = new URL(req.url);\r\n  const prefix = searchParams.get(\"prefix\");\r\n\r\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  // اگر ریکوئسٹ میں Prefix ہے تو صرف اگلا کوڈ بھیجیں (Auto-Code Logic)\r\n  // Back-end (route.ts) کے اندر GET میں تبدیلی:\r\nif (prefix) {\r\n  const lastAccount = await prisma.account.findFirst({\r\n    where: { code: { startsWith: prefix } },\r\n    orderBy: { code: \"desc\" },\r\n  });\r\n\r\n  let nextNumber = 1;\r\n  if (lastAccount) {\r\n    // یہ ریجیکس (Regex) کوڈ کے آخر سے نمبر نکال لے گا چاہے بیچ میں ڈیش ہو یا نہ ہو\r\n    const match = lastAccount.code.match(/\\d+$/);\r\n    if (match) {\r\n      nextNumber = parseInt(match[0]) + 1;\r\n    }\r\n  }\r\n\r\n  const nextCode = `${prefix}-${String(nextNumber).padStart(3, \"0\")}`;\r\n  return NextResponse.json({ nextCode });\r\n}\r\n\r\n  // ورنہ تمام اکاؤنٹس کی لسٹ بھیجیں\r\n  const accounts = await prisma.account.findMany({\r\n    orderBy: { name: \"asc\" },\r\n  });\r\n\r\n  return NextResponse.json(accounts);\r\n}\r\n\r\n/* ================= POST ================= */\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const rawRole = req.headers.get(\"x-user-role\");\r\n    const role = rawRole?.toUpperCase();\r\n\r\n    if (role !== \"ADMIN\") {\r\n      return NextResponse.json({ error: \"Only ADMIN can create accounts\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n\r\n    // Standard Cleanup Logic\r\n    if (body && body.cleanupStandard === true) {\r\n      const removableCodes = [\"BANK002\", \"AP001\", \"EXP001\", \"TAX001\"]; // وغیرہ\r\n      const result = await prisma.account.deleteMany({\r\n        where: {\r\n          code: { in: removableCodes },\r\n          voucherEntries: { none: {} },\r\n          salesInvoices: { none: {} },\r\n        },\r\n      });\r\n      return NextResponse.json({ cleaned: result.count });\r\n    }\r\n\r\n    if (!body.code || !body.name) {\r\n      return NextResponse.json({ error: \"Code and name required\" }, { status: 400 });\r\n    }\r\n\r\n    const fixedType = CATEGORY_TYPE_MAP[body.partyType] || \"ASSET\";\r\n\r\n    const account = await prisma.account.create({\r\n      data: {\r\n        code: body.code,\r\n        name: body.name,\r\n        type: fixedType,\r\n        partyType: body.partyType || \"GENERAL\",\r\n        city: body.city || null,\r\n        phone: body.phone || null,\r\n        openDate: body.openDate ? new Date(body.openDate) : new Date(),\r\n        openDebit: Number(body.openDebit || 0),\r\n        openCredit: Number(body.openCredit || 0),\r\n        creditDays: Number(body.creditDays || 0),\r\n        creditLimit: Number(body.creditLimit || 0),\r\n      },\r\n    });\r\n\r\n    // Bank Account creation logic\r\n    if (body.partyType === \"BANKS\") {\r\n      const nameParts = account.name.split(\" - \");\r\n      await prisma.bankAccount.create({\r\n        data: {\r\n          accountNo: nameParts[1] || account.code,\r\n          bankName: nameParts[0] || account.name,\r\n          accountName: account.name,\r\n          accountId: account.id,\r\n          balance: Number(body.openDebit || body.openCredit || 0),\r\n        },\r\n      });\r\n    }\r\n\r\n    return NextResponse.json(account);\r\n  } catch (e) {\r\n    console.error(\"❌ ACCOUNT CREATE ERROR:\", e);\r\n    return NextResponse.json({ error: \"Failed to create account\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n/* ================= PUT (EDIT) ================= */\r\nexport async function PUT(req: Request) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\")?.toUpperCase();\r\n    if (role !== \"ADMIN\") return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n\r\n    const body = await req.json();\r\n    const { id, ...updateData } = body;\r\n\r\n    if (!id) return NextResponse.json({ error: \"ID required\" }, { status: 400 });\r\n\r\n    const fixedType = CATEGORY_TYPE_MAP[updateData.partyType] || undefined;\r\n\r\n    const formattedData = {\r\n      ...updateData,\r\n      type: fixedType,\r\n      openDate: updateData.openDate ? new Date(updateData.openDate) : undefined,\r\n      openDebit: updateData.openDebit !== undefined ? Number(updateData.openDebit) : undefined,\r\n      openCredit: updateData.openCredit !== undefined ? Number(updateData.openCredit) : undefined,\r\n      creditDays: updateData.creditDays !== undefined ? Number(updateData.creditDays) : undefined,\r\n      creditLimit: updateData.creditLimit !== undefined ? Number(updateData.creditLimit) : undefined,\r\n    };\r\n\r\n    const updatedAccount = await prisma.account.update({\r\n      where: { id: id },\r\n      data: formattedData,\r\n    });\r\n\r\n    return NextResponse.json(updatedAccount);\r\n  } catch (e) {\r\n    return NextResponse.json({ error: \"Failed to update\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n/* ================= DELETE ================= */\r\nexport async function DELETE(req: Request) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\")?.toUpperCase();\r\n    if (role !== \"ADMIN\") return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) return NextResponse.json({ error: \"ID required\" }, { status: 400 });\r\n\r\n    await prisma.account.delete({ where: { id: id } });\r\n    return NextResponse.json({ message: \"Deleted\" });\r\n  } catch (e) {\r\n    return NextResponse.json({ error: \"Cannot delete. Account in use.\" }, { status: 500 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\admin\\roles\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[245,248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[245,248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[347,350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[347,350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1234,1237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1234,1237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1279,1282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1279,1282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1559,1562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1559,1562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3027,3030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3027,3030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n// Get all roles and their permissions\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    // Only users with manage-users permission can access\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.MANAGE_USERS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    // Get all role permissions\r\n    const rolePermissions = await prisma.rolePermission.findMany({\r\n      orderBy: { role: \"asc\" },\r\n    });\r\n\r\n    console.log(\"📊 ALL Role Permissions from DB:\", rolePermissions);\r\n\r\n    // Group by role\r\n    const roles = [\"ADMIN\", \"ACCOUNTANT\", \"VIEWER\"].map((role: string) => {\r\n      const perms = rolePermissions\r\n        .filter((rp: any) => rp.role === role)\r\n        .map((rp: any) => rp.permission);\r\n      \r\n      console.log(`📌 ${role} permissions:`, perms);\r\n      \r\n      return {\r\n        role,\r\n        permissions: perms,\r\n      };\r\n    });\r\n\r\n    console.log(\"✅ Final response:\", roles);\r\n\r\n    return NextResponse.json(roles);\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching roles:\", error);\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// Save role permissions\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    // Only users with manage-users permission can modify\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.MANAGE_USERS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { role, permissions } = body;\r\n\r\n    if (!role || !Array.isArray(permissions)) {\r\n      return NextResponse.json(\r\n        { error: \"Role and permissions array required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Delete existing permissions for this role\r\n    await prisma.rolePermission.deleteMany({\r\n      where: { role },\r\n    });\r\n\r\n    // Create new permissions\r\n    const createdPermissions = await Promise.all(\r\n      permissions.map((permission: string) =>\r\n        prisma.rolePermission.create({\r\n          data: { role, permission },\r\n        })\r\n      )\r\n    );\r\n\r\n    console.log(`✅ Updated ${role} role with ${permissions.length} permissions`);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      role,\r\n      permissions: createdPermissions,\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Error updating role:\", error);\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\admin\\user-permissions\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[237,240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[237,240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[339,342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[339,342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2297,2300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2297,2300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { requirePermission } from \"@/lib/requirePermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n/* =========================\r\n   GET → list users + perms\r\n========================= */\r\nexport async function GET(req: Request) {\r\n  // پہلے چیک کریں کہ کیا بھیجنے والا ADMIN ہیڈر کے ساتھ آ رہا ہے\r\n  const role = req.headers.get(\"x-user-role\");\r\n  \r\n  // اگر ایڈمن نہیں ہے، تب پرمیشن چیک کرو\r\n  if (role !== \"ADMIN\") {\r\n    const guard = await requirePermission(req, PERMISSIONS.MANAGE_USERS);\r\n    if (guard) return guard;\r\n  }\r\n\r\n  const users = await prisma.user.findMany({\r\n    include: {\r\n      permissions: true,\r\n    },\r\n    orderBy: { name: \"asc\" },\r\n  });\r\n\r\n  return NextResponse.json(users);\r\n}\r\n\r\n/* =========================\r\n   POST → update permissions\r\n========================= */\r\nexport async function POST(req: Request) {\r\n  const role = req.headers.get(\"x-user-role\");\r\n\r\n  // ایڈمن کے لیے چھوٹ، باقیوں کے لیے پرمیشن لازمی\r\n  if (role !== \"ADMIN\") {\r\n    const guard = await requirePermission(req, PERMISSIONS.MANAGE_USERS);\r\n    if (guard) return guard;\r\n  }\r\n\r\n  const { userId, permissions } = await req.json();\r\n\r\n  if (!userId || !Array.isArray(permissions)) {\r\n    return NextResponse.json(\r\n      { error: \"Invalid data\" },\r\n      { status: 400 }\r\n    );\r\n  }\r\n\r\n  try {\r\n    await prisma.$transaction([\r\n      // 🔥 پچھلی تمام پرمیشنز مٹائیں\r\n      prisma.userPermission.deleteMany({\r\n        where: { userId },\r\n      }),\r\n\r\n      // 🔥 نئی پرمیشنز ڈالیں\r\n      prisma.userPermission.createMany({\r\n        data: permissions.map((p: string) => ({\r\n          userId,\r\n          permission: p,\r\n        })),\r\n      }),\r\n\r\n      // 🔥 ایکٹیویٹی لاگ بنائیں\r\n      prisma.activityLog.create({\r\n        data: {\r\n          action: \"PERMISSIONS_UPDATED\",\r\n          details: `Updated permissions for user ${userId}`,\r\n          userId: userId, // یہاں وہ یوزر آئی ڈی دیں جس نے چینج کیا یا جس کی چینج ہوئی\r\n        },\r\n      }),\r\n    ]);\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error: any) {\r\n    console.error(\"TRANSACTION ERROR:\", error);\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\advance-payment\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\advance\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[444,447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[444,447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[687,690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[687,690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1921,1924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1921,1924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2568,2571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2568,2571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { requireRole } from \"@/lib/requireRole\";\n\n// GET: Fetch advances\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const employeeId = searchParams.get(\"employeeId\");\n    const status = searchParams.get(\"status\");\n    const monthYear = searchParams.get(\"monthYear\"); \n\n    const where: any = {};\n    if (employeeId) where.employeeId = employeeId;\n    if (status) where.status = status;\n    \n    if (monthYear) {\n      where.OR = [\n        { monthYear: monthYear },\n        { monthYear: null }\n      ];\n    }\n\n    if (!(prisma as any).advanceSalary) {\n        console.error(\"❌ Prisma Client out of sync. advanceSalary model missing.\");\n        return NextResponse.json({ error: \"System update required. Please restart the server.\" }, { status: 500 });\n    }\n\n    const advances = await prisma.advanceSalary.findMany({\n      where,\n      include: { employee: { select: { firstName: true, lastName: true } } },\n      orderBy: { date: \"desc\" },\n    });\n\n    return NextResponse.json(advances);\n  } catch (error) {\n    console.error(\"Error fetching advances:\", error);\n    return NextResponse.json({ error: \"Failed to fetch advances\" }, { status: 500 });\n  }\n}\n\n// POST: Give Advance\nexport async function POST(req: NextRequest) {\n  console.log(\"💰 POST /api/advance called\");\n  \n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\n  if (guard) {\n    console.log(\"⛔ Role check failed\");\n    return guard;\n  }\n\n  try {\n    const body = await req.json();\n    console.log(\"📥 Payload:\", body);\n    \n    const { employeeId, amount, date, monthYear, remarks } = body;\n\n    if (!employeeId || !amount || !date) {\n      console.log(\"⚠️ Missing fields\");\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 });\n    }\n\n    if (!(prisma as any).advanceSalary) {\n       console.error(\"❌ Prisma Client out of sync. advanceSalary model missing.\");\n       return NextResponse.json({ error: \"System update required. Please restart the server to apply changes.\" }, { status: 500 });\n    }\n\n    console.log(\"💾 Saving to DB...\");\n    const advance = await prisma.advanceSalary.create({\n      data: {\n        employeeId,\n        amount: Number(amount),\n        date: new Date(date),\n        monthYear: monthYear || null,\n        remarks,\n        status: \"PENDING\",\n      },\n    });\n\n    console.log(\"✅ Saved:\", advance);\n    return NextResponse.json(advance, { status: 201 });\n  } catch (error: any) {\n    console.error(\"❌ Error creating advance:\", error);\n    return NextResponse.json({ error: \"Failed to create advance: \" + error.message }, { status: 500 });\n  }\n}\n\n// DELETE: Delete/Cancel Advance\nexport async function DELETE(req: NextRequest) {\n  const guard = requireRole(req, [\"ADMIN\"]);\n  if (guard) return guard;\n\n  try {\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\n    }\n\n    await prisma.advanceSalary.delete({\n      where: { id },\n    });\n\n    return NextResponse.json({ message: \"Advance record deleted successfully\" });\n  } catch (error) {\n    console.error(\"Error deleting advance:\", error);\n    return NextResponse.json({ error: \"Failed to delete advance\" }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\ageing\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[162,165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[162,165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[264,267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[264,267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[935,938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[935,938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1064,1067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1064,1067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\n// ✅ Prisma singleton (dev safe)\r\nconst prisma =\r\n  (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    // ✅ ROLE FROM HEADER\r\n    const role = req.headers.get(\"x-user-role\");\r\n\r\n    // ✅ REPORTS ACCESS: ADMIN + ACCOUNTANT\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json(\r\n        { error: \"Forbidden\" },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // ================= DATA =================\r\n    const parties = await prisma.account.findMany({\r\n      where: {\r\n        partyType: { not: null },\r\n      },\r\n    });\r\n\r\n    const vouchers = await prisma.voucher.findMany();\r\n\r\n    const today = new Date();\r\n\r\n    const result = parties.map((party: any) => {\r\n      let b0_30 = 0;\r\n      let b31_60 = 0;\r\n      let b61_90 = 0;\r\n      let b90p = 0;\r\n\r\n      vouchers.forEach((v: any) => {\r\n        if (v.accountId !== party.id) return;\r\n\r\n        const days =\r\n          (today.getTime() - new Date(v.date).getTime()) /\r\n          (1000 * 60 * 60 * 24);\r\n\r\n        let amount = 0;\r\n\r\n        // CUSTOMER RECEIVABLE\r\n        if (party.partyType === \"CUSTOMER\" && v.type === \"CRV\") {\r\n          amount = -v.amount;\r\n        }\r\n\r\n        // SUPPLIER PAYABLE\r\n        if (party.partyType === \"SUPPLIER\" && v.type === \"CPV\") {\r\n          amount = v.amount;\r\n        }\r\n\r\n        if (days <= 30) b0_30 += amount;\r\n        else if (days <= 60) b31_60 += amount;\r\n        else if (days <= 90) b61_90 += amount;\r\n        else b90p += amount;\r\n      });\r\n\r\n      return {\r\n        name: party.name,\r\n        partyType: party.partyType,\r\n        \"0_30\": b0_30,\r\n        \"31_60\": b31_60,\r\n        \"61_90\": b61_90,\r\n        \"90p\": b90p,\r\n      };\r\n    });\r\n\r\n    return NextResponse.json(result);\r\n  } catch (err) {\r\n    console.error(\"❌ AGEING REPORT ERROR:\", err);\r\n    return NextResponse.json(\r\n      { error: \"Failed to load ageing report\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\attendance\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[471,474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[471,474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2989,2992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2989,2992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'date' is assigned a value but never used.","line":121,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":121,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3849,3852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3849,3852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6075,6078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6075,6078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatPakTime' is defined but never used.","line":191,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":191,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7211,7214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7211,7214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { requireRole } from \"@/lib/requireRole\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\n// GET: Fetch attendance records\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const employeeId = searchParams.get(\"employeeId\");\r\n    const month = searchParams.get(\"month\"); // YYYY-MM\r\n    const status = searchParams.get(\"status\");\r\n\r\n    let dateFilter: any = {};\r\n    if (month) {\r\n      const [year, monthNum] = month.split(\"-\").map(Number);\r\n      const startDate = new Date(year, monthNum - 1, 1);\r\n      const endDate = new Date(year, monthNum, 0);\r\n      dateFilter = { gte: startDate, lte: endDate };\r\n    }\r\n\r\n    const attendance = await prisma.attendance.findMany({\r\n      where: {\r\n        employeeId: employeeId || undefined,\r\n        date: Object.keys(dateFilter).length ? dateFilter : undefined,\r\n        status: status || undefined,\r\n      },\r\n      include: { employee: { select: { firstName: true, lastName: true } } },\r\n      orderBy: { date: \"desc\" },\r\n    });\r\n\r\n    return NextResponse.json(attendance);\r\n  } catch (error) {\r\n    console.error(\"Error fetching attendance:\", error);\r\n    return NextResponse.json({ error: \"Failed to fetch attendance\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST: Mark attendance\r\nexport async function POST(req: NextRequest) {\r\n  // Debugging logs\r\n  console.log(\"📝 POST /api/attendance called\");\r\n  console.log(\"Headers:\", Object.fromEntries(req.headers));\r\n\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) {\r\n    console.log(\"❌ Forbidden by requireRole\");\r\n    return guard;\r\n  }\r\n\r\n  try {\r\n    const body = await req.json();\r\n    const { employeeId, date, status, checkIn, checkOut, remarks } = body;\r\n\r\n    if (!employeeId || !date || !status) {\r\n      return NextResponse.json(\r\n        { error: \"employeeId, date, and status are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const baseDate = new Date(date);\r\n\r\n    let checkInDateTime: Date | null = null;\r\n    if (checkIn) {\r\n      const [h, m] = checkIn.split(\":\").map((v: string) => parseInt(v, 10));\r\n      if (!Number.isNaN(h)) {\r\n        const d = new Date(baseDate);\r\n        d.setHours(h, Number.isNaN(m) ? 0 : m, 0, 0);\r\n        checkInDateTime = d;\r\n      }\r\n    }\r\n\r\n    let checkOutDateTime: Date | null = null;\r\n    if (checkOut) {\r\n      const [h, m] = checkOut.split(\":\").map((v: string) => parseInt(v, 10));\r\n      if (!Number.isNaN(h)) {\r\n        const d = new Date(baseDate);\r\n        d.setHours(h, Number.isNaN(m) ? 0 : m, 0, 0);\r\n        checkOutDateTime = d;\r\n      }\r\n    }\r\n\r\n    const attendance = await prisma.attendance.create({\r\n      data: {\r\n        employeeId,\r\n        date: baseDate,\r\n        status,\r\n        checkIn: checkInDateTime,\r\n        checkOut: checkOutDateTime,\r\n        remarks,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(attendance, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2002\") {\r\n      return NextResponse.json(\r\n        { error: \"Attendance record for this date already exists\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error(\"Error marking attendance:\", error);\r\n    return NextResponse.json({ error: \"Failed to mark attendance\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// PUT: Update attendance\r\nexport async function PUT(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { status, checkIn, checkOut, remarks, date } = body; // Extract relevant fields\r\n\r\n    const updateData: any = {\r\n      status,\r\n      remarks,\r\n    };\r\n\r\n    // If date is provided (though usually not changed in update), ensure it's a Date object\r\n    // But typically we don't update date. We use date to construct time.\r\n    // Let's assume we use the existing record's date or the passed date.\r\n    // Ideally, we should fetch the existing record to get the base date if not provided, \r\n    // but frontend should probably send the date.\r\n    \r\n    // Simplification: We will just parse checkIn/checkOut if provided string.\r\n    // We need a base date. If the user updates checkIn/checkOut, they are sending time strings (HH:mm).\r\n    // We need to combine them with the record's date.\r\n    \r\n    // To be safe and consistent with POST, let's assume body might contain full ISO strings or we need to reconstruct.\r\n    // However, the frontend sends \"HH:mm\".\r\n    // We need the Date of the record to set the correct Day/Month/Year for the Time.\r\n    \r\n    // Let's fetch the existing record first to get the base date.\r\n    const existingRecord = await prisma.attendance.findUnique({ where: { id } });\r\n    if (!existingRecord) {\r\n        return NextResponse.json({ error: \"Record not found\" }, { status: 404 });\r\n    }\r\n\r\n    const baseDate = new Date(existingRecord.date);\r\n\r\n    if (checkIn !== undefined) {\r\n      if (!checkIn) {\r\n        updateData.checkIn = null;\r\n      } else {\r\n        const [h, m] = checkIn.split(\":\").map((v: string) => parseInt(v, 10));\r\n        if (!Number.isNaN(h)) {\r\n          const d = new Date(baseDate);\r\n          d.setHours(h, Number.isNaN(m) ? 0 : m, 0, 0);\r\n          updateData.checkIn = d;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (checkOut !== undefined) {\r\n      if (!checkOut) {\r\n        updateData.checkOut = null;\r\n      } else {\r\n        const [h, m] = checkOut.split(\":\").map((v: string) => parseInt(v, 10));\r\n        if (!Number.isNaN(h)) {\r\n          const d = new Date(baseDate);\r\n          d.setHours(h, Number.isNaN(m) ? 0 : m, 0, 0);\r\n          updateData.checkOut = d;\r\n        }\r\n      }\r\n    }\r\n\r\n    const attendance = await prisma.attendance.update({\r\n      where: { id },\r\n      data: updateData,\r\n    });\r\n\r\n    return NextResponse.json(attendance);\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Attendance record not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error updating attendance:\", error);\r\n    return NextResponse.json({ error: \"Failed to update attendance\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nfunction formatPakTime(dateString?: string | Date | null) {\r\n  if (!dateString) return \"--\";\r\n  const d = new Date(dateString);\r\n  if (isNaN(d.getTime())) return \"--\";\r\n\r\n  return d.toLocaleTimeString(\"en-PK\", {\r\n    hour: \"2-digit\",\r\n    minute: \"2-digit\",\r\n    hour12: true,\r\n  });\r\n}\r\n\r\n\r\n\r\n\r\n// DELETE: Delete attendance record\r\nexport async function DELETE(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    await prisma.attendance.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ message: \"Attendance record deleted successfully\" });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Attendance record not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error deleting attendance:\", error);\r\n    return NextResponse.json({ error: \"Failed to delete attendance\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\backup\\restore\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'apiHasPermission' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":26,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"apiHasPermission"},"fix":{"range":[106,161],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PERMISSIONS' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":21,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"PERMISSIONS"},"fix":{"range":[163,211],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[286,289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[286,289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[388,391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[388,391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is assigned a value but never used.","line":15,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1359,1362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1359,1362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1636,1639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1636,1639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3941,3944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3941,3944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4307,4310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4307,4310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4706,4709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4706,4709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5090,5093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5090,5093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":168,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5545,5548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5545,5548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5973,5976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5973,5976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6759,6762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6759,6762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6922,6925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6922,6925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7728,7731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7728,7731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7894,7897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7894,7897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8667,8670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8667,8670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8825,8828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8825,8828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9126,9129],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9126,9129],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":273,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9326,9329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9326,9329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\nimport { readFile } from \"fs/promises\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    // صرف ADMIN restore کر سکتا ہے\r\n    if (userRole !== \"ADMIN\") {\r\n      return NextResponse.json({ error: \"Forbidden - Admin only\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { backupId } = body;\r\n\r\n    if (!backupId) {\r\n      return NextResponse.json(\r\n        { error: \"Backup ID required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get backup record\r\n    const backup = await prisma.systemBackup.findUnique({\r\n      where: { id: backupId },\r\n    });\r\n\r\n    if (!backup || !backup.filePath) {\r\n      return NextResponse.json({ error: \"Backup not found\" }, { status: 404 });\r\n    }\r\n\r\n    // Read backup file\r\n    let backupData: string;\r\n    try {\r\n      backupData = await readFile(backup.filePath, \"utf-8\");\r\n    } catch (err: any) {\r\n      console.error(\"File read error:\", err);\r\n      return NextResponse.json(\r\n        { error: `Cannot read backup file: ${err.message}` },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    let data;\r\n    try {\r\n      data = JSON.parse(backupData);\r\n    } catch (err: any) {\r\n      return NextResponse.json(\r\n        { error: `Invalid backup file format: ${err.message}` },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    console.log(\"Backup data loaded:\", {\r\n      hasAccounts: !!data.accounts,\r\n      hasItems: !!data.items,\r\n      hasVouchers: !!data.vouchers,\r\n    });\r\n\r\n    // Clear all data and restore from backup\r\n    try {\r\n      console.log(\"Starting data deletion...\");\r\n      \r\n      // Delete in correct order (respecting foreign keys)\r\n      // Delete records that depend on others FIRST\r\n      await prisma.voucherEntry.deleteMany({});\r\n      console.log(\"Deleted VoucherEntries\");\r\n      \r\n      await prisma.voucher.deleteMany({});\r\n      console.log(\"Deleted Vouchers\");\r\n      \r\n      await prisma.salesInvoiceItem.deleteMany({});\r\n      console.log(\"Deleted SalesInvoiceItems\");\r\n      \r\n      await prisma.salesInvoice.deleteMany({});\r\n      console.log(\"Deleted SalesInvoices\");\r\n      \r\n      await prisma.purchaseInvoiceItem.deleteMany({});\r\n      console.log(\"Deleted PurchaseInvoiceItems\");\r\n      \r\n      await prisma.purchaseInvoice.deleteMany({});\r\n      console.log(\"Deleted PurchaseInvoices\");\r\n      \r\n      await prisma.recurringTransaction.deleteMany({});\r\n      console.log(\"Deleted RecurringTransactions\");\r\n      \r\n      await prisma.budget.deleteMany({});\r\n      console.log(\"Deleted Budgets\");\r\n\r\n      // BankStatement and BankReconciliation depend on BankAccount\r\n      await prisma.bankStatement.deleteMany({});\r\n      console.log(\"Deleted BankStatements\");\r\n      \r\n      await prisma.bankReconciliation.deleteMany({});\r\n      console.log(\"Deleted BankReconciliations\");\r\n      \r\n      await prisma.bankAccount.deleteMany({});\r\n      console.log(\"Deleted BankAccounts\");\r\n      \r\n      await prisma.itemNew.deleteMany({});\r\n      console.log(\"Deleted Items\");\r\n      \r\n      await prisma.account.deleteMany({});\r\n      console.log(\"Deleted Accounts\");\r\n\r\n      console.log(\"Starting data restoration...\");\r\n\r\n      // Restore data in correct order\r\n      if (data.accounts && Array.isArray(data.accounts)) {\r\n        console.log(`Restoring ${data.accounts.length} accounts...`);\r\n        for (const account of data.accounts) {\r\n          try {\r\n            await prisma.account.create({ data: account });\r\n          } catch (e: any) {\r\n            console.warn(\"Error creating account:\", e.message);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (data.items && Array.isArray(data.items)) {\r\n        console.log(`Restoring ${data.items.length} items...`);\r\n        for (const item of data.items) {\r\n          try {\r\n            await prisma.itemNew.create({ data: item });\r\n          } catch (e: any) {\r\n            console.warn(\"Error creating item:\", e.message);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (data.bankAccounts && Array.isArray(data.bankAccounts)) {\r\n        console.log(`Restoring ${data.bankAccounts.length} bank accounts...`);\r\n        for (const ba of data.bankAccounts) {\r\n          try {\r\n            await prisma.bankAccount.create({ data: ba });\r\n          } catch (e: any) {\r\n            console.warn(\"Error creating bank account:\", e.message);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (data.budgets && Array.isArray(data.budgets)) {\r\n        console.log(`Restoring ${data.budgets.length} budgets...`);\r\n        for (const budget of data.budgets) {\r\n          try {\r\n            await prisma.budget.create({ data: budget });\r\n          } catch (e: any) {\r\n            console.warn(\"Error creating budget:\", e.message);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (data.recurringTransactions && Array.isArray(data.recurringTransactions)) {\r\n        console.log(`Restoring ${data.recurringTransactions.length} recurring transactions...`);\r\n        for (const rt of data.recurringTransactions) {\r\n          try {\r\n            await prisma.recurringTransaction.create({ data: rt });\r\n          } catch (e: any) {\r\n            console.warn(\"Error creating recurring transaction:\", e.message);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (data.financialYears && Array.isArray(data.financialYears)) {\r\n        console.log(`Restoring ${data.financialYears.length} financial years...`);\r\n        for (const fy of data.financialYears) {\r\n          try {\r\n            await prisma.financialYear.create({ data: fy });\r\n          } catch (e: any) {\r\n            console.warn(\"Error creating financial year:\", e.message);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (data.salesInvoices && Array.isArray(data.salesInvoices)) {\r\n        console.log(`Restoring ${data.salesInvoices.length} sales invoices...`);\r\n        for (const si of data.salesInvoices) {\r\n          try {\r\n            const { items, ...invoiceData } = si;\r\n            const created = await prisma.salesInvoice.create({\r\n              data: invoiceData,\r\n            });\r\n            if (items && Array.isArray(items)) {\r\n              for (const item of items) {\r\n                try {\r\n                  await prisma.salesInvoiceItem.create({\r\n                    data: { ...item, invoiceId: created.id },\r\n                  });\r\n                } catch (e: any) {\r\n                  console.warn(\"Error creating sales invoice item:\", e.message);\r\n                }\r\n              }\r\n            }\r\n          } catch (e: any) {\r\n            console.warn(\"Error creating sales invoice:\", e.message);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (data.purchaseInvoices && Array.isArray(data.purchaseInvoices)) {\r\n        console.log(`Restoring ${data.purchaseInvoices.length} purchase invoices...`);\r\n        for (const pi of data.purchaseInvoices) {\r\n          try {\r\n            const { items, ...invoiceData } = pi;\r\n            const created = await prisma.purchaseInvoice.create({\r\n              data: invoiceData,\r\n            });\r\n            if (items && Array.isArray(items)) {\r\n              for (const item of items) {\r\n                try {\r\n                  await prisma.purchaseInvoiceItem.create({\r\n                    data: { ...item, invoiceId: created.id },\r\n                  });\r\n                } catch (e: any) {\r\n                  console.warn(\"Error creating purchase invoice item:\", e.message);\r\n                }\r\n              }\r\n            }\r\n          } catch (e: any) {\r\n            console.warn(\"Error creating purchase invoice:\", e.message);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (data.vouchers && Array.isArray(data.vouchers)) {\r\n        console.log(`Restoring ${data.vouchers.length} vouchers...`);\r\n        for (const voucher of data.vouchers) {\r\n          try {\r\n            const { entries, ...voucherData } = voucher;\r\n            const created = await prisma.voucher.create({\r\n              data: voucherData,\r\n            });\r\n            if (entries && Array.isArray(entries)) {\r\n              for (const entry of entries) {\r\n                try {\r\n                  await prisma.voucherEntry.create({\r\n                    data: { ...entry, voucherId: created.id },\r\n                  });\r\n                } catch (e: any) {\r\n                  console.warn(\"Error creating voucher entry:\", e.message);\r\n                }\r\n              }\r\n            }\r\n          } catch (e: any) {\r\n            console.warn(\"Error creating voucher:\", e.message);\r\n          }\r\n        }\r\n      }\r\n\r\n      console.log(\"Restore completed successfully\");\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: \"Data restored successfully\",\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Restore error:\", error);\r\n      return NextResponse.json(\r\n        { error: `Restore failed: ${error.message}` },\r\n        { status: 500 }\r\n      );\r\n    }\r\n  } catch (e: any) {\r\n    console.error(\"Restore Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\backup\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[324,327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[324,327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[426,429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[426,429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is assigned a value but never used.","line":16,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[962,965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[962,965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":91,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":91,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2914,2917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2914,2917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3890,3893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3890,3893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4150,4153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4150,4153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\nimport { writeFile, mkdir } from \"fs/promises\";\r\nimport { join } from \"path\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    // صرف ADMIN backup دیکھ سکتا ہے\r\n    if (userRole !== \"ADMIN\") {\r\n      return NextResponse.json({ error: \"Forbidden - Admin only\" }, { status: 403 });\r\n    }\r\n\r\n    const backups = await prisma.systemBackup.findMany({\r\n      orderBy: { createdAt: \"desc\" },\r\n      take: 50,\r\n    });\r\n\r\n    return NextResponse.json(backups);\r\n  } catch (e: any) {\r\n    console.error(\"Backup GET Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.CREATE_ACCOUNTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { backupType = \"FULL\" } = body;\r\n\r\n    // Create backup record\r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, \"-\");\r\n    const fileName = `backup-${timestamp}.json`;\r\n    const backup = await prisma.systemBackup.create({\r\n      data: {\r\n        fileName,\r\n        backupType,\r\n        status: \"PENDING\",\r\n        createdBy: userId || null,\r\n      },\r\n    });\r\n\r\n    try {\r\n      // Export all data\r\n      const data = {\r\n        accounts: await prisma.account.findMany(),\r\n        items: await prisma.itemNew.findMany(),\r\n        vouchers: await prisma.voucher.findMany({\r\n          include: { entries: true },\r\n        }),\r\n        salesInvoices: await prisma.salesInvoice.findMany({\r\n          include: { items: true },\r\n        }),\r\n        purchaseInvoices: await prisma.purchaseInvoice.findMany({\r\n          include: { items: true },\r\n        }),\r\n        bankAccounts: await prisma.bankAccount.findMany(),\r\n        budgets: await prisma.budget.findMany(),\r\n        recurringTransactions: await prisma.recurringTransaction.findMany(),\r\n        financialYears: await prisma.financialYear.findMany(),\r\n        timestamp: new Date().toISOString(),\r\n      };\r\n\r\n      // Save to file (in production, save to cloud storage)\r\n      const backupDir = join(process.cwd(), \"backups\");\r\n      try {\r\n        await mkdir(backupDir, { recursive: true });\r\n      } catch (e: any) {\r\n        // Directory might already exist\r\n      }\r\n\r\n      const filePath = join(backupDir, fileName);\r\n      await writeFile(filePath, JSON.stringify(data, null, 2));\r\n\r\n      const stats = await import(\"fs\").then((fs) =>\r\n        fs.promises.stat(filePath)\r\n      );\r\n\r\n      // Update backup record\r\n      await prisma.systemBackup.update({\r\n        where: { id: backup.id },\r\n        data: {\r\n          status: \"COMPLETED\",\r\n          filePath,\r\n          fileSize: stats.size,\r\n          metadata: JSON.stringify({\r\n            recordCount: {\r\n              accounts: data.accounts.length,\r\n              items: data.items.length,\r\n              vouchers: data.vouchers.length,\r\n            },\r\n          }),\r\n        },\r\n      });\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        backup: {\r\n          ...backup,\r\n          status: \"COMPLETED\",\r\n          filePath,\r\n          fileSize: stats.size,\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      await prisma.systemBackup.update({\r\n        where: { id: backup.id },\r\n        data: {\r\n          status: \"FAILED\",\r\n          metadata: JSON.stringify({ error: error.message }),\r\n        },\r\n      });\r\n\r\n      throw error;\r\n    }\r\n  } catch (e: any) {\r\n    console.error(\"Backup POST Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\bank-accounts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":10,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1037,1040],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1037,1040],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // Get banks from BankAccount table (with full details)\r\n    const bankAccountsFromTable = await prisma.bankAccount.findMany({\r\n      include: {\r\n        account: true,\r\n        statements: true,\r\n        reconciliations: { orderBy: { reconcileDate: 'desc' }, take: 1 },\r\n      },\r\n    });\r\n\r\n    // Get banks from Account table (partyType = \"BANKS\") jo BankAccount table mein nahi hain\r\n    const allBankAccounts = await prisma.account.findMany({\r\n      where: { partyType: \"BANKS\" },\r\n      include: {\r\n        bankAccounts: true,\r\n      },\r\n    });\r\n\r\n    // Combine both: BankAccount table se + Account table se (jo BankAccount mein nahi hain)\r\n    const combinedAccounts = bankAccountsFromTable.map((ba: any) => ({\r\n      id: ba.id,\r\n      accountNo: ba.accountNo,\r\n      bankName: ba.bankName,\r\n      accountName: ba.accountName,\r\n      balance: ba.balance,\r\n      accountId: ba.accountId,\r\n      account: ba.account,\r\n      statements: ba.statements,\r\n      reconciliations: ba.reconciliations,\r\n      source: 'BankAccount', // Track source\r\n    }));\r\n\r\n    // Add accounts from Account table that don't have BankAccount entry\r\n    for (const acc of allBankAccounts) {\r\n      if (!acc.bankAccounts || acc.bankAccounts.length === 0) {\r\n        // Extract bank name and account number\r\n        const nameParts = acc.name.split(\" - \");\r\n        const bankName = nameParts[0] || acc.name;\r\n        const accountNo = nameParts[1] || acc.code;\r\n\r\n        combinedAccounts.push({\r\n          id: acc.id, // Use account ID as temporary ID\r\n          accountNo: accountNo,\r\n          bankName: bankName,\r\n          accountName: acc.name,\r\n          balance: acc.openDebit || 0,\r\n          accountId: acc.id,\r\n          account: acc,\r\n          statements: [],\r\n          reconciliations: [],\r\n          source: 'Account', // Track source\r\n        });\r\n      }\r\n    }\r\n\r\n    return NextResponse.json(combinedAccounts);\r\n  } catch (error) {\r\n    console.error('Error fetching bank accounts:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch bank accounts' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { accountNo, bankName, accountName, balance } = body;\r\n\r\n    // Validation\r\n    if (!accountNo || !bankName || !accountName) {\r\n      return NextResponse.json(\r\n        { error: 'Bank Name, Account No, and Account Name are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if account number already exists\r\n    const existingBank = await prisma.bankAccount.findFirst({\r\n      where: { accountNo },\r\n    });\r\n\r\n    if (existingBank) {\r\n      return NextResponse.json(\r\n        { error: 'Bank account number already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // First create or find the parent Account in Ledger\r\n    let account = await prisma.account.findFirst({\r\n      where: { name: `${bankName} - ${accountNo}` },\r\n    });\r\n\r\n    if (!account) {\r\n      // Generate unique code for bank (e.g., BNK-0001, BNK-0002)\r\n      const bankCount = await prisma.account.count({\r\n        where: { type: 'BANK' },\r\n      });\r\n      const bankCode = `BNK-${String(bankCount + 1).padStart(4, '0')}`;\r\n\r\n      account = await prisma.account.create({\r\n        data: {\r\n          code: bankCode,\r\n          name: `${bankName} - ${accountNo}`,\r\n          type: 'BANK',\r\n          partyType: 'BANKS', // 🔥 یہ ledger میں show ہوگا\r\n          openDebit: balance || 0, // شروعاتی balance\r\n        },\r\n      });\r\n    } else {\r\n      // Update existing account to ensure partyType is BANKS\r\n      account = await prisma.account.update({\r\n        where: { id: account.id },\r\n        data: {\r\n          partyType: 'BANKS',\r\n          openDebit: balance || 0,\r\n        },\r\n      });\r\n    }\r\n\r\n    // Now create the BankAccount in BankAccount table\r\n    const bankAccount = await prisma.bankAccount.create({\r\n      data: {\r\n        accountNo,\r\n        bankName,\r\n        accountName,\r\n        accountId: account.id,\r\n        balance: balance || 0,\r\n      },\r\n      include: { account: true },\r\n    });\r\n\r\n    return NextResponse.json(bankAccount, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Error creating bank account:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to create bank account: ' + (error as Error).message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { id, accountNo, bankName, accountName, balance } = body;\r\n\r\n    // Get the bank account first\r\n    const bankAccount = await prisma.bankAccount.findUnique({\r\n      where: { id },\r\n      include: { account: true },\r\n    });\r\n\r\n    if (!bankAccount) {\r\n      return NextResponse.json(\r\n        { error: 'Bank account not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Update the BankAccount\r\n    const updated = await prisma.bankAccount.update({\r\n      where: { id },\r\n      data: {\r\n        ...(accountNo && { accountNo }),\r\n        ...(bankName && { bankName }),\r\n        ...(accountName && { accountName }),\r\n        ...(balance !== undefined && { balance }),\r\n      },\r\n      include: { account: true },\r\n    });\r\n\r\n    // Also update the linked Account in ledger\r\n    if (bankAccount.accountId) {\r\n      await prisma.account.update({\r\n        where: { id: bankAccount.accountId },\r\n        data: {\r\n          ...(bankName && accountNo && { name: `${bankName} - ${accountNo}` }),\r\n          ...(balance !== undefined && { openDebit: balance }),\r\n        },\r\n      });\r\n    }\r\n\r\n    return NextResponse.json(updated);\r\n  } catch (error) {\r\n    console.error('Error updating bank account:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to update bank account' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get('id');\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { error: 'ID required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if bank account has statements or reconciliations\r\n    const hasStatements = await prisma.bankStatement.findFirst({\r\n      where: { bankAccountId: id },\r\n    });\r\n    const hasReconciliations = await prisma.bankReconciliation.findFirst({\r\n      where: { bankAccountId: id },\r\n    });\r\n\r\n    if (hasStatements || hasReconciliations) {\r\n      return NextResponse.json(\r\n        { error: 'Cannot delete: Bank account has transactions' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await prisma.bankAccount.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error('Error deleting bank account:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to delete bank account' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\bank-reconciliation\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const bankAccountId = searchParams.get('bankAccountId');\r\n\r\n    if (bankAccountId) {\r\n      const reconciliation = await prisma.bankReconciliation.findMany({\r\n        where: { bankAccountId },\r\n        include: {\r\n          bankAccount: true,\r\n          statements: true,\r\n        },\r\n        orderBy: { reconcileDate: 'desc' },\r\n      });\r\n      return NextResponse.json(reconciliation);\r\n    }\r\n\r\n    const allReconciliations = await prisma.bankReconciliation.findMany({\r\n      include: {\r\n        bankAccount: true,\r\n        statements: true,\r\n      },\r\n      orderBy: { reconcileDate: 'desc' },\r\n    });\r\n\r\n    return NextResponse.json(allReconciliations);\r\n  } catch (error) {\r\n    console.error('Error fetching reconciliations:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch reconciliations' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const {\r\n      bankAccountId,\r\n      reconcileDate,\r\n      systemBalance,\r\n      bankBalance,\r\n      statementIds,\r\n      narration,\r\n    } = body;\r\n\r\n    const difference = Math.abs(systemBalance - bankBalance);\r\n\r\n    const reconciliation = await prisma.bankReconciliation.create({\r\n      data: {\r\n        bankAccountId,\r\n        reconcileDate: new Date(reconcileDate),\r\n        systemBalance,\r\n        bankBalance,\r\n        difference,\r\n        narration,\r\n        statements: {\r\n          connect: statementIds?.map((id: string) => ({ id })) || [],\r\n        },\r\n      },\r\n      include: {\r\n        bankAccount: true,\r\n        statements: true,\r\n      },\r\n    });\r\n\r\n    // Update bank statements as reconciled\r\n    if (statementIds && statementIds.length > 0) {\r\n      await prisma.bankStatement.updateMany({\r\n        where: { id: { in: statementIds } },\r\n        data: { isReconciled: true },\r\n      });\r\n    }\r\n\r\n    return NextResponse.json(reconciliation, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Error creating reconciliation:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to create reconciliation' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\bank-statements\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[514,517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[514,517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const bankAccountId = searchParams.get('bankAccountId');\r\n    const isReconciled = searchParams.get('isReconciled');\r\n\r\n    const filter: any = {};\r\n    if (bankAccountId) filter.bankAccountId = bankAccountId;\r\n    if (isReconciled !== null) filter.isReconciled = isReconciled === 'true';\r\n\r\n    const statements = await prisma.bankStatement.findMany({\r\n      where: filter,\r\n      include: { bankAccount: true },\r\n      orderBy: { date: 'desc' },\r\n    });\r\n\r\n    return NextResponse.json(statements);\r\n  } catch (error) {\r\n    console.error('Error fetching bank statements:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch bank statements' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const {\r\n      bankAccountId,\r\n      statementNo,\r\n      date,\r\n      amount,\r\n      description,\r\n      referenceNo,\r\n    } = body;\r\n\r\n    const statement = await prisma.bankStatement.create({\r\n      data: {\r\n        bankAccountId,\r\n        statementNo,\r\n        date: new Date(date),\r\n        amount,\r\n        description,\r\n        referenceNo,\r\n      },\r\n      include: { bankAccount: true },\r\n    });\r\n\r\n    return NextResponse.json(statement, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Error creating bank statement:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to create bank statement' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { id, ...updateData } = body;\r\n\r\n    if (updateData.date) {\r\n      updateData.date = new Date(updateData.date);\r\n    }\r\n\r\n    const statement = await prisma.bankStatement.update({\r\n      where: { id },\r\n      data: updateData,\r\n      include: { bankAccount: true },\r\n    });\r\n\r\n    return NextResponse.json(statement);\r\n  } catch (error) {\r\n    console.error('Error updating bank statement:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to update bank statement' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get('id');\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { error: 'Statement ID is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await prisma.bankStatement.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ message: 'Statement deleted successfully' });\r\n  } catch (error) {\r\n    console.error('Error deleting bank statement:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to delete bank statement' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\budget\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[339,342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[339,342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[940,943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[940,943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1365,1368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1365,1368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1855,1858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1855,1858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2238,2241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2238,2241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3673,3676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3673,3676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4475,4478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4475,4478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { PrismaClient } from \"@prisma/client\";\nimport { apiHasPermission } from \"@/lib/apiPermission\";\nimport { PERMISSIONS } from \"@/lib/permissions\";\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\nexport async function GET(req: NextRequest) {\n  try {\n    const userId = req.headers.get(\"x-user-id\");\n    const userRole = req.headers.get(\"x-user-role\");\n\n    const allowed = await apiHasPermission(\n      userId,\n      userRole,\n      PERMISSIONS.VIEW_REPORTS\n    );\n\n    if (!allowed) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const year = searchParams.get(\"year\");\n    const month = searchParams.get(\"month\");\n    const accountId = searchParams.get(\"accountId\");\n\n    const where: any = {};\n    if (year) where.year = parseInt(year);\n    if (month) where.month = parseInt(month);\n    if (accountId) where.accountId = accountId;\n\n    const budgets = await prisma.budget.findMany({\n      where,\n      include: { account: true },\n      orderBy: [{ year: \"desc\" }, { month: \"desc\" }],\n    });\n\n    // Calculate actual vs budget\n    const budgetsWithActual = await Promise.all(\n      budgets.map(async (budget: any) => {\n        const startDate = new Date(budget.year, budget.month ? budget.month - 1 : 0, 1);\n        const endDate = new Date(budget.year, budget.month ? budget.month : 12, 0, 23, 59, 59);\n\n        const entries = await prisma.voucherEntry.findMany({\n          where: {\n            accountId: budget.accountId,\n            voucher: {\n              date: { gte: startDate, lte: endDate },\n            },\n          },\n        });\n\n        const actual = entries.reduce((sum: number, e: any) => sum + (e.amount > 0 ? e.amount : 0), 0);\n        const variance = budget.amount - actual;\n        const variancePercent = budget.amount > 0 ? (variance / budget.amount) * 100 : 0;\n\n        return {\n          ...budget,\n          actual,\n          variance,\n          variancePercent,\n        };\n      })\n    );\n\n    return NextResponse.json(budgetsWithActual);\n  } catch (e: any) {\n    console.error(\"Budget GET Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const userId = req.headers.get(\"x-user-id\");\n    const userRole = req.headers.get(\"x-user-role\");\n\n    const allowed = await apiHasPermission(\n      userId,\n      userRole,\n      PERMISSIONS.CREATE_ACCOUNTS\n    );\n\n    if (!allowed) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const { accountId, year, month, amount, category, description } = body;\n\n    if (!accountId || !year || !amount) {\n      return NextResponse.json(\n        { error: \"Account, year, and amount required\" },\n        { status: 400 }\n      );\n    }\n\n    const budget = await prisma.budget.upsert({\n      where: {\n        accountId_year_month: {\n          accountId,\n          year: parseInt(year),\n          month: month ? parseInt(month) : null,\n        },\n      },\n      update: {\n        amount: parseFloat(amount),\n        category: category || null,\n        description: description || null,\n      },\n      create: {\n        accountId,\n        year: parseInt(year),\n        month: month ? parseInt(month) : null,\n        amount: parseFloat(amount),\n        category: category || null,\n        description: description || null,\n      },\n    });\n\n    return NextResponse.json(budget);\n  } catch (e: any) {\n    console.error(\"Budget POST Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\nexport async function DELETE(req: NextRequest) {\n  try {\n    const userId = req.headers.get(\"x-user-id\");\n    const userRole = req.headers.get(\"x-user-role\");\n\n    const allowed = await apiHasPermission(\n      userId,\n      userRole,\n      PERMISSIONS.CREATE_ACCOUNTS\n    );\n\n    if (!allowed) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"ID required\" }, { status: 400 });\n    }\n\n    await prisma.budget.delete({ where: { id } });\n\n    return NextResponse.json({ success: true });\n  } catch (e: any) {\n    console.error(\"Budget DELETE Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\bulk\\payments\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[245,248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[245,248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[347,350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[347,350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'paymentMode' is assigned a value but never used.","line":42,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2424,2427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2424,2427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2716,2719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2716,2719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n// Bulk payment processing\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.CREATE_ACCOUNTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { payments, date, narration } = body;\r\n\r\n    if (!payments || !Array.isArray(payments) || payments.length === 0) {\r\n      return NextResponse.json(\r\n        { error: \"Payments array required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const results = [];\r\n\r\n    for (const payment of payments) {\r\n      try {\r\n        const { accountId, bankAccountId, paymentMode, amount } = payment;\r\n\r\n        if (!accountId || !amount || !date) {\r\n          results.push({\r\n            accountId,\r\n            status: \"error\",\r\n            error: \"Missing required fields\",\r\n          });\r\n          continue;\r\n        }\r\n\r\n        // Generate voucher number\r\n        const count = await prisma.voucher.count({ where: { type: \"CPV\" } });\r\n        const voucherNo = `CPV-${count + 1}`;\r\n\r\n        // Create voucher\r\n        const voucher = await prisma.voucher.create({\r\n          data: {\r\n            voucherNo,\r\n            type: \"CPV\",\r\n            date: new Date(date),\r\n            narration: narration || `Bulk payment - ${payment.accountId}`,\r\n            entries: {\r\n              create: [\r\n                {\r\n                  accountId,\r\n                  amount: -parseFloat(amount),\r\n                },\r\n                {\r\n                  accountId: bankAccountId || accountId,\r\n                  amount: parseFloat(amount),\r\n                },\r\n              ],\r\n            },\r\n          },\r\n        });\r\n\r\n        results.push({\r\n          accountId,\r\n          voucherNo,\r\n          status: \"success\",\r\n          voucherId: voucher.id,\r\n        });\r\n      } catch (error: any) {\r\n        results.push({\r\n          accountId: payment.accountId,\r\n          status: \"error\",\r\n          error: error.message,\r\n        });\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      processed: results.length,\r\n      results,\r\n    });\r\n  } catch (e: any) {\r\n    console.error(\"Bulk Payments Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\costumers\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[162,165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[162,165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[264,267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[264,267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\n// ✅ Prisma singleton (dev safe)\r\nconst prisma =\r\n  (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    // ✅ ROLE FROM HEADER (SINGLE SOURCE OF TRUTH)\r\n    const role = req.headers.get(\"x-user-role\");\r\n\r\n    // ✅ ALLOW ADMIN + ACCOUNTANT ONLY\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json(\r\n        { error: \"Forbidden\" },\r\n        { status: 403 }\r\n      );\r\n    }\r\n\r\n    // ✅ DATA\r\n    const customers = await prisma.account.findMany({\r\n      where: { partyType: \"CUSTOMER\" },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        phone: true,\r\n      },\r\n      orderBy: { name: \"asc\" },\r\n    });\r\n\r\n    return NextResponse.json(customers);\r\n  } catch (err) {\r\n    console.error(\"❌ CUSTOMERS API ERROR:\", err);\r\n    return NextResponse.json(\r\n      { error: \"Failed to load customers\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\cpv\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[135,138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[135,138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[234,237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[234,237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1137,1140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1137,1140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1193,1196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1193,1196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1262,1265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1262,1265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1824,1827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1824,1827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2274,2277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2274,2277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6300,6303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6300,6303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9306,9309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9306,9309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":374,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12166,12169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12166,12169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":376,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12260,12263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12260,12263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":418,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13489,13492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13489,13492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":448,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":448,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14358,14361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14358,14361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":454,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":454,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14560,14563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14560,14563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { PrismaClient } from \"@prisma/client\";\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\n// GET - List all CPVs\nexport async function GET(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const from = searchParams.get(\"from\");\n    const to = searchParams.get(\"to\");\n\n    const where: any = { type: \"CPV\" };\n    if (from && to) {\n      where.date = {\n        gte: new Date(from + \"T00:00:00\"),\n        lte: new Date(to + \"T23:59:59\"),\n      };\n    }\n\n    const vouchers = await prisma.voucher.findMany({\n      where,\n      include: {\n        entries: {\n          include: {\n            account: true,\n          },\n        },\n      },\n      orderBy: { date: \"desc\" },\n    });\n\n    // Format vouchers with account names\n    const formatted = vouchers.map((v: any) => {\n      const paymentEntry = v.entries.find((e: any) => e.amount < 0);\n      const accountEntry = v.entries.find((e: any) => e.amount > 0);\n      return {\n        id: v.id,\n        voucherNo: v.voucherNo,\n        date: v.date.toISOString().split(\"T\")[0],\n        narration: v.narration,\n        accountName: accountEntry?.account?.name || \"N/A\",\n        accountId: accountEntry?.accountId || \"\",\n        amount: Math.abs(accountEntry?.amount || 0),\n        paymentMode: paymentEntry?.account?.name?.toLowerCase().includes(\"cash\") ? \"CASH\" : \"BANK\",\n        paymentAccountId: paymentEntry?.accountId || \"\",\n      };\n    });\n\n    return NextResponse.json(formatted);\n  } catch (e: any) {\n    console.error(\"CPV GET Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\nexport async function POST(req: Request) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    let requestBody;\n    try {\n      requestBody = await req.json();\n    } catch (parseError: any) {\n      console.error(\"❌ CPV JSON PARSE ERROR:\", parseError);\n      return NextResponse.json(\n        { error: \"Invalid request body\", details: parseError.message },\n        { status: 400 }\n      );\n    }\n\n    const { accountId, bankAccountId, paymentMode, amount, date, narration } = requestBody;\n\n    // Debug logging\n    console.log(\"🔥 CPV REQUEST:\", { accountId, bankAccountId, paymentMode, amount, date, narration });\n\n    // Validate amount properly\n    const amountNum = Number(amount);\n    console.log(\"🔥 AMOUNT PARSED:\", { original: amount, parsed: amountNum, isValid: !isNaN(amountNum) && amountNum > 0 });\n\n    if (!accountId || !date) {\n      return NextResponse.json(\n        { error: \"Account & date required\" },\n        { status: 400 }\n      );\n    }\n\n    if (!amount || amount === \"\" || isNaN(amountNum) || amountNum <= 0) {\n      console.error(\"❌ INVALID AMOUNT:\", { amount, amountNum, isNaN: isNaN(amountNum) });\n      return NextResponse.json(\n        { error: `Valid amount required (must be greater than 0). Received: ${amount}` },\n        { status: 400 }\n      );\n    }\n\n    if (paymentMode === \"BANK\" && !bankAccountId) {\n      return NextResponse.json(\n        { error: \"Bank account required for bank payment\" },\n        { status: 400 }\n      );\n    }\n\n    const account = await prisma.account.findUnique({\n      where: { id: accountId },\n    });\n\n    if (!account || account.partyType === \"CUSTOMER\") {\n      return NextResponse.json(\n        { error: \"CPV sirf Supplier / Bank / Expense ke liye hota hai\" },\n        { status: 400 }\n      );\n    }\n\n    // Find payment account (Cash or Bank)\n    let paymentAccount;\n    let bankAccountRecord = null;\n    if (paymentMode === \"BANK\") {\n      // First find BankAccount record (bankAccountId is BankAccount table ID)\n      bankAccountRecord = await prisma.bankAccount.findUnique({\n        where: { id: bankAccountId },\n        include: { account: true },\n      });\n\n      if (!bankAccountRecord) {\n        // If not found in BankAccount, try to find in Account table\n        const accountFromTable = await prisma.account.findUnique({\n          where: { id: bankAccountId },\n        });\n\n        if (!accountFromTable || accountFromTable.partyType !== \"BANKS\") {\n          return NextResponse.json(\n            { error: \"Bank account not found\" },\n            { status: 400 }\n          );\n        }\n\n        // Create BankAccount entry from Account\n        const nameParts = accountFromTable.name.split(\" - \");\n        const bankName = nameParts[0] || accountFromTable.name;\n        const accountNo = nameParts[1] || accountFromTable.code;\n\n        bankAccountRecord = await prisma.bankAccount.create({\n          data: {\n            accountNo: accountNo,\n            bankName: bankName,\n            accountName: accountFromTable.name,\n            accountId: accountFromTable.id,\n            balance: accountFromTable.openDebit || 0,\n          },\n          include: { account: true },\n        });\n      }\n\n      // Get payment account from BankAccount's linked account\n      paymentAccount = bankAccountRecord.account;\n      if (!paymentAccount) {\n        return NextResponse.json(\n          { error: \"Bank account linked account not found\" },\n          { status: 400 }\n        );\n      }\n    } else {\n      paymentAccount = await prisma.account.findFirst({\n        where: { name: { equals: \"Cash in hand\", mode: \"insensitive\" } },\n      });\n\n      if (!paymentAccount) {\n        return NextResponse.json(\n          { error: \"Cash account not found\" },\n          { status: 400 }\n        );\n      }\n    }\n\n    const count = await prisma.voucher.count({ where: { type: \"CPV\" } });\n    const voucherNo = `CPV-${count + 1}`;\n    const paymentAmount = Math.abs(amountNum); // Use already validated amountNum\n\n    console.log(\"🔥 CREATING CPV:\", { voucherNo, paymentAmount, accountId: account.id, paymentAccountId: paymentAccount.id });\n\n    // Create voucher and update bank balance in transaction\n    const result = await prisma.$transaction(async (tx: any) => {\n      // CPV = Cash Payment Voucher (روپے ادا کرنا)\n      // Supplier/Expense کو روپے دے رہے ہیں\n      //\n      // Ledger میں:\n      // - Supplier/Expense: DEBIT (+) کیونکہ ہمیں ادا کرنا ہے\n      // - Bank/Cash: CREDIT (-) کیونکہ روپے ہم سے نکل رہے ہیں\n      \n      const voucher = await tx.voucher.create({\n        data: {\n          voucherNo,\n          type: \"CPV\",\n          date: new Date(date),\n          narration: narration || `${paymentMode === \"BANK\" ? \"Bank\" : \"Cash\"} payment`,\n          entries: {\n            create: [\n              { accountId: account.id, amount: paymentAmount },        // Supplier/Expense DEBIT (+)\n              { accountId: paymentAccount.id, amount: -paymentAmount }, // Bank/Cash CREDIT (-)\n            ],\n          },\n        },\n      });\n\n      console.log(\"🔥 CPV CREATED:\", { voucherId: voucher.id, voucherNo, entries: voucher.entries });\n\n      // If bank payment, update bank balance and create statement\n      if (paymentMode === \"BANK\" && bankAccountRecord) {\n        // Update bank balance (decrease)\n        await tx.bankAccount.update({\n          where: { id: bankAccountRecord.id },\n          data: {\n            balance: { decrement: paymentAmount },\n          },\n        });\n\n        // Create bank statement\n        await tx.bankStatement.create({\n          data: {\n            bankAccountId: bankAccountRecord.id,\n            statementNo: `STMT-${Date.now()}`,\n            date: new Date(date),\n            amount: -paymentAmount, // Negative for payment\n            description: narration || `Payment to ${account.name}`,\n            referenceNo: voucherNo,\n            isReconciled: false,\n          },\n        });\n      }\n\n      return voucher;\n    });\n\n    // Fetch complete voucher with entries\n    const fullVoucher = await prisma.voucher.findUnique({\n      where: { id: result.id },\n      include: {\n        entries: {\n          include: {\n            account: true,\n          },\n        },\n      },\n    });\n\n    if (!fullVoucher) {\n      console.error(\"❌ CPV: Voucher not found after creation:\", result.id);\n      return NextResponse.json(\n        { error: \"Voucher created but could not be retrieved\" },\n        { status: 500 }\n      );\n    }\n\n    // 🔥 یہ حصہ واٹس ایپ کے لیے ڈیٹا تیار کرتا ہے\n    const responseData = {\n      id: fullVoucher.id,\n      voucherNo: fullVoucher.voucherNo,\n      type: fullVoucher.type,\n      date: fullVoucher.date.toISOString().split('T')[0], // Format date\n      narration: fullVoucher.narration,\n      entries: fullVoucher.entries,\n      accountName: account.name,\n      phone: account.phone,\n      amount: paymentAmount, // Use parsed amount\n      paymentMode: paymentMode || \"CASH\",\n    };\n\n    console.log(\"🔥 CPV RESPONSE:\", { \n      voucherId: responseData.id, \n      voucherNo: responseData.voucherNo,\n      amount: responseData.amount, \n      entries: responseData.entries?.length,\n      hasEntries: !!responseData.entries \n    });\n\n    return NextResponse.json(responseData);\n  } catch (e: any) {\n    console.error(\"❌ CPV ERROR:\", e);\n    console.error(\"❌ CPV ERROR DETAILS:\", {\n      message: e.message,\n      stack: e.stack,\n      code: e.code,\n    });\n    return NextResponse.json(\n      { error: e.message || \"CPV failed\", details: e.code || \"Unknown error\" },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Update CPV\nexport async function PUT(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const { id, accountId, bankAccountId, paymentMode, amount, date, narration } = body;\n\n    if (!id) {\n      return NextResponse.json({ error: \"Voucher ID required\" }, { status: 400 });\n    }\n\n    const amountNum = Number(amount);\n    if (!amount || isNaN(amountNum) || amountNum <= 0) {\n      return NextResponse.json({ error: \"Valid amount required\" }, { status: 400 });\n    }\n\n    const existing = await prisma.voucher.findUnique({\n      where: { id },\n      include: { entries: true },\n    });\n\n    if (!existing || existing.type !== \"CPV\") {\n      return NextResponse.json({ error: \"CPV not found\" }, { status: 404 });\n    }\n\n    const account = await prisma.account.findUnique({ where: { id: accountId } });\n    if (!account) {\n      return NextResponse.json({ error: \"Account not found\" }, { status: 400 });\n    }\n\n    let paymentAccount;\n    let bankAccountRecord = null;\n    if (paymentMode === \"BANK\" && bankAccountId) {\n      bankAccountRecord = await prisma.bankAccount.findUnique({\n        where: { id: bankAccountId },\n        include: { account: true },\n      });\n      if (!bankAccountRecord) {\n        const accountFromTable = await prisma.account.findUnique({\n          where: { id: bankAccountId },\n        });\n        if (accountFromTable && accountFromTable.partyType === \"BANKS\") {\n          const nameParts = accountFromTable.name.split(\" - \");\n          bankAccountRecord = await prisma.bankAccount.create({\n            data: {\n              accountNo: nameParts[1] || accountFromTable.code,\n              bankName: nameParts[0] || accountFromTable.name,\n              accountName: accountFromTable.name,\n              accountId: accountFromTable.id,\n              balance: accountFromTable.openDebit || 0,\n            },\n            include: { account: true },\n          });\n        }\n      }\n      paymentAccount = bankAccountRecord?.account;\n    } else {\n      paymentAccount = await prisma.account.findFirst({\n        where: { name: { equals: \"Cash in hand\", mode: \"insensitive\" } },\n      });\n    }\n\n    if (!paymentAccount) {\n      return NextResponse.json({ error: \"Payment account not found\" }, { status: 400 });\n    }\n\n    const paymentAmount = Math.abs(amountNum);\n    const oldAmount = Math.abs(existing.entries.find((e: any) => e.amount > 0)?.amount || 0);\n\n    const result = await prisma.$transaction(async (tx: any) => {\n      await tx.voucherEntry.deleteMany({ where: { voucherId: id } });\n\n      const voucher = await tx.voucher.update({\n        where: { id },\n        data: {\n          date: new Date(date),\n          narration: narration || `${paymentMode === \"BANK\" ? \"Bank\" : \"Cash\"} payment`,\n          entries: {\n            create: [\n              { accountId: account.id, amount: paymentAmount },\n              { accountId: paymentAccount.id, amount: -paymentAmount },\n            ],\n          },\n        },\n        include: {\n          entries: {\n            include: { account: true },\n          },\n        },\n      });\n\n      if (paymentMode === \"BANK\" && bankAccountRecord) {\n        const balanceDiff = paymentAmount - oldAmount;\n        await tx.bankAccount.update({\n          where: { id: bankAccountRecord.id },\n          data: { balance: { decrement: balanceDiff } },\n        });\n      }\n\n      return voucher;\n    });\n\n    return NextResponse.json({\n      id: result.id,\n      voucherNo: result.voucherNo,\n      date: result.date.toISOString().split(\"T\")[0],\n      narration: result.narration,\n      accountName: account.name,\n      amount: paymentAmount,\n      paymentMode: paymentMode || \"CASH\",\n    });\n  } catch (e: any) {\n    console.error(\"CPV PUT Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// DELETE - Delete CPV\nexport async function DELETE(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"Voucher ID required\" }, { status: 400 });\n    }\n\n    const existing = await prisma.voucher.findUnique({\n      where: { id },\n      include: { entries: true },\n    });\n\n    if (!existing || existing.type !== \"CPV\") {\n      return NextResponse.json({ error: \"CPV not found\" }, { status: 404 });\n    }\n\n    await prisma.$transaction(async (tx: any) => {\n      await tx.voucherEntry.deleteMany({ where: { voucherId: id } });\n      await tx.voucher.delete({ where: { id } });\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (e: any) {\n    console.error(\"CPV DELETE Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\create-default-user\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2094,2097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2094,2097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":105,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { password = \"us786\", name = \"Umer Sajjad\", email = \"umer@traders.com\" } = body;\r\n\r\n    console.log(\"🔨 Creating default user...\");\r\n\r\n    // Check if user already exists\r\n    const existing = await prisma.user.findFirst({\r\n      where: {\r\n        OR: [\r\n          { email: email },\r\n          { name: { equals: name, mode: \"insensitive\" } },\r\n        ],\r\n      },\r\n    });\r\n\r\n    if (existing) {\r\n      console.log(\"⚠️ User already exists, updating password...\");\r\n      \r\n      const hashedPassword = await bcrypt.hash(password, 10);\r\n      \r\n      const updated = await prisma.user.update({\r\n        where: { id: existing.id },\r\n        data: {\r\n          password: hashedPassword,\r\n          active: true,\r\n          email: email, // Ensure email is set\r\n        },\r\n      });\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: \"User updated successfully! Password reset to 'us786'\",\r\n        user: {\r\n          id: updated.id,\r\n          name: updated.name,\r\n          email: updated.email,\r\n          role: updated.role,\r\n        },\r\n        email: updated.email,\r\n        password: password,\r\n      });\r\n    }\r\n\r\n    // Create new user\r\n    console.log(\"✅ Creating new user...\");\r\n    const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n    const user = await prisma.user.create({\r\n      data: {\r\n        name: name,\r\n        email: email,\r\n        password: hashedPassword,\r\n        role: \"ADMIN\",\r\n        active: true,\r\n      },\r\n    });\r\n\r\n    console.log(\"✅ User created:\", user.email);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"Default admin user created successfully!\",\r\n      user: {\r\n        id: user.id,\r\n        name: user.name,\r\n        email: user.email,\r\n        role: user.role,\r\n      },\r\n      email: user.email,\r\n      password: password,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"❌ Error creating default user:\", error);\r\n    \r\n    if (error.code === \"P2002\") {\r\n      return NextResponse.json(\r\n        { \r\n          success: false,\r\n          error: \"User with this email already exists. Try a different email.\",\r\n          code: error.code \r\n        },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { \r\n        success: false,\r\n        error: error.message || \"Failed to create user\",\r\n        details: process.env.NODE_ENV === \"development\" ? error : undefined,\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// GET endpoint to show instructions\r\nexport async function GET(req: NextRequest) {\r\n  return NextResponse.json({\r\n    message: \"Create Default User API\",\r\n    instructions: \"Send POST request with optional body\",\r\n    defaultValues: {\r\n      name: \"Umer Sajjad\",\r\n      email: \"umer@traders.com\", \r\n      password: \"us786\",\r\n    },\r\n    example: {\r\n      method: \"POST\",\r\n      body: {\r\n        name: \"Your Name\",\r\n        email: \"your@email.com\",\r\n        password: \"yourpassword\",\r\n      },\r\n    },\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\crm\\contacts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1857,1860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1857,1860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2731,2734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2731,2734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3532,3535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3532,3535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { requireRole } from \"@/lib/requireRole\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\n// GET: Fetch all contacts\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const type = searchParams.get(\"type\");\r\n    const company = searchParams.get(\"company\");\r\n    const isActive = searchParams.get(\"isActive\") === \"true\";\r\n\r\n    const contacts = await prisma.contact.findMany({\r\n      where: {\r\n        ...(type && { type }),\r\n        ...(company && { company: { contains: company, mode: \"insensitive\" } }),\r\n        ...(isActive !== undefined && { isActive }),\r\n      },\r\n      include: {\r\n        interactions: { orderBy: { date: \"desc\" }, take: 5 },\r\n        opportunities: { orderBy: { createdAt: \"desc\" }, take: 3 },\r\n      },\r\n      orderBy: { name: \"asc\" },\r\n    });\r\n\r\n    return NextResponse.json(contacts);\r\n  } catch (error) {\r\n    console.error(\"Error fetching contacts:\", error);\r\n    return NextResponse.json({ error: \"Failed to fetch contacts\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST: Create new contact\r\nexport async function POST(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const body = await req.json();\r\n    const { name, email, phone, company, position, type } = body;\r\n\r\n    if (!name || !phone || !company || !type) {\r\n      return NextResponse.json(\r\n        { error: \"name, phone, company, and type are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const contact = await prisma.contact.create({\r\n      data: {\r\n        name,\r\n        email: email || null,\r\n        phone,\r\n        company,\r\n        position,\r\n        type,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(contact, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2002\") {\r\n      return NextResponse.json(\r\n        { error: \"Email already exists\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error(\"Error creating contact:\", error);\r\n    return NextResponse.json({ error: \"Failed to create contact\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// PUT: Update contact\r\nexport async function PUT(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const contact = await prisma.contact.update({\r\n      where: { id },\r\n      data: body,\r\n    });\r\n\r\n    return NextResponse.json(contact);\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Contact not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error updating contact:\", error);\r\n    return NextResponse.json({ error: \"Failed to update contact\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// DELETE: Delete contact\r\nexport async function DELETE(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    await prisma.contact.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ message: \"Contact deleted successfully\" });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Contact not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error deleting contact:\", error);\r\n    return NextResponse.json({ error: \"Failed to delete contact\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\crm\\interactions\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1789,1792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1789,1792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2703,2706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2703,2706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3542,3545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3542,3545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { requireRole } from \"@/lib/requireRole\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\n// GET: Fetch interactions\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const contactId = searchParams.get(\"contactId\");\r\n    const type = searchParams.get(\"type\");\r\n\r\n    const interactions = await prisma.interaction.findMany({\r\n      where: {\r\n        contactId: contactId || undefined,\r\n        type: type || undefined,\r\n      },\r\n      include: { contact: { select: { name: true } } },\r\n      orderBy: { date: \"desc\" },\r\n    });\r\n\r\n    return NextResponse.json(interactions);\r\n  } catch (error) {\r\n    console.error(\"Error fetching interactions:\", error);\r\n    return NextResponse.json({ error: \"Failed to fetch interactions\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST: Create interaction\r\nexport async function POST(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const body = await req.json();\r\n    const { contactId, type, date, subject, description, outcome, nextFollowUp } = body;\r\n\r\n    if (!contactId || !type || !date || !subject) {\r\n      return NextResponse.json(\r\n        { error: \"contactId, type, date, and subject are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const interaction = await prisma.interaction.create({\r\n      data: {\r\n        contactId,\r\n        type,\r\n        date: new Date(date),\r\n        subject,\r\n        description: description || \"\",\r\n        outcome: outcome || \"NEUTRAL\",\r\n        nextFollowUp: nextFollowUp ? new Date(nextFollowUp) : null,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(interaction, { status: 201 });\r\n  } catch (error: any) {\r\n    console.error(\"Error creating interaction:\", error);\r\n    return NextResponse.json({ error: \"Failed to create interaction\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// PUT: Update interaction\r\nexport async function PUT(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    \r\n    // Parse dates if provided\r\n    if (body.date) body.date = new Date(body.date);\r\n    if (body.nextFollowUp) body.nextFollowUp = new Date(body.nextFollowUp);\r\n\r\n    const interaction = await prisma.interaction.update({\r\n      where: { id },\r\n      data: body,\r\n    });\r\n\r\n    return NextResponse.json(interaction);\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Interaction not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error updating interaction:\", error);\r\n    return NextResponse.json({ error: \"Failed to update interaction\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// DELETE: Delete interaction\r\nexport async function DELETE(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    await prisma.interaction.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ message: \"Interaction deleted successfully\" });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Interaction not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error deleting interaction:\", error);\r\n    return NextResponse.json({ error: \"Failed to delete interaction\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\crm\\opportunities\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1899,1902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1899,1902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2643,2646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2643,2646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3468,3471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3468,3471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { requireRole } from \"@/lib/requireRole\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\n// GET: Fetch opportunities\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const contactId = searchParams.get(\"contactId\");\r\n    const stage = searchParams.get(\"stage\");\r\n\r\n    const opportunities = await prisma.opportunity.findMany({\r\n      where: {\r\n        contactId: contactId || undefined,\r\n        stage: stage || undefined,\r\n      },\r\n      include: { \r\n        contact: { select: { name: true, company: true } },\r\n        activities: { orderBy: { date: \"desc\" } },\r\n      },\r\n      orderBy: { expectedCloseDate: \"asc\" },\r\n    });\r\n\r\n    return NextResponse.json(opportunities);\r\n  } catch (error) {\r\n    console.error(\"Error fetching opportunities:\", error);\r\n    return NextResponse.json({ error: \"Failed to fetch opportunities\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST: Create opportunity\r\nexport async function POST(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const body = await req.json();\r\n    const { contactId, title, description, value, probability, stage, expectedCloseDate } = body;\r\n\r\n    if (!contactId || !title || !value || !expectedCloseDate) {\r\n      return NextResponse.json(\r\n        { error: \"contactId, title, value, and expectedCloseDate are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const opportunity = await prisma.opportunity.create({\r\n      data: {\r\n        contactId,\r\n        title,\r\n        description,\r\n        value,\r\n        probability: probability || 50,\r\n        stage: stage || \"LEAD\",\r\n        expectedCloseDate: new Date(expectedCloseDate),\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(opportunity, { status: 201 });\r\n  } catch (error: any) {\r\n    console.error(\"Error creating opportunity:\", error);\r\n    return NextResponse.json({ error: \"Failed to create opportunity\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// PUT: Update opportunity\r\nexport async function PUT(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const opportunity = await prisma.opportunity.update({\r\n      where: { id },\r\n      data: body,\r\n    });\r\n\r\n    return NextResponse.json(opportunity);\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Opportunity not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error updating opportunity:\", error);\r\n    return NextResponse.json({ error: \"Failed to update opportunity\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// DELETE: Delete opportunity\r\nexport async function DELETE(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    await prisma.opportunity.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ message: \"Opportunity deleted successfully\" });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Opportunity not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error deleting opportunity:\", error);\r\n    return NextResponse.json({ error: \"Failed to delete opportunity\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\crv\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[178,181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[178,181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[277,280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[277,280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[708,711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[708,711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1161,1164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1161,1164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1217,1220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1217,1220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1287,1290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1287,1290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1852,1855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1852,1855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2302,2305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2302,2305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6431,6434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6431,6434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":295,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9418,9421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9418,9421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":381,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":381,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12346,12349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12346,12349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":383,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12440,12443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12440,12443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":425,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":425,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13672,13675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13672,13675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":461,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14764,14767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14764,14767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { PrismaClient } from \"@prisma/client\";\n\nimport { Prisma } from \"@prisma/client\";\n\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\n// GET - List all CRVs\nexport async function GET(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const from = searchParams.get(\"from\");\n    const to = searchParams.get(\"to\");\n\n    const where: any = { type: \"CRV\" };\n    if (from && to) {\n      where.date = {\n        gte: new Date(from + \"T00:00:00\"),\n        lte: new Date(to + \"T23:59:59\"),\n      };\n    }\n\n    const vouchers = await prisma.voucher.findMany({\n      where,\n      include: {\n        entries: {\n          include: {\n            account: true,\n          },\n        },\n      },\n      orderBy: { date: \"desc\" },\n    });\n\n    // Format vouchers\n    const formatted = vouchers.map((v: any) => {\n      const receiptEntry = v.entries.find((e: any) => e.amount > 0);\n      const customerEntry = v.entries.find((e: any) => e.amount < 0);\n      return {\n        id: v.id,\n        voucherNo: v.voucherNo,\n        date: v.date.toISOString().split(\"T\")[0],\n        narration: v.narration,\n        accountName: customerEntry?.account?.name || \"N/A\",\n        accountId: customerEntry?.accountId || \"\",\n        amount: Math.abs(customerEntry?.amount || 0),\n        paymentMode: receiptEntry?.account?.name?.toLowerCase().includes(\"cash\") ? \"CASH\" : \"BANK\",\n        paymentAccountId: receiptEntry?.accountId || \"\",\n      };\n    });\n\n    return NextResponse.json(formatted);\n  } catch (e: any) {\n    console.error(\"CRV GET Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\nexport async function POST(req: Request) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    let requestBody;\n    try {\n      requestBody = await req.json();\n    } catch (parseError: any) {\n      console.error(\"❌ CRV JSON PARSE ERROR:\", parseError);\n      return NextResponse.json(\n        { error: \"Invalid request body\", details: parseError.message },\n        { status: 400 }\n      );\n    }\n\n    const { accountId, bankAccountId, paymentMode, amount, date, narration } = requestBody;\n\n    // Debug logging\n    console.log(\"🔥 CRV REQUEST:\", { accountId, bankAccountId, paymentMode, amount, date, narration });\n\n    // Validate amount properly\n    const amountNum = Number(amount);\n    console.log(\"🔥 AMOUNT PARSED:\", { original: amount, parsed: amountNum, isValid: !isNaN(amountNum) && amountNum > 0 });\n\n    if (!accountId || !date) {\n      return NextResponse.json(\n        { error: \"Account & date required\" },\n        { status: 400 }\n      );\n    }\n\n    if (!amount || amount === \"\" || isNaN(amountNum) || amountNum <= 0) {\n      console.error(\"❌ INVALID AMOUNT:\", { amount, amountNum, isNaN: isNaN(amountNum) });\n      return NextResponse.json(\n        { error: `Valid amount required (must be greater than 0). Received: ${amount}` },\n        { status: 400 }\n      );\n    }\n\n    if (paymentMode === \"BANK\" && !bankAccountId) {\n      return NextResponse.json(\n        { error: \"Bank account required for bank receipt\" },\n        { status: 400 }\n      );\n    }\n\n    const customer = await prisma.account.findUnique({\n      where: { id: accountId },\n    });\n\n    // CRV = Cash Receipt Voucher = CUSTOMER سے روپے وصول\n    // تو یہاں CUSTOMER ہی چاہیے\n    if (!customer || (customer.partyType && customer.partyType !== \"CUSTOMER\")) {\n      return NextResponse.json(\n        { error: \"CRV sirf Customer ke liye hota hai\" },\n        { status: 400 }\n      );\n    }\n\n    // Find payment account (Cash or Bank)\n    let paymentAccount;\n    let bankAccountRecord = null;\n    if (paymentMode === \"BANK\") {\n      // First find BankAccount record (bankAccountId is BankAccount table ID)\n      bankAccountRecord = await prisma.bankAccount.findUnique({\n        where: { id: bankAccountId },\n        include: { account: true },\n      });\n\n      if (!bankAccountRecord) {\n        // If not found in BankAccount, try to find in Account table\n        const accountFromTable = await prisma.account.findUnique({\n          where: { id: bankAccountId },\n        });\n\n        if (!accountFromTable || accountFromTable.partyType !== \"BANKS\") {\n          return NextResponse.json(\n            { error: \"Bank account not found\" },\n            { status: 400 }\n          );\n        }\n\n        // Create BankAccount entry from Account\n        const nameParts = accountFromTable.name.split(\" - \");\n        const bankName = nameParts[0] || accountFromTable.name;\n        const accountNo = nameParts[1] || accountFromTable.code;\n\n        bankAccountRecord = await prisma.bankAccount.create({\n          data: {\n            accountNo: accountNo,\n            bankName: bankName,\n            accountName: accountFromTable.name,\n            accountId: accountFromTable.id,\n            balance: accountFromTable.openDebit || 0,\n          },\n          include: { account: true },\n        });\n      }\n\n      // Get payment account from BankAccount's linked account\n      paymentAccount = bankAccountRecord.account;\n      if (!paymentAccount) {\n        return NextResponse.json(\n          { error: \"Bank account linked account not found\" },\n          { status: 400 }\n        );\n      }\n    } else {\n      paymentAccount = await prisma.account.findFirst({\n        where: { name: { equals: \"Cash in hand\", mode: \"insensitive\" } },\n      });\n\n      if (!paymentAccount) {\n        return NextResponse.json(\n          { error: \"Cash account not found\" },\n          { status: 400 }\n        );\n      }\n    }\n\n    const count = await prisma.voucher.count({ where: { type: \"CRV\" } });\n    const voucherNo = `CRV-${count + 1}`;\n    const receiptAmount = Math.abs(amountNum); // Use already validated amountNum\n\n    console.log(\"🔥 CREATING CRV:\", { voucherNo, receiptAmount, customerId: customer.id, paymentAccountId: paymentAccount.id });\n\n    // Create voucher and update bank balance in transaction\n    const result = await prisma.$transaction(async (tx: any) => {\n      // CRV = Cash Receipt Voucher (روپے وصول)\n      // Customer سے روپے آ رہے ہیں\n      // \n      // Ledger میں:\n      // - Customer: CREDIT (-) کیونکہ وہ ہمیں ادا کر رہے ہیں\n      // - Bank/Cash: DEBIT (+) کیونکہ روپے ہم میں آ رہے ہیں\n\n      const voucher = await tx.voucher.create({\n        data: {\n          voucherNo,\n          type: \"CRV\",\n          date: new Date(date),\n          narration: narration || `${paymentMode === \"BANK\" ? \"Bank\" : \"Cash\"} received`,\n          entries: {\n            create: [\n              { accountId: customer.id, amount: -receiptAmount },      // Customer CREDIT (-)\n              { accountId: paymentAccount.id, amount: receiptAmount }, // Bank/Cash DEBIT (+)\n            ],\n          },\n        },\n      });\n\n      console.log(\"🔥 CRV CREATED:\", { voucherId: voucher.id, voucherNo, entries: voucher.entries });\n\n      // If bank receipt, update bank balance and create statement\n      if (paymentMode === \"BANK\" && bankAccountRecord) {\n        // Update bank balance (increase)\n        await tx.bankAccount.update({\n          where: { id: bankAccountRecord.id },\n          data: {\n            balance: { increment: receiptAmount },\n          },\n        });\n\n        // Create bank statement\n        await tx.bankStatement.create({\n          data: {\n            bankAccountId: bankAccountRecord.id,\n            statementNo: `STMT-${Date.now()}`,\n            date: new Date(date),\n            amount: receiptAmount, // Positive for receipt\n            description: narration || `Receipt from ${customer.name}`,\n            referenceNo: voucherNo,\n            isReconciled: false,\n          },\n        });\n      }\n\n      return voucher;\n    });\n\n    // 2. واؤچر کی تفصیلات اور اکاؤنٹ (فون/نام) کو شامل کرنا\n    const fullVoucher = await prisma.voucher.findUnique({\n      where: { id: result.id },\n      include: {\n        entries: {\n          include: {\n            account: true,\n          },\n        },\n      },\n    });\n\n    if (!fullVoucher) {\n      console.error(\"❌ CRV: Voucher not found after creation:\", result.id);\n      return NextResponse.json(\n        { error: \"Voucher created but could not be retrieved\" },\n        { status: 500 }\n      );\n    }\n\n    // 3. فرنٹ اینڈ کے لیے ڈیٹا تیار کرنا\n    const responseData = {\n      id: fullVoucher.id,\n      voucherNo: fullVoucher.voucherNo,\n      type: fullVoucher.type,\n      date: fullVoucher.date.toISOString().split('T')[0], // Format date\n      narration: fullVoucher.narration,\n      entries: fullVoucher.entries,\n      accountName: customer.name,\n      phone: customer.phone,\n      amount: receiptAmount, // Use parsed amount\n      paymentMode: paymentMode || \"CASH\",\n    };\n\n    console.log(\"🔥 CRV RESPONSE:\", {\n      voucherId: responseData.id,\n      voucherNo: responseData.voucherNo,\n      amount: responseData.amount,\n      entries: responseData.entries?.length,\n      hasEntries: !!responseData.entries\n    });\n\n    return NextResponse.json(responseData);\n\n  } catch (e: any) {\n    console.error(\"❌ CRV ERROR:\", e);\n    console.error(\"❌ CRV ERROR DETAILS:\", {\n      message: e.message,\n      stack: e.stack,\n      code: e.code,\n    });\n    return NextResponse.json(\n      { error: e.message || \"CRV failed\", details: e.code || \"Unknown error\" },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Update CRV\nexport async function PUT(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const { id, accountId, bankAccountId, paymentMode, amount, date, narration } = body;\n\n    if (!id) {\n      return NextResponse.json({ error: \"Voucher ID required\" }, { status: 400 });\n    }\n\n    const amountNum = Number(amount);\n    if (!amount || isNaN(amountNum) || amountNum <= 0) {\n      return NextResponse.json({ error: \"Valid amount required\" }, { status: 400 });\n    }\n\n    const existing = await prisma.voucher.findUnique({\n      where: { id },\n      include: { entries: true },\n    });\n\n    if (!existing || existing.type !== \"CRV\") {\n      return NextResponse.json({ error: \"CRV not found\" }, { status: 404 });\n    }\n\n    const customer = await prisma.account.findUnique({ where: { id: accountId } });\n    if (!customer || customer.partyType !== \"CUSTOMER\") {\n      return NextResponse.json({ error: \"Customer not found\" }, { status: 400 });\n    }\n\n    // Find payment account\n    let paymentAccount;\n    let bankAccountRecord = null;\n    if (paymentMode === \"BANK\" && bankAccountId) {\n      bankAccountRecord = await prisma.bankAccount.findUnique({\n        where: { id: bankAccountId },\n        include: { account: true },\n      });\n      if (!bankAccountRecord) {\n        const accountFromTable = await prisma.account.findUnique({\n          where: { id: bankAccountId },\n        });\n        if (accountFromTable && accountFromTable.partyType === \"BANKS\") {\n          const nameParts = accountFromTable.name.split(\" - \");\n          bankAccountRecord = await prisma.bankAccount.create({\n            data: {\n              accountNo: nameParts[1] || accountFromTable.code,\n              bankName: nameParts[0] || accountFromTable.name,\n              accountName: accountFromTable.name,\n              accountId: accountFromTable.id,\n              balance: accountFromTable.openDebit || 0,\n            },\n            include: { account: true },\n          });\n        }\n      }\n      paymentAccount = bankAccountRecord?.account;\n    } else {\n      paymentAccount = await prisma.account.findFirst({\n        where: { name: { equals: \"Cash in hand\", mode: \"insensitive\" } },\n      });\n    }\n\n    if (!paymentAccount) {\n      return NextResponse.json({ error: \"Payment account not found\" }, { status: 400 });\n    }\n\n    const receiptAmount = Math.abs(amountNum);\n    const oldAmount = Math.abs(existing.entries.find((e: any) => e.amount < 0)?.amount || 0);\n\n    const result = await prisma.$transaction(async (tx: any) => {\n      await tx.voucherEntry.deleteMany({ where: { voucherId: id } });\n\n      const voucher = await tx.voucher.update({\n        where: { id },\n        data: {\n          date: new Date(date),\n          narration: narration || `${paymentMode === \"BANK\" ? \"Bank\" : \"Cash\"} received`,\n          entries: {\n            create: [\n              { accountId: customer.id, amount: -receiptAmount },\n              { accountId: paymentAccount.id, amount: receiptAmount },\n            ],\n          },\n        },\n        include: {\n          entries: {\n            include: { account: true },\n          },\n        },\n      });\n\n      if (paymentMode === \"BANK\" && bankAccountRecord) {\n        const balanceDiff = receiptAmount - oldAmount;\n        await tx.bankAccount.update({\n          where: { id: bankAccountRecord.id },\n          data: { balance: { increment: balanceDiff } },\n        });\n      }\n\n      return voucher;\n    });\n\n    return NextResponse.json({\n      id: result.id,\n      voucherNo: result.voucherNo,\n      date: result.date.toISOString().split(\"T\")[0],\n      narration: result.narration,\n      accountName: customer.name,\n      amount: receiptAmount,\n      paymentMode: paymentMode || \"CASH\",\n    });\n  } catch (e: any) {\n    console.error(\"CRV PUT Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// DELETE - Delete CRV\nexport async function DELETE(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"Voucher ID required\" }, { status: 400 });\n    }\n\n    const existing = await prisma.voucher.findUnique({\n      where: { id },\n      include: { entries: true },\n    });\n\n    if (!existing || existing.type !== \"CRV\") {\n      return NextResponse.json({ error: \"CRV not found\" }, { status: 404 });\n    }\n\n    await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n      await tx.voucherEntry.deleteMany({ where: { voucherId: id } });\n      await tx.voucher.delete({ where: { id } });\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (e: any) {\n    console.error(\"CRV DELETE Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\currencies\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":6,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1296,1299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1296,1299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2312,2315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2312,2315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3119,3122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3119,3122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { requireRole } from \"@/lib/requireRole\";\r\n\r\n// GET: Fetch all currencies\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const currencies = await prisma.currency.findMany({\r\n      where: { isActive: true },\r\n      orderBy: { code: \"asc\" },\r\n    });\r\n    return NextResponse.json(currencies);\r\n  } catch (error) {\r\n    console.error(\"Error fetching currencies:\", error);\r\n    return NextResponse.json({ error: \"Failed to fetch currencies\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST: Create new currency\r\nexport async function POST(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const body = await req.json();\r\n    const { code, name, symbol, exchangeRate } = body;\r\n\r\n    if (!code || !name || !symbol) {\r\n      return NextResponse.json(\r\n        { error: \"Code, name, and symbol are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const currency = await prisma.currency.create({\r\n      data: {\r\n        code: code.toUpperCase(),\r\n        name,\r\n        symbol,\r\n        exchangeRate: exchangeRate || 1.0,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(currency, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2002\") {\r\n      return NextResponse.json(\r\n        { error: \"Currency code already exists\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error(\"Error creating currency:\", error);\r\n    return NextResponse.json({ error: \"Failed to create currency\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// PUT: Update currency\r\nexport async function PUT(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { name, symbol, exchangeRate, isActive } = body;\r\n\r\n    const currency = await prisma.currency.update({\r\n      where: { id },\r\n      data: {\r\n        name,\r\n        symbol,\r\n        exchangeRate,\r\n        isActive,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(currency);\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Currency not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error updating currency:\", error);\r\n    return NextResponse.json({ error: \"Failed to update currency\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// DELETE: Delete currency\r\nexport async function DELETE(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    await prisma.currency.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ message: \"Currency deleted successfully\" });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Currency not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error deleting currency:\", error);\r\n    return NextResponse.json({ error: \"Failed to delete currency\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\dashboard\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[174,177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[174,177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[276,279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[276,279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient, Prisma } from \"@prisma/client\";\r\n\r\n\r\n\r\n// ✅ Prisma singleton (dev safe)\r\nconst prisma =\r\n  (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    // 🔐 ROLE CHECK\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    // ================= TOTAL SALES =================\r\n    const sales = await prisma.salesInvoice.aggregate({\r\n      _sum: { total: true }, // ✅ correct field\r\n    });\r\n\r\n    // ================= STOCK VALUE =================\r\n    const items = await prisma.itemNew.findMany({\r\n      include: { inventoryTxns: true },\r\n    });\r\n\r\n    type ItemWithTxns = Prisma.ItemNewGetPayload<{\r\n  include: { inventoryTxns: true };\r\n}>;\r\n\r\n\r\n    let stockValue = 0;\r\n\r\nitems.forEach((item: ItemWithTxns) => {\r\n  let qty = 0;\r\n  let lastRate = 0;\r\n\r\n  item.inventoryTxns.forEach((t) => {\r\n    qty += t.qty;\r\n    if (t.rate > 0) {\r\n      lastRate = t.rate;\r\n    }\r\n  });\r\n\r\n  stockValue += qty * lastRate;\r\n});\r\n\r\n    return NextResponse.json({\r\n      totalSales: sales._sum.total || 0,\r\n      stockValue: Math.round(stockValue),\r\n    });\r\n\r\n  } catch (e) {\r\n    console.error(\"❌ DASHBOARD ERROR:\", e);\r\n    return NextResponse.json(\r\n      { error: \"Dashboard failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\debug-check\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[131,134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[131,134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[505,508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[505,508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1384,1387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1384,1387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport async function GET() {\n  const results: any = {};\n\n  // 1. Check Employees\n  try {\n    const employees = await prisma.employee.findMany({\n      take: 5,\n      include: {\n        attendances: { orderBy: { date: \"desc\" }, take: 1 },\n        payroll: { orderBy: { monthYear: \"desc\" }, take: 1 },\n      },\n    });\n    results.employees = { success: true, count: employees.length, sample: employees[0] };\n  } catch (e: any) {\n    results.employees = { success: false, error: e.message };\n  }\n\n  // 2. Check Purchase Invoice Dependencies\n  try {\n    // Check if any supplier exists\n    const supplier = await prisma.account.findFirst({\n        where: { \n            OR: [\n                { type: \"SUPPLIER\" },\n                { partyType: \"SUPPLIER\" }\n            ]\n        } \n    });\n    \n    // Check Inventory Account\n    const inventoryAcc = await prisma.account.findFirst({\n        where: {\n          OR: [\n            { name: { equals: \"Stock/Inventory\", mode: \"insensitive\" } },\n            { code: { equals: \"INV001\", mode: \"insensitive\" } },\n          ],\n        },\n    });\n\n    results.purchaseInvoice = {\n        supplierFound: !!supplier,\n        inventoryAccFound: !!inventoryAcc,\n        supplierSample: supplier ? { id: supplier.id, name: supplier.name } : null\n    };\n\n  } catch (e: any) {\n    results.purchaseInvoice = { success: false, error: e.message };\n  }\n\n  return NextResponse.json(results);\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\delivery-challan\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":51,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2523,2526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2523,2526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4166,4169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4166,4169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":166,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":166,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { z } from \"zod\";\n\n// VALIDATION SCHEMA\nconst challanSchema = z.object({\n  id: z.string().optional(),\n  date: z.string(),\n  customerId: z.string(),\n  driverName: z.string().optional().nullable(),\n  vehicleNo: z.string().optional().nullable(),\n  remarks: z.string().optional().nullable(),\n  items: z.array(\n    z.object({\n      itemId: z.string(),\n      qty: z.number().min(1),\n      rate: z.number().optional().nullable(), // Optional in Challan\n    })\n  ),\n  status: z.enum([\"PENDING\", \"DELIVERED\", \"INVOICED\"]).optional(),\n});\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (id) {\n      const challan = await prisma.deliveryChallan.findUnique({\n        where: { id },\n        include: {\n          customer: true,\n          items: {\n            include: { item: true },\n          },\n        },\n      });\n      if (!challan) return NextResponse.json({ error: \"Delivery Challan not found\" }, { status: 404 });\n      return NextResponse.json(challan);\n    }\n\n    const challans = await prisma.deliveryChallan.findMany({\n      include: {\n        customer: true,\n        items: true,\n      },\n      orderBy: { createdAt: \"desc\" },\n    });\n\n    return NextResponse.json(challans);\n  } catch (error) {\n    return NextResponse.json({ error: \"Failed to fetch delivery challans\" }, { status: 500 });\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const data = challanSchema.parse(body);\n\n    // Auto-generate Challan No\n    const count = await prisma.deliveryChallan.count();\n    const challanNo = `DC-${String(count + 1).padStart(4, \"0\")}`;\n\n    const challan = await prisma.deliveryChallan.create({\n      data: {\n        challanNo,\n        date: new Date(data.date),\n        customerId: data.customerId,\n        driverName: data.driverName || null,\n        vehicleNo: data.vehicleNo || null,\n        remarks: data.remarks || null,\n        status: data.status || \"PENDING\",\n        items: {\n          create: data.items.map((item) => ({\n            itemId: item.itemId,\n            qty: item.qty,\n            rate: item.rate || 0, // Store 0 if not provided\n          })),\n        },\n      },\n      include: {\n        customer: true,\n        items: {\n          include: { item: true },\n        },\n      },\n    });\n\n    return NextResponse.json(challan);\n  } catch (error: any) {\n    console.error(\"Create Delivery Challan Error:\", error);\n    return NextResponse.json({ error: error.message || \"Failed to create delivery challan\" }, { status: 400 });\n  }\n}\n\nexport async function PUT(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (!role || (role !== \"ADMIN\" && role !== \"ACCOUNTANT\")) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const data = challanSchema.parse(body);\n\n    if (!data.id) return NextResponse.json({ error: \"ID required\" }, { status: 400 });\n\n    // Transaction to update: delete old items, create new ones\n    const updated = await prisma.$transaction(async (tx) => {\n      // 1. Delete existing items\n      await tx.deliveryChallanItem.deleteMany({\n        where: { challanId: data.id },\n      });\n\n      // 2. Update Challan\n      return await tx.deliveryChallan.update({\n        where: { id: data.id },\n        data: {\n          date: new Date(data.date),\n          customerId: data.customerId,\n          driverName: data.driverName || null,\n          vehicleNo: data.vehicleNo || null,\n          remarks: data.remarks || null,\n          status: data.status || \"PENDING\",\n          items: {\n            create: data.items.map((item) => ({\n              itemId: item.itemId,\n              qty: item.qty,\n              rate: item.rate || 0,\n            })),\n          },\n        },\n        include: {\n          customer: true,\n          items: {\n            include: { item: true },\n          },\n        },\n      });\n    });\n\n    return NextResponse.json(updated);\n  } catch (error: any) {\n    console.error(\"Update Delivery Challan Error:\", error);\n    return NextResponse.json({ error: error.message || \"Failed to update delivery challan\" }, { status: 400 });\n  }\n}\n\nexport async function DELETE(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (!role || (role !== \"ADMIN\" && role !== \"ACCOUNTANT\")) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n    if (!id) return NextResponse.json({ error: \"ID required\" }, { status: 400 });\n\n    await prisma.deliveryChallan.delete({\n      where: { id },\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    return NextResponse.json({ error: \"Failed to delete delivery challan\" }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\email\\send\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[303,306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[303,306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[403,406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[403,406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4320,4323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4320,4323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { sendEmail, emailTemplates } from \"@/lib/email\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.VIEW_REPORTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Permission denied\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { type, invoiceId, to, subject, message } = body;\r\n\r\n    if (!type || !to) {\r\n      return NextResponse.json(\r\n        { error: 'Type and recipient email are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    let html = '';\r\n    let emailSubject = subject || '';\r\n\r\n    // Handle different email types\r\n    if (type === 'sales-invoice' && invoiceId) {\r\n      const invoice = await prisma.salesInvoice.findUnique({\r\n        where: { id: invoiceId },\r\n        include: {\r\n          customer: true,\r\n          items: {\r\n            include: {\r\n              item: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      if (!invoice) {\r\n        return NextResponse.json(\r\n          { error: 'Invoice not found' },\r\n          { status: 404 }\r\n        );\r\n      }\r\n\r\n      html = emailTemplates.salesInvoice(invoice, invoice.customer);\r\n      emailSubject = subject || `Sales Invoice ${invoice.invoiceNo} - US Traders`;\r\n    } else if (type === 'purchase-invoice' && invoiceId) {\r\n      const invoice = await prisma.purchaseInvoice.findUnique({\r\n        where: { id: invoiceId },\r\n        include: {\r\n          supplier: true,\r\n          items: {\r\n            include: {\r\n              item: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      if (!invoice) {\r\n        return NextResponse.json(\r\n          { error: 'Invoice not found' },\r\n          { status: 404 }\r\n        );\r\n      }\r\n\r\n      html = emailTemplates.purchaseInvoice(invoice, invoice.supplier);\r\n      emailSubject = subject || `Purchase Invoice ${invoice.invoiceNo} - US Traders`;\r\n    } else if (type === \"purchase-order\" && invoiceId) {\r\n\r\n  const po = await prisma.purchaseOrder.findUnique({\r\n    where: { id: invoiceId },\r\n    include: {\r\n      supplier: true,\r\n      items: {\r\n        include: { item: true },\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!po) {\r\n    return NextResponse.json(\r\n      { error: \"Purchase Order not found\" },\r\n      { status: 404 }\r\n    );\r\n  }\r\n\r\n  html = emailTemplates.purchaseOrder(po, po.supplier);\r\n  emailSubject = subject || `Purchase Order ${po.poNo} - US Traders`;\r\n\r\n    } else if (type === 'custom' && message) {\r\n      html = emailTemplates.report(subject || 'Message from US Traders', message, 'custom');\r\n      emailSubject = subject || 'Message from US Traders';\r\n    } else {\r\n      return NextResponse.json(\r\n        { error: 'Invalid email type or missing data' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const recipients = Array.isArray(to) ? to.join(\", \") : to;\r\n\r\n    const result = await sendEmail({\r\n      to: Array.isArray(to) ? to : [to],\r\n      subject: emailSubject,\r\n      html,\r\n    });\r\n\r\n    if (!result.success) {\r\n      await prisma.activityLog.create({\r\n        data: {\r\n          action: \"EMAIL_SEND_FAILED\",\r\n          details: `type=${type}, to=${recipients}, error=${result.error || \"Unknown error\"}`,\r\n          userId: userId || null,\r\n        },\r\n      });\r\n\r\n      return NextResponse.json(\r\n        { error: result.error || 'Failed to send email' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    await prisma.activityLog.create({\r\n      data: {\r\n        action: \"EMAIL_SENT\",\r\n        details: `type=${type}, to=${recipients}, subject=${emailSubject}`,\r\n        userId: userId || null,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Email sent successfully',\r\n      messageId: result.messageId,\r\n    });\r\n  } catch (error: any) {\r\n    console.error('❌ Email send API error:', error);\r\n\r\n    try {\r\n      const userId = req.headers.get(\"x-user-id\");\r\n      await prisma.activityLog.create({\r\n        data: {\r\n          action: \"EMAIL_SEND_FAILED\",\r\n          details: error.message || \"Unhandled email send error\",\r\n          userId: userId || null,\r\n        },\r\n      });\r\n    } catch (logError) {\r\n      console.error(\"❌ Failed to log email send error:\", logError);\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { error: error.message || 'Failed to send email' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\email\\test\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[287,290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[287,290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[385,388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[385,388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1131,1134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1131,1134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { testEmailConfig } from \"@/lib/email\";\nimport { apiHasPermission } from \"@/lib/apiPermission\";\nimport { PERMISSIONS } from \"@/lib/permissions\";\nimport { PrismaClient } from \"@prisma/client\";\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\nexport async function GET(req: NextRequest) {\n  try {\n    const userId = req.headers.get(\"x-user-id\");\n    const userRole = req.headers.get(\"x-user-role\");\n\n    const allowed = await apiHasPermission(\n      userId,\n      userRole,\n      PERMISSIONS.MANAGE_USERS\n    );\n\n    if (!allowed) {\n      return NextResponse.json({ error: \"Permission denied\" }, { status: 403 });\n    }\n\n    const result = await testEmailConfig();\n\n    await prisma.activityLog.create({\n      data: {\n        action: result.success ? \"EMAIL_TEST_SUCCESS\" : \"EMAIL_TEST_FAILED\",\n        details: result.message || \"Email configuration test\",\n        userId: userId || null,\n      },\n    });\n\n    return NextResponse.json(result);\n  } catch (error: any) {\n    console.error(\"❌ Email test error:\", error);\n\n    try {\n      const userId = req.headers.get(\"x-user-id\");\n      await prisma.activityLog.create({\n        data: {\n          action: \"EMAIL_TEST_FAILED\",\n          details: error.message || \"Unhandled email test error\",\n          userId: userId || null,\n        },\n      });\n    } catch (logError) {\n      console.error(\"❌ Failed to log email test error:\", logError);\n    }\n\n    return NextResponse.json(\n      { success: false, message: error.message || \"Email test failed\" },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\employees\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2146,2149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2146,2149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3383,3386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3383,3386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4332,4335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4332,4335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { requireRole } from \"@/lib/requireRole\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\n// GET: Fetch all employees\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const department = searchParams.get(\"department\");\r\n    const isActiveParam = searchParams.get(\"isActive\");\r\n    const isActive =\r\n      isActiveParam === null\r\n        ? true\r\n        : isActiveParam === \"true\";\r\n\r\n    const employees = await prisma.employee.findMany({\r\n      where: {\r\n        ...(department && { department }),\r\n        ...(isActive !== undefined && { isActive }),\r\n      },\r\n      include: {\r\n        attendances: { orderBy: { date: \"desc\" }, take: 10 },\r\n        // payroll: { orderBy: { monthYear: \"desc\" }, take: 3 },\r\n      },\r\n      orderBy: { firstName: \"asc\" },\r\n    });\r\n\r\n    return NextResponse.json(employees);\r\n  } catch (error) {\r\n    console.error(\"Error fetching employees:\", error);\r\n    return NextResponse.json({ error: \"Failed to fetch employees\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST: Create new employee\r\nexport async function POST(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const body = await req.json();\r\n    const {\r\n      employeeId,\r\n      firstName,\r\n      lastName,\r\n      email,\r\n      phone,\r\n      designations,\r\n      department,\r\n      dateOfJoining,\r\n      salary,\r\n      salaryFrequency,\r\n    } = body;\r\n\r\n    if (!employeeId || !firstName || !email || !department) {\r\n      return NextResponse.json(\r\n        { error: \"Required fields: employeeId, firstName, email, department\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const employee = await prisma.employee.create({\r\n      data: {\r\n        employeeId,\r\n        firstName,\r\n        lastName,\r\n        email,\r\n        phone,\r\n        designations,\r\n        department,\r\n        dateOfJoining: new Date(dateOfJoining),\r\n        salary,\r\n        salaryFrequency,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(employee, { status: 201 });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2002\") {\r\n      return NextResponse.json(\r\n        { error: \"Employee ID or email already exists\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    console.error(\"Error creating employee:\", error);\r\n    return NextResponse.json({ error: \"Failed to create employee\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// PUT: Update employee\r\nexport async function PUT(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    const body = await req.json();\r\n\r\n    // Fix: Convert dateOfJoining to Date object if present\r\n    if (body.dateOfJoining) {\r\n      body.dateOfJoining = new Date(body.dateOfJoining);\r\n    }\r\n    \r\n    // Remove ID from body if present to avoid changing primary key (optional but good practice)\r\n    delete body.id;\r\n    delete body.createdAt;\r\n    delete body.updatedAt;\r\n\r\n    const employee = await prisma.employee.update({\r\n      where: { id },\r\n      data: body,\r\n    });\r\n\r\n    return NextResponse.json(employee);\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Employee not found\" }, { status: 404 });\r\n    }\r\n    if (error.code === \"P2002\") {\r\n      return NextResponse.json({ error: \"Employee ID or Email already exists\" }, { status: 400 });\r\n    }\r\n    console.error(\"Error updating employee:\", error);\r\n    return NextResponse.json({ error: \"Failed to update employee\" }, { status: 500 });\r\n  }\r\n}\r\n\r\n// DELETE: Delete employee\r\nexport async function DELETE(req: NextRequest) {\r\n  const guard = requireRole(req, [\"ADMIN\"]);\r\n  if (guard) return guard;\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    await prisma.employee.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ message: \"Employee deleted successfully\" });\r\n  } catch (error: any) {\r\n    if (error.code === \"P2025\") {\r\n      return NextResponse.json({ error: \"Employee not found\" }, { status: 404 });\r\n    }\r\n    console.error(\"Error deleting employee:\", error);\r\n    return NextResponse.json({ error: \"Failed to delete employee\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\expense-vouchers\\approve\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[245,248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[245,248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[347,350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[347,350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2501,2504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2501,2504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n// Approve or reject expense voucher\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.CREATE_ACCOUNTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { voucherId, action, remarks } = body; // action: APPROVE | REJECT\r\n\r\n    if (!voucherId || !action) {\r\n      return NextResponse.json(\r\n        { error: \"Voucher ID and action required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const voucher = await prisma.expenseVoucher.findUnique({\r\n      where: { id: voucherId },\r\n    });\r\n\r\n    if (!voucher) {\r\n      return NextResponse.json(\r\n        { error: \"Voucher not found\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const newStatus = action === \"APPROVE\" ? \"APPROVED\" : \"REJECTED\";\r\n\r\n    // Update voucher status\r\n    const updated = await prisma.expenseVoucher.update({\r\n      where: { id: voucherId },\r\n      data: {\r\n        approvalStatus: newStatus,\r\n        approvedAt: action === \"APPROVE\" ? new Date() : null,\r\n        remarks: remarks || null,\r\n      },\r\n    });\r\n\r\n    // If approved, create accounting entries\r\n    if (action === \"APPROVE\") {\r\n      // Create voucher entry\r\n      await prisma.voucher.create({\r\n        data: {\r\n          voucherNo: voucher.voucherNo,\r\n          type: \"EXPENSE\",\r\n          date: voucher.date,\r\n          narration: voucher.description || \"Expense Voucher\",\r\n          entries: {\r\n            create: [\r\n              {\r\n                accountId: voucher.expenseAccountId,\r\n                amount: voucher.totalAmount,\r\n              },\r\n              {\r\n                accountId: voucher.paymentAccountId,\r\n                amount: -voucher.totalAmount,\r\n              },\r\n            ],\r\n          },\r\n        },\r\n      });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      voucher: updated,\r\n    });\r\n  } catch (e: any) {\r\n    console.error(\"Expense Approval Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\expense-vouchers\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[440,443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[440,443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalAmount' is assigned a value but never used.","line":48,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2628,2631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2628,2631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3061,3064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3061,3064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4291,4294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4291,4294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4721,4724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4721,4724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const status = searchParams.get('status');\r\n\r\n    const filter: any = {};\r\n    if (status) filter.approvalStatus = status;\r\n\r\n    const vouchers = await prisma.expenseVoucher.findMany({\r\n      where: filter,\r\n      include: {\r\n        items: true,\r\n        attachments: true,\r\n        approvals: true,\r\n        expenseAccount: true,\r\n        paymentAccount: true,\r\n        voucher: { include: { entries: true } },\r\n      },\r\n      orderBy: { date: 'desc' },\r\n    });\r\n\r\n    return NextResponse.json(vouchers);\r\n  } catch (error) {\r\n    console.error('Error fetching expense vouchers:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch expense vouchers' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const {\r\n      voucherNo,\r\n      date,\r\n      description,\r\n      totalAmount,\r\n      expenseAccountId,\r\n      paymentAccountId,\r\n      items,\r\n    } = body;\r\n\r\n    // Validation\r\n    if (!voucherNo || !date || !expenseAccountId || !paymentAccountId) {\r\n      return NextResponse.json(\r\n        { error: 'Voucher No, Date, Expense Account, and Payment Account are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!items || items.length === 0) {\r\n      return NextResponse.json(\r\n        { error: 'At least one expense item is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if voucher number already exists\r\n    const existing = await prisma.expenseVoucher.findUnique({\r\n      where: { voucherNo },\r\n    });\r\n\r\n    if (existing) {\r\n      return NextResponse.json(\r\n        { error: 'Voucher number already exists' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validate accounts exist\r\n    const expenseAccount = await prisma.account.findUnique({\r\n      where: { id: expenseAccountId },\r\n    });\r\n\r\n    const paymentAccount = await prisma.account.findUnique({\r\n      where: { id: paymentAccountId },\r\n    });\r\n\r\n    if (!expenseAccount || !paymentAccount) {\r\n      return NextResponse.json(\r\n        { error: 'One or both accounts not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Calculate total from items\r\n    const calculatedTotal = items.reduce((sum: number, item: any) => \r\n      sum + parseFloat(item.amount || 0), 0\r\n    );\r\n\r\n    // Create expense voucher with items\r\n    const voucher = await prisma.expenseVoucher.create({\r\n      data: {\r\n        voucherNo,\r\n        date: new Date(date),\r\n        description,\r\n        totalAmount: calculatedTotal,\r\n        expenseAccountId,\r\n        paymentAccountId,\r\n        approvalStatus: 'DRAFT',\r\n        items: {\r\n          create: items.map((item: any) => ({\r\n            description: item.description || '',\r\n            amount: parseFloat(item.amount || 0),\r\n            category: item.category || 'OTHER',\r\n          })),\r\n        },\r\n      },\r\n      include: {\r\n        items: true,\r\n        attachments: true,\r\n        approvals: true,\r\n        expenseAccount: true,\r\n        paymentAccount: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(voucher, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Error creating expense voucher:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to create expense voucher: ' + (error as Error).message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { id, items, date, ...updateData } = body;\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { error: 'ID required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // First, delete old items if new items are provided\r\n    if (items && items.length > 0) {\r\n      await prisma.expenseItem.deleteMany({\r\n        where: { expenseVoucherId: id },\r\n      });\r\n\r\n      // Calculate new total\r\n      const newTotal = items.reduce((sum: number, item: any) => \r\n        sum + parseFloat(item.amount || 0), 0\r\n      );\r\n\r\n      updateData.totalAmount = newTotal;\r\n    }\r\n\r\n    if (date) {\r\n      updateData.date = new Date(date);\r\n    }\r\n\r\n    // Update voucher\r\n    const voucher = await prisma.expenseVoucher.update({\r\n      where: { id },\r\n      data: {\r\n        ...updateData,\r\n        ...(items && items.length > 0 && {\r\n          items: {\r\n            create: items.map((item: any) => ({\r\n              description: item.description || '',\r\n              amount: parseFloat(item.amount || 0),\r\n              category: item.category || 'OTHER',\r\n            })),\r\n          },\r\n        }),\r\n      },\r\n      include: {\r\n        items: true,\r\n        attachments: true,\r\n        approvals: true,\r\n        expenseAccount: true,\r\n        paymentAccount: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(voucher);\r\n  } catch (error) {\r\n    console.error('Error updating expense voucher:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to update expense voucher: ' + (error as Error).message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get('id');\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { error: 'ID required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await prisma.expenseVoucher.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error('Error deleting expense voucher:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to delete expense voucher' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\financial-year\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[245,248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[245,248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[347,350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[347,350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[914,917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[914,917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2165,2168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2165,2168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2901,2904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2901,2904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3302,3305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3302,3305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.VIEW_REPORTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const years = await prisma.financialYear.findMany({\r\n      orderBy: { year: \"desc\" },\r\n    });\r\n\r\n    return NextResponse.json(years);\r\n  } catch (e: any) {\r\n    console.error(\"Financial Year GET Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.CREATE_ACCOUNTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { year, startDate, endDate } = body;\r\n\r\n    if (!year || !startDate || !endDate) {\r\n      return NextResponse.json(\r\n        { error: \"Year, start date, and end date required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Deactivate all other years\r\n    await prisma.financialYear.updateMany({\r\n      where: { isActive: true },\r\n      data: { isActive: false },\r\n    });\r\n\r\n    const financialYear = await prisma.financialYear.create({\r\n      data: {\r\n        year: parseInt(year),\r\n        startDate: new Date(startDate),\r\n        endDate: new Date(endDate),\r\n        isActive: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(financialYear);\r\n  } catch (e: any) {\r\n    console.error(\"Financial Year POST Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.CREATE_ACCOUNTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { id, isClosed, closedBy } = body;\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID required\" }, { status: 400 });\r\n    }\r\n\r\n    const updateData: any = {};\r\n    if (isClosed !== undefined) {\r\n      updateData.isClosed = isClosed;\r\n      if (isClosed) {\r\n        updateData.closedAt = new Date();\r\n        updateData.closedBy = closedBy || userId;\r\n      }\r\n    }\r\n\r\n    const financialYear = await prisma.financialYear.update({\r\n      where: { id },\r\n      data: updateData,\r\n    });\r\n\r\n    return NextResponse.json(financialYear);\r\n  } catch (e: any) {\r\n    console.error(\"Financial Year PUT Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\inventory\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient, Prisma } from \"@prisma/client\";\r\n\r\n\r\nconst prisma =\r\n  (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  const role = req.headers.get(\"x-user-role\");\r\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  type ItemWithTxns = Prisma.ItemNewGetPayload<{\r\n  include: { inventoryTxns: true };\r\n}>;\r\n\r\n  const items = await prisma.itemNew.findMany({\r\n    include: { inventoryTxns: true },\r\n  });\r\n\r\n  const stock = items.map((item: ItemWithTxns) => ({\r\n  itemId: item.id,\r\n  name: item.name,\r\n  qty: item.inventoryTxns.reduce((s, t) => s + t.qty, 0),\r\n}));\r\n\r\n\r\n  return NextResponse.json(stock);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\invoice-taxes\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[504,507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[504,507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const invoiceType = searchParams.get('invoiceType');\r\n    const invoiceId = searchParams.get('invoiceId');\r\n\r\n    const filter: any = {};\r\n    if (invoiceType) filter.invoiceType = invoiceType;\r\n    if (invoiceId) filter.invoiceId = invoiceId;\r\n\r\n    const taxes = await prisma.invoiceTax.findMany({\r\n      where: filter,\r\n      include: {\r\n        taxConfiguration: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(taxes);\r\n  } catch (error) {\r\n    console.error('Error fetching invoice taxes:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch invoice taxes' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const {\r\n      invoiceType,\r\n      invoiceId,\r\n      taxConfigurationId,\r\n      subtotal,\r\n      taxAmount,\r\n      totalAmount,\r\n    } = body;\r\n\r\n    const tax = await prisma.invoiceTax.create({\r\n      data: {\r\n        invoiceType,\r\n        invoiceId,\r\n        taxConfigurationId,\r\n        subtotal,\r\n        taxAmount,\r\n        totalAmount,\r\n      },\r\n      include: {\r\n        taxConfiguration: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(tax, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Error creating invoice tax:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to create invoice tax' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { id, ...updateData } = body;\r\n\r\n    const tax = await prisma.invoiceTax.update({\r\n      where: { id },\r\n      data: updateData,\r\n      include: {\r\n        taxConfiguration: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(tax);\r\n  } catch (error) {\r\n    console.error('Error updating invoice tax:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to update invoice tax' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\items-new\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[128,131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[128,131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[230,233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[230,233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1521,1524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1521,1524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2753,2756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2753,2756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4281,4284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4281,4284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma =\r\n  (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET() {\r\n  const items = await prisma.itemNew.findMany({\r\n    orderBy: { name: \"asc\" },\r\n  });\r\n  return NextResponse.json(items);\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  const role = req.headers.get(\"x-user-role\");\r\n  if (role !== \"ADMIN\") {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await req.json();\r\n\r\n    if (!body.name || !body.unit) {\r\n      return NextResponse.json(\r\n        { error: \"Name & Unit required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const lastItem = await prisma.itemNew.findFirst({\r\n      orderBy: { createdAt: \"desc\" },\r\n    });\r\n\r\n    let nextNumber = 1;\r\n    if (lastItem?.code?.includes(\"-\")) {\r\n      const n = parseInt(lastItem.code.split(\"-\")[1]);\r\n      if (!isNaN(n)) nextNumber = n + 1;\r\n    }\r\n\r\n    const item = await prisma.itemNew.create({\r\n      data: {\r\n        code: `I-${nextNumber}`,\r\n        name: body.name,\r\n        unit: body.unit,\r\n        rate: Number(body.rate) || 0,\r\n        minStock: Number(body.minStock) || 0,\r\n        barcode: body.barcode ? String(body.barcode).trim() : null,\r\n        description: body.description || \"\",\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(item);\r\n  } catch (e: any) {\r\n    console.error(\"❌ ITEMS-NEW POST ERROR:\", e);\r\n    if (e.code === \"P2002\") {\r\n      return NextResponse.json(\r\n        { error: \"Barcode or Code already exists\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    return NextResponse.json(\r\n      { error: e.message || \"Save failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/* ================= PUT (EDIT) ================= */\r\nexport async function PUT(req: Request) {\r\n  const role = req.headers.get(\"x-user-role\");\r\n  if (role !== \"ADMIN\") {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await req.json();\r\n    const { id, name, unit, rate, minStock, barcode, description } = body;\r\n\r\n    if (!id || !name || !unit) {\r\n      return NextResponse.json(\r\n        { error: \"ID, Name & Unit required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const item = await prisma.itemNew.update({\r\n      where: { id },\r\n      data: {\r\n        name,\r\n        unit,\r\n        rate: Number(rate) || 0,\r\n        minStock: Number(minStock) || 0,\r\n        barcode: barcode ? String(barcode).trim() : null,\r\n        description: description || \"\",\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(item);\r\n  } catch (e: any) {\r\n    console.error(\"❌ ITEMS-NEW PUT ERROR:\", e);\r\n    if (e.code === \"P2002\") {\r\n      return NextResponse.json(\r\n        { error: \"Barcode already exists\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n    return NextResponse.json(\r\n      { error: e.message || \"Update failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/* ================= DELETE ================= */\r\nexport async function DELETE(req: Request) {\r\n  const role = req.headers.get(\"x-user-role\");\r\n  if (role !== \"ADMIN\") {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { error: \"ID required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Check if item is used in any invoices/transactions\r\n    const usedInSales = await prisma.salesInvoiceItem.findFirst({\r\n      where: { itemId: id },\r\n    });\r\n    const usedInPurchase = await prisma.purchaseInvoiceItem.findFirst({\r\n      where: { itemId: id },\r\n    });\r\n    const usedInInventory = await prisma.inventoryTxn.findFirst({\r\n      where: { itemId: id },\r\n    });\r\n\r\n    if (usedInSales || usedInPurchase || usedInInventory) {\r\n      return NextResponse.json(\r\n        { error: \"Cannot delete: Item is used in transactions\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await prisma.itemNew.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (e: any) {\r\n    console.error(\"❌ ITEMS-NEW DELETE ERROR:\", e);\r\n    return NextResponse.json(\r\n      { error: e.message || \"Delete failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\jv\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[144,147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[144,147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[243,246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[243,246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[673,676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[673,676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1618,1621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1618,1621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2067,2070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2067,2070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3942,3945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3942,3945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4572,4575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4572,4575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6670,6673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6670,6673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7219,7222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7219,7222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8308,8311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8308,8311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { PrismaClient, Prisma } from \"@prisma/client\";\n\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\n// GET - List all JVs\nexport async function GET(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const from = searchParams.get(\"from\");\n    const to = searchParams.get(\"to\");\n\n    const where: any = { type: \"JV\" };\n    if (from && to) {\n      where.date = {\n        gte: new Date(from + \"T00:00:00\"),\n        lte: new Date(to + \"T23:59:59\"),\n      };\n    }\n\n    const vouchers = await prisma.voucher.findMany({\n      where,\n      include: {\n        entries: {\n          include: {\n            account: true,\n          },\n        },\n      },\n      orderBy: { date: \"desc\" },\n    });\n\n   type VoucherWithEntries = Prisma.VoucherGetPayload<{\n  include: {\n    entries: {\n      include: {\n        account: true;\n      };\n    };\n  };\n}>;\n\n\n\n   const formatted = vouchers.map((v: VoucherWithEntries) => {\n  const totalDebit = v.entries.reduce(\n    (sum, e) => sum + (e.amount > 0 ? e.amount : 0),\n    0\n  );\n\n  const totalCredit = v.entries.reduce(\n    (sum, e) => sum + (e.amount < 0 ? Math.abs(e.amount) : 0),\n    0\n  );\n\n  return {\n    ...v,\n    totalDebit,\n    totalCredit,\n  };\n});\n\n\n\n    return NextResponse.json(formatted);\n  } catch (e: any) {\n    console.error(\"JV GET Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\nexport async function POST(req: Request) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    let requestBody;\n    try {\n      requestBody = await req.json();\n    } catch (parseError: any) {\n      console.error(\"❌ JV JSON PARSE ERROR:\", parseError);\n      return NextResponse.json(\n        { error: \"Invalid request body\", details: parseError.message },\n        { status: 400 }\n      );\n    }\n\n    const { entries, date, narration } = requestBody;\n\n    if (!date) {\n      return NextResponse.json(\n        { error: \"Date required\" },\n        { status: 400 }\n      );\n    }\n\n    if (!entries || !Array.isArray(entries) || entries.length < 2) {\n      return NextResponse.json(\n        { error: \"At least 2 entries required (Debit & Credit)\" },\n        { status: 400 }\n      );\n    }\n\n    // Validate entries\n    let totalDebit = 0;\n    let totalCredit = 0;\n\n    for (const entry of entries) {\n      const amount = Number(entry.amount);\n      if (!entry.accountId || isNaN(amount) || amount === 0) {\n        return NextResponse.json(\n          { error: \"All entries must have valid account and non-zero amount\" },\n          { status: 400 }\n        );\n      }\n\n      if (amount > 0) {\n        totalDebit += amount;\n      } else {\n        totalCredit += Math.abs(amount);\n      }\n    }\n\n    // Double entry validation\n    if (Math.abs(totalDebit - totalCredit) > 0.01) {\n      return NextResponse.json(\n        { error: `Debit (${totalDebit}) and Credit (${totalCredit}) must be equal` },\n        { status: 400 }\n      );\n    }\n\n    // Generate voucher number\n    const count = await prisma.voucher.count({ where: { type: \"JV\" } });\n    const voucherNo = `JV-${count + 1}`;\n\n    // Create voucher with entries in transaction\n    const result = await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n\n      const voucher = await tx.voucher.create({\n        data: {\n          voucherNo,\n          type: \"JV\",\n          date: new Date(date),\n          narration: narration || \"Journal Entry\",\n          entries: {\n            create: entries.map((entry: any) => ({\n              accountId: entry.accountId,\n              amount: Number(entry.amount), // +ve = Debit, -ve = Credit\n            })),\n          },\n        },\n        include: {\n          entries: {\n            include: {\n              account: true,\n            },\n          },\n        },\n      });\n\n      return voucher;\n    });\n\n    return NextResponse.json({\n      id: result.id,\n      voucherNo: result.voucherNo,\n      type: result.type,\n      date: result.date.toISOString().split('T')[0],\n      narration: result.narration,\n      entries: result.entries,\n      totalDebit,\n      totalCredit,\n    });\n  } catch (e: any) {\n    console.error(\"❌ JV ERROR:\", e);\n    return NextResponse.json(\n      { error: e.message || \"JV failed\", details: e.code || \"Unknown error\" },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Update JV\nexport async function PUT(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const { id, entries, date, narration } = body;\n\n    if (!id) {\n      return NextResponse.json({ error: \"Voucher ID required\" }, { status: 400 });\n    }\n\n    if (!entries || !Array.isArray(entries) || entries.length < 2) {\n      return NextResponse.json({ error: \"At least 2 entries required\" }, { status: 400 });\n    }\n\n    // Validate entries\n    let totalDebit = 0;\n    let totalCredit = 0;\n    for (const entry of entries) {\n      const amount = Number(entry.amount);\n      if (!entry.accountId || isNaN(amount) || amount === 0) {\n        return NextResponse.json({ error: \"All entries must have valid account and non-zero amount\" }, { status: 400 });\n      }\n      if (amount > 0) {\n        totalDebit += amount;\n      } else {\n        totalCredit += Math.abs(amount);\n      }\n    }\n\n    if (Math.abs(totalDebit - totalCredit) > 0.01) {\n      return NextResponse.json({ error: `Debit (${totalDebit}) and Credit (${totalCredit}) must be equal` }, { status: 400 });\n    }\n\n    const existing = await prisma.voucher.findUnique({\n      where: { id },\n      include: { entries: true },\n    });\n\n    if (!existing || existing.type !== \"JV\") {\n      return NextResponse.json({ error: \"JV not found\" }, { status: 404 });\n    }\n\n    const result = await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n\n\n      await tx.voucherEntry.deleteMany({ where: { voucherId: id } });\n\n      const voucher = await tx.voucher.update({\n        where: { id },\n        data: {\n          date: new Date(date),\n          narration: narration || \"Journal Entry\",\n          entries: {\n            create: entries.map((entry: any) => ({\n              accountId: entry.accountId,\n              amount: Number(entry.amount),\n            })),\n          },\n        },\n        include: {\n          entries: {\n            include: { account: true },\n          },\n        },\n      });\n\n      return voucher;\n    });\n\n    return NextResponse.json({\n      id: result.id,\n      voucherNo: result.voucherNo,\n      date: result.date.toISOString().split(\"T\")[0],\n      narration: result.narration,\n      entries: result.entries,\n      totalDebit,\n      totalCredit,\n    });\n  } catch (e: any) {\n    console.error(\"JV PUT Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// DELETE - Delete JV\nexport async function DELETE(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"Voucher ID required\" }, { status: 400 });\n    }\n\n    const existing = await prisma.voucher.findUnique({\n      where: { id },\n      include: { entries: true },\n    });\n\n    if (!existing || existing.type !== \"JV\") {\n      return NextResponse.json({ error: \"JV not found\" }, { status: 404 });\n    }\n\n    await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n\n      await tx.voucherEntry.deleteMany({ where: { voucherId: id } });\n      await tx.voucher.delete({ where: { id } });\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (e: any) {\n    console.error(\"JV DELETE Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\ledger\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[137,140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[137,140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[239,242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[239,242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma } from \"@prisma/client\";\r\n\r\nconst prisma =\r\n  (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const accountId = searchParams.get(\"accountId\");\r\n    if (!accountId) return NextResponse.json([]);\r\n\r\n    const entries = await prisma.voucherEntry.findMany({\r\n      where: { accountId },\r\n      include: { voucher: true },\r\n      orderBy: { voucher: { date: \"asc\" } },\r\n    });\r\n\r\n    type LedgerEntry = Prisma.VoucherEntryGetPayload<{\r\n  include: {\r\n    voucher: true;\r\n  };\r\n}>;\r\n\r\n\r\n    let balance = 0;\r\n\r\n    const rows = entries.map((e: LedgerEntry) => {\r\n\r\n      const debit = e.amount > 0 ? e.amount : 0;\r\n      const credit = e.amount < 0 ? Math.abs(e.amount) : 0;\r\n      balance += debit - credit;\r\n\r\n      return {\r\n        date: e.voucher.date.toISOString().slice(0, 10),\r\n        voucherNo: e.voucher.voucherNo,\r\n        narration: e.voucher.narration || \"\",\r\n        debit,\r\n        credit,\r\n        balance,\r\n      };\r\n    });\r\n\r\n    return NextResponse.json(rows);\r\n  } catch (e) {\r\n    console.error(\"LEDGER ERROR:\", e);\r\n    return NextResponse.json({ error: \"Ledger failed\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\login\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":4,"column":55,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":4,"endColumn":57,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[201,203],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[201,203],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[241,244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[241,244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[343,346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[343,346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2289,2292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2289,2292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3388,3391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3388,3391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4211,4214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4211,4214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4640,4643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4640,4643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4998,5001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4998,5001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma } from \"@prisma/client\";\r\nimport bcrypt from \"bcryptjs\";\r\ntype RolePermission = Prisma.RolePermissionGetPayload<{}>;\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    let body;\r\n    try {\r\n      body = await req.json();\r\n    } catch (parseError) {\r\n      console.error(\"❌ LOGIN JSON PARSE ERROR:\", parseError);\r\n      return NextResponse.json(\r\n        { message: \"Invalid request format\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const { email, password } = body;\r\n\r\n    if (!email || !password) {\r\n      return NextResponse.json(\r\n        { message: \"Username/Email and password required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const emailNormalized = email.trim().toLowerCase();\r\n    console.log(\"🔍 LOGIN ATTEMPT:\", { emailOrName: emailNormalized, hasPassword: !!password });\r\n\r\n    // Check database connection - search by email OR name\r\n    let user;\r\n    try {\r\n      // First try to find by email (exact match)\r\n      user = await prisma.user.findUnique({\r\n        where: { email: emailNormalized },\r\n        include: {\r\n          permissions: true,\r\n        },\r\n      });\r\n\r\n      // If not found, search by name OR email (case-insensitive)\r\n      if (!user) {\r\n        const allUsers = await prisma.user.findMany({\r\n          where: {\r\n            OR: [\r\n              {\r\n                email: {\r\n                  equals: emailNormalized,\r\n                  mode: \"insensitive\",\r\n                },\r\n              },\r\n              {\r\n                name: {\r\n                  equals: email.trim(), // Try exact name match\r\n                  mode: \"insensitive\",\r\n                },\r\n              },\r\n            ],\r\n          },\r\n          include: {\r\n            permissions: true,\r\n          },\r\n        });\r\n        user = allUsers[0] || null;\r\n      }\r\n\r\n      console.log(\"🔍 USER SEARCH:\", { searchTerm: emailNormalized });\r\n      console.log(\"🔍 USER FOUND:\", user ? { id: user.id, name: user.name, email: user.email, active: user.active } : \"NOT FOUND\");\r\n    } catch (dbError: any) {\r\n      console.error(\"❌ LOGIN DATABASE ERROR:\", dbError);\r\n      console.error(\"❌ DATABASE ERROR DETAILS:\", {\r\n        message: dbError.message,\r\n        code: dbError.code,\r\n        meta: dbError.meta,\r\n      });\r\n      return NextResponse.json(\r\n        { message: \"Database connection error. Please try again.\", error: dbError.message },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { message: \"Invalid username/email or password\" },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    if (!user.active) {\r\n      return NextResponse.json(\r\n        { message: \"Account is inactive. Please contact administrator.\" },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Verify password\r\n    let passwordMatch = false;\r\n    try {\r\n      console.log(\"🔐 PASSWORD CHECK:\", {\r\n        hasStoredPassword: !!user.password,\r\n        storedPasswordLength: user.password?.length,\r\n      });\r\n      passwordMatch = await bcrypt.compare(password, user.password);\r\n      console.log(\"🔐 PASSWORD MATCH:\", passwordMatch);\r\n    } catch (bcryptError: any) {\r\n      console.error(\"❌ LOGIN BCRYPT ERROR:\", bcryptError);\r\n      console.error(\"❌ BCRYPT ERROR DETAILS:\", {\r\n        message: bcryptError.message,\r\n        stack: bcryptError.stack,\r\n      });\r\n      return NextResponse.json(\r\n        { message: \"Password verification failed\", error: bcryptError.message },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    if (!passwordMatch) {\r\n      console.log(\"❌ PASSWORD MISMATCH\");\r\n      return NextResponse.json(\r\n        { message: \"Invalid username/email or password\" },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Fetch role-based permissions\r\n    let rolePermissions = [];\r\n    try {\r\n      rolePermissions = await prisma.rolePermission.findMany({\r\n        where: { role: user.role },\r\n        select: { permission: true },\r\n      });\r\n    } catch (permError: any) {\r\n      console.error(\"❌ LOGIN PERMISSIONS ERROR:\", permError);\r\n      // Continue without role permissions if error occurs\r\n    }\r\n\r\n    // 🔥 FRONTEND KE LIYE SAFE USER OBJECT (getCurrentUser() ke format ke mutabiq)\r\n    const safeUser = {\r\n      id: user.id,\r\n      name: user.name,\r\n      email: user.email,\r\n      role: user.role.toUpperCase(), // Ensure uppercase\r\n      permissions: (user.permissions || []).map((p: any) => p.permission || p), // User-specific permissions\r\n      rolePermissions: rolePermissions.map((rp: RolePermission) => rp.permission),\r\n\r\n    };\r\n\r\n    console.log(\"✅ LOGIN SUCCESS:\", { \r\n      userId: safeUser.id, \r\n      email: safeUser.email, \r\n      role: safeUser.role \r\n    });\r\n\r\n    return NextResponse.json({ user: safeUser });\r\n  } catch (e: any) {\r\n    console.error(\"❌ LOGIN ERROR:\", e);\r\n    console.error(\"❌ LOGIN ERROR DETAILS:\", {\r\n      message: e.message,\r\n      stack: e.stack,\r\n      name: e.name,\r\n    });\r\n    return NextResponse.json(\r\n      {\r\n        message: e.message || \"Login failed. Please try again.\",\r\n        error: process.env.NODE_ENV === \"development\" ? e.message : undefined,\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\logs\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[229,232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[229,232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[328,331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[328,331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\nimport { PrismaClient } from \"@prisma/client\";\nimport { apiHasPermission } from \"@/lib/apiPermission\";\nimport { PERMISSIONS } from \"@/lib/permissions\";\n\nconst prisma =\n  (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\nexport async function GET(req: Request) {\n  const userId = req.headers.get(\"x-user-id\");\n  const userRole = req.headers.get(\"x-user-role\");\n\n  const allowed = await apiHasPermission(\n    userId,\n    userRole,\n    PERMISSIONS.VIEW_LOGS\n  );\n\n  if (!allowed) {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  const logs = await prisma.activityLog.findMany({\n    orderBy: { createdAt: \"desc\" },\n    include: { user: true },\n  });\n\n  return NextResponse.json(logs);\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\me\\permissions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\outward\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[146,149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[146,149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[244,247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[244,247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1025,1028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1025,1028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1269,1272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1269,1272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2237,2240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2237,2240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3191,3194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3191,3194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3552,3555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3552,3555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4400,4403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4400,4403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { PrismaClient, Prisma } from \"@prisma/client\";\n\n\nconst prisma =\n  (globalThis as any).prisma || new PrismaClient();\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\n// ---------- POST ----------\nexport async function POST(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { date, customerId, driverName, vehicleNo, remarks, items } =\n      await req.json();\n\n    const last = await prisma.outward.findFirst({\n      orderBy: { outwardNo: \"desc\" },\n    });\n\n    const nextNo = last ? last.outwardNo + 1 : 1;\n\n    const entry = await prisma.outward.create({\n      data: {\n        outwardNo: nextNo,\n        date: new Date(date),\n        customerId,\n        driverName,\n        vehicleNo,\n        remarks,\n        items: {\n          create: items.map((i: any) => ({\n            itemId: i.itemId,\n            qty: Number(i.qty),\n            rate: 0,\n            amount: 0,\n          })),\n        },\n      },\n      include: { items: true },\n    });\n\n    return NextResponse.json(entry);\n  } catch (e: any) {\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// ---------- GET ----------\nexport async function GET(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const from = req.nextUrl.searchParams.get(\"from\");\n    const to = req.nextUrl.searchParams.get(\"to\");\n    const customerId = req.nextUrl.searchParams.get(\"customerId\");\n\n    const data = await prisma.outward.findMany({\n      where: {\n        date: {\n          gte: from ? new Date(from) : undefined,\n          lte: to ? new Date(to + \"T23:59:59\") : undefined,\n        },\n        customerId: customerId || undefined,\n      },\n      include: {\n        customer: true,\n        items: { include: { item: true } },\n      },\n      orderBy: { outwardNo: \"desc\" },\n    });\n\n    return NextResponse.json(data);\n  } catch (e: any) {\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// PUT - Update Outward\nexport async function PUT(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const { id, date, customerId, driverName, vehicleNo, remarks, items } = body;\n\n    if (!id) {\n      return NextResponse.json({ error: \"Outward ID required\" }, { status: 400 });\n    }\n\n    const result = async (tx: Prisma.TransactionClient) => {\n\n      await tx.outwardItem.deleteMany({ where: { outwardId: id } });\n\n      const outward = await tx.outward.update({\n        where: { id },\n        data: {\n          date: new Date(date),\n          customerId,\n          driverName,\n          vehicleNo,\n          remarks,\n          items: {\n            create: items.map((i: any) => ({\n              itemId: i.itemId,\n              qty: Number(i.qty),\n              rate: 0,\n              amount: 0,\n            })),\n          },\n        },\n        include: {\n          customer: true,\n          items: { include: { item: true } },\n        },\n      });\n\n      return outward;\n    };\n\n    return NextResponse.json(result);\n  } catch (e: any) {\n    console.error(\"Outward PUT Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// DELETE - Delete Outward\nexport async function DELETE(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"Outward ID required\" }, { status: 400 });\n    }\n\n    await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n      await tx.outwardItem.deleteMany({ where: { outwardId: id } });\n      await tx.outward.delete({ where: { id } });\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (e: any) {\n    console.error(\"Outward DELETE Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\payment-receipts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[135,138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[135,138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[234,237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[234,237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[475,478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[475,478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3617,3620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3617,3620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5794,5797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5794,5797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const status = searchParams.get('status');\n    const partyId = searchParams.get('partyId');\n\n    const filter: any = {};\n    if (status) filter.status = status;\n    if (partyId) filter.partyId = partyId;\n\n    const receipts = await prisma.paymentReceipt.findMany({\n      where: filter,\n      include: {\n        party: true,\n        voucher: { include: { entries: true } },\n      },\n      orderBy: { date: 'desc' },\n    });\n\n    return NextResponse.json(receipts);\n  } catch (error) {\n    console.error('Error fetching payment receipts:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch payment receipts' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const {\n      receiptNo: providedReceiptNo,\n      date,\n      amount,\n      paymentMode,\n      partyId,\n      referenceNo,\n      narration,\n      bankAccountId, // New: which bank/cash account received this\n    } = body;\n\n    // Validation\n    if (!partyId || !amount || !date) {\n      return NextResponse.json(\n        { error: 'Party, amount, and date are required' },\n        { status: 400 }\n      );\n    }\n\n    const amountNum = parseFloat(amount);\n    if (isNaN(amountNum) || amountNum <= 0) {\n      return NextResponse.json(\n        { error: 'Invalid amount' },\n        { status: 400 }\n      );\n    }\n\n    // Get party (customer)\n    const party = await prisma.account.findUnique({\n      where: { id: partyId },\n    });\n\n    if (!party) {\n      return NextResponse.json(\n        { error: 'Party not found' },\n        { status: 404 }\n      );\n    }\n\n    // Auto-generate receipt number if not provided\n    let receiptNo = providedReceiptNo;\n    if (!receiptNo) {\n      const count = await prisma.paymentReceipt.count();\n      receiptNo = `REC-${count + 1}`;\n    }\n\n    // Get payment account (bank or cash)\n    let paymentAccount;\n    let bankAccountRecord = null;\n\n    if (paymentMode === 'BANK_TRANSFER' || paymentMode === 'CHEQUE') {\n      if (!bankAccountId) {\n        return NextResponse.json(\n          { error: 'Bank account required for bank/cheque payments' },\n          { status: 400 }\n        );\n      }\n\n      // Find bank account\n      bankAccountRecord = await prisma.bankAccount.findUnique({\n        where: { id: bankAccountId },\n        include: { account: true },\n      });\n\n      if (!bankAccountRecord) {\n        return NextResponse.json(\n          { error: 'Bank account not found' },\n          { status: 404 }\n        );\n      }\n\n      paymentAccount = bankAccountRecord.account;\n    } else {\n      // CASH mode - find Cash account\n      paymentAccount = await prisma.account.findFirst({\n        where: {\n          OR: [\n            { name: { contains: 'Cash', mode: 'insensitive' } },\n            { code: { contains: 'CASH', mode: 'insensitive' } },\n          ],\n        },\n      });\n\n      if (!paymentAccount) {\n        // Create Cash account if doesn't exist\n        paymentAccount = await prisma.account.create({\n          data: {\n            code: 'CASH',\n            name: 'Cash',\n            type: 'ASSET',\n          },\n        });\n      }\n    }\n\n    // Create voucher and payment receipt in transaction\n    const result = await prisma.$transaction(async (tx: any) => {\n      // 1. Create voucher (like CRV)\n      const voucher = await tx.voucher.create({\n        data: {\n          voucherNo: receiptNo,\n          type: 'CRV', // Payment Receipt = Cash Receipt Voucher\n          date: new Date(date),\n          narration: narration || `Payment received from ${party.name}`,\n          entries: {\n            create: [\n              { accountId: party.id, amount: -amountNum }, // Customer debit (they owe less)\n              { accountId: paymentAccount.id, amount: amountNum }, // Cash/Bank credit (we received)\n            ],\n          },\n        },\n      });\n\n      // 2. Create payment receipt\n      // Determine status based on payment mode\n      let status = 'CLEARED'; // Default: CLEARED for cash and bank transfers\n      if (paymentMode === 'CHEQUE') {\n        status = 'PENDING'; // Cheque pending until it clears\n      }\n\n      const receipt = await tx.paymentReceipt.create({\n        data: {\n          receiptNo,\n          date: new Date(date),\n          amount: amountNum,\n          paymentMode,\n          partyId,\n          referenceNo,\n          narration,\n          voucherId: voucher.id,\n          status,\n        },\n        include: {\n          party: true,\n          voucher: { include: { entries: true } },\n        },\n      });\n\n      // 3. Update bank balance if bank payment\n      if ((paymentMode === 'BANK_TRANSFER' || paymentMode === 'CHEQUE') && bankAccountRecord) {\n        await tx.bankAccount.update({\n          where: { id: bankAccountRecord.id },\n          data: {\n            balance: { increment: amountNum },\n          },\n        });\n\n        // Create bank statement entry\n        await tx.bankStatement.create({\n          data: {\n            bankAccountId: bankAccountRecord.id,\n            statementNo: `STMT-${Date.now()}`,\n            date: new Date(date),\n            amount: amountNum, // Positive for receipt\n            description: narration || `Receipt ${receiptNo} from ${party.name}`,\n            referenceNo: receiptNo,\n            isReconciled: false,\n          },\n        });\n      }\n\n      return receipt;\n    });\n\n    return NextResponse.json(result, { status: 201 });\n  } catch (error: any) {\n    console.error('Error creating payment receipt:', error);\n    return NextResponse.json(\n      { error: error.message || 'Failed to create payment receipt' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const { id, ...updateData } = body;\n\n    if (updateData.date) {\n      updateData.date = new Date(updateData.date);\n    }\n\n    const receipt = await prisma.paymentReceipt.update({\n      where: { id },\n      data: updateData,\n      include: {\n        party: true,\n        voucher: { include: { entries: true } },\n      },\n    });\n\n    return NextResponse.json(receipt);\n  } catch (error) {\n    console.error('Error updating payment receipt:', error);\n    return NextResponse.json(\n      { error: 'Failed to update payment receipt' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function DELETE(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get('id');\n\n    if (!id) {\n      return NextResponse.json(\n        { error: 'ID required' },\n        { status: 400 }\n      );\n    }\n\n    await prisma.paymentReceipt.delete({\n      where: { id },\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting payment receipt:', error);\n    return NextResponse.json(\n      { error: 'Failed to delete payment receipt' },\n      { status: 500 }\n    );\n  }\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\payroll\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2528,2531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2528,2531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { requireRole } from \"@/lib/requireRole\";\nimport { prisma } from \"@/lib/prisma\";\n\n// GET: Fetch payroll records\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const employeeId = searchParams.get(\"employeeId\");\n    const monthYear = searchParams.get(\"monthYear\");\n    const status = searchParams.get(\"status\");\n\n    const payroll = await prisma.payroll.findMany({\n      where: {\n        employeeId: employeeId || undefined,\n        monthYear: monthYear || undefined,\n        paymentStatus: status || undefined,\n      },\n      select: {\n        id: true,\n        employeeId: true,\n        monthYear: true,\n        baseSalary: true,\n        allowances: true,\n        deductions: true,\n        deductionReason: true,\n        additionalCash: true,\n        netSalary: true,\n        paymentStatus: true,\n        employee: { select: { firstName: true, lastName: true, salary: true, employeeId: true } }\n      },\n      orderBy: { monthYear: \"desc\" },\n    });\n\n    return NextResponse.json(payroll);\n  } catch (error) {\n    console.error(\"Error fetching payroll:\", error);\n    return NextResponse.json({ error: \"Failed to fetch payroll\" }, { status: 500 });\n  }\n}\n\n// POST: Create payroll\nexport async function POST(req: NextRequest) {\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\n  if (guard) return guard;\n\n  try {\n    const body = await req.json();\n    const {\n      employeeId,\n      monthYear,\n      baseSalary,\n      allowances,\n      deductions,\n      deductionReason,\n      additionalCash,\n    } = body;\n\n    if (!employeeId || !monthYear || !baseSalary) {\n      return NextResponse.json(\n        { error: \"employeeId, monthYear, and baseSalary are required\" },\n        { status: 400 }\n      );\n    }\n\n    // Net Salary should be strictly Earnings - Deductions.\n    // Additional Cash is a payment/advance that reduces the balance (or increases debt), \n    // calculated dynamically as (NetSalary - AdditionalCash).\n    const netSalary = baseSalary + (allowances || 0) - (deductions || 0);\n\n    const payroll = await prisma.payroll.create({\n      data: {\n        employeeId,\n        monthYear,\n        baseSalary,\n        allowances: allowances || 0,\n        deductions: deductions || 0,\n        deductionReason: deductionReason || null,\n        additionalCash: additionalCash || 0,\n        netSalary,\n      },\n    });\n\n    return NextResponse.json(payroll, { status: 201 });\n  } catch (error: any) {\n    if (error.code === \"P2002\") {\n      return NextResponse.json(\n        { error: \"Payroll record for this employee and month already exists\" },\n        { status: 400 }\n      );\n    }\n    console.error(\"Error creating payroll:\", error);\n    return NextResponse.json({ error: \"Failed to create payroll\" }, { status: 500 });\n  }\n}\n\n// PUT: Update payroll\nexport async function PUT(req: NextRequest) {\n  const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\n  if (guard) return guard;\n\n  try {\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\n    }\n\n    const body = await req.json();\n    \n    // Recalculate netSalary if needed\n    if (body.baseSalary || body.allowances || body.deductions || body.additionalCash !== undefined) {\n      const existing = await prisma.payroll.findUnique({ where: { id } });\n      if (existing) {\n        // Net Salary = Earnings - Deductions (Excluding Additional Cash)\n        body.netSalary = (body.baseSalary || existing.baseSalary) + \n                         (body.allowances || existing.allowances) - \n                         (body.deductions || existing.deductions);\n      }\n    }\n\n    const payroll = await prisma.payroll.update({\n      where: { id },\n      data: body,\n    });\n\n    return NextResponse.json(payroll);\n  } catch (error) {\n    console.error(\"Error updating payroll:\", error);\n    return NextResponse.json({ error: \"Failed to update payroll\" }, { status: 500 });\n  }\n}\n\n// DELETE: Delete payroll\nexport async function DELETE(req: NextRequest) {\n    const guard = requireRole(req, [\"ADMIN\", \"ACCOUNTANT\"]);\n    if (guard) return guard;\n  \n    try {\n      const { searchParams } = new URL(req.url);\n      const id = searchParams.get(\"id\");\n  \n      if (!id) {\n        return NextResponse.json({ error: \"ID is required\" }, { status: 400 });\n      }\n  \n      await prisma.payroll.delete({\n        where: { id },\n      });\n  \n      return NextResponse.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting payroll:\", error);\n      return NextResponse.json({ error: \"Failed to delete payroll\" }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\permissions\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[133,136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[133,136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":5,"column":55,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":5,"endColumn":57,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[223,225],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[223,225],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[297,300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[297,300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma} from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\ntype RolePermission = Prisma.RolePermissionGetPayload<{}>;\r\n\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  const role = new URL(req.url).searchParams.get(\"role\") || \"\";\r\n  const perms = await prisma.rolePermission.findMany({ where: { role } });\r\n return NextResponse.json(\r\n  perms.map((p: RolePermission) => p.permission)\r\n);\r\n\r\n\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  const headerRole = req.headers.get(\"x-user-role\");\r\n  if (headerRole !== \"ADMIN\") {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  const { role, permissions } = await req.json();\r\n\r\n  await prisma.rolePermission.deleteMany({ where: { role } });\r\n  await prisma.rolePermission.createMany({\r\n    data: permissions.map((p: string) => ({ role, permission: p })),\r\n  });\r\n\r\n  return NextResponse.json({ success: true });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\purchase-invoice\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Prisma' is defined but never used.","line":2,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":30,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Prisma"},"fix":{"range":[66,73],"text":""},"desc":"Remove unused variable \"Prisma\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[130,133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[130,133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[229,232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[229,232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1837,1840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1837,1840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2571,2574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2571,2574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3915,3918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3915,3918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4711,4714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4711,4714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5927,5930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5927,5930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6841,6844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6841,6844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supplierId' is assigned a value but never used.","line":227,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":227,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'location' is assigned a value but never used.","line":227,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":227,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":244,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7874,7877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7874,7877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":245,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7976,7979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7976,7979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8851,8854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8851,8854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9366,9369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9366,9369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":323,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10252,10255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10252,10255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\nimport { PrismaClient ,Prisma } from \"@prisma/client\";\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\n/* ================= GET: Pending POs for Selection OR All Purchase Invoices ================= */\nexport async function GET(req: Request) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const type = searchParams.get(\"type\");\n    const id = searchParams.get(\"id\");\n\n    // If id provided, return specific invoice\n    if (id) {\n      const invoice = await prisma.purchaseInvoice.findUnique({\n        where: { id },\n        include: {\n          supplier: true,\n          items: {\n            include: { item: true },\n          },\n        },\n      });\n      if (!invoice) return NextResponse.json({ error: \"Not found\" }, { status: 404 });\n      return NextResponse.json(invoice);\n    }\n\n    // If type=invoices, return all purchase invoices\n    if (type === \"invoices\") {\n      const invoices = await prisma.purchaseInvoice.findMany({\n        include: {\n          supplier: true,\n          items: {\n            include: { item: true },\n          },\n        },\n        orderBy: { createdAt: \"desc\" },\n      });\n      return NextResponse.json(invoices);\n    }\n\n    // Default: return pending POs\n    const pos = await prisma.purchaseOrder.findMany({\n      where: { status: \"PENDING\" },\n      include: {\n        supplier: true,\n        items: {\n          include: { item: true },\n        },\n      },\n      orderBy: { createdAt: \"desc\" },\n    });\n    return NextResponse.json(pos);\n  } catch (e: any) {\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n/* ================= POST: Create Invoice & Update Everything ================= */\nexport async function POST(req: Request) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  try {\n    const body = await req.json();\n    const { supplierId, poId, date, items, location, freight = 0, applyTax = false, taxConfigId = null } = body;\n\n    // 1. Validation\n    if (!supplierId || !date || !items?.length) {\n      return NextResponse.json({ error: \"Data missing\" }, { status: 400 });\n    }\n\n    const validItems = items.filter((i: any) => Number(i.qty) > 0 && i.itemId);\n\n    // 2. Start Transaction (Disabled due to Supabase connection issues)\n    // const result = await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n    const tx = prisma;\n      \n      // A. Supplier اور Inventory Account تلاش کریں\n      const supplier = await tx.account.findUnique({ where: { id: supplierId } });\n      if (!supplier) throw new Error(\"Supplier not found\");\n\n      let inventoryAcc = await tx.account.findFirst({\n        where: {\n          OR: [\n            { name: { equals: \"Stock/Inventory\", mode: \"insensitive\" } },\n            { code: { equals: \"INV001\", mode: \"insensitive\" } },\n          ],\n        },\n      });\n\n      if (!inventoryAcc) {\n        inventoryAcc = await tx.account.create({\n          data: { code: \"INV001\", name: \"Stock/Inventory\", type: \"ASSET\" },\n        });\n      }\n\n      // B. Invoice Number جنریٹ کریں (PI-1, PI-2...)\n      const last = await tx.purchaseInvoice.findFirst({\n        where: { invoiceNo: { startsWith: \"PI-\" } },\n        orderBy: { createdAt: \"desc\" },\n      });\n      let nextNo = 1;\n      if (last?.invoiceNo) {\n        const n = parseInt(last.invoiceNo.replace(\"PI-\", \"\"));\n        if (!isNaN(n)) nextNo = n + 1;\n      }\n      const invoiceNo = `PI-${nextNo}`;\n\n      const totalItemsAmount = validItems.reduce((s: number, i: any) => s + (Number(i.qty) * Number(i.rate)), 0);\n      \n      // Calculate tax if applied\n      let taxAmount = 0;\n      if (applyTax && taxConfigId) {\n        const tax = await tx.taxConfiguration.findUnique({\n          where: { id: taxConfigId }\n        });\n        if (tax) {\n          taxAmount = (totalItemsAmount * tax.taxRate) / 100;\n        }\n      }\n      \n      const netTotal = totalItemsAmount + Number(freight) + taxAmount;\n\n      // C. Purchase Invoice ریکارڈ کریں\n      const invoice = await tx.purchaseInvoice.create({\n        data: {\n          invoiceNo,\n          date: new Date(date),\n          supplierId,\n          poId: poId || null,\n          total: netTotal,\n          taxConfigId: applyTax ? taxConfigId : null,\n          items: {\n            create: validItems.map((i: any) => ({\n              itemId: i.itemId,\n              qty: Number(i.qty),\n              rate: Number(i.rate),\n              amount: Number(i.qty) * Number(i.rate),\n            })),\n          },\n        },\n      });\n\n      // D. اسٹاک اور PO اپڈیٹ کریں\n      for (const i of validItems) {\n        // 1. Inventory میں مال داخل کریں (Stock In)\n        await tx.inventoryTxn.create({\n          data: {\n            type: \"PURCHASE\",\n            date: new Date(date),\n            itemId: i.itemId,\n            qty: Math.abs(Number(i.qty)), // پلس میں اسٹاک\n            rate: Number(i.rate),\n            amount: Number(i.qty) * Number(i.rate),\n            location: location || \"MAIN\",\n            partyId: supplierId,\n          },\n        });\n\n        // 2. اگر PO سلیکٹڈ ہے تو اس کی invoicedQty اپڈیٹ کریں\n        if (poId) {\n          await tx.purchaseOrderItem.updateMany({\n            where: { poId: poId, itemId: i.itemId },\n            data: { invoicedQty: { increment: Number(i.qty) } },\n          });\n        }\n      }\n\n      // E. اگر PO ہے تو اس کا اسٹیٹس چیک کریں\n      if (poId) {\n        const allItems = await tx.purchaseOrderItem.findMany({ where: { poId } });\n        const isDone = allItems.every((pi: any) => pi.invoicedQty >= pi.qty);\n        await tx.purchaseOrder.update({\n          where: { id: poId },\n          data: { status: isDone ? \"COMPLETED\" : \"PENDING\" },\n        });\n      }\n\n      // F. اکاؤنٹنگ واؤچر (Double Entry) – Inventory (Asset) کو Debit کریں\n      await tx.voucher.create({\n        data: {\n          voucherNo: invoiceNo,\n          type: \"PI\",\n          date: new Date(date),\n          narration: `Purchase Invoice ${invoiceNo} from ${supplier.name}`,\n          entries: {\n            create: [\n              { accountId: inventoryAcc.id, amount: netTotal }, // Debit Inventory (Asset)\n              { accountId: supplier.id, amount: -netTotal },    // Credit Supplier\n            ],\n          },\n        },\n      });\n\n      // return invoice;\n    // });\n    const result = invoice;\n\n    return NextResponse.json({ success: true, id: result.id, invoiceNo: result.invoiceNo });\n  } catch (e: any) {\n    console.error(\"PI ERROR:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// PUT - Update Purchase Invoice\nexport async function PUT(req: Request) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  try {\n    const body = await req.json();\n    const { id, supplierId, date, items, location, freight = 0, applyTax = false, taxConfigId = null } = body;\n\n    if (!id) {\n      return NextResponse.json({ error: \"Invoice ID required\" }, { status: 400 });\n    }\n\n    const existing = await prisma.purchaseInvoice.findUnique({\n      where: { id },\n      include: { items: true },\n    });\n\n    if (!existing) {\n      return NextResponse.json({ error: \"Invoice not found\" }, { status: 404 });\n    }\n\n    // Note: Updating purchase invoices is complex due to inventory transactions\n    // For now, we'll just update the invoice data\n    const validItems = items.filter((i: any) => Number(i.qty) > 0 && i.itemId);\n    const totalItemsAmount = validItems.reduce((s: number, i: any) => s + (Number(i.qty) * Number(i.rate)), 0);\n    \n    // Calculate tax if applied\n    let taxAmount = 0;\n    if (applyTax && taxConfigId) {\n      const tax = await prisma.taxConfiguration.findUnique({\n        where: { id: taxConfigId }\n      });\n      if (tax) {\n        taxAmount = (totalItemsAmount * tax.taxRate) / 100;\n      }\n    }\n    \n    const netTotal = totalItemsAmount + Number(freight) + taxAmount;\n\n    // const result = await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n    const tx = prisma;\n\n      await tx.purchaseInvoiceItem.deleteMany({ where: { invoiceId: id } });\n\n      const invoice = await tx.purchaseInvoice.update({\n        where: { id },\n        data: {\n          date: new Date(date),\n          total: netTotal,\n          taxConfigId: applyTax ? taxConfigId : null,\n          items: {\n            create: validItems.map((i: any) => ({\n              itemId: i.itemId,\n              qty: Number(i.qty),\n              rate: Number(i.rate),\n              amount: Number(i.qty) * Number(i.rate),\n            })),\n          },\n        },\n        include: {\n          supplier: true,\n          items: {\n            include: { item: true },\n          },\n          taxConfig: true\n        },\n      });\n\n      // return invoice;\n    // });\n    const result = invoice;\n\n    return NextResponse.json({ success: true, invoice: result });\n  } catch (e: any) {\n    console.error(\"PI PUT ERROR:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// DELETE - Delete Purchase Invoice\nexport async function DELETE(req: Request) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  try {\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"Invoice ID required\" }, { status: 400 });\n    }\n\n    // await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n    const tx = prisma;\n\n      await tx.purchaseInvoiceItem.deleteMany({ where: { invoiceId: id } });\n      await tx.purchaseInvoice.delete({ where: { id } });\n    // });\n\n    return NextResponse.json({ success: true });\n  } catch (e: any) {\n    console.error(\"PI DELETE ERROR:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\purchase-order\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[130,133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[130,133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[229,232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[229,232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[809,812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[809,812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3206,3209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3206,3209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\nimport { PrismaClient,Prisma } from \"@prisma/client\";\nconst prisma =\n  (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\n\nexport async function POST(req: Request) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  const { poNo, supplierId, date, items, remarks } = await req.json();\n\n  const po = await prisma.purchaseOrder.create({\n    data: {\n      poNo,\n      supplierId,\n      date: new Date(date),\n      remarks: remarks || \"\",\n      status: \"PENDING\", // 🔴 یہ لائن شامل کرنا ضروری تھی جو مسنگ تھی\n      items: {\n        create: items.map((i: any) => ({\n          itemId: i.itemId,\n          qty: Number(i.qty),\n          rate: Number(i.rate || 0),\n        })),\n      },\n    },\n  });\n\n  return NextResponse.json(po);\n}\n\nexport async function GET(req: Request) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  const { searchParams } = new URL(req.url);\n  const id = searchParams.get(\"id\");\n\n  // If ID provided, return single PO\n  if (id) {\n    const po = await prisma.purchaseOrder.findUnique({\n      where: { id },\n      include: {\n        supplier: true,\n        items: {\n          include: { item: true },\n        },\n      },\n    });\n    return NextResponse.json(po || { error: \"Not found\" }, { status: po ? 200 : 404 });\n  }\n\n  // Check if requesting next PO number\n  const nextNo = searchParams.get(\"nextNo\");\n  if (nextNo === \"true\") {\n    const last = await prisma.purchaseOrder.findFirst({\n      where: { poNo: { startsWith: \"PO #\" } },\n      orderBy: { createdAt: \"desc\" },\n      select: { poNo: true },\n    });\n    let next = 1;\n    if (last?.poNo) {\n      const n = parseInt(last.poNo.replace(/\\D/g, \"\"));\n      if (!isNaN(n)) next = n + 1;\n    }\n    return NextResponse.json({ poNo: `PO # ${next}` });\n  }\n\n  // Return all POs\n  const pos = await prisma.purchaseOrder.findMany({\n    include: {\n      supplier: true,\n      items: {\n        include: { item: true },\n      },\n    },\n    orderBy: { createdAt: \"desc\" },\n  });\n\n  return NextResponse.json(pos);\n}\n\n// PUT - Update Purchase Order\nexport async function PUT(req: Request) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  const { id, poNo, supplierId, date, items, remarks } = await req.json();\n\n  if (!id) {\n    return NextResponse.json({ error: \"PO ID required\" }, { status: 400 });\n  }\n\n  const result = await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n\n    // Delete old items\n    await tx.purchaseOrderItem.deleteMany({ where: { poId: id } });\n\n    // Update PO\n    const po = await tx.purchaseOrder.update({\n      where: { id },\n      data: {\n        poNo,\n        supplierId,\n        date: new Date(date),\n        remarks: remarks || \"\",\n        items: {\n          create: items.map((i: any) => ({\n            itemId: i.itemId,\n            qty: Number(i.qty),\n            rate: Number(i.rate || 0),\n          })),\n        },\n      },\n      include: {\n        supplier: true,\n        items: {\n          include: { item: true },\n        },\n      },\n    });\n\n    return po;\n  });\n\n  return NextResponse.json(result);\n}\n\n// DELETE - Delete Purchase Order\nexport async function DELETE(req: Request) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  const { searchParams } = new URL(req.url);\n  const id = searchParams.get(\"id\");\n\n  if (!id) {\n    return NextResponse.json({ error: \"PO ID required\" }, { status: 400 });\n  }\n\n  await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n    await tx.purchaseOrderItem.deleteMany({ where: { poId: id } });\n    await tx.purchaseOrder.delete({ where: { id } });\n  });\n\n  return NextResponse.json({ success: true });\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\quotation\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QuotationInput' is defined but never used.","line":6,"column":6,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":93,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4377,4380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4377,4380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6117,6120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6117,6120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":228,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":228,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { z } from \"zod\";\n\ntype QuotationInput = {\n  id?: string;\n  quotationNo?: string;   // 👈 THIS IS THE KEY\n  date: string;\n  validUntil?: string | null;\n  customerId?: string | null;\n  customerName?: string | null;\n  status?: \"DRAFT\" | \"SENT\" | \"APPROVED\" | \"REJECTED\";\n  items: {\n    itemId: string;\n    qty: number;\n    rate: number;\n    amount: number;\n  }[];\n};\n\n\n// VALIDATION SCHEMA\nconst quotationSchema = z.object({\n  id: z.string().optional(),\n  quotationNo: z.string().optional(), // ✅ ADD THIS\n  date: z.string(),\n  validUntil: z.string().optional().nullable(),\n  customerId: z.string().optional().nullable(),\n  customerName: z.string().optional().nullable(),\n  items: z.array(\n    z.object({\n      itemId: z.string(),\n      qty: z.number().min(1),\n      rate: z.number().min(0),\n      amount: z.number(),\n    })\n  ),\n  status: z.enum([\"DRAFT\", \"SENT\", \"ACCEPTED\", \"REJECTED\"]).optional(),\n});\n\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (id) {\n      const quotation = await prisma.quotation.findUnique({\n        where: { id },\n        include: {\n          customer: true,\n          items: {\n            include: { item: true },\n          },\n        },\n      });\n      if (!quotation) return NextResponse.json({ error: \"Quotation not found\" }, { status: 404 });\n      return NextResponse.json({ quotation });\n    }\n\n    // Calculate next quotation number\n    const allQuotations = await prisma.quotation.findMany({\n      where: { quotationNo: { startsWith: \"QT-\" } },\n      select: { quotationNo: true }\n    });\n\n    let nextNo = \"QT-0001\";\n    if (allQuotations.length > 0) {\n      const numbers = allQuotations.map((q) => {\n        const n = parseInt(q.quotationNo.replace(\"QT-\", \"\"));\n        return isNaN(n) ? 0 : n;\n      });\n\n      const maxNum = Math.max(...numbers);\n      nextNo = `QT-${String(maxNum + 1).padStart(4, \"0\")}`;\n    }\n\n    const quotations = await prisma.quotation.findMany({\n      include: {\n        customer: true,\n        items: {\n          include: { item: true },\n        },\n      },\n      orderBy: { createdAt: \"desc\" },\n    });\n\n    return NextResponse.json({\n      nextNo,\n      quotations\n    });\n  } catch (error) {\n    return NextResponse.json({ error: \"Failed to fetch quotations\" }, { status: 500 });\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (!role || (role !== \"ADMIN\" && role !== \"ACCOUNTANT\")) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const data = quotationSchema.parse(body);\n\n    // Auto-generate Quotation No if not provided or ensure uniqueness?\n    // The previous code generated it. Let's keep it but handle if user provided one?\n    // The previous code:\n    // const count = await prisma.quotation.count();\n    // const quotationNo = `QT-${String(count + 1).padStart(4, \"0\")}`;\n    // This is simple counting, might duplicate if deletions happen.\n    // Better to use the max logic or just trust the one sent?\n    // The frontend sends `quotationNo`.\n    // Let's use the one from frontend if valid, or generate if missing.\n    \n    let quotationNo = data.quotationNo;\n    if (!quotationNo) {\n       const count = await prisma.quotation.count();\n       quotationNo = `QT-${String(count + 1).padStart(4, \"0\")}`;\n    }\n\n    const quotation = await prisma.quotation.create({\n      data: {\n        quotationNo, // Use the one we decided on\n        date: new Date(data.date),\n        validUntil: data.validUntil ? new Date(data.validUntil) : null,\n        customerId: data.customerId || null,\n        customerName: data.customerName || null,\n        status: data.status || \"DRAFT\",\n        total: data.items.reduce((sum, item) => sum + item.amount, 0),\n        items: {\n          create: data.items.map((item) => ({\n            itemId: item.itemId,\n            qty: item.qty,\n            rate: item.rate,\n            amount: item.amount,\n          })),\n        },\n      },\n      include: {\n        customer: true,\n        items: {\n          include: { item: true },\n        },\n      },\n    });\n\n    return NextResponse.json({ quotation });\n  } catch (error: any) {\n    console.error(\"Create Quotation Error:\", error);\n    return NextResponse.json({ error: error.message || \"Failed to create quotation\" }, { status: 400 });\n  }\n}\n\nexport async function PUT(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (!role || (role !== \"ADMIN\" && role !== \"ACCOUNTANT\")) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const data = quotationSchema.parse(body);\n\n    if (!data.id) return NextResponse.json({ error: \"ID required\" }, { status: 400 });\n\n    // Transaction to update: delete old items, create new ones\n    const updated = await prisma.$transaction(async (tx) => {\n      // 1. Delete existing items\n      await tx.quotationItem.deleteMany({\n        where: { quotationId: data.id },\n      });\n\n      // 2. Update Quotation\n      return await tx.quotation.update({\n        where: { id: data.id },\n        data: {\n          date: new Date(data.date),\n          validUntil: data.validUntil ? new Date(data.validUntil) : null,\n          customerId: data.customerId || null,\n          customerName: data.customerName || null,\n          status: data.status || \"DRAFT\",\n          total: data.items.reduce((sum, item) => sum + item.amount, 0),\n          items: {\n            create: data.items.map((item) => ({\n              itemId: item.itemId,\n              qty: item.qty,\n              rate: item.rate,\n              amount: item.amount,\n            })),\n          },\n        },\n        include: {\n          customer: true,\n          items: {\n            include: { item: true },\n          },\n        },\n      });\n    });\n\n    return NextResponse.json({ quotation: updated });\n\n  } catch (error: any) {\n    console.error(\"Update Quotation Error:\", error);\n    return NextResponse.json({ error: error.message || \"Failed to update quotation\" }, { status: 400 });\n  }\n}\n\nexport async function DELETE(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (!role || (role !== \"ADMIN\" && role !== \"ACCOUNTANT\")) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n    if (!id) return NextResponse.json({ error: \"ID required\" }, { status: 400 });\n\n    await prisma.quotation.delete({\n      where: { id },\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    return NextResponse.json({ error: \"Failed to delete quotation\" }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\recurring-transactions\\process\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":11,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1738,1741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1738,1741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1998,2001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1998,2001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2800,2803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2800,2803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3629,3632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3629,3632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4432,4435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4432,4435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n// Process recurring transactions that are due\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    // Find all active recurring transactions due today or earlier\r\n    const dueTransactions = await prisma.recurringTransaction.findMany({\r\n      where: {\r\n        isActive: true,\r\n        nextDate: { lte: today },\r\n      },\r\n      include: { account: true },\r\n    });\r\n\r\n    const results = [];\r\n\r\n    for (const transaction of dueTransactions) {\r\n      try {\r\n        // Calculate next date based on frequency\r\n        const nextDate = calculateNextDate(transaction.nextDate, transaction.frequency);\r\n\r\n        // Create the actual transaction based on type\r\n        let created = null;\r\n        if (transaction.type === \"CPV\") {\r\n          created = await createCPV(transaction);\r\n        } else if (transaction.type === \"CRV\") {\r\n          created = await createCRV(transaction);\r\n        } else if (transaction.type === \"EXPENSE\") {\r\n          created = await createExpense(transaction);\r\n        }\r\n\r\n        // Update recurring transaction\r\n        await prisma.recurringTransaction.update({\r\n          where: { id: transaction.id },\r\n          data: {\r\n            lastRun: new Date(),\r\n            nextDate: nextDate,\r\n          },\r\n        });\r\n\r\n        results.push({\r\n          id: transaction.id,\r\n          status: \"success\",\r\n          created,\r\n        });\r\n      } catch (error: any) {\r\n        results.push({\r\n          id: transaction.id,\r\n          status: \"error\",\r\n          error: error.message,\r\n        });\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      processed: results.length,\r\n      results,\r\n    });\r\n  } catch (e: any) {\r\n    console.error(\"Process Recurring Transactions Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nfunction calculateNextDate(currentDate: Date, frequency: string): Date {\r\n  const next = new Date(currentDate);\r\n\r\n  switch (frequency) {\r\n    case \"DAILY\":\r\n      next.setDate(next.getDate() + 1);\r\n      break;\r\n    case \"WEEKLY\":\r\n      next.setDate(next.getDate() + 7);\r\n      break;\r\n    case \"MONTHLY\":\r\n      next.setMonth(next.getMonth() + 1);\r\n      break;\r\n    case \"QUARTERLY\":\r\n      next.setMonth(next.getMonth() + 3);\r\n      break;\r\n    case \"YEARLY\":\r\n      next.setFullYear(next.getFullYear() + 1);\r\n      break;\r\n    default:\r\n      next.setDate(next.getDate() + 1);\r\n  }\r\n\r\n  return next;\r\n}\r\n\r\nasync function createCPV(transaction: any) {\r\n  // Generate voucher number\r\n  const count = await prisma.voucher.count({ where: { type: \"CPV\" } });\r\n  const voucherNo = `CPV-${count + 1}`;\r\n\r\n  const metadata = transaction.metadata ? JSON.parse(transaction.metadata) : {};\r\n\r\n  const voucher = await prisma.voucher.create({\r\n    data: {\r\n      voucherNo,\r\n      type: \"CPV\",\r\n      date: new Date(),\r\n      narration: transaction.narration || transaction.description,\r\n      entries: {\r\n        create: [\r\n          {\r\n            accountId: transaction.accountId,\r\n            amount: -transaction.amount,\r\n          },\r\n          {\r\n            accountId: metadata.paymentAccountId || transaction.accountId,\r\n            amount: transaction.amount,\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  });\r\n\r\n  return voucher;\r\n}\r\n\r\nasync function createCRV(transaction: any) {\r\n  const count = await prisma.voucher.count({ where: { type: \"CRV\" } });\r\n  const voucherNo = `CRV-${count + 1}`;\r\n\r\n  const metadata = transaction.metadata ? JSON.parse(transaction.metadata) : {};\r\n\r\n  const voucher = await prisma.voucher.create({\r\n    data: {\r\n      voucherNo,\r\n      type: \"CRV\",\r\n      date: new Date(),\r\n      narration: transaction.narration || transaction.description,\r\n      entries: {\r\n        create: [\r\n          {\r\n            accountId: transaction.accountId,\r\n            amount: transaction.amount,\r\n          },\r\n          {\r\n            accountId: metadata.receiptAccountId || transaction.accountId,\r\n            amount: -transaction.amount,\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  });\r\n\r\n  return voucher;\r\n}\r\n\r\nasync function createExpense(transaction: any) {\r\n  const metadata = transaction.metadata ? JSON.parse(transaction.metadata) : {};\r\n\r\n  const expense = await prisma.expenseVoucher.create({\r\n    data: {\r\n      voucherNo: `EXP-${Date.now()}`,\r\n      date: new Date(),\r\n      accountId: transaction.accountId,\r\n      paymentAccountId: metadata.paymentAccountId || transaction.accountId,\r\n      totalAmount: transaction.amount,\r\n      items: {\r\n        create: [\r\n          {\r\n            description: transaction.description,\r\n            amount: transaction.amount,\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  });\r\n\r\n  return expense;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\recurring-transactions\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[245,248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[245,248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[347,350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[347,350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[880,883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[880,883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1202,1205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1202,1205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2587,2590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2587,2590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3772,3775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3772,3775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4634,4637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4634,4637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.VIEW_ACCOUNTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const isActive = searchParams.get(\"isActive\");\r\n\r\n    const where: any = {};\r\n    if (isActive !== null) {\r\n      where.isActive = isActive === \"true\";\r\n    }\r\n\r\n    const transactions = await prisma.recurringTransaction.findMany({\r\n      where,\r\n      include: { account: true },\r\n      orderBy: { nextDate: \"asc\" },\r\n    });\r\n\r\n    return NextResponse.json(transactions);\r\n  } catch (e: any) {\r\n    console.error(\"Recurring Transactions GET Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.CREATE_ACCOUNTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const {\r\n      accountId,\r\n      type,\r\n      frequency,\r\n      amount,\r\n      description,\r\n      narration,\r\n      nextDate,\r\n      metadata,\r\n    } = body;\r\n\r\n    if (!accountId || !type || !frequency || !amount || !nextDate) {\r\n      return NextResponse.json(\r\n        { error: \"Required fields missing\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const transaction = await prisma.recurringTransaction.create({\r\n      data: {\r\n        accountId,\r\n        type,\r\n        frequency,\r\n        amount: parseFloat(amount),\r\n        description,\r\n        narration: narration || null,\r\n        nextDate: new Date(nextDate),\r\n        metadata: metadata ? JSON.stringify(metadata) : null,\r\n      },\r\n      include: { account: true },\r\n    });\r\n\r\n    return NextResponse.json(transaction);\r\n  } catch (e: any) {\r\n    console.error(\"Recurring Transactions POST Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.CREATE_ACCOUNTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { id, ...updateData } = body;\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID required\" }, { status: 400 });\r\n    }\r\n\r\n    if (updateData.nextDate) {\r\n      updateData.nextDate = new Date(updateData.nextDate);\r\n    }\r\n    if (updateData.metadata && typeof updateData.metadata === \"object\") {\r\n      updateData.metadata = JSON.stringify(updateData.metadata);\r\n    }\r\n\r\n    const transaction = await prisma.recurringTransaction.update({\r\n      where: { id },\r\n      data: updateData,\r\n      include: { account: true },\r\n    });\r\n\r\n    return NextResponse.json(transaction);\r\n  } catch (e: any) {\r\n    console.error(\"Recurring Transactions PUT Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.CREATE_ACCOUNTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"ID required\" }, { status: 400 });\r\n    }\r\n\r\n    await prisma.recurringTransaction.delete({ where: { id } });\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (e: any) {\r\n    console.error(\"Recurring Transactions DELETE Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\ageing\\customer\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[145,148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[145,148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":5,"column":50,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":5,"endColumn":52,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[230,232],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[230,232],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[304,307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[304,307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1495,1498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1495,1498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient ,Prisma} from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\ntype CreditEntry = Prisma.VoucherEntryGetPayload<{}>;\r\n\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // 🔐 ROLE CHECK\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const customerId = req.nextUrl.searchParams.get(\"customerId\");\r\n    const asOnParam = req.nextUrl.searchParams.get(\"date\");\r\n\r\n    if (!customerId) return NextResponse.json([]);\r\n\r\n    const asOn = asOnParam\r\n      ? new Date(asOnParam + \"T23:59:59.999\")\r\n      : new Date();\r\n\r\n    // 1️⃣ SALES INVOICES\r\n    const invoices = await prisma.salesInvoice.findMany({\r\n      where: {\r\n        customerId,\r\n        date: { lte: asOn },\r\n      },\r\n      orderBy: { date: \"asc\" },\r\n    });\r\n\r\n    // 2️⃣ CREDITS (Receipts, Sales Return, JV)\r\n    const credits = await prisma.voucherEntry.findMany({\r\n      where: {\r\n        accountId: customerId,\r\n        amount: { lt: 0 },\r\n        voucher: { date: { lte: asOn } },\r\n      },\r\n    });\r\n\r\nlet availableCredit = credits.reduce(\r\n  (s: number, c: CreditEntry) => s + Math.abs(Number(c.amount)),\r\n  0\r\n);\r\n\r\n    let runningBalance = 0;\r\n    const rows: any[] = [];\r\n\r\n    for (const inv of invoices) {\r\n      const billAmount = Number(inv.total) || 0;\r\n      let billBalance = billAmount;\r\n\r\n      // FIFO adjustment\r\n      if (availableCredit >= billBalance) {\r\n        availableCredit -= billBalance;\r\n        billBalance = 0;\r\n      } else {\r\n        billBalance -= availableCredit;\r\n        availableCredit = 0;\r\n      }\r\n\r\n      if (billBalance > 0) {\r\n        const days = Math.floor(\r\n          (asOn.getTime() - new Date(inv.date).getTime()) /\r\n            (1000 * 60 * 60 * 24)\r\n        );\r\n\r\n        runningBalance += billBalance;\r\n\r\n        rows.push({\r\n          numType: \"SI\",\r\n          date: inv.date.toISOString().slice(0, 10),\r\n          narration: `BILL # ${inv.invoiceNo}`,\r\n          billAmount,\r\n          billBalance,\r\n          days,\r\n          totalBalance: runningBalance,\r\n        });\r\n      }\r\n    }\r\n\r\n    return NextResponse.json(rows);\r\n  } catch (e) {\r\n    console.error(\"❌ CUSTOMER AGEING ERROR:\", e);\r\n    return NextResponse.json([]);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\ageing\\supplier\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[146,149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[146,149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[248,251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[248,251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":45,"column":53,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":45,"endColumn":55,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[1337,1339],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[1337,1339],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1495,1498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1495,1498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma} from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // 🔐 ROLE CHECK\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const supplierId = req.nextUrl.searchParams.get(\"supplierId\");\r\n    const asOnParam = req.nextUrl.searchParams.get(\"date\");\r\n\r\n    if (!supplierId) return NextResponse.json([]);\r\n\r\n    const asOn = asOnParam\r\n      ? new Date(asOnParam + \"T23:59:59.999\")\r\n      : new Date();\r\n\r\n    // 1️⃣ PURCHASE INVOICES\r\n    const invoices = await prisma.purchaseInvoice.findMany({\r\n      where: {\r\n        supplierId,\r\n        date: { lte: asOn },\r\n      },\r\n      orderBy: { date: \"asc\" },\r\n    });\r\n\r\n    // 2️⃣ DEBITS (Payments, Purchase Return, JV)\r\n    const debits = await prisma.voucherEntry.findMany({\r\n      where: {\r\n        accountId: supplierId,\r\n        amount: { gt: 0 },\r\n        voucher: { date: { lte: asOn } },\r\n      },\r\n    });\r\n\r\n    type DebitEntry = Prisma.VoucherEntryGetPayload<{}>;\r\n\r\nlet availableDebit = debits.reduce(\r\n  (s: number, d: DebitEntry) => s + Number(d.amount),\r\n  0\r\n);\r\n\r\n\r\n    let runningBalance = 0;\r\n    const rows: any[] = [];\r\n\r\n    for (const inv of invoices) {\r\n      const billAmount = Number(inv.total) || 0;\r\n      let billBalance = billAmount;\r\n\r\n      if (availableDebit >= billBalance) {\r\n        availableDebit -= billBalance;\r\n        billBalance = 0;\r\n      } else {\r\n        billBalance -= availableDebit;\r\n        availableDebit = 0;\r\n      }\r\n\r\n      if (billBalance > 0) {\r\n        const days = Math.floor(\r\n          (asOn.getTime() - new Date(inv.date).getTime()) /\r\n            (1000 * 60 * 60 * 24)\r\n        );\r\n\r\n        runningBalance += billBalance;\r\n\r\n        rows.push({\r\n          numType: \"PI\",\r\n          date: inv.date.toISOString().slice(0, 10),\r\n          narration: `PURCHASE # ${inv.invoiceNo}`,\r\n          billAmount,\r\n          billBalance,\r\n          days,\r\n          totalBalance: runningBalance,\r\n        });\r\n      }\r\n    }\r\n\r\n    return NextResponse.json(rows);\r\n  } catch (e) {\r\n    console.error(\"❌ SUPPLIER AGEING ERROR:\", e);\r\n    return NextResponse.json([]);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\annual-statements\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[254,257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[254,257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[356,359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[356,359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2249,2252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2249,2252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3796,3799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3796,3799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n// Annual Financial Statements\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.VIEW_REPORTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const year = searchParams.get(\"year\") || new Date().getFullYear().toString();\r\n\r\n    const startDate = new Date(`${year}-01-01T00:00:00`);\r\n    const endDate = new Date(`${year}-12-31T23:59:59`);\r\n\r\n    // Get all accounts with their balances\r\n    const accounts = await prisma.account.findMany({\r\n      include: {\r\n        voucherEntries: {\r\n          where: {\r\n            voucher: {\r\n              date: { gte: startDate, lte: endDate },\r\n            },\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    type AccountWithEntries = Prisma.AccountGetPayload<{\r\n  include: {\r\n    voucherEntries: true;\r\n  };\r\n}>;\r\n\r\ntype AccountBalance = {\r\n  accountId: string;\r\n  name: string;\r\n  type: string;\r\n  openingBalance: number;\r\n  closingBalance: number;\r\n};\r\n\r\n\r\n\r\n    // Calculate balances\r\nconst accountBalances: AccountBalance[] = accounts.map(\r\n  (acc: AccountWithEntries) => {\r\n    const entries = acc.voucherEntries || [];\r\n    const periodBalance = entries.reduce(\r\n      (sum: number, e) => sum + e.amount,\r\n      0\r\n    );\r\n\r\n    const openingBalance =\r\n      (acc.openDebit || 0) - (acc.openCredit || 0);\r\n\r\n    const closingBalance = openingBalance + periodBalance;\r\n\r\n    return {\r\n      accountId: acc.id,\r\n      name: acc.name,\r\n      type: acc.type,\r\n      openingBalance,\r\n      closingBalance,\r\n    };\r\n  }\r\n);\r\n\r\n\r\n\r\n    // Group by account type\r\n    const grouped: Record<string, any[]> = {};\r\n   accountBalances.forEach((acc) => {\r\n  if (!grouped[acc.type]) {\r\n    grouped[acc.type] = [];\r\n  }\r\n  grouped[acc.type].push(acc);\r\n});\r\n\r\n\r\n    // Calculate totals\r\n    const totals = {\r\n      assets: 0,\r\n      liabilities: 0,\r\n      equity: 0,\r\n      income: 0,\r\n      expenses: 0,\r\n    };\r\n\r\n    accountBalances.forEach((acc) => {\r\n      if ([\"ASSET\", \"BANK\", \"CASH\"].includes(acc.type)) {\r\n        totals.assets += acc.closingBalance;\r\n      } else if ([\"LIABILITY\"].includes(acc.type)) {\r\n        totals.liabilities += acc.closingBalance;\r\n      } else if ([\"EQUITY\", \"CAPITAL\"].includes(acc.type)) {\r\n        totals.equity += acc.closingBalance;\r\n      } else if ([\"INCOME\", \"REVENUE\"].includes(acc.type)) {\r\n        totals.income += acc.closingBalance;\r\n      } else if ([\"EXPENSE\", \"COST\"].includes(acc.type)) {\r\n        totals.expenses += acc.closingBalance;\r\n      }\r\n    });\r\n\r\n    const netProfit = totals.income - totals.expenses;\r\n\r\n    return NextResponse.json({\r\n      year: parseInt(year),\r\n      startDate: startDate.toISOString(),\r\n      endDate: endDate.toISOString(),\r\n      accounts: accountBalances,\r\n      grouped,\r\n      totals: {\r\n        ...totals,\r\n        netProfit,\r\n      },\r\n      balanceSheet: {\r\n        assets: totals.assets,\r\n        liabilities: totals.liabilities,\r\n        equity: totals.equity + netProfit,\r\n        total: totals.assets,\r\n      },\r\n      profitLoss: {\r\n        income: totals.income,\r\n        expenses: totals.expenses,\r\n        netProfit,\r\n      },\r\n    });\r\n  } catch (e: any) {\r\n    console.error(\"Annual Statements Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\balance-sheet\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[144,147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[144,147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[345,348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[345,348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[856,859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[856,859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[895,898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[895,898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[929,932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[929,932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { PrismaClient , Prisma } from \"@prisma/client\";\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\ntype AccountWithEntries = Prisma.AccountGetPayload<{\n  include: {\n    voucherEntries: true;\n  };\n}>;\n\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\n// api/reports/balance-sheet/route.ts\nexport async function GET(req: NextRequest) {\n  try {\n    const dateParam = req.nextUrl.searchParams.get(\"date\");\n    const asOn = dateParam ? new Date(dateParam + \"T23:59:59.999\") : new Date();\n\n    const accounts = await prisma.account.findMany({\n      include: {\n        voucherEntries: {\n          where: {\n            voucher: {\n              date: { lte: asOn },\n            },\n          },\n        },\n      },\n    });\n\n    const assetsList: any[] = [];\n    const liabilitiesList: any[] = [];\n    const equityList: any[] = [];\n\n    let incomeTotal = 0;\n    let expenseTotal = 0;\n    let totalAssets = 0;\n    let totalLiabilities = 0;\n    let totalEquityAccounts = 0;\n\n    accounts.forEach((acc: AccountWithEntries) => {\n\n      const opening =\n        Number(acc.openDebit || 0) - Number(acc.openCredit || 0);\n      const movement = (acc.voucherEntries || []).reduce(\n        (sum, e) => sum + Number(e.amount),\n        0\n      );\n      const closing = opening + movement;\n\n      if (Math.abs(closing) < 0.0001) {\n        return;\n      }\n\n      const type = (acc.type || \"\").toUpperCase();\n      const party = (acc.partyType || \"\").toUpperCase();\n\n      const isAsset =\n        type === \"ASSET\" ||\n        type === \"BANK\" ||\n        type === \"CASH\" ||\n        party === \"CUSTOMER\";\n      const isLiability =\n        type === \"LIABILITY\" || party === \"SUPPLIER\";\n      const isEquity =\n        type === \"EQUITY\" || type === \"CAPITAL\";\n      const isIncome =\n        type === \"INCOME\" || type === \"REVENUE\";\n      const isExpense =\n        type === \"EXPENSE\" || type === \"COST\";\n\n      if (isAsset && closing > 0) {\n        assetsList.push({ name: acc.name, amount: closing });\n        totalAssets += closing;\n      }\n\n      if (isLiability && closing < 0) {\n        const val = Math.abs(closing);\n        liabilitiesList.push({ name: acc.name, amount: val });\n        totalLiabilities += val;\n      }\n\n      if (isEquity && closing < 0) {\n        const val = Math.abs(closing);\n        equityList.push({ name: acc.name, amount: val });\n        totalEquityAccounts += val;\n      }\n\n      if (isIncome) {\n        if (closing < 0) {\n          incomeTotal += Math.abs(closing);\n        } else {\n          expenseTotal += closing;\n        }\n      }\n\n      if (isExpense) {\n        if (closing > 0) {\n          expenseTotal += closing;\n        } else {\n          incomeTotal += Math.abs(closing);\n        }\n      }\n    });\n\n    const netProfit = incomeTotal - expenseTotal;\n    const totalEquity = totalEquityAccounts + netProfit;\n\n    return NextResponse.json({\n      assets: assetsList,\n      liabilities: liabilitiesList,\n      equity: equityList,\n      netProfit,\n      totalAssets,\n      totalLiabilities,\n      totalEquity,\n      isBalanced:\n        Math.abs(totalAssets - (totalLiabilities + totalEquity)) < 1,\n    });\n  } catch (e) {\n    console.error(\"BALANCE SHEET ERROR:\", e);\n    return NextResponse.json({ error: \"Balance calculation failed\" }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\cash-flow\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[146,149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[146,149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":5,"column":45,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":5,"endColumn":47,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[226,228],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[226,228],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[705,708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[705,708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'cashAccount' is never reassigned. Use 'const' instead.","line":77,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":77,"endColumn":20,"fix":{"range":[1888,2014],"text":"const cashAccount = await prisma.account.findFirst({\r\n      where: { name: { contains: \"Cash\", mode: \"insensitive\" } },\r\n    });"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":211,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6110,6113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6110,6113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient, Prisma } from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\ntype BankAccount = Prisma.AccountGetPayload<{}>;\r\n\r\ntype VoucherWithEntries = Prisma.VoucherGetPayload<{\r\n  include: {\r\n    entries: {\r\n      include: {\r\n        account: true;\r\n      };\r\n    };\r\n  };\r\n}>;\r\n\r\ntype VoucherEntryWithAccount =\r\n  Prisma.VoucherEntryGetPayload<{ include: { account: true } }>;\r\n\r\ntype CashFlowItem = {\r\n  date: string;\r\n  voucherNo: string;\r\n  description: string;\r\n  amount: number;\r\n  type: \"INFLOW\" | \"OUTFLOW\";\r\n};\r\n\r\n\r\n\r\n\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const from = searchParams.get(\"from\");\r\n    const to = searchParams.get(\"to\");\r\n\r\n    if (!from || !to) {\r\n      return NextResponse.json(\r\n        { error: \"From and To dates required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const fromDate = new Date(from + \"T00:00:00\");\r\n    const toDate = new Date(to + \"T23:59:59.999\");\r\n\r\n    // Get all vouchers in date range\r\n    const vouchers = await prisma.voucher.findMany({\r\n      where: {\r\n        date: { gte: fromDate, lte: toDate },\r\n      },\r\n      include: {\r\n        entries: {\r\n          include: {\r\n            account: true,\r\n          },\r\n        },\r\n      },\r\n      orderBy: { date: \"asc\" },\r\n    });\r\n\r\n    const operating: CashFlowItem[] = [];\r\n    const investing: CashFlowItem[] = [];\r\n    const financing: CashFlowItem[] = [];\r\n\r\n    // Get Cash account - try multiple variations\r\n    let cashAccount = await prisma.account.findFirst({\r\n      where: { name: { contains: \"Cash\", mode: \"insensitive\" } },\r\n    });\r\n\r\n    if (!cashAccount) {\r\n      console.warn(\"⚠️ Cash account not found, Cash Flow may be incomplete\");\r\n    }\r\n\r\n    // Get Bank accounts\r\n    const bankAccounts = await prisma.account.findMany({\r\n      where: { partyType: { equals: \"BANKS\", mode: \"insensitive\" } },\r\n    });\r\n\r\n    const cashAccountIds = [\r\n      cashAccount?.id,\r\n      ...bankAccounts.map((b: BankAccount) => b.id),\r\n    ].filter(Boolean) as string[];\r\n\r\n\r\n    console.log(\"💰 Cash/Bank Account IDs:\", cashAccountIds);\r\n\r\n    vouchers.forEach((voucher: VoucherWithEntries) => {\r\n      const cashEntries = voucher.entries.filter(\r\n        (e: VoucherEntryWithAccount) =>\r\n          cashAccountIds.includes(e.accountId)\r\n      );\r\n\r\n      if (cashEntries.length === 0) return;\r\n\r\n      const cashMovement = cashEntries.reduce(\r\n        (sum: number, e: VoucherEntryWithAccount) =>\r\n          sum + Number(e.amount),\r\n        0\r\n      );\r\n\r\n      if (cashMovement === 0) return;\r\n\r\n\r\nconst direction: \"INFLOW\" | \"OUTFLOW\" =\r\n  cashMovement > 0 ? \"INFLOW\" : \"OUTFLOW\";\r\n\r\n      const nonCashEntries = voucher.entries.filter(\r\n        (e: Prisma.VoucherEntryGetPayload<{ include: { account: true } }>) =>\r\n          cashAccountIds.includes(e.accountId)\r\n      );\r\n\r\n      nonCashEntries.forEach((entry) => {\r\n        const acc = entry.account;\r\n        const type = (acc.type || \"\").toUpperCase();\r\n        const party = (acc.partyType || \"\").toUpperCase();\r\n        const amount = Math.abs(Number(entry.amount));\r\n        const base = {\r\n          date: voucher.date.toISOString().split(\"T\")[0],\r\n          voucherNo: voucher.voucherNo,\r\n          description: voucher.narration || acc.name,\r\n          amount,\r\n          type: direction,\r\n        };\r\n\r\n        const isOperating =\r\n          type === \"REVENUE\" ||\r\n          type === \"INCOME\" ||\r\n          type === \"EXPENSE\" ||\r\n          type === \"COST\" ||\r\n          party === \"CUSTOMER\" ||\r\n          party === \"SUPPLIER\";\r\n\r\n        const isInvesting =\r\n          type === \"ASSET\" &&\r\n          !cashAccountIds.includes(entry.accountId) &&\r\n          acc.name.toLowerCase().includes(\"asset\");\r\n\r\n        const isFinancing =\r\n          type === \"LIABILITY\" || type === \"EQUITY\" || type === \"CAPITAL\";\r\n\r\n        if (isOperating) {\r\n          operating.push(base);\r\n        } else if (isInvesting) {\r\n          investing.push(base);\r\n        } else if (isFinancing) {\r\n          financing.push(base);\r\n        }\r\n      });\r\n    });\r\n\r\n    // Calculate totals\r\n    const operatingInflow = operating\r\n      .filter((o) => o.type === \"INFLOW\")\r\n      .reduce((sum, o) => sum + o.amount, 0);\r\n    const operatingOutflow = operating\r\n      .filter((o) => o.type === \"OUTFLOW\")\r\n      .reduce((sum, o) => sum + o.amount, 0);\r\n    const operatingNet = operatingInflow - operatingOutflow;\r\n\r\n    const investingInflow = investing\r\n      .filter((i) => i.type === \"INFLOW\")\r\n      .reduce((sum, i) => sum + i.amount, 0);\r\n    const investingOutflow = investing\r\n      .filter((i) => i.type === \"OUTFLOW\")\r\n      .reduce((sum, i) => sum + i.amount, 0);\r\n    const investingNet = investingInflow - investingOutflow;\r\n\r\n    const financingInflow = financing\r\n      .filter((f) => f.type === \"INFLOW\")\r\n      .reduce((sum, f) => sum + f.amount, 0);\r\n    const financingOutflow = financing\r\n      .filter((f) => f.type === \"OUTFLOW\")\r\n      .reduce((sum, f) => sum + f.amount, 0);\r\n    const financingNet = financingInflow - financingOutflow;\r\n\r\n    const netCashFlow = operatingNet + investingNet + financingNet;\r\n\r\n    return NextResponse.json({\r\n      period: { from, to },\r\n      operating: {\r\n        items: operating,\r\n        inflow: operatingInflow,\r\n        outflow: operatingOutflow,\r\n        net: operatingNet,\r\n      },\r\n      investing: {\r\n        items: investing,\r\n        inflow: investingInflow,\r\n        outflow: investingOutflow,\r\n        net: investingNet,\r\n      },\r\n      financing: {\r\n        items: financing,\r\n        inflow: financingInflow,\r\n        outflow: financingOutflow,\r\n        net: financingNet,\r\n      },\r\n      netCashFlow,\r\n    });\r\n  } catch (e: any) {\r\n    console.error(\"❌ CASH FLOW ERROR:\", e);\r\n    return NextResponse.json(\r\n      { error: e.message || \"Cash flow report failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\dashboard-charts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[133,136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[133,136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[559,562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[559,562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4156,4159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4156,4159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4881,4884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4881,4884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma} from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\ntype SalesInvoice = Prisma.SalesInvoiceGetPayload<{\r\n  select: {\r\n    date: true;\r\n    total: true;\r\n  };\r\n}>;\r\n\r\ntype PurchaseInvoice = Prisma.PurchaseInvoiceGetPayload<{\r\n  select: {\r\n    date: true;\r\n    total: true;\r\n  };\r\n}>;\r\n\r\ntype TopCustomer = {\r\n  customerId: string;\r\n  _sum: { total: number | null };\r\n};\r\n\r\n\r\n\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const period = searchParams.get(\"period\") || \"month\"; // month, week, year\r\n\r\n    const now = new Date();\r\n    let startDate: Date;\r\n\r\n    switch (period) {\r\n      case \"week\":\r\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n        break;\r\n      case \"month\":\r\n        startDate = new Date(now.getFullYear(), now.getMonth(), 1);\r\n        break;\r\n      case \"year\":\r\n        startDate = new Date(now.getFullYear(), 0, 1);\r\n        break;\r\n      default:\r\n        startDate = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    }\r\n\r\n    // Sales by day/week/month\r\n    const salesInvoices = await prisma.salesInvoice.findMany({\r\n      where: {\r\n        date: { gte: startDate },\r\n      },\r\n      select: {\r\n        date: true,\r\n        total: true,\r\n      },\r\n    });\r\n\r\n    // Purchases by day/week/month\r\n    const purchaseInvoices = await prisma.purchaseInvoice.findMany({\r\n      where: {\r\n        date: { gte: startDate },\r\n      },\r\n      select: {\r\n        date: true,\r\n        total: true,\r\n      },\r\n    });\r\n\r\n    // Group sales by period\r\n    const salesByPeriod: Record<string, number> = {};\r\n    salesInvoices.forEach((inv: SalesInvoice) => {\r\n\r\n      let key: string;\r\n      if (period === \"week\") {\r\n        key = inv.date.toISOString().split(\"T\")[0];\r\n      } else if (period === \"month\") {\r\n        key = inv.date.toISOString().slice(0, 7); // YYYY-MM\r\n      } else {\r\n        key = inv.date.getFullYear().toString();\r\n      }\r\n      salesByPeriod[key] = (salesByPeriod[key] || 0) + Number(inv.total || 0);\r\n    });\r\n\r\n    // Group purchases by period\r\n    const purchasesByPeriod: Record<string, number> = {};\r\n    purchaseInvoices.forEach((inv: PurchaseInvoice) => {\r\n\r\n\r\n      let key: string;\r\n      if (period === \"week\") {\r\n        key = inv.date.toISOString().split(\"T\")[0];\r\n      } else if (period === \"month\") {\r\n        key = inv.date.toISOString().slice(0, 7);\r\n      } else {\r\n        key = inv.date.getFullYear().toString();\r\n      }\r\n      purchasesByPeriod[key] =\r\n        (purchasesByPeriod[key] || 0) + Number(inv.total || 0);\r\n    });\r\n\r\n    // Top customers\r\n    const topCustomers = await prisma.salesInvoice.groupBy({\r\n      by: [\"customerId\"],\r\n      where: {\r\n        date: { gte: startDate },\r\n      },\r\n      _sum: {\r\n        total: true,\r\n      },\r\n      orderBy: {\r\n        _sum: {\r\n          total: \"desc\",\r\n        },\r\n      },\r\n      take: 5,\r\n    });\r\n\r\n    const customerDetails = await Promise.all(\r\n      topCustomers.map(async (item: TopCustomer) => {\r\n        const customer = await prisma.account.findUnique({\r\n          where: { id: item.customerId },\r\n          select: { name: true },\r\n        });\r\n        return {\r\n          name: customer?.name || \"Unknown\",\r\n          total: Number(item._sum.total || 0),\r\n        };\r\n      })\r\n    );\r\n\r\n    // Top items\r\n    const topItems = await prisma.salesInvoiceItem.groupBy({\r\n      by: [\"itemId\"],\r\n      where: {\r\n        invoice: {\r\n          date: { gte: startDate },\r\n        },\r\n      },\r\n      _sum: {\r\n        qty: true,\r\n        amount: true,\r\n      },\r\n      orderBy: {\r\n        _sum: {\r\n          amount: \"desc\",\r\n        },\r\n      },\r\n      take: 5,\r\n    });\r\n\r\n    const itemDetails = await Promise.all(\r\n      topItems.map(async (item: any) => {\r\n        const itemData = await prisma.itemNew.findUnique({\r\n          where: { id: item.itemId },\r\n          select: { name: true },\r\n        });\r\n        return {\r\n          name: itemData?.name || \"Unknown\",\r\n          qty: Number(item._sum.qty || 0),\r\n          amount: Number(item._sum.amount || 0),\r\n        };\r\n      })\r\n    );\r\n\r\n    return NextResponse.json({\r\n      salesTrend: Object.entries(salesByPeriod).map(([key, value]) => ({\r\n        label: key,\r\n        value,\r\n      })),\r\n      purchasesTrend: Object.entries(purchasesByPeriod).map(([key, value]) => ({\r\n        label: key,\r\n        value,\r\n      })),\r\n      topCustomers: customerDetails,\r\n      topItems: itemDetails,\r\n    });\r\n  } catch (e: any) {\r\n    console.error(\"❌ DASHBOARD CHARTS ERROR:\", e);\r\n    return NextResponse.json(\r\n      { error: e.message || \"Charts data failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\dashboard-summary\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[125,128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[125,128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[227,230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[227,230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":36,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET() {\r\n  try {\r\n    // 1. کل سیلز (Sales)\r\n    const sales = await prisma.salesInvoice.aggregate({\r\n      _sum: { total: true },\r\n    });\r\n\r\n    // 2. کل خریداری (Purchases)\r\n    const purchases = await prisma.purchaseInvoice.aggregate({\r\n      _sum: { total: true },\r\n    });\r\n\r\n    // 3. ایکٹو کسٹمرز کی تعداد\r\n    const customersCount = await prisma.account.count({\r\n      where: { partyType: \"CUSTOMER\" },\r\n    });\r\n\r\n    const totalSales = Number(sales._sum.total || 0);\r\n    const totalPurchases = Number(purchases._sum.total || 0);\r\n\r\n    return NextResponse.json({\r\n      sales: totalSales,\r\n      purchases: totalPurchases,\r\n      profit: totalSales - totalPurchases, // سادہ منافع کا فارمولا\r\n      customers: customersCount,\r\n    });\r\n  } catch (error) {\r\n    return NextResponse.json({ error: \"Failed to fetch stats\" }, { status: 500 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\inventory\\inward\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[146,149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[146,149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":11,"column":58,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":11,"endColumn":60,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[345,347],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[345,347],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[421,424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[421,424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma} from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\ntype PurchaseWithItems = Prisma.PurchaseInvoiceGetPayload<{\r\n  include: {\r\n    items: true;\r\n  };\r\n}>;\r\ntype PurchaseItem = Prisma.PurchaseInvoiceItemGetPayload<{}>;\r\n\r\n\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // 🔐 ROLE GUARD - Checking if role is provided\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (!role || (role !== \"ADMIN\" && role !== \"ACCOUNTANT\")) {\r\n      return NextResponse.json({ error: \"Unauthorized access\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const from = searchParams.get(\"from\");\r\n    const to = searchParams.get(\"to\");\r\n\r\n    const fromDate = from ? new Date(from + \"T00:00:00\") : new Date(\"2000-01-01\");\r\n    const toDate = to ? new Date(to + \"T23:59:59.999\") : new Date();\r\n\r\n    // Fetching Purchase Invoices as Inward Data\r\n    const purchases = await prisma.purchaseInvoice.findMany({\r\n      where: {\r\n        date: { gte: fromDate, lte: toDate }\r\n      },\r\n      include: {\r\n        supplier: true,\r\n        items: {\r\n          include: { item: true }\r\n        }\r\n      },\r\n      orderBy: { date: 'desc' }\r\n    });\r\nconst rows = purchases.flatMap((inv: PurchaseWithItems) =>\r\n  inv.items.map((line: PurchaseItem) => ({\r\n    date: inv.date.toISOString().split(\"T\")[0],\r\n    type: \"PURCHASE\",\r\n    itemId: line.itemId,\r\n    qty: Number(line.qty),\r\n    rate: Number(line.rate),\r\n    amount: Number(line.amount),\r\n    invoiceNo: inv.invoiceNo,\r\n  }))\r\n);\r\n\r\n\r\n    return NextResponse.json(rows);\r\n  } catch (e) {\r\n    console.error(\"❌ INWARD REPORT ERROR:\", e);\r\n    return NextResponse.json({ error: \"Failed to fetch report\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\inventory\\stock-summary\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[147,150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[147,150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":12,"column":51,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":12,"endColumn":53,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[341,343],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[341,343],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[415,418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[415,418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma } from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\ntype ItemWithInventory = Prisma.ItemNewGetPayload<{\r\n  include: {\r\n    inventoryTxns: true;\r\n  };\r\n\r\n}>;\r\n\r\ntype InventoryTxn = Prisma.InventoryTxnGetPayload<{}>;\r\n\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // 🔐 ROLE GUARD\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    // 📅 DATE PARAM\r\n    const { searchParams } = new URL(req.url);\r\n    const dateParam = searchParams.get(\"date\");\r\n    const asOn = dateParam ? new Date(dateParam + \"T23:59:59.999\") : new Date();\r\n\r\n    // 📦 ITEMS WITH INVENTORY (AS ON DATE)\r\n    const items = await prisma.itemNew.findMany({\r\n      include: {\r\n        inventoryTxns: {\r\n          where: {\r\n            date: { lte: asOn },\r\n          },\r\n        },\r\n      },\r\n      orderBy: { name: \"asc\" },\r\n    });\r\nconst rows = items.map((i: ItemWithInventory) => {\r\n  const stockQty = i.inventoryTxns.reduce(\r\n    (sum: number, t: InventoryTxn) => {\r\n      const qty = Number(t.qty || 0);\r\n      return t.type === \"INWARD\" ? sum + qty : sum - qty;\r\n    },\r\n    0\r\n  );\r\n\r\n  return {\r\n    itemId: i.id,\r\n    name: i.name,\r\n    stockQty,\r\n  };\r\n});\r\n\r\n\r\n    return NextResponse.json(rows);\r\n  } catch (e) {\r\n    console.error(\"❌ STOCK SUMMARY ERROR:\", e);\r\n    return NextResponse.json([], { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\ledger\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SalesInvoicePage' is defined but never used.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":24,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"SalesInvoicePage"},"fix":{"range":[101,167],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":10,"column":51,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":10,"endColumn":53,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[320,322],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[320,322],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":11,"column":51,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":11,"endColumn":53,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[376,378],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[376,378],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":12,"column":57,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":12,"endColumn":59,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[438,440],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[438,440],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":13,"column":47,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":13,"endColumn":49,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[490,492],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[490,492],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[528,531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[528,531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[630,633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[630,633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4212,4215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4212,4215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6491,6494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6491,6494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient, Prisma } from \"@prisma/client\";\r\nimport SalesInvoicePage from \"@/app/dashboard/sales-invoice/page\";\r\ntype VoucherWithEntries = Prisma.VoucherGetPayload<{\r\n  include: {\r\n    entries: true;\r\n  };\r\n}>;\r\n\r\ntype VoucherEntry = Prisma.VoucherEntryGetPayload<{}>;\r\ntype SalesInvoice = Prisma.SalesInvoiceGetPayload<{}>;\r\ntype PurchaseInvoice = Prisma.PurchaseInvoiceGetPayload<{}>;\r\ntype saleReturn = Prisma.SaleReturnGetPayload<{}>;\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    // 🔐 Role Check\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const accountId = searchParams.get(\"accountId\");\r\n    const from = searchParams.get(\"from\");\r\n    const to = searchParams.get(\"to\");\r\n\r\n    if (!accountId) return NextResponse.json([]);\r\n\r\n    // 📅 Dates Calculation\r\n    const fromDate = from ? new Date(from + \"T00:00:00\") : new Date(\"2024-01-01\");\r\n    const toDate = to ? new Date(new Date(to).setHours(23, 59, 59, 999)) : new Date();\r\n\r\n    // ---------------------------------------------------------\r\n    // 1. 🟢 OPENING BALANCE CALCULATION\r\n    // 'from' date سے پہلے کی تمام ٹرانزیکشنز کا ٹوٹل\r\n    // ---------------------------------------------------------\r\n\r\n    // Previous Vouchers\r\n    const prevVouchers = await prisma.voucher.findMany({\r\n      where: { date: { lt: fromDate }, entries: { some: { accountId } } },\r\n      include: { entries: true }\r\n    });\r\n    let openingBal = prevVouchers.reduce(\r\n      (sum: number, v: VoucherWithEntries) => {\r\n        const amt = v.entries\r\n          .filter((e: VoucherEntry) => e.accountId === accountId)\r\n          .reduce((s: number, e: VoucherEntry) => s + Number(e.amount), 0);\r\n\r\n        return sum + amt;\r\n      },\r\n      0\r\n    );\r\n\r\n\r\n    // Previous Sales\r\n    const prevSales = await prisma.salesInvoice.aggregate({\r\n      where: { date: { lt: fromDate }, customerId: accountId },\r\n      _sum: { total: true }\r\n    });\r\n    openingBal += Number(prevSales._sum.total || 0);\r\n\r\n    // Previous Purchases\r\n    const prevPurchases = await prisma.purchaseInvoice.aggregate({\r\n      where: { date: { lt: fromDate }, supplierId: accountId },\r\n      _sum: { total: true }\r\n    });\r\n    openingBal -= Number(prevPurchases._sum.total || 0);\r\n\r\n    // Previous Returns\r\n    const prevReturns = await prisma.saleReturn.aggregate({\r\n      where: { date: { lt: fromDate }, customerId: accountId },\r\n      _sum: { total: true }\r\n    });\r\n    openingBal -= Number(prevReturns._sum.total || 0);\r\n\r\n\r\n    // ---------------------------------------------------------\r\n    // 2. 🔵 FETCH CURRENT PERIOD DATA\r\n    // ---------------------------------------------------------\r\n\r\n    // Fetch Vouchers (Filter out PI and SI to avoid doubles)\r\n    const vouchers = await prisma.voucher.findMany({\r\n      where: {\r\n        date: { gte: fromDate, lte: toDate },\r\n        entries: { some: { accountId } },\r\n        // 🔥 ڈبل انٹری روکنے کے لیے فلٹر\r\n        NOT: {\r\n          OR: [\r\n            { voucherNo: { startsWith: \"PI-\" } },\r\n            { voucherNo: { startsWith: \"SI-\" } },\r\n            { voucherNo: { startsWith: \"SR-\" } },\r\n          ]\r\n        }\r\n      },\r\n      include: { entries: true },\r\n    });\r\n\r\n    const sales = await prisma.salesInvoice.findMany({\r\n      where: { date: { gte: fromDate, lte: toDate }, customerId: accountId },\r\n    });\r\n\r\n    const purchases = await prisma.purchaseInvoice.findMany({\r\n      where: { date: { gte: fromDate, lte: toDate }, supplierId: accountId },\r\n    });\r\n\r\n    const returns = await prisma.saleReturn.findMany({\r\n      where: { date: { gte: fromDate, lte: toDate }, customerId: accountId },\r\n    });\r\n\r\n    // ---------------------------------------------------------\r\n    // 3. 🟠 COMBINE AND SORT\r\n    // ---------------------------------------------------------\r\n    const combinedData: any[] = [];\r\n    vouchers.forEach((v: VoucherWithEntries) => {\r\n      const amount = v.entries\r\n        .filter((e: VoucherEntry) => e.accountId === accountId)\r\n        .reduce(\r\n          (sum: number, e: VoucherEntry) => sum + Number(e.amount),\r\n          0\r\n        );\r\n\r\n      combinedData.push({\r\n        date: new Date(v.date),\r\n        voucherNo: v.voucherNo,\r\n        narration: v.narration || \"Voucher Entry\",\r\n        debit: amount > 0 ? amount : 0,\r\n        credit: amount < 0 ? Math.abs(amount) : 0,\r\n      });\r\n    });\r\n\r\n\r\n    sales.forEach((s : SalesInvoice) => {\r\n      combinedData.push({\r\n        date: new Date(s.date),\r\n        voucherNo: s.invoiceNo,\r\n        narration: \"Sales Invoice\",\r\n        debit: Number(s.total || 0),\r\n        credit: 0,\r\n      });\r\n    });\r\n\r\n    purchases.forEach((p : PurchaseInvoice) => {\r\n      combinedData.push({\r\n        date: new Date(p.date),\r\n        voucherNo: p.invoiceNo,\r\n        narration: \"Purchase Invoice\",\r\n        debit: 0,\r\n        credit: Number(p.total || 0),\r\n      });\r\n    });\r\n\r\n    returns.forEach((r:saleReturn) => {\r\n      combinedData.push({\r\n        date: new Date(r.date),\r\n        voucherNo: r.returnNo,\r\n        narration: \"Sale Return\",\r\n        debit: 0,\r\n        credit: Number(r.total || 0),\r\n      });\r\n    });\r\n\r\n    // Sort by Date\r\n    combinedData.sort((a, b) => a.date.getTime() - b.date.getTime());\r\n\r\n    // ---------------------------------------------------------\r\n    // 4. 🏁 FINAL CALCULATIONS (Running Balance)\r\n    // ---------------------------------------------------------\r\n    let runningBalance = openingBal;\r\n\r\n    // اوپننگ بیلنس کو پہلی لائن کے طور پر شامل کریں\r\n    const finalRows = [\r\n      {\r\n        date: fromDate.toISOString().slice(0, 10),\r\n        voucherNo: \"---\",\r\n        narration: \"OPENING BALANCE B/F\",\r\n        debit: openingBal > 0 ? openingBal : 0,\r\n        credit: openingBal < 0 ? Math.abs(openingBal) : 0,\r\n        balance: openingBal\r\n      },\r\n      ...combinedData.map(row => {\r\n        runningBalance += row.debit - row.credit;\r\n        return {\r\n          ...row,\r\n          date: row.date.toISOString().slice(0, 10),\r\n          balance: runningBalance\r\n        };\r\n      })\r\n    ];\r\n\r\n    return NextResponse.json(finalRows);\r\n\r\n  } catch (e: any) {\r\n    console.error(\"LEDGER ERROR:\", e);\r\n    return NextResponse.json({ error: \"Ledger generation failed\" }, { status: 500 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\outward\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":9,"column":49,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":9,"endColumn":51,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[259,261],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[259,261],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[299,302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[299,302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[401,404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[401,404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1436,1439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1436,1439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1925,1928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1925,1928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient, Prisma } from \"@prisma/client\";\r\ntype OutwardWithItems = Prisma.OutwardGetPayload<{\r\n  include: {\r\n    items: true;\r\n  };\r\n}>;\r\n\r\ntype OutwardItem = Prisma.OutwardItemGetPayload<{}>;\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // 🔐 ROLE CHECK\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    // 🔎 FILTERS\r\n    const from = req.nextUrl.searchParams.get(\"from\");\r\n    const to = req.nextUrl.searchParams.get(\"to\");\r\n    const customerId = req.nextUrl.searchParams.get(\"customerId\");\r\n\r\n    const fromDate = from ? new Date(from + \"T00:00:00\") : undefined;\r\n    const toDate = to ? new Date(to + \"T23:59:59\") : undefined;\r\n\r\n    // 📦 DATA\r\n    const data = await prisma.outward.findMany({\r\n      where: {\r\n        date: { gte: fromDate, lte: toDate },\r\n        customerId: customerId && customerId !== \"\" ? customerId : undefined,\r\n      },\r\n      include: {\r\n        customer: true,\r\n        items: {\r\n          include: { item: true },\r\n        },\r\n      },\r\n      orderBy: { outwardNo: \"desc\" },\r\n    });\r\n    const reportRows: any[] = [];\r\n\r\n    data.forEach((out: OutwardWithItems) => {\r\n      out.items.forEach((line: OutwardItem) => {\r\n        reportRows.push({\r\n          id: out.id,\r\n          date: out.date.toISOString().slice(0, 10),\r\n          outwardNo: out.outwardNo,\r\n          itemId: line.itemId,\r\n          qty: Number(line.qty),\r\n          rate: Number(line.rate),\r\n          amount: Number(line.amount),\r\n        });\r\n      });\r\n    });\r\n\r\n\r\n    return NextResponse.json(reportRows);\r\n  } catch (e: any) {\r\n    console.error(\"OUTWARD REPORT ERROR:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\profit-loss\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[237,240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[237,240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[339,342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[339,342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma} from \"@prisma/client\";\r\ntype EntryWithAccount = Prisma.VoucherEntryGetPayload<{\r\n  include: {\r\n    account: true;\r\n  };\r\n}>;\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n// api/reports/profit-loss/route.ts\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const from = searchParams.get(\"from\");\r\n    const to = searchParams.get(\"to\");\r\n    const fromDate = from ? new Date(from + \"T00:00:00\") : new Date(\"2000-01-01\");\r\n    const toDate = to ? new Date(to + \"T23:59:59.999\") : new Date();\r\n\r\n    const entries = await prisma.voucherEntry.findMany({\r\n      where: {\r\n        voucher: { date: { gte: fromDate, lte: toDate } },\r\n        account: {\r\n          type: { in: [\"INCOME\", \"EXPENSE\", \"REVENUE\", \"COST\"] },\r\n        },\r\n      },\r\n      include: { account: true },\r\n    });\r\n\r\n    const incomeMap: Record<string, number> = {};\r\n    const expenseMap: Record<string, number> = {};\r\n\r\n    entries.forEach((e: EntryWithAccount) => {\r\n\r\n      const amt = Number(e.amount);\r\n      const type = (e.account.type || \"\").toUpperCase();\r\n      const name = e.account.name;\r\n\r\n      if (Math.abs(amt) < 0.0001) return;\r\n\r\n      if (type === \"INCOME\" || type === \"REVENUE\") {\r\n        if (amt < 0) {\r\n          incomeMap[name] = (incomeMap[name] || 0) + Math.abs(amt);\r\n        } else {\r\n          expenseMap[name] = (expenseMap[name] || 0) + amt;\r\n        }\r\n      } else if (type === \"EXPENSE\" || type === \"COST\") {\r\n        if (amt > 0) {\r\n          expenseMap[name] = (expenseMap[name] || 0) + amt;\r\n        } else {\r\n          incomeMap[name] = (incomeMap[name] || 0) + Math.abs(amt);\r\n        }\r\n      }\r\n    });\r\n\r\n    const income = Object.entries(incomeMap).map(([name, amount]) => ({\r\n      name,\r\n      amount,\r\n    }));\r\n    const expense = Object.entries(expenseMap).map(([name, amount]) => ({\r\n      name,\r\n      amount,\r\n    }));\r\n\r\n    const totalIncome = income.reduce((s, r) => s + r.amount, 0);\r\n    const totalExpense = expense.reduce((s, r) => s + r.amount, 0);\r\n\r\n    return NextResponse.json({\r\n      income,\r\n      expense,\r\n      totalIncome,\r\n      totalExpense,\r\n      grossProfit: totalIncome - totalExpense,\r\n      netProfit: totalIncome - totalExpense,\r\n    });\r\n  } catch (e) {\r\n    console.error(\"P&L ERROR:\", e);\r\n    return NextResponse.json({ error: \"Failed\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\profitability\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[245,248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[245,248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[347,350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[347,350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1554,1557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1554,1557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2689,2692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2689,2692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3303,3306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3303,3306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4243,4246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4243,4246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4664,4667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4664,4667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.VIEW_REPORTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const from = searchParams.get(\"from\");\r\n    const to = searchParams.get(\"to\");\r\n    const groupBy = searchParams.get(\"groupBy\") || \"customer\"; // customer | product\r\n\r\n    const fromDate = from ? new Date(from + \"T00:00:00\") : undefined;\r\n    const toDate = to ? new Date(to + \"T23:59:59.999\") : undefined;\r\n\r\n    if (groupBy === \"customer\") {\r\n      // Profitability by Customer\r\n      const salesInvoices = await prisma.salesInvoice.findMany({\r\n        where: {\r\n          date: { gte: fromDate, lte: toDate },\r\n        },\r\n        include: {\r\n          customer: true,\r\n          items: {\r\n            include: {\r\n              item: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      const customerProfit: Record<string, any> = {};\r\n\r\n      for (const invoice of salesInvoices) {\r\n        const customerId = invoice.customerId;\r\n        const customerName = invoice.customer?.name || \"Unknown\";\r\n\r\n        if (!customerProfit[customerId]) {\r\n          customerProfit[customerId] = {\r\n            customerId,\r\n            customerName,\r\n            invoiceCount: 0,\r\n            totalSales: 0,\r\n            totalCost: 0,\r\n            totalProfit: 0,\r\n          };\r\n        }\r\n\r\n        customerProfit[customerId].invoiceCount += 1;\r\n        customerProfit[customerId].totalSales += invoice.total;\r\n\r\n        // Calculate cost (simplified - using average cost)\r\n        for (const item of invoice.items) {\r\n          const stockRates = await prisma.stockRate.findMany({\r\n            where: { itemId: item.itemId },\r\n            orderBy: { createdAt: \"desc\" },\r\n            take: 1,\r\n          });\r\n\r\n          const avgCost = stockRates.length > 0 ? stockRates[0].rate : 0;\r\n          const cost = avgCost * item.qty;\r\n          customerProfit[customerId].totalCost += cost;\r\n        }\r\n      }\r\n\r\n      const result = Object.values(customerProfit).map((cp: any) => ({\r\n        ...cp,\r\n        totalProfit: cp.totalSales - cp.totalCost,\r\n        profitMargin: cp.totalSales > 0 ? ((cp.totalSales - cp.totalCost) / cp.totalSales) * 100 : 0,\r\n      }));\r\n\r\n      return NextResponse.json(result);\r\n    } else {\r\n      // Profitability by Product\r\n      const salesInvoiceItems = await prisma.salesInvoiceItem.findMany({\r\n        where: {\r\n          invoice: {\r\n            date: { gte: fromDate, lte: toDate },\r\n          },\r\n        },\r\n        include: {\r\n          item: true,\r\n          invoice: true,\r\n        },\r\n      });\r\n\r\n      const productProfit: Record<string, any> = {};\r\n\r\n      for (const item of salesInvoiceItems) {\r\n        const itemId = item.itemId;\r\n        const itemName = item.item?.name || \"Unknown\";\r\n\r\n        if (!productProfit[itemId]) {\r\n          productProfit[itemId] = {\r\n            itemId,\r\n            itemName,\r\n            quantitySold: 0,\r\n            totalSales: 0,\r\n            totalCost: 0,\r\n            totalProfit: 0,\r\n          };\r\n        }\r\n\r\n        productProfit[itemId].quantitySold += item.qty;\r\n        productProfit[itemId].totalSales += item.amount;\r\n\r\n        // Get average cost\r\n        const stockRates = await prisma.stockRate.findMany({\r\n          where: { itemId },\r\n          orderBy: { createdAt: \"desc\" },\r\n          take: 1,\r\n        });\r\n\r\n        const avgCost = stockRates.length > 0 ? stockRates[0].rate : 0;\r\n        productProfit[itemId].totalCost += avgCost * item.qty;\r\n      }\r\n\r\n      const result = Object.values(productProfit).map((pp: any) => ({\r\n        ...pp,\r\n        totalProfit: pp.totalSales - pp.totalCost,\r\n        profitMargin: pp.totalSales > 0 ? ((pp.totalSales - pp.totalCost) / pp.totalSales) * 100 : 0,\r\n        averagePrice: pp.quantitySold > 0 ? pp.totalSales / pp.quantitySold : 0,\r\n        averageCost: pp.quantitySold > 0 ? pp.totalCost / pp.quantitySold : 0,\r\n      }));\r\n\r\n      return NextResponse.json(result);\r\n    }\r\n  } catch (e: any) {\r\n    console.error(\"Profitability Report Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\sales\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":9,"column":59,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":9,"endColumn":61,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[267,269],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[267,269],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[307,310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[307,310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[409,412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[409,412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma } from \"@prisma/client\";\r\ntype SalesInvoiceWithItems = Prisma.SalesInvoiceGetPayload<{\r\n  include: {\r\n    items: true;\r\n  };\r\n}>;\r\n\r\ntype SalesInvoiceItem = Prisma.SalesInvoiceItemGetPayload<{}>;\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    // 🔐 ROLE CHECK - پیج سے رول ہیڈر ملنا لازمی ہے\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (!role || (role !== \"ADMIN\" && role !== \"ACCOUNTANT\")) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    // 📅 FILTERS\r\n    const { searchParams } = new URL(req.url);\r\n    const from = searchParams.get(\"from\");\r\n    const to = searchParams.get(\"to\");\r\n    const customerId = searchParams.get(\"customerId\") || undefined;\r\n\r\n    const fromDate = from ? new Date(from + \"T00:00:00\") : undefined;\r\n    const toDate = to ? new Date(to + \"T23:59:59.999\") : undefined;\r\n\r\n    // 📄 SALES INVOICES FETCHING\r\n    const invoices = await prisma.salesInvoice.findMany({\r\n      where: {\r\n        date: { gte: fromDate, lte: toDate },\r\n        customerId: customerId === \"all\" ? undefined : customerId,\r\n      },\r\n      include: {\r\n        customer: { select: { name: true } },\r\n        items: {\r\n          include: { item: { select: { name: true } } },\r\n        },\r\n      },\r\n      orderBy: { date: \"asc\" },\r\n    });\r\n\r\n    // 📊 FLATTEN ROWS - ڈیٹا کو صاف ستھرا کرنا\r\n    const rows = invoices.flatMap((inv: SalesInvoiceWithItems) =>\r\n  inv.items.map((it: SalesInvoiceItem) => ({\r\n    date: inv.date.toISOString().slice(0, 10),\r\n    invoiceNo: inv.invoiceNo,\r\n    customerId: inv.customerId,\r\n    itemId: it.itemId,\r\n    qty: Number(it.qty),\r\n    rate: Number(it.rate),\r\n    amount: Number(it.amount),\r\n  }))\r\n);\r\n\r\n\r\n    return NextResponse.json(rows);\r\n  } catch (e) {\r\n    console.error(\"❌ SALES REPORT ERROR:\", e);\r\n    return NextResponse.json([], { status: 500 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\stock-ledger\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rows' is assigned a value but never used.","line":18,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[424,427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[424,427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[526,529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[526,529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma } from \"@prisma/client\";\r\ntype InventoryTxnWithParty = Prisma.InventoryTxnGetPayload<{\r\n  include: {\r\n    party: true;\r\n  };\r\n}>;\r\n\r\ntype StockLedgerRow = {\r\n  date: string;\r\n  type: string;\r\n  party: string;\r\n  inQty: number;\r\n  outQty: number;\r\n  balanceQty: number;\r\n};\r\n\r\nconst rows: StockLedgerRow[] = [];\r\n\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const itemId = searchParams.get(\"itemId\");\r\n    const from = searchParams.get(\"from\");\r\n    const to = searchParams.get(\"to\");\r\n\r\n    if (!itemId) return NextResponse.json([]);\r\n\r\n    const fromDate = from ? new Date(from + \"T00:00:00\") : new Date(\"2025-01-01\");\r\n    const toDate = to ? new Date(to + \"T23:59:59.999\") : new Date();\r\n\r\n    // 1. OPENING BALANCE\r\n    const openingTxns = await prisma.inventoryTxn.aggregate({\r\n      where: { itemId, date: { lt: fromDate } },\r\n      _sum: { qty: true },\r\n    });\r\n    let runningBalance = openingTxns._sum.qty || 0;\r\n\r\n    // 2. FETCH TRANSACTIONS\r\n    // ہم نے SalesInvoiceItem کو بھی شامل کیا ہے تاکہ وہاں سے لنک ڈھونڈ سکیں\r\n    const txns = await prisma.inventoryTxn.findMany({\r\n      where: { itemId, date: { gte: fromDate, lte: toDate } },\r\n      include: {\r\n        party: { select: { name: true } },\r\n      },\r\n      orderBy: { date: \"asc\" },\r\n    });\r\n\r\n    const rows = [];\r\n    \r\n    // Opening Balance Row\r\n    rows.push({\r\n      date: fromDate.toISOString().slice(0, 10),\r\n      type: \"OPENING\",\r\n      party: \"Opening Balance B/F\",\r\n      inQty: runningBalance > 0 ? runningBalance : 0,\r\n      outQty: runningBalance < 0 ? Math.abs(runningBalance) : 0,\r\n      balanceQty: runningBalance,\r\n    });\r\n\r\n    // 3. LOOP THROUGH TRANSACTIONS\r\n    // یہاں ہم ان ٹرانزیکشنز کے لیے کسٹمر کا نام ڈھونڈیں گے جن کا partyId خالی ہے\r\n    const updatedRows: StockLedgerRow[] = await Promise.all(\r\n  txns.map(async (t: InventoryTxnWithParty) => {\r\n    runningBalance += Number(t.qty || 0);\r\n\r\n    let displayName = t.party?.name;\r\n\r\n    if (!displayName) {\r\n      if (t.type === \"SALE\") {\r\n        const saleDetail = await prisma.salesInvoiceItem.findFirst({\r\n          where: {\r\n            itemId: t.itemId,\r\n            qty: Math.abs(t.qty),\r\n            invoice: { date: t.date },\r\n          },\r\n          include: {\r\n            invoice: { include: { customer: true } },\r\n          },\r\n        });\r\n        displayName =\r\n          saleDetail?.invoice?.customer?.name || \"Walking Customer\";\r\n      } else if (t.type === \"PURCHASE\") {\r\n        displayName = \"Supplier / Purchase\";\r\n      } else {\r\n        displayName = \"Self / Adjustment\";\r\n      }\r\n    }\r\n\r\n    return {\r\n      date: t.date.toISOString().slice(0, 10),\r\n      type: t.type,\r\n      party: displayName,\r\n      inQty: t.qty > 0 ? t.qty : 0,\r\n      outQty: t.qty < 0 ? Math.abs(t.qty) : 0,\r\n      balanceQty: runningBalance,\r\n    };\r\n  })\r\n);\r\n\r\n\r\n    return NextResponse.json([...rows, ...updatedRows]);\r\n  } catch (e) {\r\n    console.error(\"STOCK LEDGER ERROR:\", e);\r\n    return NextResponse.json([], { status: 500 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\stock\\location\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[125,128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[125,128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[227,230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[227,230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[656,659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[656,659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1268,1271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1268,1271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1363,1366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1363,1366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1371,1374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1371,1374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const txns = await prisma.inventoryTxn.findMany({\r\n      include: { item: { select: { name: true, unit: true } } },\r\n    });\r\n\r\n    const map: Record<string, any> = {};\r\n\r\n    for (const t of txns) {\r\n      // Key format: Location-ItemID\r\n      const key = `${t.location}_${t.itemId}`;\r\n\r\n      if (!map[key]) {\r\n        map[key] = {\r\n          location: t.location,\r\n          itemName: t.item.name,\r\n          unit: t.item.unit,\r\n          qty: 0,\r\n        };\r\n      }\r\n\r\n      // اگر آپ کے ڈیٹا بیس میں qty پہلے ہی سیلز کے لیے مائنس میں ہے تو صرف جمع کریں\r\n      // ورنہ آپ کی موجودہ ٹائپ وائز لاجک (جو نیچے ہے) استعمال کریں:\r\n      map[key].qty += t.qty; \r\n    }\r\n\r\n    // صرف وہ آئٹمز دکھائیں جن کا اسٹاک 0 نہیں ہے\r\n    const result = Object.values(map).filter((r: any) => r.qty !== 0);\r\n    \r\n    // لوکیشن کے حساب سے ترتیب دیں (Sorting)\r\n    result.sort((a: any, b: any) => a.location.localeCompare(b.location));\r\n\r\n    return NextResponse.json(result);\r\n  } catch (e) {\r\n    console.error(\"LOCATION STOCK ERROR:\", e);\r\n    return NextResponse.json([]);\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\stock\\low\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[546,549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[546,549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[648,651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[648,651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient, Prisma } from \"@prisma/client\";\r\n\r\ntype ItemWithInventory = Prisma.ItemNewGetPayload<{\r\n  select: {\r\n    id: true;\r\n    name: true;\r\n    unit: true;\r\n    minStock: true;\r\n    description: true;\r\n    inventoryTxns: {\r\n      select: {\r\n        qty: true;\r\n      };\r\n    };\r\n  };\r\n}>;\r\n\r\ntype LowStockItem = {\r\n  itemId: string;\r\n  itemName: string;\r\n  description: string;\r\n  unit: string;\r\n  stockQty: number;\r\n  minStock: number | null;\r\n};\r\n\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const items = await prisma.itemNew.findMany({\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        unit: true,\r\n        minStock: true,\r\n        description: true,\r\n        inventoryTxns: {\r\n          select: { qty: true }\r\n        }\r\n      },\r\n    });\r\n\r\nconst result: LowStockItem[] = items\r\n  .map((i: ItemWithInventory): LowStockItem => {\r\n    const stockQty = i.inventoryTxns.reduce(\r\n      (sum: number, t: { qty: number }) => sum + Number(t.qty || 0),\r\n      0\r\n    );\r\n\r\n    return {\r\n      itemId: i.id,\r\n      itemName: i.name,\r\n      description: i.description || \"\",\r\n      unit: i.unit,\r\n      stockQty,\r\n      minStock: i.minStock,\r\n    };\r\n  })\r\n  .filter((i: LowStockItem) => i.stockQty <= (i.minStock ?? 0))\r\n  .sort((a: LowStockItem, b: LowStockItem) => a.stockQty - b.stockQty);\r\n\r\n    return NextResponse.json(result);\r\n  } catch (e) {\r\n    console.error(\"LOW STOCK ERROR:\", e);\r\n    return NextResponse.json([], { status: 500 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\stock\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[385,388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[385,388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[487,490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[487,490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma} from \"@prisma/client\";\r\ntype ItemWithInventory = Prisma.ItemNewGetPayload<{\r\n  select: {\r\n    id: true;\r\n    name: true;\r\n    unit: true;\r\n    description: true;\r\n    inventoryTxns: {\r\n      select: {\r\n        qty: true;\r\n        rate: true;\r\n      };\r\n    };\r\n  };\r\n}>;\r\n\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const items = await prisma.itemNew.findMany({\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        unit: true,\r\n        description: true,\r\n        inventoryTxns: {\r\n          select: {\r\n            qty: true,\r\n            rate: true,\r\n          }\r\n        }\r\n      },\r\n      orderBy: { name: \"asc\" },\r\n    });\r\nconst result = items.map((item: ItemWithInventory) => {\r\n  let totalQty = 0;\r\n  let calculatedValue = 0;\r\n\r\n  item.inventoryTxns.forEach((t: { qty: number; rate: number }) => {\r\n    totalQty += Number(t.qty || 0);\r\n    calculatedValue += Number(t.qty || 0) * Number(t.rate || 0);\r\n  });\r\n\r\n  const finalValue = totalQty <= 0 ? 0 : Math.round(calculatedValue);\r\n\r\n  return {\r\n    itemId: item.id,\r\n    itemName: item.name,\r\n    unit: item.unit,\r\n    description: item.description || \"\",\r\n    stockQty: totalQty,\r\n    stockValue: finalValue,\r\n  };\r\n});\r\n\r\n\r\n    return NextResponse.json(result);\r\n  } catch (e) {\r\n    console.error(\"STOCK REPORT ERROR:\", e);\r\n    return NextResponse.json([], { status: 500 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\tax-summary\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[245,248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[245,248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[347,350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[347,350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'taxType' is assigned a value but never used.","line":30,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1103,1106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1103,1106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2031,2034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2031,2034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2115,2118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2115,2118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2992,2995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2992,2995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3864,3867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3864,3867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4490,4493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4490,4493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4673,4676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4673,4676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport { apiHasPermission } from \"@/lib/apiPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const userId = req.headers.get(\"x-user-id\");\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n\r\n    const allowed = await apiHasPermission(\r\n      userId,\r\n      userRole,\r\n      PERMISSIONS.VIEW_REPORTS\r\n    );\r\n\r\n    if (!allowed) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const from = searchParams.get(\"from\");\r\n    const to = searchParams.get(\"to\");\r\n    const taxType = searchParams.get(\"taxType\");\r\n\r\n    const fromDate = from ? new Date(from + \"T00:00:00\") : undefined;\r\n    const toDate = to ? new Date(to + \"T23:59:59.999\") : undefined;\r\n\r\n    const where: any = {};\r\n    if (fromDate && toDate) {\r\n      where.date = { gte: fromDate, lte: toDate };\r\n    }\r\n\r\n    // 1. Sales Invoices with Tax\r\n    const salesInvoicesWithTax = await prisma.salesInvoice.findMany({\r\n      where: {\r\n        ...where,\r\n        taxConfigId: { not: null },\r\n      },\r\n      include: {\r\n        taxConfig: true,\r\n      },\r\n    });\r\n\r\n    // 2. Purchase Invoices with Tax\r\n    const purchaseInvoicesWithTax = await prisma.purchaseInvoice.findMany({\r\n      where: {\r\n        ...where,\r\n        taxConfigId: { not: null },\r\n      },\r\n      include: {\r\n        taxConfig: true,\r\n      },\r\n    });\r\n\r\n    // 3. Legacy InvoiceTax entries (پرانی system سے)\r\n    const legacyTaxes = await prisma.invoiceTax.findMany({\r\n      where: {\r\n        createdAt: where.createdAt,\r\n      },\r\n      include: {\r\n        taxConfiguration: true,\r\n      },\r\n    });\r\n\r\n    // Group by tax type\r\n    const summary: Record<string, any> = {};\r\n\r\n    // Process Sales Invoices\r\n    salesInvoicesWithTax.forEach((inv: any) => {\r\n      if (!inv.taxConfig) return;\r\n      const key = inv.taxConfig.taxType;\r\n      \r\n      if (!summary[key]) {\r\n        summary[key] = {\r\n          taxType: key,\r\n          taxCode: inv.taxConfig.taxCode,\r\n          taxRate: inv.taxConfig.taxRate,\r\n          invoiceCount: 0,\r\n          totalSubtotal: 0,\r\n          totalTaxAmount: 0,\r\n          totalAmount: 0,\r\n        };\r\n      }\r\n\r\n      // ✅ صحیح calculation: Total میں سے subtotal نکالیں\r\n      const taxRate = inv.taxConfig.taxRate / 100;\r\n      const subtotal = inv.total / (1 + taxRate);\r\n      const taxAmount = inv.total - subtotal;\r\n\r\n      summary[key].invoiceCount += 1;\r\n      summary[key].totalSubtotal += subtotal;\r\n      summary[key].totalTaxAmount += taxAmount;\r\n      summary[key].totalAmount += inv.total;\r\n    });\r\n\r\n    // Process Purchase Invoices\r\n    purchaseInvoicesWithTax.forEach((inv: any) => {\r\n      if (!inv.taxConfig) return;\r\n      const key = inv.taxConfig.taxType;\r\n      \r\n      if (!summary[key]) {\r\n        summary[key] = {\r\n          taxType: key,\r\n          taxCode: inv.taxConfig.taxCode,\r\n          taxRate: inv.taxConfig.taxRate,\r\n          invoiceCount: 0,\r\n          totalSubtotal: 0,\r\n          totalTaxAmount: 0,\r\n          totalAmount: 0,\r\n        };\r\n      }\r\n\r\n      // ✅ صحیح calculation: Total میں سے subtotal نکالیں\r\n      const taxRate = inv.taxConfig.taxRate / 100;\r\n      const subtotal = inv.total / (1 + taxRate);\r\n      const taxAmount = inv.total - subtotal;\r\n\r\n      summary[key].invoiceCount += 1;\r\n      summary[key].totalSubtotal += subtotal;\r\n      summary[key].totalTaxAmount += taxAmount;\r\n      summary[key].totalAmount += inv.total;\r\n    });\r\n\r\n    // Process Legacy InvoiceTax entries\r\n    legacyTaxes.forEach((it: any) => {\r\n      const key = it.taxConfiguration.taxType;\r\n      if (!summary[key]) {\r\n        summary[key] = {\r\n          taxType: key,\r\n          taxCode: it.taxConfiguration.taxCode,\r\n          taxRate: it.taxConfiguration.taxRate,\r\n          invoiceCount: 0,\r\n          totalSubtotal: 0,\r\n          totalTaxAmount: 0,\r\n          totalAmount: 0,\r\n        };\r\n      }\r\n\r\n      summary[key].invoiceCount += 1;\r\n      summary[key].totalSubtotal += it.subtotal;\r\n      summary[key].totalTaxAmount += it.taxAmount;\r\n      summary[key].totalAmount += it.totalAmount;\r\n    });\r\n\r\n    const result = Object.values(summary).map((s: any) => ({\r\n      ...s,\r\n      averageTaxRate: s.totalSubtotal > 0 ? (s.totalTaxAmount / s.totalSubtotal) * 100 : 0,\r\n    }));\r\n\r\n    return NextResponse.json(result);\r\n  } catch (e: any) {\r\n    console.error(\"Tax Summary Report Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\trial-balance\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":3,"column":51,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":3,"endColumn":53,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[151,153],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[151,153],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[191,194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[191,194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[293,296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[293,296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[412,415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[412,415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1495,1498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1495,1498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'transDebit' is never reassigned. Use 'const' instead.","line":69,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":69,"endColumn":15,"fix":{"range":[2420,2589],"text":"const transDebit = periodVouchers\r\n  .filter((v: VoucherEntry) => Number(v.amount) > 0)\r\n  .reduce(\r\n    (s: number, v: VoucherEntry) => s + Number(v.amount),\r\n    0\r\n  );"}},{"ruleId":"prefer-const","severity":2,"message":"'transCredit' is never reassigned. Use 'const' instead.","line":76,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":76,"endColumn":16,"fix":{"range":[2593,2773],"text":"const transCredit = periodVouchers\r\n  .filter((v: VoucherEntry) => Number(v.amount) < 0)\r\n  .reduce(\r\n    (s: number, v: VoucherEntry) => s + Math.abs(Number(v.amount)),\r\n    0\r\n  );"}}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient, Prisma } from \"@prisma/client\";\r\ntype VoucherEntry = Prisma.VoucherEntryGetPayload<{}>;\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n/* ================= CATEGORY RESOLVER ================= */\r\nfunction resolveCategory(acc: any) {\r\n  if (acc.partyType === \"EMPLOYES\" || acc.partyType === \"EMPLOYEE\") return \"EMPLOYEES\";\r\n  if (acc.partyType === \"CUSTOMER\") return \"CUSTOMERS\";\r\n  if (acc.partyType === \"SUPPLIER\") return \"SUPPLIERS\";\r\n\r\n  if (acc.type === \"ASSET\") return \"ASSETS\";\r\n  if (acc.type === \"LIABILITY\") return \"LIABILITIES\";\r\n  if (acc.type === \"INCOME\") return \"INCOME\";\r\n  if (acc.type === \"EXPENSE\") return \"EXPENSES\";\r\n\r\n  return \"OTHERS\";\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const from = searchParams.get(\"from\");\r\n    const to = searchParams.get(\"to\");\r\n\r\n    const fromDate = from ? new Date(from + \"T00:00:00\") : new Date(\"2000-01-01\");\r\n    const toDate = to ? new Date(to + \"T23:59:59.999\") : new Date();\r\n\r\n    const accounts = await prisma.account.findMany({\r\n      orderBy: [{ name: \"asc\" }],\r\n    });\r\n\r\n    const rows: any[] = [];\r\n\r\n    for (const acc of accounts) {\r\n      /* ---------- OPENING: Opening balance + vouchers before period ---------- */\r\n      const opVouchers = await prisma.voucherEntry.aggregate({\r\n        where: {\r\n          accountId: acc.id,\r\n          voucher: { date: { lt: fromDate } },\r\n        },\r\n        _sum: { amount: true },\r\n      });\r\n\r\n      const openingFromVouchers = Number(opVouchers._sum.amount || 0);\r\n      const openingFromMaster =\r\n        Number(acc.openDebit || 0) - Number(acc.openCredit || 0);\r\n      const openingNet = openingFromMaster + openingFromVouchers;\r\n\r\n      /* ---------- PERIOD TRANSACTIONS ---------- */\r\n      /* ---------- PERIOD TRANSACTIONS (Voucher-based only) ---------- */\r\n      const periodVouchers = await prisma.voucherEntry.findMany({\r\n        where: {\r\n          accountId: acc.id,\r\n          voucher: { date: { gte: fromDate, lte: toDate } },\r\n        },\r\n      });\r\nlet transDebit = periodVouchers\r\n  .filter((v: VoucherEntry) => Number(v.amount) > 0)\r\n  .reduce(\r\n    (s: number, v: VoucherEntry) => s + Number(v.amount),\r\n    0\r\n  );\r\n\r\nlet transCredit = periodVouchers\r\n  .filter((v: VoucherEntry) => Number(v.amount) < 0)\r\n  .reduce(\r\n    (s: number, v: VoucherEntry) => s + Math.abs(Number(v.amount)),\r\n    0\r\n  );\r\n\r\n\r\n      const closingNet = openingNet + (transDebit - transCredit);\r\n\r\n      if (openingNet === 0 && transDebit === 0 && transCredit === 0) continue;\r\n\r\n      rows.push({\r\n        code: acc.code,\r\n        name: acc.name,\r\n        category: resolveCategory(acc),\r\n\r\n        opDebit: openingNet > 0 ? openingNet : 0,\r\n        opCredit: openingNet < 0 ? Math.abs(openingNet) : 0,\r\n\r\n        transDebit,\r\n        transCredit,\r\n\r\n        clDebit: closingNet > 0 ? closingNet : 0,\r\n        clCredit: closingNet < 0 ? Math.abs(closingNet) : 0,\r\n      });\r\n    }\r\n\r\n    const totals = rows.reduce(\r\n      (a, r) => ({\r\n        opDebit: a.opDebit + r.opDebit,\r\n        opCredit: a.opCredit + r.opCredit,\r\n        transDebit: a.transDebit + r.transDebit,\r\n        transCredit: a.transCredit + r.transCredit,\r\n        clDebit: a.clDebit + r.clDebit,\r\n        clCredit: a.clCredit + r.clCredit,\r\n      }),\r\n      { opDebit: 0, opCredit: 0, transDebit: 0, transCredit: 0, clDebit: 0, clCredit: 0 }\r\n    );\r\n\r\n    return NextResponse.json({ rows, totals });\r\n  } catch (e) {\r\n    console.error(\"TRIAL BALANCE ERROR:\", e);\r\n    return NextResponse.json({ error: \"Failed\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\reports\\year-end\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[125,128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[125,128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[227,230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[227,230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3141,3144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3141,3144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    // 🔐 ROLE CHECK\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    // 📥 BODY\r\n    const body = await req.json();\r\n    const { date } = body;\r\n\r\n    if (!date) {\r\n      return NextResponse.json(\r\n        { error: \"Closing date required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const closingDate = new Date(date + \"T23:59:59\");\r\n\r\n    // 🔎 GET INCOME & EXPENSE ENTRIES\r\n    const entries = await prisma.voucherEntry.findMany({\r\n      where: {\r\n        voucher: {\r\n          date: { lte: closingDate },\r\n        },\r\n        account: {\r\n          type: { in: [\"INCOME\", \"EXPENSE\"] },\r\n        },\r\n      },\r\n      include: {\r\n        account: true,\r\n      },\r\n    });\r\n\r\n    let incomeTotal = 0;\r\n    let expenseTotal = 0;\r\n\r\n    const incomeMap: Record<string, number> = {};\r\n    const expenseMap: Record<string, number> = {};\r\n\r\n    for (const e of entries) {\r\n      const amt = Math.abs(Number(e.amount));\r\n\r\n      if (e.account.type === \"INCOME\") {\r\n        incomeTotal += amt;\r\n        incomeMap[e.account.id] =\r\n          (incomeMap[e.account.id] || 0) + amt;\r\n      }\r\n\r\n      if (e.account.type === \"EXPENSE\") {\r\n        expenseTotal += amt;\r\n        expenseMap[e.account.id] =\r\n          (expenseMap[e.account.id] || 0) + amt;\r\n      }\r\n    }\r\n\r\n    const profit = incomeTotal - expenseTotal;\r\n\r\n    // 🏦 CAPITAL ACCOUNT\r\n    const capital = await prisma.account.findFirst({\r\n      where: { type: \"CAPITAL\" },\r\n    });\r\n\r\n    if (!capital) {\r\n      throw new Error(\"Capital account missing\");\r\n    }\r\n\r\n    // 🧾 YEAR END CLOSING VOUCHER\r\n    await prisma.voucher.create({\r\n      data: {\r\n        voucherNo: `CLOSE-${Date.now()}`,\r\n        type: \"YEAR_END\",\r\n        date: closingDate,\r\n        narration: \"Year End Closing\",\r\n        entries: {\r\n          create: [\r\n            // CLOSE INCOME (DEBIT)\r\n            ...Object.entries(incomeMap).map(([accId, amt]) => ({\r\n              accountId: accId,\r\n              amount: amt,\r\n            })),\r\n\r\n            // CLOSE EXPENSE (CREDIT)\r\n            ...Object.entries(expenseMap).map(([accId, amt]) => ({\r\n              accountId: accId,\r\n              amount: -amt,\r\n            })),\r\n\r\n            // PROFIT / LOSS → CAPITAL\r\n            profit >= 0\r\n              ? {\r\n                  accountId: capital.id,\r\n                  amount: -profit, // PROFIT\r\n                }\r\n              : {\r\n                  accountId: capital.id,\r\n                  amount: Math.abs(profit), // LOSS\r\n                },\r\n          ],\r\n        },\r\n      },\r\n    });\r\n\r\n    return NextResponse.json({\r\n      incomeTotal,\r\n      expenseTotal,\r\n      profit,\r\n      status: \"YEAR CLOSED SUCCESSFULLY\",\r\n    });\r\n  } catch (e: any) {\r\n    console.error(\"YEAR END ERROR:\", e);\r\n    return NextResponse.json(\r\n      { error: e.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\sale-return\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[277,280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[277,280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[376,379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[376,379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[954,957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[954,957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2231,2234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2231,2234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2848,2851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2848,2851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4043,4046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4043,4046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'customerId' is assigned a value but never used.","line":161,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":161,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'invoiceId' is assigned a value but never used.","line":161,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":161,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4925,4928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4925,4928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5366,5369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5366,5369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5823,5826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5823,5826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6668,6671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6668,6671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { PrismaClient , Prisma} from \"@prisma/client\";\ntype SaleReturn = Prisma.SaleReturnGetPayload<{\n  select: {\n    returnNo: true;\n  };\n}>;\n\ntype TxClient = Prisma.TransactionClient;\n\n\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\n// GET - List all Sale Returns\nexport async function GET(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const returns = await prisma.saleReturn.findMany({\n      include: {\n        customer: true,\n        invoice: true,\n        items: {\n          include: { item: true },\n        },\n      },\n      orderBy: { date: \"desc\" },\n    });\n\n    return NextResponse.json(returns);\n  } catch (e: any) {\n    console.error(\"Sale Return GET Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\nexport async function POST(req: Request) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  try {\n    const { customerId, invoiceId, date, items, freight = 0 } = await req.json();\n\n    if (!customerId || !date || !items?.length) {\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 });\n    }\n\n    // 1. تمام موجودہ SR نمبرز حاصل کر کے اگلا نمبر (SR-1, SR-2...) نکالنا\n    const allReturns = await prisma.saleReturn.findMany({\n      where: { returnNo: { startsWith: 'SR-' } },\n      select: { returnNo: true }\n    });\n\n    let nextNo = \"SR-1\";\n    if (allReturns.length > 0) {\n      const numbers = allReturns.map((r: SaleReturn) => {\n  const n = parseInt(r.returnNo.replace(\"SR-\", \"\"));\n  return isNaN(n) ? 0 : n;\n});\n\n      const maxNum = Math.max(...numbers);\n      nextNo = `SR-${maxNum + 1}`;\n    }\n\n    // 2. ٹرانزیکشن شروع کریں تاکہ سارا ڈیٹا ایک ساتھ سیو ہو\n   const result = await prisma.$transaction(async (tx: TxClient) => {\n  const subtotal = items.reduce(\n    (s: number, i: any) => s + Number(i.qty) * Number(i.rate),\n    0\n  );\n  const total = subtotal + Number(freight);\n\n  let salesReturnAcc = await tx.account.findFirst({\n    where: { name: { equals: \"Sales Return\", mode: \"insensitive\" } },\n  });\n\n  if (!salesReturnAcc) {\n    salesReturnAcc = await tx.account.create({\n      data: { code: \"SALES_RETURN\", name: \"Sales Return\", type: \"EXPENSE\" },\n    });\n  }\n\n  const saleReturn = await tx.saleReturn.create({\n    data: {\n      returnNo: nextNo,\n      date: new Date(date),\n      customerId,\n      invoiceId: invoiceId || null,\n      total,\n      items: {\n        create: items.map((i: any) => ({\n          itemId: i.itemId,\n          qty: Number(i.qty),\n          rate: Number(i.rate),\n          amount: Number(i.qty) * Number(i.rate),\n        })),\n      },\n    },\n  });\n\n      // اسٹاک واپس پلس کرنا\n      for (const i of items) {\n        await tx.inventoryTxn.create({\n          data: {\n            type: \"SALE_RETURN\",\n            date: new Date(date),\n            itemId: i.itemId,\n            qty: Number(i.qty),\n            rate: Number(i.rate),\n            amount: Number(i.qty) * Number(i.rate),\n            partyId: customerId,\n          },\n        });\n      }\n\n      // اکاؤنٹنگ واؤچر بنانا\n      await tx.voucher.create({\n        data: {\n          voucherNo: nextNo,\n          type: \"SR\",\n          date: new Date(date),\n          narration: `Sales Return ${nextNo} (Invoice: ${invoiceId || 'N/A'})`,\n          entries: {\n            create: [\n              { accountId: salesReturnAcc.id, amount: total }, // Debit\n              { accountId: customerId, amount: -total },       // Credit\n            ],\n          },\n        },\n      });\n\n      return saleReturn;\n    });\n\n    return NextResponse.json({ success: true, id: result.id, returnNo: nextNo });\n  } catch (e: any) {\n    console.error(\"SALE RETURN ERROR:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// PUT - Update Sale Return\nexport async function PUT(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const { id, customerId, invoiceId, date, items, freight = 0 } = body;\n\n    if (!id) {\n      return NextResponse.json({ error: \"Return ID required\" }, { status: 400 });\n    }\n\n    const existing = await prisma.saleReturn.findUnique({\n      where: { id },\n      include: { items: true },\n    });\n\n    if (!existing) {\n      return NextResponse.json({ error: \"Return not found\" }, { status: 404 });\n    }\n\n    const subtotal = items.reduce((s: number, i: any) => s + Number(i.qty) * Number(i.rate), 0);\n    const total = subtotal + Number(freight);\n\n    const result = await prisma.$transaction(async (tx: TxClient) => {\n\n      await tx.saleReturnItem.deleteMany({ where: { returnId: id } });\n\n      const saleReturn = await tx.saleReturn.update({\n        where: { id },\n        data: {\n          date: new Date(date),\n          total: total,\n          items: {\n            create: items.map((i: any) => ({\n              itemId: i.itemId,\n              qty: Number(i.qty),\n              rate: Number(i.rate),\n              amount: Number(i.qty) * Number(i.rate),\n            })),\n          },\n        },\n        include: {\n          customer: true,\n          items: {\n            include: { item: true },\n          },\n        },\n      });\n\n      return saleReturn;\n    });\n\n    return NextResponse.json({ success: true, return: result });\n  } catch (e: any) {\n    console.error(\"Sale Return PUT Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// DELETE - Delete Sale Return\nexport async function DELETE(req: NextRequest) {\n  try {\n    const role = req.headers.get(\"x-user-role\");\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"Return ID required\" }, { status: 400 });\n    }\n\n    await prisma.$transaction(async (tx : TxClient) => {\n      await tx.saleReturnItem.deleteMany({ where: { returnId: id } });\n      await tx.saleReturn.delete({ where: { id } });\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (e: any) {\n    console.error(\"Sale Return DELETE Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\sales-invoice\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":10,"column":55,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":10,"endColumn":57,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[274,276],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[274,276],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[692,695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[692,695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[794,797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[794,797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2556,2559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2556,2559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3598,3601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3598,3601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3993,3996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3993,3996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5324,5327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5324,5327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma } from \"@prisma/client\";\r\n\r\ntype SaleReturnWithItems = Prisma.SaleReturnGetPayload<{\r\n  include: {\r\n    items: true;\r\n  };\r\n}>;\r\n\r\ntype SaleReturnItem = Prisma.SaleReturnItemGetPayload<{}>;\r\n\r\ntype SalesInvoiceItemWithItem = Prisma.SalesInvoiceItemGetPayload<{\r\n  include: {\r\n    item: true;\r\n  };\r\n}>;\r\n\r\ntype SaleReturn = Prisma.SaleReturnGetPayload<{\r\n  select: {\r\n    returnNo: true;\r\n  };\r\n}>;\r\n\r\ntype TxClient = Prisma.TransactionClient;\r\n\r\n\r\n\r\ntype PendingItem = {\r\n  itemId: string;\r\n  name: string;\r\n  qty: number;\r\n  rate: number;\r\n  maxQty: number;\r\n};\r\n\r\n\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n// ================= GET FUNCTION =================\r\n// انوائس کی تفصیل لانا اور چیک کرنا کہ کتنا مال باقی ہے\r\nexport async function GET(req: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const { id } = await params;\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"Invoice ID is missing\" }, { status: 400 });\r\n    }\r\n\r\n    const invoice = await prisma.salesInvoice.findUnique({\r\n      where: { id: id },\r\n      include: {\r\n        customer: true,\r\n        items: { include: { item: true } },\r\n        returns: { include: { items: true } } // تمام پرانی ریٹرنز بھی شامل کریں\r\n      },\r\n    });\r\n\r\n    if (!invoice) {\r\n      return NextResponse.json({ error: \"Invoice not found\" }, { status: 404 });\r\n    }\r\n\r\n    // 1. حساب لگائیں کہ کون سا آئٹم کتنا واپس ہو چکا ہے\r\n    const returnedQtyMap: Record<string, number> = {};\r\n    invoice.returns.forEach((ret: SaleReturnWithItems) => {\r\n  ret.items.forEach((item: SaleReturnItem) => {\r\n    returnedQtyMap[item.itemId] =\r\n      (returnedQtyMap[item.itemId] || 0) + Number(item.qty || 0);\r\n  });\r\n});\r\n\r\nconst pendingItems = invoice.items\r\n  .map(\r\n    (i: SalesInvoiceItemWithItem): PendingItem => {\r\n      const alreadyReturned = returnedQtyMap[i.itemId] || 0;\r\n      const remainingQty = i.qty - alreadyReturned;\r\n\r\n      return {\r\n        itemId: i.itemId,\r\n        name: i.item?.name || \"Unknown Item\",\r\n        qty: remainingQty,\r\n        rate: i.rate,\r\n        maxQty: remainingQty,\r\n      };\r\n    }\r\n  )\r\n  .filter((it: PendingItem) => it.qty > 0);\r\n\r\n\r\n\r\n    return NextResponse.json({\r\n      customerId: invoice.customerId,\r\n      customerName: invoice.customer?.name || \"Unknown\",\r\n      items: pendingItems,\r\n    });\r\n\r\n  } catch (e: any) {\r\n    console.error(\"DETAIL FETCH ERROR:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// ================= POST FUNCTION =================\r\n// سیلز ریٹرن کو سیو کرنا، اسٹاک اپ ڈیٹ کرنا اور واؤچر بنانا\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { customerId, invoiceId, date, freight = 0, items } = body;\r\n\r\n    // 1. اگلا SR نمبر جنریٹ کرنا (SR-1, SR-2...)\r\n    const allReturns = await prisma.saleReturn.findMany({\r\n      where: { returnNo: { startsWith: 'SR-' } },\r\n      select: { returnNo: true }\r\n    });\r\n\r\n    let nextNo = \"SR-1\";\r\n    if (allReturns.length > 0) {\r\n      const numbers = allReturns.map((r: SaleReturn) => {\r\n  const n = parseInt(r.returnNo.replace(\"SR-\", \"\"));\r\n  return isNaN(n) ? 0 : n;\r\n});\r\n\r\n      const maxNum = Math.max(...numbers);\r\n      nextNo = `SR-${maxNum + 1}`;\r\n    }\r\n\r\n    const result = await prisma.$transaction(async (tx: TxClient) => {\r\n      const subtotal = items.reduce((s: number, i: any) => s + Number(i.qty) * Number(i.rate), 0);\r\n      const total = subtotal + Number(freight);\r\n\r\n      // 2. سیلز ریٹرن ریکارڈ بنانا\r\n      const saleReturn = await tx.saleReturn.create({\r\n        data: {\r\n          returnNo: nextNo,\r\n          date: new Date(date),\r\n          customerId,\r\n          invoiceId,\r\n          total: total,\r\n          items: {\r\n            create: items.map((i: any) => ({\r\n              itemId: i.itemId,\r\n              qty: Number(i.qty),\r\n              rate: Number(i.rate),\r\n              amount: Number(i.qty) * Number(i.rate),\r\n            })),\r\n          },\r\n        },\r\n      });\r\n\r\n      // 3. اسٹاک میں واپسی (Inventory Transaction)\r\n      for (const i of items) {\r\n        await tx.inventoryTxn.create({\r\n          data: {\r\n            type: \"SALE_RETURN\",\r\n            date: new Date(date),\r\n            itemId: i.itemId,\r\n            qty: Number(i.qty),\r\n            rate: Number(i.rate),\r\n            amount: Number(i.qty) * Number(i.rate),\r\n            partyId: customerId,\r\n          },\r\n        });\r\n      }\r\n\r\n      // 4. اکاؤنٹنگ واؤچر اینٹری\r\n      await tx.voucher.create({\r\n        data: {\r\n          voucherNo: nextNo,\r\n          type: \"SR\",\r\n          date: new Date(date),\r\n          narration: `Sales Return ${nextNo} against Invoice ID ${invoiceId}`,\r\n          entries: {\r\n            create: [\r\n              { accountId: \"SALES_RETURN_ACC_ID\", amount: total }, // Debit (Replace with real ID)\r\n              { accountId: customerId, amount: -total },           // Credit\r\n            ],\r\n          },\r\n        },\r\n      });\r\n\r\n      return saleReturn;\r\n    });\r\n\r\n    return NextResponse.json({ success: true, returnNo: nextNo, id: result.id });\r\n\r\n  } catch (e: any) {\r\n    console.error(\"POST ERROR:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\sales-invoice\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[567,570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[567,570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[666,669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[666,669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3142,3145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3142,3145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3848,3851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3848,3851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4439,4442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4439,4442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6095,6098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6095,6098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'customerId' is assigned a value but never used.","line":251,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":251,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'location' is assigned a value but never used.","line":251,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":251,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7152,7155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7152,7155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":291,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7928,7931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7928,7931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":310,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8354,8357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8354,8357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9350,9353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9350,9353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\nimport { PrismaClient, Prisma } from \"@prisma/client\";\nimport { apiHasPermission } from \"@/lib/apiPermission\";\nimport { PERMISSIONS } from \"@/lib/permissions\";\ntype SalesInvoiceNoOnly = Prisma.SalesInvoiceGetPayload<{\n  select: { invoiceNo: true };\n}>;\n\ntype SalesInvoiceFull = Prisma.SalesInvoiceGetPayload<{\n  include: {\n    customer: true;\n    items: { include: { item: true } };\n    returns: { include: { items: true } };\n  };\n}>;\n\ntype TxClient = Prisma.TransactionClient;\n\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\nexport async function GET(req: NextRequest) {\n  try {\n    const userId = req.headers.get(\"x-user-id\");\n    const userRole = req.headers.get(\"x-user-role\");\n\n    const allowed = await apiHasPermission(\n      userId,\n      userRole,\n      PERMISSIONS.CREATE_SALES_INVOICE\n    );\n\n    if (!allowed) {\n      return NextResponse.json({ error: \"No Access\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (id) {\n      const inv = await prisma.salesInvoice.findUnique({\n        where: { id },\n        include: {\n          customer: true,\n          items: { include: { item: true } },\n          returns: { include: { items: true } }\n        }\n      });\n      if (!inv) return NextResponse.json({ error: \"Not found\" }, { status: 404 });\n      \n      return NextResponse.json({\n        id: inv.id,\n        invoiceNo: inv.invoiceNo,\n        customerId: inv.customerId,\n        customerName: inv.customer?.name || \"Unknown\",\n        date: inv.date,\n        total: inv.total,\n        items: inv.items,\n        customer: inv.customer,\n        driverName: inv.driverName,\n        vehicleNo: inv.vehicleNo,\n        location: inv.location\n      });\n    }\n\n    // Calculate next invoice number\n    const allInvoices = await prisma.salesInvoice.findMany({\n      where: { invoiceNo: { startsWith: \"SI-\" } },\n      select: { invoiceNo: true }\n    });\n\n    let nextNo = \"SI-1\";\n    if (allInvoices.length > 0) {\n      const numbers = allInvoices.map((inv: SalesInvoiceNoOnly) => {\n        const n = parseInt(inv.invoiceNo.replace(\"SI-\", \"\"));\n        return isNaN(n) ? 0 : n;\n      });\n\n      const maxNum = Math.max(...numbers);\n      nextNo = `SI-${maxNum + 1}`;\n    }\n\n    const invoices = await prisma.salesInvoice.findMany({\n      include: {\n        customer: true,\n        items: { include: { item: true } },\n        returns: { include: { items: true } }\n      },\n      orderBy: { date: \"desc\" }\n    });\n\n    const formattedInvoices = invoices.map((inv: SalesInvoiceFull) => ({\n      id: inv.id,\n      invoiceNo: inv.invoiceNo,\n      customerId: inv.customerId,\n      customerName: inv.customer?.name || \"Unknown\",\n      date: inv.date,\n      total: inv.total,\n      items: inv.items,\n      customer: inv.customer,\n      driverName: inv.driverName,\n      vehicleNo: inv.vehicleNo,\n    }));\n\n\n\n    return NextResponse.json({\n      nextNo,\n      invoices: formattedInvoices\n    });\n  } catch (e: any) {\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const userId = req.headers.get(\"x-user-id\");\n    const userRole = req.headers.get(\"x-user-role\");\n\n    const allowed = await apiHasPermission(\n      userId,\n      userRole,\n      PERMISSIONS.CREATE_SALES_INVOICE\n    );\n\n    if (!allowed) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const { invoiceNo, customerId, date, location, freight = 0, items, applyTax = false, taxConfigId = null, driverName = null, vehicleNo = null } = body;\n\n    const total = items.reduce(\n      (s: number, i: any) => s + i.qty * i.rate,\n      0\n    );\n\n    // Calculate tax if applied\n    let taxAmount = 0;\n    if (applyTax && taxConfigId) {\n      const tax = await prisma.taxConfiguration.findUnique({\n        where: { id: taxConfigId }\n      });\n      if (tax) {\n        taxAmount = (total * tax.taxRate) / 100;\n      }\n    }\n\n    const invoice = await prisma.salesInvoice.create({\n      data: {\n        invoiceNo,\n        date: new Date(date),\n        customerId,\n        driverName,\n        vehicleNo,\n        total: total + freight + taxAmount,\n        items: {\n          create: items.map((i: any) => ({\n            itemId: i.itemId,\n            qty: i.qty,\n            rate: i.rate,\n            amount: i.qty * i.rate,\n          })),\n        },\n        taxConfigId: applyTax ? taxConfigId : null,\n      },\n    });\n\n    let salesAcc = await prisma.account.findFirst({\n      where: { name: { equals: \"Sales\", mode: \"insensitive\" } },\n    });\n\n    if (!salesAcc) {\n      salesAcc = await prisma.account.create({\n        data: { code: \"SALES\", name: \"Sales\", type: \"INCOME\" },\n      });\n    }\n\n    await prisma.voucher.create({\n      data: {\n        voucherNo: invoice.invoiceNo,\n        type: \"SI\",\n        date: new Date(date),\n        narration: \"Sales Invoice\",\n        entries: {\n          create: [\n            { accountId: customerId, amount: total + freight + taxAmount },\n            { accountId: salesAcc.id, amount: -(total + freight + taxAmount) },\n          ],\n        },\n      },\n    });\n\n    for (const i of items) {\n      await prisma.inventoryTxn.create({\n        data: {\n          type: \"SALE\",\n          date: new Date(date),\n          itemId: i.itemId,\n          qty: -i.qty,\n          rate: i.rate,\n          amount: i.qty * i.rate,\n          location,\n        },\n      });\n    }\n\n    // Fetch the created invoice with customer details for preview\n    const savedInvoice = await prisma.salesInvoice.findUnique({\n      where: { id: invoice.id },\n      include: {\n        customer: true,\n        items: { include: { item: true } },\n        taxConfig: true\n      }\n    });\n\n    return NextResponse.json({\n      success: true,\n      id: invoice.id,\n      invoiceNo: invoice.invoiceNo,\n      invoice: savedInvoice\n    });\n  } catch (e: any) {\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// PUT - Update Sales Invoice\nexport async function PUT(req: NextRequest) {\n  try {\n    const userId = req.headers.get(\"x-user-id\");\n    const userRole = req.headers.get(\"x-user-role\");\n\n    const allowed = await apiHasPermission(\n      userId,\n      userRole,\n      PERMISSIONS.CREATE_SALES_INVOICE\n    );\n\n    if (!allowed) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const body = await req.json();\n    const { id, customerId, date, location, freight = 0, items, applyTax = false, taxConfigId = null, driverName = null, vehicleNo = null } = body;\n\n    if (!id) {\n      return NextResponse.json({ error: \"Invoice ID required\" }, { status: 400 });\n    }\n\n    const existing = await prisma.salesInvoice.findUnique({\n      where: { id },\n      include: { items: true },\n    });\n\n    if (!existing) {\n      return NextResponse.json({ error: \"Invoice not found\" }, { status: 404 });\n    }\n\n    const total = items.reduce((s: number, i: any) => s + i.qty * i.rate, 0);\n\n    // Calculate tax if applied\n    let taxAmount = 0;\n    if (applyTax && taxConfigId) {\n      const tax = await prisma.taxConfiguration.findUnique({\n        where: { id: taxConfigId }\n      });\n      if (tax) {\n        taxAmount = (total * tax.taxRate) / 100;\n      }\n    }\n\n    const result = await prisma.$transaction(async (tx: TxClient) => {\n      await tx.salesInvoiceItem.deleteMany({ where: { invoiceId: id } });\n\n      const invoice = await tx.salesInvoice.update({\n        where: { id },\n        data: {\n          date: new Date(date),\n          driverName,\n          vehicleNo,\n          total: total + freight + taxAmount,\n          taxConfigId: applyTax ? taxConfigId : null,\n          items: {\n            create: items.map((i: any) => ({\n              itemId: i.itemId,\n              qty: i.qty,\n              rate: i.rate,\n              amount: i.qty * i.rate,\n            })),\n          },\n        },\n        include: {\n          customer: true,\n          items: { include: { item: true } },\n          taxConfig: true\n        },\n      });\n\n      return invoice;\n    });\n\n    return NextResponse.json({ success: true, invoice: result });\n  } catch (e: any) {\n    console.error(\"Sales Invoice PUT Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n\n// DELETE - Delete Sales Invoice\nexport async function DELETE(req: NextRequest) {\n  try {\n    const userId = req.headers.get(\"x-user-id\");\n    const userRole = req.headers.get(\"x-user-role\");\n\n    const allowed = await apiHasPermission(\n      userId,\n      userRole,\n      PERMISSIONS.CREATE_SALES_INVOICE\n    );\n\n    if (!allowed) {\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(req.url);\n    const id = searchParams.get(\"id\");\n\n    if (!id) {\n      return NextResponse.json({ error: \"Invoice ID required\" }, { status: 400 });\n    }\n\n    await prisma.$transaction(async (tx: TxClient) => {\n      await tx.salesInvoiceItem.deleteMany({ where: { invoiceId: id } });\n      await tx.salesInvoice.delete({ where: { id } });\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (e: any) {\n    console.error(\"Sales Invoice DELETE Error:\", e);\n    return NextResponse.json({ error: e.message }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\search\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[449,452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[449,452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[551,554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[551,554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'searchTerm' is assigned a value but never used.","line":42,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":210,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5127,5130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5127,5130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma} from \"@prisma/client\";\r\n\r\ntype AccountSearch = Prisma.AccountGetPayload<{\r\n  select: {\r\n    id: true;\r\n    name: true;\r\n      code: true,  \r\n    type: true;\r\n    partyType: true;\r\n  };\r\n}>;\r\ntype ItemSearch = Prisma.ItemNewGetPayload<{\r\n  select: {\r\n    id: true;\r\n    name: true;\r\n    code: true;\r\n    unit: true;\r\n  };\r\n}>;\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const query = searchParams.get(\"q\")?.trim();\r\n\r\n    if (!query || query.length < 2) {\r\n      return NextResponse.json({ results: [] });\r\n    }\r\n\r\n    const searchTerm = `%${query}%`;\r\n\r\n    // Search Accounts\r\n    const accounts = await prisma.account.findMany({\r\n      where: {\r\n        OR: [\r\n          { name: { contains: query, mode: \"insensitive\" } },\r\n          { code: { contains: query, mode: \"insensitive\" } },\r\n        ],\r\n      },\r\n      take: 10,\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        code: true,\r\n        type: true,\r\n        partyType: true,\r\n      },\r\n    });\r\n\r\n    // Search Items\r\n    const items = await prisma.itemNew.findMany({\r\n      where: {\r\n        OR: [\r\n          { name: { contains: query, mode: \"insensitive\" } },\r\n          { code: { contains: query, mode: \"insensitive\" } },\r\n        ],\r\n      },\r\n      take: 10,\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        code: true,\r\n        unit: true,\r\n      },\r\n    });\r\n\r\n    // Search Sales Invoices\r\n    const salesInvoices = await prisma.salesInvoice.findMany({\r\n      where: {\r\n        invoiceNo: { contains: query, mode: \"insensitive\" },\r\n      },\r\n      take: 10,\r\n      include: {\r\n        customer: { select: { name: true } },\r\n      },\r\n      select: {\r\n        id: true,\r\n        invoiceNo: true,\r\n        date: true,\r\n        total: true,\r\n        customer: true,\r\n      },\r\n    });\r\n\r\n    // Search Purchase Invoices\r\n    const purchaseInvoices = await prisma.purchaseInvoice.findMany({\r\n      where: {\r\n        invoiceNo: { contains: query, mode: \"insensitive\" },\r\n      },\r\n      take: 10,\r\n      include: {\r\n        supplier: { select: { name: true } },\r\n      },\r\n      select: {\r\n        id: true,\r\n        invoiceNo: true,\r\n        date: true,\r\n        total: true,\r\n        supplier: true,\r\n      },\r\n    });\r\n\r\n    // Search Vouchers\r\n    const vouchers = await prisma.voucher.findMany({\r\n      where: {\r\n        OR: [\r\n          { voucherNo: { contains: query, mode: \"insensitive\" } },\r\n          { narration: { contains: query, mode: \"insensitive\" } },\r\n        ],\r\n      },\r\n      take: 10,\r\n      select: {\r\n        id: true,\r\n        voucherNo: true,\r\n        type: true,\r\n        date: true,\r\n        narration: true,\r\n      },\r\n    });\r\n\r\n   return NextResponse.json({\r\n  accounts: accounts.map((a: AccountSearch) => ({\r\n    type: \"account\",\r\n    id: a.id,\r\n    title: a.name,\r\n    subtitle: `${a.code} - ${a.type}${a.partyType ? ` (${a.partyType})` : \"\"}`,\r\n    url: `/dashboard/accounts`,\r\n  })),\r\n\r\n  items: items.map((i: ItemSearch) => ({\r\n    type: \"item\",\r\n    id: i.id,\r\n    title: i.name,\r\n    subtitle: `${i.code} - ${i.unit}`,\r\n    url: `/dashboard/items-new`,\r\n  })),\r\n\r\n  salesInvoices: salesInvoices.map(\r\n    (inv: {\r\n      id: string;\r\n      invoiceNo: string;\r\n      date: Date;\r\n      total: number;\r\n      customer?: { name: string } | null;\r\n    }) => ({\r\n      type: \"sales-invoice\",\r\n      id: inv.id,\r\n      title: inv.invoiceNo,\r\n      subtitle: `${inv.customer?.name || \"N/A\"} - ${new Date(\r\n        inv.date\r\n      ).toLocaleDateString()} - Rs. ${inv.total}`,\r\n      url: `/dashboard/sales-invoice?id=${inv.id}`,\r\n    })\r\n  ),\r\n\r\n  purchaseInvoices: purchaseInvoices.map(\r\n    (inv: {\r\n      id: string;\r\n      invoiceNo: string;\r\n      date: Date;\r\n      total: number;\r\n      supplier?: { name: string } | null;\r\n    }) => ({\r\n      type: \"purchase-invoice\",\r\n      id: inv.id,\r\n      title: inv.invoiceNo,\r\n      subtitle: `${inv.supplier?.name || \"N/A\"} - ${new Date(\r\n        inv.date\r\n      ).toLocaleDateString()} - Rs. ${inv.total}`,\r\n      url: `/dashboard/purchase-invoice?id=${inv.id}`,\r\n    })\r\n  ),\r\n\r\n  vouchers: vouchers.map(\r\n    (v: {\r\n      id: string;\r\n      voucherNo: string;\r\n      type: string;\r\n      date: Date;\r\n      narration?: string | null;\r\n    }) => ({\r\n      type: \"voucher\",\r\n      id: v.id,\r\n      title: v.voucherNo,\r\n      subtitle: `${v.type} - ${new Date(\r\n        v.date\r\n      ).toLocaleDateString()}${v.narration ? ` - ${v.narration}` : \"\"}`,\r\n      url:\r\n        v.type === \"CPV\"\r\n          ? `/dashboard/cpv`\r\n          : v.type === \"CRV\"\r\n          ? `/dashboard/crv`\r\n          : `/dashboard/jv`,\r\n    })\r\n  ),\r\n});\r\n\r\n  } catch (e: any) {\r\n    console.error(\"❌ SEARCH ERROR:\", e);\r\n    return NextResponse.json(\r\n      { error: e.message || \"Search failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\stock-available-for-sale\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Prisma' is defined but never used.","line":2,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":31,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Prisma"},"fix":{"range":[67,75],"text":""},"desc":"Remove unused variable \"Prisma\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[339,342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[339,342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[441,444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[441,444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma } from \"@prisma/client\";\r\ntype StockAggRow = {\r\n  itemId: string;\r\n  _sum: {\r\n    qty: number | null;\r\n  };\r\n};\r\n\r\ntype ItemRow = {\r\n  id: string;\r\n  name: string;\r\n  description: string | null;\r\n  barcode: string | null;\r\n};\r\n\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET() {\r\n  try {\r\n    const txns = await prisma.inventoryTxn.groupBy({\r\n      by: [\"itemId\"],\r\n      _sum: { qty: true },\r\n    });\r\n\r\n    const inStock = txns.filter(\r\n  (t: StockAggRow) => (t._sum.qty ?? 0) > 0\r\n);\r\n\r\n    if (!inStock.length) return NextResponse.json([]);\r\n\r\n    const items = await prisma.itemNew.findMany({\r\n  where: {\r\n    id: {\r\n      in: inStock.map((t: StockAggRow) => t.itemId),\r\n    },\r\n  },\r\n  select: {\r\n    id: true,\r\n    name: true,\r\n    description: true,\r\n    barcode: true,\r\n  },\r\n});\r\n\r\n\r\n    const stockMap = new Map<string, number>();\r\n    inStock.forEach((t: StockAggRow) => {\r\n  stockMap.set(t.itemId, t._sum.qty ?? 0);\r\n});\r\n\r\n      return NextResponse.json(\r\n  items.map((i: ItemRow) => ({\r\n    ...i,\r\n    availableQty: stockMap.get(i.id) || 0,\r\n  }))\r\n);\r\n\r\n  } catch (e) {\r\n    console.error(e);\r\n    return NextResponse.json([], { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\stock-rate\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[135,138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[135,138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[234,237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[234,237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PrismaClient } from \"@prisma/client\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nconst prisma = (globalThis as any).prisma || new PrismaClient();\n\nif (process.env.NODE_ENV === \"development\") {\n  (globalThis as any).prisma = prisma;\n}\n\n/* GET – list */\nexport async function GET(req: NextRequest) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  const rates = await prisma.stockRate.findMany({\n    include: { item: true },\n    orderBy: { date: \"desc\" },\n  });\n\n  return NextResponse.json(rates);\n}\n\n/* POST – add rate */\nexport async function POST(req: NextRequest) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  const { itemId, rate, date } = await req.json();\n\n  if (!itemId || !rate) {\n    return NextResponse.json(\n      { error: \"Item & rate required\" },\n      { status: 400 }\n    );\n  }\n\n  const stockRate = await prisma.stockRate.create({\n    data: {\n      itemId,\n      rate: Number(rate),\n      date: date ? new Date(date) : new Date(),\n    },\n  });\n\n  return NextResponse.json(stockRate);\n}\n\n/* PUT – update rate */\nexport async function PUT(req: NextRequest) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  const { id, itemId, rate, date } = await req.json();\n\n  if (!id) {\n    return NextResponse.json(\n      { error: \"Rate ID required\" },\n      { status: 400 }\n    );\n  }\n\n  if (!itemId || !rate) {\n    return NextResponse.json(\n      { error: \"Item & rate required\" },\n      { status: 400 }\n    );\n  }\n\n  const stockRate = await prisma.stockRate.update({\n    where: { id },\n    data: {\n      itemId,\n      rate: Number(rate),\n      date: date ? new Date(date) : new Date(),\n    },\n    include: { item: true },\n  });\n\n  return NextResponse.json(stockRate);\n}\n\n/* DELETE – delete rate */\nexport async function DELETE(req: NextRequest) {\n  const role = req.headers.get(\"x-user-role\");\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\n  }\n\n  const { searchParams } = new URL(req.url);\n  const id = searchParams.get(\"id\");\n\n  if (!id) {\n    return NextResponse.json(\n      { error: \"Rate ID required\" },\n      { status: 400 }\n    );\n  }\n\n  await prisma.stockRate.delete({\n    where: { id },\n  });\n\n  return NextResponse.json({ success: true });\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\stock-report\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[248,251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[248,251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[350,353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[350,353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient , Prisma } from \"@prisma/client\";\r\ntype ItemWithTxns = Prisma.ItemNewGetPayload<{\r\n  include: {\r\n    inventoryTxns: true;\r\n  };\r\n}>;\r\n\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const role = req.headers.get(\"x-user-role\");\r\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  const items = await prisma.itemNew.findMany({\r\n    include: { inventoryTxns: true },\r\n  });\r\n\r\nconst report = items.map((item: ItemWithTxns) => {\r\n  const stock = item.inventoryTxns.reduce(\r\n    (s: number, t: { qty: number }) => s + Number(t.qty || 0),\r\n    0\r\n  );\r\n\r\n  return {\r\n    item: item.name,\r\n    stock,\r\n  };\r\n});\r\n\r\n  return NextResponse.json(report);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\suppliers\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PrismaClient } from \"@prisma/client\";\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const role = req.headers.get(\"x-user-role\");\r\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  const suppliers = await prisma.account.findMany({\r\n    where: { partyType: \"SUPPLIER\" },\r\n    orderBy: { name: \"asc\" },\r\n  });\r\n\r\n  return NextResponse.json(suppliers);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\tax-configuration\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[444,447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[444,447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const isActive = searchParams.get('isActive');\r\n\r\n    const filter: any = {};\r\n    if (isActive !== null) filter.isActive = isActive === 'true';\r\n\r\n    const taxes = await prisma.taxConfiguration.findMany({\r\n      where: filter,\r\n      include: {\r\n        taxAccounts: { include: { account: true } },\r\n        invoiceTaxes: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(taxes);\r\n  } catch (error) {\r\n    console.error('Error fetching tax configurations:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch tax configurations' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { taxType, taxCode, taxRate, description } = body;\r\n\r\n    const tax = await prisma.taxConfiguration.create({\r\n      data: {\r\n        taxType,\r\n        taxCode,\r\n        taxRate,\r\n        description,\r\n        isActive: true,\r\n      },\r\n      include: {\r\n        taxAccounts: { include: { account: true } },\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(tax, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Error creating tax configuration:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to create tax configuration' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (!role || (role !== \"ADMIN\" && role !== \"ACCOUNTANT\")) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { id, ...updateData } = body;\r\n\r\n    const tax = await prisma.taxConfiguration.update({\r\n      where: { id },\r\n      data: updateData,\r\n      include: {\r\n        taxAccounts: { include: { account: true } },\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(tax);\r\n  } catch (error) {\r\n    console.error('Error updating tax configuration:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to update tax configuration' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: NextRequest) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n    if (!role || (role !== \"ADMIN\" && role !== \"ACCOUNTANT\")) {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get('id');\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { error: 'ID required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    await prisma.taxConfiguration.delete({\r\n      where: { id },\r\n    });\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error('Error deleting tax configuration:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to delete tax configuration' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\test-db\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[125,128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[125,128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[227,230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[227,230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[684,687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[684,687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n// Simple database connection test\r\nexport async function GET() {\r\n  try {\r\n    // Test connection\r\n    await prisma.$connect();\r\n    \r\n    // Simple query\r\n    const userCount = await prisma.user.count();\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"Database connected successfully\",\r\n      userCount,\r\n      database: \"smart_accounts\",\r\n      host: \"localhost:5432\",\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"❌ DATABASE CONNECTION ERROR:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: error.message,\r\n        code: error.code,\r\n        details: {\r\n          message: \"Cannot connect to PostgreSQL database\",\r\n          solution: [\r\n            \"1. Make sure PostgreSQL service is running\",\r\n            \"2. Check if port 5432 is open\",\r\n            \"3. Verify database 'smart_accounts' exists\",\r\n            \"4. Check username/password: postgres/12345678\",\r\n          ],\r\n        },\r\n      },\r\n      { status: 500 }\r\n    );\r\n  } finally {\r\n    await prisma.$disconnect().catch(() => {});\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\test-login\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":11,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1044,1047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1044,1047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\n// Test endpoint to check users and database\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // Check database connection\r\n    await prisma.$connect();\r\n    \r\n    // Get all users (without passwords)\r\n    const users = await prisma.user.findMany({\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        email: true,\r\n        role: true,\r\n        active: true,\r\n        createdAt: true,\r\n      },\r\n      orderBy: { createdAt: \"desc\" },\r\n    });\r\n\r\n    // Check if any users exist\r\n    const userCount = await prisma.user.count();\r\n\r\n    return NextResponse.json({\r\n      databaseConnected: true,\r\n      userCount,\r\n      users,\r\n      message: userCount === 0 ? \"No users found. Please create a user first.\" : \"Users found\",\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"❌ TEST LOGIN ERROR:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        databaseConnected: false,\r\n        error: error.message,\r\n        code: error.code,\r\n        meta: error.meta,\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\trial-balance\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"The `{}` (\"empty object\") type allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowObjectTypes' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":4,"column":41,"nodeType":"TSTypeLiteral","messageId":"noEmptyObject","endLine":4,"endColumn":43,"suggestions":[{"messageId":"replaceEmptyObjectType","data":{"replacement":"object"},"fix":{"range":[156,158],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"replaceEmptyObjectType","data":{"replacement":"unknown"},"fix":{"range":[156,158],"text":"unknown"},"desc":"Replace `{}` with `unknown`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[273,276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[273,276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[375,378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[375,378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient, Prisma } from \"@prisma/client\";\r\n\r\ntype Account = Prisma.AccountGetPayload<{}>;\r\ntype Voucher = Prisma.VoucherGetPayload<{\r\n  include: { entries: true };\r\n}>;\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const role = req.headers.get(\"x-user-role\");\r\n  if (role !== \"ADMIN\" && role !== \"ACCOUNTANT\") {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n  }\r\n\r\n  const accounts = await prisma.account.findMany();\r\n  const vouchers = await prisma.voucher.findMany({\r\n    include: { entries: true },\r\n  });\r\n\r\n  const result = accounts.map((acc: Account) => {\r\n    let debit = 0;\r\n    let credit = 0;\r\n\r\n    vouchers.forEach((v: Voucher) => {\r\n      v.entries.forEach((e) => {\r\n        if (e.accountId !== acc.id) return;\r\n\r\n        if (v.type === \"CRV\") {\r\n          if (e.amount > 0) debit += e.amount;\r\n          else credit += Math.abs(e.amount);\r\n        }\r\n\r\n        if (v.type === \"CPV\") {\r\n          if (e.amount > 0) debit += e.amount;\r\n          else credit += Math.abs(e.amount);\r\n        }\r\n      });\r\n    });\r\n\r\n    return {\r\n      name: acc.name,\r\n      debit,\r\n      credit,\r\n    };\r\n  });\r\n\r\n  return NextResponse.json(result);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\api\\users\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[170,173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[170,173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[272,275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[272,275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1084,1087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1084,1087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2033,2036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2033,2036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2514,2517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2514,2517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2831,2834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2831,2834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3397,3400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3397,3400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nimport { PrismaClient } from \"@prisma/client\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nconst prisma = (globalThis as any).prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  (globalThis as any).prisma = prisma;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const role = req.headers.get(\"x-user-role\");\r\n\r\n    // اگر یہ ایڈمن پینل سے کال ہو رہی ہے تو مکمل ڈیٹا بھیجیں\r\n    if (role === \"ADMIN\") {\r\n      const users = await prisma.user.findMany({\r\n        include: { permissions: true },\r\n        orderBy: { createdAt: \"desc\" },\r\n      });\r\n      return NextResponse.json(users);\r\n    }\r\n\r\n    // لاگ ان پیج کے لیے صرف ضروری ڈیٹا بھیجیں (سیکیورٹی کے لیے پاس ورڈ نکال دیا گیا ہے)\r\n    const publicUsers = await prisma.user.findMany({\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        email: true,\r\n        role: true,\r\n      },\r\n      where: { active: true },\r\n      orderBy: { name: \"asc\" },\r\n    });\r\n\r\n    return NextResponse.json(publicUsers);\r\n  } catch (error: any) {\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n    \r\n    // صرف ADMIN صارفین نئے users create کر سکتے ہیں\r\n    if (userRole !== \"ADMIN\") {\r\n      return NextResponse.json({ error: \"Forbidden - Admin only\" }, { status: 403 });\r\n    }\r\n\r\n    const { name, email, password, role } = await req.json();\r\n    const existing = await prisma.user.findUnique({ where: { email } });\r\n    if (existing) return NextResponse.json({ error: \"Email already exists\" }, { status: 400 });\r\n\r\n    const hashedPassword = await bcrypt.hash(password, 10);\r\n    const user = await prisma.user.create({\r\n      data: {\r\n        name,\r\n        email,\r\n        password: hashedPassword,\r\n        role: role || \"ACCOUNTANT\",\r\n        active: true,\r\n      },\r\n    });\r\n    return NextResponse.json(user);\r\n  } catch (error: any) {\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n    \r\n    // صرف ADMIN صارفین کو update کر سکتے ہیں\r\n    if (userRole !== \"ADMIN\") {\r\n      return NextResponse.json({ error: \"Forbidden - Admin only\" }, { status: 403 });\r\n    }\r\n\r\n    const { id, name, email, password, role, active } = await req.json();\r\n    const updateData: any = { name, email, role, active };\r\n    if (password && password.trim()) {\r\n      updateData.password = await bcrypt.hash(password, 10);\r\n    }\r\n    const updatedUser = await prisma.user.update({\r\n      where: { id },\r\n      data: updateData,\r\n    });\r\n    return NextResponse.json(updatedUser);\r\n  } catch (error: any) {\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: NextRequest) {\r\n  try {\r\n    const userRole = req.headers.get(\"x-user-role\");\r\n    \r\n    // صرف ADMIN صارفین کو delete کر سکتے ہیں\r\n    if (userRole !== \"ADMIN\") {\r\n      return NextResponse.json({ error: \"Forbidden - Admin only\" }, { status: 403 });\r\n    }\r\n\r\n    const { id } = await req.json();\r\n    await prisma.user.delete({ where: { id } });\r\n    return NextResponse.json({ message: \"User deleted successfully\" });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\DashboardContent\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\accounts\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":84,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":84,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\ntype Account = {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n  type?: string | null;\r\n  partyType?: string | null;\r\n  city?: string | null;\r\n  phone?: string | null;\r\n  openDebit?: number;\r\n  openCredit?: number;\r\n  openDate?: string;\r\n  creditDays?: number;\r\n  creditLimit?: number;\r\n};\r\n\r\n// --- PREFIX MAP BASED ON YOUR LIST ---\r\nconst PREFIX_MAP: Record<string, string> = {\r\n  \"CUSTOMER\": \"CS\",\r\n  \"SUPPLIER\": \"SP\",\r\n  \"BANKS\": \"BNK\",\r\n  \"CASH\": \"CASH\",\r\n  \"FIXED ASSETS\": \"FA\",\r\n  \"ACCUMULATED DEPRECIATION\": \"ADEP\",\r\n  \"EXPENSE\": \"EXP\",\r\n  \"INCOME\": \"INC\",\r\n  \"EQUITY\": \"EQT\",\r\n  \"LIABILITIES\": \"LIAB\",\r\n  \"STOCK\": \"STK\",\r\n  \"GENERAL\": \"GEN\",\r\n  \"CONTRA\": \"CON\",\r\n};\r\n\r\nexport default function ChartOfAccounts() {\r\n  const today = new Date().toISOString().split(\"T\")[0];\r\n  const [accounts, setAccounts] = useState<Account[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState(\"ALL\");\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n\r\n  const [form, setForm] = useState({\r\n    code: \"\",\r\n    name: \"\",\r\n    partyType: \"GENERAL\",\r\n    city: \"\",\r\n    phone: \"\",\r\n    openDate: today,\r\n    openDebit: \"\",\r\n    openCredit: \"\",\r\n    creditDays: \"\",\r\n    creditLimit: \"\",\r\n  });\r\n\r\n  async function loadAccounts() {\r\n    const user = getCurrentUser();\r\n    if (!user) { setLoading(false); return; }\r\n    try {\r\n      const res = await fetch(\"/api/accounts\", {\r\n        headers: { \"x-user-role\": user.role },\r\n      });\r\n      const data = await res.json();\r\n      if (res.ok && Array.isArray(data)) setAccounts(data);\r\n    } catch (e) { console.error(e); }\r\n    finally { setLoading(false); }\r\n  }\r\n\r\n  useEffect(() => { loadAccounts(); }, []);\r\n\r\n  \r\n  async function handleCategoryChange(category: string) {\r\n  \r\n    if (editingId) {\r\n      setForm({ ...form, partyType: category });\r\n      return;\r\n    }\r\n\r\n    const prefix = PREFIX_MAP[category] || \"ACC\";\r\n    const user = getCurrentUser();\r\n\r\n    try {\r\n      // یہاں ہم نے پاتھ کو ٹھیک کیا ہے: /api/accounts/next-code کی جگہ /api/accounts استعمال کریں\r\n      // اس URL کو تبدیل کریں\r\n      const res = await fetch(`/api/accounts?prefix=${prefix}`, { // 'next-code' ہٹا دیں\r\n        headers: {\r\n          \"x-user-role\": \"ADMIN\" // رول بھیجنا لازمی ہے\r\n        }\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (data.nextCode) {\r\n        setForm({ ...form, partyType: category, code: data.nextCode });\r\n      } else {\r\n        setForm({ ...form, partyType: category });\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Error fetching next code\", e);\r\n      setForm({ ...form, partyType: category });\r\n    }\r\n  }\r\n\r\n  async function saveAccount() {\r\n    const user = getCurrentUser();\r\n    if (!user) return alert(\"Session expired\");\r\n    if (!form.code || !form.name) return alert(\"Code aur name zaroori hai\");\r\n\r\n    const method = editingId ? \"PUT\" : \"POST\";\r\n    const payload = editingId ? { ...form, id: editingId } : form;\r\n\r\n    const res = await fetch(\"/api/accounts\", {\r\n      method: method,\r\n      headers: { \"Content-Type\": \"application/json\", \"x-user-role\": user.role },\r\n      body: JSON.stringify(payload),\r\n    });\r\n\r\n    if (res.ok) {\r\n      resetForm();\r\n      loadAccounts();\r\n      alert(editingId ? \"Account updated!\" : \"Account saved!\");\r\n    } else {\r\n      alert(\"Failed to save account\");\r\n    }\r\n  }\r\n\r\n  async function deleteAccount(id: string) {\r\n    if (!confirm(\"Are you sure?\")) return;\r\n    const user = getCurrentUser();\r\n    if (!user) {\r\n  alert(\"User not logged in\");\r\n  return;\r\n}\r\n\r\nconst res = await fetch(`/api/accounts?id=${id}`, {\r\n  method: \"DELETE\",\r\n  headers: { \"x-user-role\": user.role },\r\n});\r\n\r\n    if (res.ok) loadAccounts();\r\n    else alert(\"Failed to delete\");\r\n  }\r\n\r\n  function handleEdit(a: Account) {\r\n    setEditingId(a.id);\r\n    setForm({\r\n      code: a.code,\r\n      name: a.name,\r\n      partyType: a.partyType || \"GENERAL\",\r\n      city: a.city || \"\",\r\n      phone: a.phone || \"\",\r\n      openDate: a.openDate ? new Date(a.openDate).toISOString().split(\"T\")[0] : today,\r\n      openDebit: String(a.openDebit || \"\"),\r\n      openCredit: String(a.openCredit || \"\"),\r\n      creditDays: String(a.creditDays || \"\"),\r\n      creditLimit: String(a.creditLimit || \"\"),\r\n    });\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n  }\r\n\r\n  function resetForm() {\r\n    setEditingId(null);\r\n    setForm({\r\n      code: \"\", name: \"\", partyType: \"GENERAL\",\r\n      city: \"\", phone: \"\", openDate: today,\r\n      openDebit: \"\", openCredit: \"\", creditDays: \"\", creditLimit: \"\",\r\n    });\r\n  }\r\n\r\n  const filteredAccounts = accounts.filter(a => {\r\n    const matchesTab = activeTab === \"ALL\" ? true : a.partyType === activeTab;\r\n    const term = searchTerm.toLowerCase();\r\n    const matchesSearch =\r\n      a.name.toLowerCase().includes(term) ||\r\n      a.code.toLowerCase().includes(term) ||\r\n      (a.city || \"\").toLowerCase().includes(term);\r\n    return matchesTab && matchesSearch;\r\n  });\r\n\r\n  if (loading) return <div className=\"p-6 font-bold\">Loading accounts…</div>;\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gray-50 min-h-screen space-y-6\">\r\n      <h1 className=\"text-2xl font-black border-b-4 border-black pb-2 uppercase italic\">Chart of Accounts</h1>\r\n        <input\r\n    type=\"text\"\r\n    placeholder=\"Search accounts...\"\r\n    value={searchTerm}\r\n    onChange={(e) => setSearchTerm(e.target.value)}\r\n    className=\"border px-3 py-2 rounded w-full md:w-64\"\r\n  />\r\n\r\n      <div className={`bg-white border-2 border-black p-4 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] ${editingId ? 'border-blue-500 bg-blue-50' : ''}`}>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-3 text-sm font-bold\">\r\n\r\n          <select\r\n            className=\"border-2 border-black p-2 bg-yellow-50 md:col-span-1\"\r\n            value={form.partyType}\r\n            onChange={e => handleCategoryChange(e.target.value)}\r\n          >\r\n            <option value=\"GENERAL\">General</option>\r\n            <option value=\"CUSTOMER\">Customers</option>\r\n            <option value=\"SUPPLIER\">Suppliers</option>\r\n            <option value=\"BANKS\">Banks (Savings/Current)</option>\r\n            <option value=\"CASH\">Cash in Hand</option>\r\n            <option value=\"FIXED ASSETS\">Fixed Assets (Building, Machinery)</option>\r\n            <option value=\"ACCUMULATED DEPRECIATION\">Accumulated Depreciation</option>\r\n            <option value=\"EXPENSE\">Expense</option>\r\n            <option value=\"INCOME\">Revenue / Other Income</option>\r\n            <option value=\"EQUITY\">Equity (Capital, Retained Earnings)</option>\r\n            <option value=\"LIABILITIES\">Liabilities (Loans, Tax Payable)</option>\r\n            <option value=\"STOCK\">Stock / Inventory</option>\r\n            <option value=\"CONTRA\">Contra</option>\r\n          </select>\r\n\r\n          <input placeholder=\"A/C Code\" className=\"border-2 border-black p-2 outline-none font-black text-blue-600\" value={form.code} onChange={e => setForm({ ...form, code: e.target.value })} />\r\n          <input placeholder=\"Account Name\" className=\"border-2 border-black p-2 md:col-span-2 outline-none\" value={form.name} onChange={e => setForm({ ...form, name: e.target.value })} />\r\n          <input placeholder=\"City\" className=\"border-2 border-black p-2 outline-none\" value={form.city} onChange={e => setForm({ ...form, city: e.target.value })} />\r\n          <input placeholder=\"Phone\" className=\"border-2 border-black p-2 outline-none\" value={form.phone} onChange={e => setForm({ ...form, phone: e.target.value })} />\r\n\r\n          <input type=\"date\" className=\"border-2 border-black p-2 outline-none\" value={form.openDate} onChange={e => setForm({ ...form, openDate: e.target.value })} />\r\n          <input placeholder=\"Open Debit\" className=\"border-2 border-black p-2 outline-none\" value={form.openDebit} onChange={e => setForm({ ...form, openDebit: e.target.value })} />\r\n          <input placeholder=\"Open Credit\" className=\"border-2 border-black p-2 outline-none\" value={form.openCredit} onChange={e => setForm({ ...form, openCredit: e.target.value })} />\r\n          <input placeholder=\"Credit Days\" className=\"border-2 border-black p-2 outline-none\" value={form.creditDays} onChange={e => setForm({ ...form, creditDays: e.target.value })} />\r\n          <input placeholder=\"Credit Limit\" className=\"border-2 border-black p-2 outline-none\" value={form.creditLimit} onChange={e => setForm({ ...form, creditLimit: e.target.value })} />\r\n\r\n          <div className=\"md:col-span-1 flex gap-2\">\r\n            <button onClick={saveAccount} className={`${editingId ? 'bg-blue-600' : 'bg-black'} text-white flex-1 py-2 uppercase font-black`}>\r\n              {editingId ? \"Update\" : \"Save\"}\r\n            </button>\r\n            {editingId && <button onClick={resetForm} className=\"bg-red-500 text-white px-4 py-2 uppercase font-black\">X</button>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* TABS (Simplified for UI) */}\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        {[\"ALL\", \"CUSTOMER\", \"SUPPLIER\", \"BANKS\", \"EXPENSE\", \"FIXED ASSETS\", \"EQUITY\", \r\n        \"LIABILITIES\", \"CASH\", \"INCOME\", \"GENERAL\", \"CONTRA\"\r\n        ].map((tab) => (\r\n          <button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-1 border-2 border-black font-black text-[10px] ${activeTab === tab ? \"bg-yellow-400\" : \"bg-white shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]\"}`}>{tab}</button>\r\n        ))}\r\n      </div>\r\n\r\n      <div className=\"bg-white border-2 border-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] overflow-x-auto\">\r\n        <table className=\"w-full text-left text-sm min-w-[800px]\">\r\n          <thead>\r\n            <tr className=\"bg-black text-white uppercase text-[10px]\">\r\n              <th className=\"p-3 border-r\">Code</th>\r\n              <th className=\"p-3 border-r\">Name</th>\r\n              <th className=\"p-3 border-r\">Category</th>\r\n              <th className=\"p-3 border-r\">City</th>\r\n              <th className=\"p-3 text-center\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"font-bold uppercase text-[12px]\">\r\n            {filteredAccounts.map((a) => (\r\n              <tr key={a.id} className=\"border-b-2 border-black hover:bg-blue-50\">\r\n                <td className=\"p-3 border-r-2 border-black text-blue-700\">{a.code}</td>\r\n                <td className=\"p-3 border-r-2 border-black\">{a.name}</td>\r\n                <td className=\"p-3 border-r-2 border-black text-[9px]\">{a.partyType}</td>\r\n                <td className=\"p-3 border-r-2 border-black\">{a.city || \"---\"}</td>\r\n                <td className=\"p-3 flex justify-center gap-2\">\r\n                  <button onClick={() => handleEdit(a)} className=\"bg-yellow-400 border border-black px-2 py-1 text-[10px]\">EDIT</button>\r\n                  <button onClick={() => deleteAccount(a.id)} className=\"bg-red-500 text-white border border-black px-2 py-1 text-[10px]\">DEL</button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\admin\\permissions\\page.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":22,"column":29,"nodeType":"Identifier","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[768,771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[768,771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":23,"column":43,"nodeType":"Identifier","endLine":23,"endColumn":51},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[832,835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[832,835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":24,"column":41,"nodeType":"Identifier","endLine":24,"endColumn":49},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":25,"column":33,"nodeType":"Identifier","endLine":25,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":28,"column":3,"nodeType":"Identifier","endLine":28,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1350,1353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1350,1353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1495,1498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1495,1498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":77,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4065,4068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4065,4068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\"; // آپ کی پرمیشنز کی لسٹ\r\n\r\nexport default function AdminPermissionsPage() {\r\n  const userSession = getCurrentUser();\r\n\r\n  // Guard - صرف ADMIN رسائی کر سکتے ہیں\r\n  if (!userSession) return null;\r\n  if (userSession.role !== \"ADMIN\") {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\r\n          <h2 className=\"text-xl font-bold text-red-600 mb-2\">❌ رسائی مسترد</h2>\r\n          <p className=\"text-red-700\">صرف ADMIN صارفین اجازتیں سنبھال سکتے ہیں</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const [users, setUsers] = useState<any[]>([]);\r\n  const [selectedUser, setSelectedUser] = useState<any>(null);\r\n  const [permissions, setPermissions] = useState<string[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // 1. تمام یوزرز لوڈ کریں (ہیڈر کے ساتھ)\r\n  useEffect(() => {\r\n    fetch(\"/api/users\", {\r\n      headers: { \"x-user-role\": \"ADMIN\" }\r\n    })\r\n      .then(r => r.json())\r\n      .then(data => setUsers(Array.isArray(data) ? data : []))\r\n      .catch(err => console.error(\"Error loading users:\", err));\r\n  }, []);\r\n\r\n  // 2. یوزر کی موجودہ پرمیشنز لوڈ کرنا\r\n  function loadPermissions(user: any) {\r\n    // اگر یوزر ابجیکٹ میں پرمیشنز پہلے سے ہیں تو وہ اٹھا لو\r\n    if (user.permissions) {\r\n      setPermissions(user.permissions.map((p: any) => p.permission));\r\n    } else {\r\n      setPermissions([]);\r\n    }\r\n  }\r\n\r\n  function togglePermission(p: string) {\r\n    setPermissions(prev =>\r\n      prev.includes(p) ? prev.filter(x => x !== p) : [...prev, p]\r\n    );\r\n  }\r\n\r\n  // 3. سیو کرنے والا فنکشن (ہیڈرز فکس کر دیے)\r\n  async function save() {\r\n    if (!selectedUser) return alert(\"Please select a user first\");\r\n    \r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/api/admin/user-permissions\", { // صحیح پاتھ استعمال کریں\r\n        method: \"POST\",\r\n        headers: { \r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": \"ADMIN\" // یہ جادوئی لائن ہے جو ایرر ختم کرے گی\r\n        },\r\n        body: JSON.stringify({\r\n          userId: selectedUser.id,\r\n          permissions,\r\n        }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        alert(\"Permissions Saved Successfully! ✅\");\r\n      } else {\r\n        const err = await res.json();\r\n        alert(\"Error: \" + (err.error || \"Failed to save\"));\r\n      }\r\n    } catch (err) {\r\n      alert(\"Network error occurred!\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-4xl bg-white shadow-lg rounded-xl mt-10 mx-auto border\">\r\n      <h1 className=\"text-2xl font-black mb-6 text-blue-800 uppercase tracking-tight\">\r\n        🛡️ User Permissions Control\r\n      </h1>\r\n\r\n      <div className=\"bg-gray-50 p-4 rounded-lg border-2 border-dashed mb-6\">\r\n        <label className=\"block text-sm font-bold mb-2\">SELECT USER TO MANAGE:</label>\r\n        <select\r\n          className=\"w-full border-2 p-3 rounded-md font-bold text-lg focus:border-blue-500 outline-none\"\r\n          onChange={e => {\r\n            const u = users.find(x => x.id === e.target.value);\r\n            setSelectedUser(u);\r\n            if (u) loadPermissions(u);\r\n          }}\r\n        >\r\n          <option value=\"\">-- Select a User --</option>\r\n          {users.map(u => (\r\n            <option key={u.id} value={u.id}>\r\n              {u.name} ({u.role})\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n\r\n      {selectedUser && (\r\n        <div className=\"mt-6 space-y-4 animate-in fade-in duration-500\">\r\n          <h2 className=\"font-bold text-gray-700 border-b pb-2\">\r\n            Assigning Access for: <span className=\"text-blue-600\">{selectedUser.name}</span>\r\n          </h2>\r\n          \r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n            {/* آپ کی PERMISSIONS فائل سے تمام آپشنز یہاں خود بخود آ جائیں گے */}\r\n            {Object.values(PERMISSIONS).map((p: any) => (\r\n              <label key={p} className=\"flex items-center p-3 bg-white border rounded-lg hover:bg-blue-50 cursor-pointer transition-all shadow-sm\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  className=\"w-5 h-5 mr-3\"\r\n                  checked={permissions.includes(p)}\r\n                  onChange={() => togglePermission(p)}\r\n                />{\" \"}\r\n                <span className=\"text-sm font-semibold text-gray-700\">{p}</span>\r\n              </label>\r\n            ))}\r\n          </div>\r\n\r\n          <button\r\n            onClick={save}\r\n            disabled={loading}\r\n            className={`w-full mt-6 text-white px-4 py-4 rounded-lg font-black text-lg shadow-xl transition-all ${\r\n                loading ? \"bg-gray-400 cursor-not-allowed\" : \"bg-blue-600 hover:bg-blue-700 active:scale-95\"\r\n            }`}\r\n          >\r\n            {loading ? \"SAVING...\" : \"CONFIRM & SAVE PERMISSIONS\"}\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\admin\\roles\\page.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":21,"column":29,"nodeType":"Identifier","endLine":21,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[683,686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[683,686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":22,"column":29,"nodeType":"Identifier","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[733,736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[733,736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":23,"column":33,"nodeType":"Identifier","endLine":23,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":24,"column":33,"nodeType":"Identifier","endLine":24,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":25,"column":27,"nodeType":"Identifier","endLine":25,"endColumn":35},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":54,"column":3,"nodeType":"Identifier","endLine":54,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'userSession?.role'. Either include it or remove the dependency array.","line":60,"column":6,"nodeType":"ArrayExpression","endLine":60,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [userSession?.role]","fix":{"range":[1883,1885],"text":"[userSession?.role]"}}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\nexport default function UsersPage() {\r\n  const userSession = getCurrentUser();\r\n\r\n  // Guard - صرف ADMIN رسائی کر سکتے ہیں\r\n  if (!userSession) return null;\r\n  if (userSession.role !== \"ADMIN\") {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\r\n          <h2 className=\"text-xl font-bold text-red-600 mb-2\">❌ رسائی مسترد</h2>\r\n          <p className=\"text-red-700\">صرف ADMIN صارفین رولز کو سنبھال سکتے ہیں</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const [users, setUsers] = useState<any[]>([]);\r\n  const [roles, setRoles] = useState<any[]>([]); // رولز کے لیے اسٹیٹ\r\n  const [loading, setLoading] = useState(true);\r\n  const [editing, setEditing] = useState(false);\r\n  const [form, setForm] = useState({\r\n    id: null, name: \"\", email: \"\", password: \"\", role: \"ACCOUNTANT\", roleId: \"\", active: true,\r\n  });\r\n\r\n  const fetchData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // دونوں APIs کو ایک ساتھ کال کرنا\r\n      const [uRes, rRes] = await Promise.all([\r\n        fetch(\"/api/users\", { headers: { \"x-user-role\": \"ADMIN\" } }),\r\n        fetch(\"/api/admin/roles\", { headers: { \"x-user-role\": \"ADMIN\" } })\r\n      ]);\r\n\r\n      const uData = await uRes.json();\r\n      const rData = await rRes.json();\r\n\r\n      // 🔥 اہم چیک: اگر ڈیٹا ایریے نہیں ہے تو خالی ایریے سیٹ کریں\r\n      setUsers(Array.isArray(uData) ? uData : []);\r\n      setRoles(Array.isArray(rData) ? rData : []);\r\n\r\n    } catch (err) {\r\n      console.error(\"Fetch Error:\", err);\r\n      setUsers([]);\r\n      setRoles([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (userSession?.role === \"ADMIN\") {\r\n      fetchData();\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  async function save() {\r\n    if (!form.name || !form.email) return alert(\"Fields missing!\");\r\n    const method = editing ? \"PUT\" : \"POST\";\r\n    await fetch(\"/api/users\", {\r\n      method,\r\n      headers: { \"Content-Type\": \"application/json\", \"x-user-role\": \"ADMIN\" },\r\n      body: JSON.stringify(form),\r\n    });\r\n    reset();\r\n    fetchData();\r\n  }\r\n\r\n  const reset = () => {\r\n    setForm({ id: null, name: \"\", email: \"\", password: \"\", role: \"ACCOUNTANT\", roleId: \"\", active: true });\r\n    setEditing(false);\r\n  };\r\n\r\n  if (loading) return <div className=\"p-10 text-center\">Loading Data...</div>;\r\n\r\n  return (\r\n    <div className=\"p-8 space-y-6\">\r\n      <h1 className=\"text-2xl font-bold\">User Management</h1>\r\n\r\n      {/* یوزر فارم */}\r\n      <div className=\"bg-white p-6 rounded-lg border shadow-sm\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\r\n          <input className=\"border p-2 rounded\" placeholder=\"Name\" value={form.name} onChange={e => setForm({...form, name: e.target.value})} />\r\n          <input className=\"border p-2 rounded\" placeholder=\"Email\" value={form.email} onChange={e => setForm({...form, email: e.target.value})} />\r\n          <input className=\"border p-2 rounded\" type=\"password\" placeholder=\"Password\" value={form.password} onChange={e => setForm({...form, password: e.target.value})} />\r\n          \r\n          <select className=\"border p-2 rounded\" value={form.role} onChange={e => setForm({...form, role: e.target.value})}>\r\n            <option value=\"ADMIN\">ADMIN</option>\r\n            <option value=\"ACCOUNTANT\">ACCOUNTANT</option>\r\n          </select>\r\n\r\n          {/* رولز ڈراپ ڈاؤن */}\r\n          <select className=\"border p-2 rounded\" value={form.roleId} onChange={e => setForm({...form, roleId: e.target.value})}>\r\n            <option value=\"\">-- Dynamic Role --</option>\r\n            {/* یہاں چیک لگایا گیا ہے تاکہ کریش نہ ہو */}\r\n            {Array.isArray(roles) && roles.map((r) => (\r\n              <option key={r.id} value={r.id}>{r.name}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n        <button onClick={save} className=\"mt-4 bg-black text-white px-6 py-2 rounded\">\r\n          {editing ? \"Update User\" : \"Add User\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* یوزر ٹیبل */}\r\n      <div className=\"border rounded-lg bg-white overflow-hidden\">\r\n        <table className=\"w-full text-left\">\r\n          <thead className=\"bg-gray-50\">\r\n            <tr>\r\n              <th className=\"p-3\">Name</th>\r\n              <th className=\"p-3\">Email</th>\r\n              <th className=\"p-3\">Role</th>\r\n              <th className=\"p-3\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {Array.isArray(users) && users.map((u) => (\r\n              <tr key={u.id} className=\"border-t\">\r\n                <td className=\"p-3\">{u.name}</td>\r\n                <td className=\"p-3\">{u.email}</td>\r\n                <td className=\"p-3\">{u.roleObject?.name || u.role}</td>\r\n                <td className=\"p-3\">\r\n                  <button onClick={() => { setForm({...u, password: \"\"}); setEditing(true); }} className=\"text-blue-600 mr-2\">Edit</button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\advance-payment\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[724,727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[724,727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nimport {\r\n  ResponsiveContainer,\r\n  PageHeader,\r\n  Card,\r\n} from \"@/components/ui/ResponsiveContainer\";\r\n\r\nimport {\r\n  ResponsiveForm,\r\n  FormField,\r\n  FormActions,\r\n  Input,\r\n  Select,\r\n  Button,\r\n} from \"@/components/ui/ResponsiveForm\";\r\n\r\nimport {\r\n  MobileTable,\r\n  MobileCard,\r\n  MobileCardRow,\r\n  DesktopTable,\r\n} from \"@/components/ui/MobileTable\";\r\n\r\n\r\ntype AdvancePayment = {\r\n  id: string;\r\n  advanceNo: string;\r\n  date: string;\r\n  amount: number;\r\n  adjustedAmount: number;\r\n  balance: number;\r\n  status: string;\r\n  supplier: { id: string; name: string };\r\n  po?: { id: string; poNo: string };\r\n  adjustments: any[];\r\n  createdAt: string;\r\n};\r\n\r\ninterface Account {\r\n  id: string;\r\n  name: string;\r\n  type: string;\r\n  partyType?: string | null;\r\n}\r\n\r\n\r\nexport default function AdvancePaymentPage() {\r\n  const [advances, setAdvances] = useState<AdvancePayment[]>([]);\r\n  const [suppliers, setSuppliers] = useState<Account[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [showAdjustForm, setShowAdjustForm] = useState(false);\r\n  const [selectedAdvance, setSelectedAdvance] = useState<AdvancePayment | null>(null);\r\n\r\n  // Form state\r\n  const [advanceNo, setAdvanceNo] = useState(\"\");\r\n  const [date, setDate] = useState(new Date().toISOString().split(\"T\")[0]);\r\n  const [amount, setAmount] = useState(\"\");\r\n  const [supplierId, setSupplierId] = useState(\"\");\r\n  const [narration, setNarration] = useState(\"\");\r\n\r\n  // Adjust form state\r\n  const [invoiceNo, setInvoiceNo] = useState(\"\");\r\n  const [adjustedAmount, setAdjustedAmount] = useState(\"\");\r\n  const [adjustRemarks, setAdjustRemarks] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  async function fetchData() {\r\n    try {\r\n      const [advancesRes, accountsRes] = await Promise.all([\r\n        fetch(\"/api/advance-payment\"),\r\n        fetch(\"/api/accounts\"),\r\n      ]);\r\n\r\n      const advancesData = await advancesRes.json();\r\n      const accountsData = await accountsRes.json();\r\n\r\n      setAdvances(advancesData);\r\n\r\n      // Filter suppliers\r\n      const supplierAccounts = accountsData.filter(\r\n  (acc: Account) => acc.type === \"SUPPLIER\"\r\n);\r\n\r\n      setSuppliers(supplierAccounts);\r\n\r\n      // Generate next advance number\r\n      if (advancesData.length > 0) {\r\n        const lastNo = Math.max(...advancesData.map((a: AdvancePayment) => {\r\n          const match = a.advanceNo.match(/\\d+/);\r\n          return match ? parseInt(match[0]) : 0;\r\n        }));\r\n        setAdvanceNo(`ADV-${String(lastNo + 1).padStart(3, \"0\")}`);\r\n      } else {\r\n        setAdvanceNo(\"ADV-001\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching data:\", error);\r\n      toast.error(\"Failed to load data\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n\r\n    if (!supplierId || !amount) {\r\n      toast.error(\"Please fill all required fields\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      const res = await fetch(\"/api/advance-payment\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          advanceNo,\r\n          date,\r\n          amount: parseFloat(amount),\r\n          supplierId,\r\n          narration,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (res.ok) {\r\n        toast.success(\"Advance payment created successfully!\");\r\n        resetForm();\r\n        fetchData();\r\n        setShowForm(false);\r\n      } else {\r\n        toast.error(data.error || \"Failed to create advance payment\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error creating advance payment:\", error);\r\n      toast.error(\"Failed to create advance payment\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleAdjust(e: React.FormEvent) {\r\n    e.preventDefault();\r\n\r\n    if (!selectedAdvance || !invoiceNo || !adjustedAmount) {\r\n      toast.error(\"Please fill all required fields\");\r\n      return;\r\n    }\r\n\r\n    const adjustAmount = parseFloat(adjustedAmount);\r\n    if (adjustAmount > selectedAdvance.balance) {\r\n      toast.error(`Adjusted amount cannot exceed balance: Rs. ${selectedAdvance.balance.toLocaleString()}`);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      const res = await fetch(\"/api/advance-payment\", {\r\n        method: \"PUT\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          id: selectedAdvance.id,\r\n          invoiceNo,\r\n          adjustedAmount: adjustAmount,\r\n          date: new Date().toISOString(),\r\n          remarks: adjustRemarks,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (res.ok) {\r\n        toast.success(\"Advance adjusted successfully!\");\r\n        setShowAdjustForm(false);\r\n        setSelectedAdvance(null);\r\n        resetAdjustForm();\r\n        fetchData();\r\n      } else {\r\n        toast.error(data.error || \"Failed to adjust advance\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error adjusting advance:\", error);\r\n      toast.error(\"Failed to adjust advance\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  function resetForm() {\r\n    setDate(new Date().toISOString().split(\"T\")[0]);\r\n    setAmount(\"\");\r\n    setSupplierId(\"\");\r\n    setNarration(\"\");\r\n  }\r\n\r\n  function resetAdjustForm() {\r\n    setInvoiceNo(\"\");\r\n    setAdjustedAmount(\"\");\r\n    setAdjustRemarks(\"\");\r\n  }\r\n\r\n  async function handleDelete(id: string) {\r\n    if (!confirm(\"Are you sure you want to delete this advance payment?\")) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/advance-payment?id=${id}`, {\r\n        method: \"DELETE\",\r\n      });\r\n\r\n      if (res.ok) {\r\n        toast.success(\"Advance payment deleted!\");\r\n        fetchData();\r\n      } else {\r\n        const data = await res.json();\r\n        toast.error(data.error || \"Failed to delete\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error deleting:\", error);\r\n      toast.error(\"Failed to delete\");\r\n    }\r\n  }\r\n\r\nfunction getStatusBadge(status: string) {\r\n  const color =\r\n    status === \"CLOSED\"\r\n      ? \"bg-green-100 text-green-700\"\r\n      : status === \"ADJUSTED\"\r\n      ? \"bg-blue-100 text-blue-700\"\r\n      : \"bg-yellow-100 text-yellow-700\";\r\n\r\n  return (\r\n    <span\r\n      className={`px-2 py-1 rounded text-xs font-semibold inline-block ${color}`}\r\n    >\r\n      {status}\r\n    </span>\r\n  );\r\n}\r\n\r\n  if (loading && advances.length === 0) {\r\n    return (\r\n      <ResponsiveContainer>\r\n        <div className=\"text-center py-10\">Loading...</div>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ResponsiveContainer>\r\n      <PageHeader\r\n        title=\"💰 Advance Payment to Suppliers\"\r\n        description=\"Track supplier advances and adjust against invoices\"\r\n        action={{\r\n          label: showForm ? \"Cancel\" : \"+ New Advance Payment\",\r\n          onClick: () => setShowForm(!showForm)\r\n        }}\r\n      />\r\n\r\n      {showForm && (\r\n        <Card className=\"mb-6\">\r\n          <ResponsiveForm onSubmit={handleSubmit}>\r\n            <FormField label=\"Advance No\" required>\r\n              <Input\r\n                type=\"text\"\r\n                value={advanceNo}\r\n                onChange={(e) => setAdvanceNo(e.target.value)}\r\n                required\r\n              />\r\n            </FormField>\r\n\r\n            <FormField label=\"Date\" required>\r\n              <Input\r\n                type=\"date\"\r\n                value={date}\r\n                onChange={(e) => setDate(e.target.value)}\r\n                required\r\n              />\r\n            </FormField>\r\n\r\n            <FormField label=\"Supplier\" required>\r\n              <Select\r\n                value={supplierId}\r\n                onChange={(e) => setSupplierId(e.target.value)}\r\n                required\r\n              >\r\n                <option value=\"\">Select Supplier</option>\r\n                {suppliers.map((sup) => (\r\n                  <option key={sup.id} value={sup.id}>\r\n                    {sup.name}\r\n                  </option>\r\n                ))}\r\n              </Select>\r\n            </FormField>\r\n\r\n            <FormField label=\"Amount\" required>\r\n              <Input\r\n                type=\"number\"\r\n                step=\"0.01\"\r\n                value={amount}\r\n                onChange={(e) => setAmount(e.target.value)}\r\n                placeholder=\"0.00\"\r\n                required\r\n              />\r\n            </FormField>\r\n\r\n            <FormField label=\"Narration\">\r\n              <Input\r\n                type=\"text\"\r\n                value={narration}\r\n                onChange={(e) => setNarration(e.target.value)}\r\n                placeholder=\"Optional description\"\r\n              />\r\n            </FormField>\r\n\r\n            <FormActions>\r\n              <Button type=\"submit\" variant=\"primary\" disabled={loading}>\r\n                {loading ? \"Saving...\" : \"Save Advance Payment\"}\r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"secondary\"\r\n                onClick={() => {\r\n                  setShowForm(false);\r\n                  resetForm();\r\n                }}\r\n              >\r\n                Cancel\r\n              </Button>\r\n            </FormActions>\r\n          </ResponsiveForm>\r\n        </Card>\r\n      )}\r\n\r\n      {showAdjustForm && selectedAdvance && (\r\n        <Card className=\"mb-6 border-2 border-blue-500\">\r\n          <h3 className=\"text-lg font-bold mb-4 text-blue-600\">\r\n            Adjust Advance: {selectedAdvance.advanceNo}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-600 mb-4\">\r\n            Supplier: <strong>{selectedAdvance.supplier.name}</strong> | \r\n            Balance: <strong>Rs. {selectedAdvance.balance.toLocaleString()}</strong>\r\n          </p>\r\n          <ResponsiveForm onSubmit={handleAdjust}>\r\n            <FormField label=\"Invoice No\" required>\r\n              <Input\r\n                type=\"text\"\r\n                value={invoiceNo}\r\n                onChange={(e) => setInvoiceNo(e.target.value)}\r\n                placeholder=\"e.g., INV-123\"\r\n                required\r\n              />\r\n            </FormField>\r\n\r\n            <FormField label=\"Adjusted Amount\" required>\r\n              <Input\r\n                type=\"number\"\r\n                step=\"0.01\"\r\n                value={adjustedAmount}\r\n                onChange={(e) => setAdjustedAmount(e.target.value)}\r\n                placeholder=\"0.00\"\r\n                max={selectedAdvance.balance}\r\n                required\r\n              />\r\n            </FormField>\r\n\r\n            <FormField label=\"Remarks\">\r\n              <Input\r\n                type=\"text\"\r\n                value={adjustRemarks}\r\n                onChange={(e) => setAdjustRemarks(e.target.value)}\r\n                placeholder=\"Optional remarks\"\r\n              />\r\n            </FormField>\r\n\r\n            <FormActions>\r\n              <Button type=\"submit\" variant=\"success\" disabled={loading}>\r\n                {loading ? \"Adjusting...\" : \"Adjust Advance\"}\r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"secondary\"\r\n                onClick={() => {\r\n                  setShowAdjustForm(false);\r\n                  setSelectedAdvance(null);\r\n                  resetAdjustForm();\r\n                }}\r\n              >\r\n                Cancel\r\n              </Button>\r\n            </FormActions>\r\n          </ResponsiveForm>\r\n        </Card>\r\n      )}\r\n\r\n      <Card>\r\n        {/* Desktop Table */}\r\n        <div className=\"hidden md:block overflow-x-auto\">\r\n          <DesktopTable>\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                  Advance No\r\n                </th>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                  Date\r\n                </th>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                  Supplier\r\n                </th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase\">\r\n                  Amount\r\n                </th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase\">\r\n                  Adjusted\r\n                </th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase\">\r\n                  Balance\r\n                </th>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                  Status\r\n                </th>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\r\n                  Actions\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-gray-200\">\r\n              {advances.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={8} className=\"px-4 py-8 text-center text-gray-500\">\r\n                    No advance payments found. Create your first one!\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                advances.map((adv) => (\r\n                  <tr key={adv.id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"px-4 py-3 text-sm font-medium text-gray-900\">\r\n                      {adv.advanceNo}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-sm text-gray-600\">\r\n                      {new Date(adv.date).toLocaleDateString()}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-sm text-gray-900\">\r\n                      {adv.supplier.name}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-sm text-right font-medium text-gray-900\">\r\n                      Rs. {adv.amount.toLocaleString()}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-sm text-right text-blue-600\">\r\n                      Rs. {adv.adjustedAmount.toLocaleString()}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-sm text-right font-bold text-green-600\">\r\n                      Rs. {adv.balance.toLocaleString()}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-sm\">\r\n                      {getStatusBadge(adv.status)}\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-sm space-x-2\">\r\n                      {adv.status !== \"CLOSED\" && (\r\n                        <button\r\n                          onClick={() => {\r\n                            setSelectedAdvance(adv);\r\n                            setShowAdjustForm(true);\r\n                          }}\r\n                          className=\"text-blue-600 hover:text-blue-800\"\r\n                        >\r\n                          Adjust\r\n                        </button>\r\n                      )}\r\n                      <button\r\n                        onClick={() => handleDelete(adv.id)}\r\n                        className=\"text-red-600 hover:text-red-800\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </DesktopTable>\r\n        </div>\r\n\r\n        {/* Mobile Cards */}\r\n        <div className=\"md:hidden\">\r\n          <MobileTable\r\n            data={advances}\r\n            emptyMessage=\"No advance payments found. Create your first one!\"\r\n            renderCard={(adv) => (\r\n              <MobileCard>\r\n                <MobileCardRow label=\"Advance No\" value={adv.advanceNo} />\r\n                <MobileCardRow\r\n                  label=\"Date\"\r\n                  value={new Date(adv.date).toLocaleDateString()}\r\n                />\r\n                <MobileCardRow label=\"Supplier\" value={adv.supplier.name} />\r\n                <MobileCardRow\r\n                  label=\"Amount\"\r\n                  value={`Rs. ${adv.amount.toLocaleString()}`}\r\n                  valueClassName=\"font-bold\"\r\n                />\r\n                <MobileCardRow\r\n                  label=\"Adjusted\"\r\n                  value={`Rs. ${adv.adjustedAmount.toLocaleString()}`}\r\n                />\r\n                <MobileCardRow\r\n                  label=\"Balance\"\r\n                  value={`Rs. ${adv.balance.toLocaleString()}`}\r\n                  valueClassName=\"font-bold text-green-600\"\r\n                />\r\n                <MobileCardRow\r\n                  label=\"Status\"\r\n                  value={getStatusBadge(adv.status)}\r\n                />\r\n                <div className=\"pt-2 mt-2 border-t border-gray-200 flex gap-2\">\r\n                  {adv.status !== \"CLOSED\" && (\r\n                    <Button\r\n                      variant=\"primary\"\r\n                      onClick={() => {\r\n                        setSelectedAdvance(adv);\r\n                        setShowAdjustForm(true);\r\n                      }}\r\n                      className=\"flex-1\"\r\n                    >\r\n                      Adjust\r\n                    </Button>\r\n                  )}\r\n                  <Button\r\n                    variant=\"danger\"\r\n                    onClick={() => handleDelete(adv.id)}\r\n                    className=\"flex-1\"\r\n                  >\r\n                    Delete\r\n                  </Button>\r\n                </div>\r\n              </MobileCard>\r\n            )}\r\n          />\r\n        </div>\r\n      </Card>\r\n    </ResponsiveContainer>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\advance\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2422,2425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2422,2425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\n\ninterface Advance {\n  id: string;\n  employeeId: string;\n  amount: number;\n  date: string;\n  monthYear?: string;\n  status: string;\n  remarks?: string;\n  employee: { firstName: string; lastName: string };\n}\n\ninterface Employee {\n  id: string;\n  firstName: string;\n  lastName: string;\n}\n\nexport default function AdvancePage() {\n  const user = getCurrentUser();\n  const [advances, setAdvances] = useState<Advance[]>([]);\n  const [employees, setEmployees] = useState<Employee[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  const [formData, setFormData] = useState({\n    employeeId: \"\",\n    amount: \"\",\n    date: new Date().toISOString().slice(0, 10),\n    monthYear: \"\", // Optional target month\n    remarks: \"\",\n  });\n\n  useEffect(() => {\n    fetchEmployees();\n    fetchAdvances();\n  }, []);\n\n  async function fetchEmployees() {\n    const res = await fetch(\"/api/employees\");\n    const data = await res.json();\n    setEmployees(Array.isArray(data) ? data : []);\n  }\n\n  async function fetchAdvances() {\n    setLoading(true);\n    try {\n      const res = await fetch(\"/api/advance\");\n      const data = await res.json();\n      setAdvances(Array.isArray(data) ? data : []);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    console.log(\"Submitting advance form...\", formData);\n    \n    if (!user) {\n      alert(\"Please login\");\n      return;\n    }\n\n    setLoading(true);\n    try {\n      console.log(\"Sending request to /api/advance\");\n      const res = await fetch(\"/api/advance\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user.role || \"\",\n          \"x-user-id\": user.id || \"\",\n        },\n        body: JSON.stringify(formData),\n      });\n\n      console.log(\"Response status:\", res.status);\n      const data = await res.json();\n      console.log(\"Response data:\", data);\n\n      if (!res.ok) {\n        alert(\"Error: \" + (data.error || \"Failed to save\"));\n      } else {\n        alert(\"Advance Recorded Successfully!\");\n        setFormData({\n          employeeId: \"\",\n          amount: \"\",\n          date: new Date().toISOString().slice(0, 10),\n          monthYear: \"\",\n          remarks: \"\",\n        });\n        fetchAdvances();\n      }\n    } catch (error: any) {\n      console.error(\"Submit error:\", error);\n      alert(\"Network Error: \" + error.message);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleDelete(id: string) {\n    if (!confirm(\"Delete this record?\")) return;\n    if (!user) return;\n\n    await fetch(`/api/advance?id=${id}`, {\n      method: \"DELETE\",\n      headers: {\n        \"x-user-role\": user.role || \"\",\n        \"x-user-id\": user.id || \"\",\n      },\n    });\n    fetchAdvances();\n  }\n\n  return (\n    <div className=\"p-6 bg-gray-50 min-h-screen\">\n      <div className=\"max-w-5xl mx-auto space-y-6\">\n        <h1 className=\"text-3xl font-black text-gray-900\">💸 Advance Salary Manager</h1>\n\n        {/* FORM */}\n        <div className=\"bg-white p-6 rounded-xl shadow border border-gray-100\">\n          <h2 className=\"font-bold text-lg mb-4\">Give Advance</h2>\n          <form onSubmit={handleSubmit} className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n            \n            <select\n              required\n              className=\"border p-2 rounded-lg\"\n              value={formData.employeeId}\n              onChange={(e) => setFormData({ ...formData, employeeId: e.target.value })}\n            >\n              <option value=\"\">Select Employee</option>\n              {employees.map((e) => (\n                <option key={e.id} value={e.id}>{e.firstName} {e.lastName}</option>\n              ))}\n            </select>\n\n            <input\n              required\n              type=\"number\"\n              placeholder=\"Amount\"\n              className=\"border p-2 rounded-lg\"\n              value={formData.amount}\n              onChange={(e) => setFormData({ ...formData, amount: e.target.value })}\n            />\n\n            <input\n              required\n              type=\"date\"\n              className=\"border p-2 rounded-lg\"\n              value={formData.date}\n              onChange={(e) => setFormData({ ...formData, date: e.target.value })}\n            />\n\n            <input\n              type=\"month\"\n              placeholder=\"Deduction Month (Optional)\"\n              className=\"border p-2 rounded-lg\"\n              value={formData.monthYear}\n              onChange={(e) => setFormData({ ...formData, monthYear: e.target.value })}\n            />\n            <div className=\"text-xs text-gray-500 col-span-1 md:col-span-2 lg:col-span-5 -mt-3 mb-2\">\n                * Select month if you want to auto-deduct in specific payroll\n            </div>\n\n            <input\n              type=\"text\"\n              placeholder=\"Remarks / Reason\"\n              className=\"border p-2 rounded-lg col-span-1 md:col-span-1 lg:col-span-4\"\n              value={formData.remarks}\n              onChange={(e) => setFormData({ ...formData, remarks: e.target.value })}\n            />\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"bg-black text-white font-bold py-2 rounded-lg hover:bg-gray-800 disabled:opacity-50\"\n            >\n              {loading ? \"Saving...\" : \"Save Record\"}\n            </button>\n          </form>\n        </div>\n\n        {/* LIST */}\n        <div className=\"bg-white rounded-xl shadow overflow-x-auto border border-gray-100\">\n          <table className=\"w-full text-left min-w-[800px]\">\n            <thead className=\"bg-gray-100 border-b\">\n              <tr>\n                <th className=\"p-4 font-bold text-gray-600\">Date</th>\n                <th className=\"p-4 font-bold text-gray-600\">Employee</th>\n                <th className=\"p-4 font-bold text-gray-600\">Amount</th>\n                <th className=\"p-4 font-bold text-gray-600\">Deduction Month</th>\n                <th className=\"p-4 font-bold text-gray-600\">Status</th>\n                <th className=\"p-4 font-bold text-gray-600\">Remarks</th>\n                <th className=\"p-4 font-bold text-gray-600 text-right\">Action</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y\">\n              {advances.map((adv) => (\n                <tr key={adv.id} className=\"hover:bg-gray-50\">\n                  <td className=\"p-4 text-sm\">{new Date(adv.date).toLocaleDateString()}</td>\n                  <td className=\"p-4 font-bold\">{adv.employee.firstName} {adv.employee.lastName}</td>\n                  <td className=\"p-4 font-mono font-bold text-red-600\">-{adv.amount.toLocaleString()}</td>\n                  <td className=\"p-4 text-sm\">{adv.monthYear || \"Any\"}</td>\n                  <td className=\"p-4\">\n                    <span className={`px-2 py-1 rounded text-xs font-black uppercase ${\n                      adv.status === \"PENDING\" ? \"bg-yellow-100 text-yellow-700\" : \"bg-green-100 text-green-700\"\n                    }`}>\n                      {adv.status}\n                    </span>\n                  </td>\n                  <td className=\"p-4 text-sm text-gray-500\">{adv.remarks}</td>\n                  <td className=\"p-4 text-right\">\n                    <button\n                      onClick={() => handleDelete(adv.id)}\n                      className=\"text-red-500 hover:text-red-700 font-bold text-sm\"\n                    >\n                      Delete\n                    </button>\n                  </td>\n                </tr>\n              ))}\n              {advances.length === 0 && (\n                <tr>\n                  <td colSpan={7} className=\"p-8 text-center text-gray-400\">No advance records found</td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\attendance\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAttendance'. Either include it or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [selectedEmployeeId, month, fetchAttendance]","fix":{"range":[1429,1456],"text":"[selectedEmployeeId, month, fetchAttendance]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\ninterface AttendanceRecord {\r\n  id: string;\r\n  employeeId: string;\r\n  date: string;\r\n  status: string;\r\n  checkIn?: string;\r\n  checkOut?: string;\r\n  remarks?: string;\r\n  employee: { firstName: string; lastName: string };\r\n}\r\n\r\ninterface Employee {\r\n  id: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  department: string;\r\n}\r\n\r\nexport default function AttendancePage() {\r\n  const user = getCurrentUser();\r\n  \r\n  // State\r\n  const [employees, setEmployees] = useState<Employee[]>([]);\r\n  const [records, setRecords] = useState<AttendanceRecord[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  \r\n  // Selection\r\n  const [selectedEmployeeId, setSelectedEmployeeId] = useState<string | null>(null);\r\n  const [month, setMonth] = useState(new Date().toISOString().slice(0, 7)); // YYYY-MM\r\n  \r\n  // Form State (for Modal/Inline)\r\n  const [selectedDate, setSelectedDate] = useState<string | null>(null);\r\n  const [formData, setFormData] = useState({\r\n    status: \"PRESENT\",\r\n    checkIn: \"\",\r\n    checkOut: \"\",\r\n    remarks: \"\",\r\n  });\r\n\r\n  /* ================= FETCH DATA ================= */\r\n\r\n  useEffect(() => {\r\n    fetchEmployees();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedEmployeeId) {\r\n      fetchAttendance(selectedEmployeeId, month);\r\n    } else {\r\n      setRecords([]);\r\n    }\r\n  }, [selectedEmployeeId, month]);\r\n\r\n  async function fetchEmployees() {\r\n    try {\r\n      const res = await fetch(\"/api/employees\");\r\n      const data = await res.json();\r\n      setEmployees(Array.isArray(data) ? data : []);\r\n    } catch {\r\n      setEmployees([]);\r\n    }\r\n  }\r\n\r\n  async function fetchAttendance(empId: string, monthStr: string) {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    try {\r\n      // Fetch specific employee's attendance for the month\r\n      const res = await fetch(`/api/attendance?month=${monthStr}&employeeId=${empId}`, {\r\n        headers: {\r\n          \"x-user-role\": user.role || \"\",\r\n          \"x-user-id\": user.id || \"\",\r\n        },\r\n      });\r\n      const data = await res.json();\r\n      setRecords(Array.isArray(data) ? data : []);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  /* ================= HELPERS ================= */\r\n\r\n  // Helper to get local date string YYYY-MM-DD\r\n  function toLocalISOString(date: Date) {\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, \"0\");\r\n    const day = String(date.getDate()).padStart(2, \"0\");\r\n    return `${year}-${month}-${day}`;\r\n  }\r\n\r\n  function formatPakTime(dateString?: string | Date | null) {\r\n    if (!dateString) return \"--\";\r\n    const d = new Date(dateString);\r\n    if (isNaN(d.getTime())) return \"--\";\r\n    return d.toLocaleTimeString(\"en-PK\", {\r\n      hour: \"numeric\",\r\n      minute: \"2-digit\",\r\n      hour12: true,\r\n      timeZone: \"Asia/Karachi\",\r\n    });\r\n  }\r\n\r\n  // Generate Calendar Days\r\n  const getCalendarDays = () => {\r\n    const [y, m] = month.split(\"-\").map(Number);\r\n    const date = new Date(y, m - 1, 1);\r\n    const days = [];\r\n    \r\n    // Add empty slots for days before the 1st\r\n    const firstDayIndex = date.getDay(); // 0 = Sun\r\n    for (let i = 0; i < firstDayIndex; i++) {\r\n      days.push(null);\r\n    }\r\n    \r\n    // Add actual days\r\n    while (date.getMonth() === m - 1) {\r\n      days.push(new Date(date));\r\n      date.setDate(date.getDate() + 1);\r\n    }\r\n    \r\n    return days;\r\n  };\r\n\r\n  const getRecordForDate = (date: Date) => {\r\n    const dateStr = toLocalISOString(date);\r\n    // Backend returns date as ISO string (UTC), but usually we compare by YYYY-MM-DD\r\n    // If backend stores time as 00:00:00 UTC, then toISOString().slice(0,10) matches.\r\n    // However, we want to match based on the local day we are viewing.\r\n    // The record.date from backend is typically \"2024-01-02T00:00:00.000Z\".\r\n    // If we sent \"2024-01-02\" (local), backend saved \"2024-01-02T00:00:00.000Z\".\r\n    // So checking startWith(\"2024-01-02\") works.\r\n    return records.find(r => r.date.startsWith(dateStr));\r\n  };\r\n\r\n  /* ================= ACTIONS ================= */\r\n\r\n  async function handleSave(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    if (!user || !selectedEmployeeId || !selectedDate) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const payload = {\r\n        employeeId: selectedEmployeeId,\r\n        date: selectedDate,\r\n        ...formData\r\n      };\r\n\r\n      // Check if updating existing\r\n      const existing = getRecordForDate(new Date(selectedDate));\r\n      const url = existing \r\n        ? `/api/attendance?id=${existing.id}` \r\n        : \"/api/attendance\";\r\n      \r\n      const method = existing ? \"PUT\" : \"POST\";\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": user.role || \"\",\r\n          \"x-user-id\": user.id || \"\",\r\n        },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const err = await res.json();\r\n        alert(err.error || \"Failed\");\r\n      } else {\r\n        fetchAttendance(selectedEmployeeId, month);\r\n        setSelectedDate(null); // Close form\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert(\"Error saving\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleDelete(id: string) {\r\n    if (!confirm(\"Delete this record?\")) return;\r\n    if (!user) return;\r\n\r\n    await fetch(`/api/attendance?id=${id}`, {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        \"x-user-role\": user.role || \"\",\r\n        \"x-user-id\": user.id || \"\",\r\n      },\r\n    });\r\n    if (selectedEmployeeId) fetchAttendance(selectedEmployeeId, month);\r\n  }\r\n\r\n  /* ================= RENDER ================= */\r\n\r\n  const calendarDays = getCalendarDays();\r\n  const selectedEmployee = employees.find(e => e.id === selectedEmployeeId);\r\n  const weekDays = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\r\n\r\n  // Calculate Sundays that are treated as holidays (either explicitly marked or default)\r\n  const isSunday = (d: Date) => d.getDay() === 0;\r\n  \r\n  // Get all valid dates in the current month view\r\n  const validDatesInMonth = calendarDays.filter((d): d is Date => d !== null);\r\n  \r\n  // Count explicit holidays\r\n  const explicitHolidays = records.filter(r => r.status === \"HOLIDAY\").length;\r\n  \r\n  // Count Sundays that have NO record (default holidays)\r\n  const defaultHolidaySundays = validDatesInMonth.filter(d => {\r\n    if (!isSunday(d)) return false;\r\n    const hasRecord = getRecordForDate(d);\r\n    return !hasRecord;\r\n  }).length;\r\n\r\n  const stats = {\r\n    present: records.filter(r => r.status === \"PRESENT\" || r.status === \"LATE\").length,\r\n    absent: records.filter(r => r.status === \"ABSENT\").length,\r\n    leave: records.filter(r => r.status === \"LEAVE\" || r.status === \"HALF_DAY\").length,\r\n    holiday: explicitHolidays + defaultHolidaySundays,\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col md:flex-row h-screen bg-gray-50 overflow-hidden\">\r\n      \r\n      {/* SIDEBAR: Employee List */}\r\n      <div className=\"w-full md:w-80 h-60 md:h-full bg-white border-r flex flex-col shadow-lg z-10 shrink-0\">\r\n        <div className=\"p-4 border-b bg-gray-100\">\r\n          <h2 className=\"font-black text-xl mb-1\">Employees</h2>\r\n          <p className=\"text-xs text-gray-500\">Select to view calendar</p>\r\n        </div>\r\n        \r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          {employees.map(emp => (\r\n            <div\r\n              key={emp.id}\r\n              onClick={() => setSelectedEmployeeId(emp.id)}\r\n              className={`p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors ${\r\n                selectedEmployeeId === emp.id ? \"bg-blue-50 border-l-4 border-l-blue-600\" : \"\"\r\n              }`}\r\n            >\r\n              <p className=\"font-bold text-gray-800\">{emp.firstName} {emp.lastName}</p>\r\n              <p className=\"text-xs text-gray-500\">{emp.department}</p>\r\n            </div>\r\n          ))}\r\n          {employees.length === 0 && (\r\n            <div className=\"p-4 text-center text-gray-400 italic\">No employees found</div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* MAIN CONTENT: Calendar */}\r\n      <div className=\"flex-1 flex flex-col h-full overflow-hidden\">\r\n        \r\n        {/* HEADER */}\r\n        <div className=\"p-6 bg-white border-b flex justify-between items-center shadow-sm\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-black text-gray-900\">\r\n              {selectedEmployee ? `${selectedEmployee.firstName}'s Attendance` : \"Attendance Calendar\"}\r\n            </h1>\r\n            <p className=\"text-sm text-gray-500\">\r\n              {selectedEmployee ? \"Manage daily records\" : \"Select an employee from the list\"}\r\n            </p>\r\n          </div>\r\n          \r\n          <input\r\n            type=\"month\"\r\n            value={month}\r\n            onChange={(e) => setMonth(e.target.value)}\r\n            className=\"border px-4 py-2 rounded-lg font-bold shadow-sm\"\r\n          />\r\n        </div>\r\n\r\n        {/* STATS BOXES */}\r\n        {selectedEmployeeId && (\r\n          <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4 p-6 pb-0\">\r\n            <div className=\"bg-green-100 p-4 rounded-xl border border-green-200\">\r\n              <p className=\"text-green-600 font-bold text-sm uppercase\">Present</p>\r\n              <p className=\"text-3xl font-black text-green-800\">{stats.present}</p>\r\n            </div>\r\n            <div className=\"bg-red-100 p-4 rounded-xl border border-red-200\">\r\n              <p className=\"text-red-600 font-bold text-sm uppercase\">Absent</p>\r\n              <p className=\"text-3xl font-black text-red-800\">{stats.absent}</p>\r\n            </div>\r\n            <div className=\"bg-yellow-100 p-4 rounded-xl border border-yellow-200\">\r\n              <p className=\"text-yellow-600 font-bold text-sm uppercase\">Leaves</p>\r\n              <p className=\"text-3xl font-black text-yellow-800\">{stats.leave}</p>\r\n            </div>\r\n            <div className=\"bg-purple-100 p-4 rounded-xl border border-purple-200\">\r\n              <p className=\"text-purple-600 font-bold text-sm uppercase\">Holidays</p>\r\n              <p className=\"text-3xl font-black text-purple-800\">{stats.holiday}</p>\r\n            </div>\r\n            <div className=\"bg-blue-100 p-4 rounded-xl border border-blue-200\">\r\n              <p className=\"text-blue-600 font-bold text-sm uppercase\">Attendance + Holidays</p>\r\n              <p className=\"text-3xl font-black text-blue-800\">\r\n                {stats.present + stats.absent + stats.leave + stats.holiday}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* CALENDAR GRID */}\r\n        {selectedEmployeeId ? (\r\n          <div className=\"flex-1 overflow-auto p-6\">\r\n            \r\n            <div className=\"grid grid-cols-7 gap-px bg-gray-200 border rounded-xl overflow-hidden shadow-sm min-w-[600px]\">\r\n              {/* Weekday Headers */}\r\n              {weekDays.map(day => (\r\n                <div key={day} className=\"bg-gray-100 p-2 text-center font-bold text-gray-500 text-sm\">\r\n                  {day}\r\n                </div>\r\n              ))}\r\n\r\n              {/* Days */}\r\n              {calendarDays.map((date, i) => {\r\n                if (!date) return <div key={i} className=\"bg-white min-h-[100px]\" />;\r\n                \r\n                const record = getRecordForDate(date);\r\n                const dateStr = toLocalISOString(date);\r\n                const isToday = dateStr === toLocalISOString(new Date());\r\n                const isSelected = selectedDate === dateStr;\r\n                const isDefaultHoliday = !record && isSunday(date);\r\n\r\n                return (\r\n                  <div\r\n                    key={i}\r\n                    onClick={() => {\r\n                      setSelectedDate(dateStr);\r\n                      // Pre-fill form if record exists\r\n                      if (record) {\r\n                        setFormData({\r\n                          status: record.status,\r\n                          checkIn: record.checkIn ? new Date(record.checkIn).toTimeString().slice(0, 5) : \"\",\r\n                          checkOut: record.checkOut ? new Date(record.checkOut).toTimeString().slice(0, 5) : \"\",\r\n                          remarks: record.remarks || \"\",\r\n                        });\r\n                      } else {\r\n                         // Reset form for new entry\r\n                         setFormData({\r\n                          status: isSunday(date) ? \"HOLIDAY\" : \"PRESENT\",\r\n                          checkIn: \"\",\r\n                          checkOut: \"\",\r\n                          remarks: \"\",\r\n                        });\r\n                      }\r\n                    }}\r\n                    className={`bg-white min-h-[120px] p-2 hover:bg-gray-50 cursor-pointer transition-colors relative flex flex-col justify-between ${\r\n                      isToday ? \"ring-2 ring-blue-500 inset-0 z-10\" : \"\"\r\n                    } ${isSelected ? \"bg-blue-50\" : \"\"} ${isDefaultHoliday ? \"bg-purple-50/50\" : \"\"}`}\r\n                  >\r\n                    <div className=\"flex justify-between items-start\">\r\n                      <span className={`text-sm font-bold ${isToday ? \"text-blue-600\" : \"text-gray-700\"}`}>\r\n                        {date.getDate()}\r\n                      </span>\r\n                      {record && (\r\n                        <button\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            handleDelete(record.id);\r\n                          }}\r\n                          className=\"text-gray-400 hover:text-red-600 text-xs font-bold px-1\"\r\n                          >\r\n                          ✕\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n\r\n                    {record ? (\r\n                      <div className=\"mt-1 space-y-1\">\r\n                        <span className={`block text-center text-xs font-black py-1 rounded ${\r\n                          record.status === \"PRESENT\" ? \"bg-green-100 text-green-800\" :\r\n                          record.status === \"ABSENT\" ? \"bg-red-100 text-red-800\" :\r\n                          record.status === \"HOLIDAY\" ? \"bg-purple-100 text-purple-800\" :\r\n                          \"bg-yellow-100 text-yellow-800\"\r\n                        }`}>\r\n                          {record.status}\r\n                        </span>\r\n                        {(record.checkIn || record.checkOut) && (\r\n                          <div className=\"text-[10px] text-center text-gray-500 font-mono\">\r\n                            {formatPakTime(record.checkIn)} - {formatPakTime(record.checkOut)}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    ) : isDefaultHoliday ? (\r\n                      <div className=\"mt-1 space-y-1 opacity-60\">\r\n                         <span className=\"block text-center text-xs font-black py-1 rounded bg-purple-50 text-purple-400 border border-purple-100\">\r\n                          HOLIDAY\r\n                        </span>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"flex-1 flex items-center justify-center opacity-0 hover:opacity-100\">\r\n                        <span className=\"text-2xl text-gray-200\">+</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex-1 flex flex-col items-center justify-center text-gray-400\">\r\n            <div className=\"text-6xl mb-4\">👈</div>\r\n            <p className=\"text-xl font-bold\">Select an employee from the left</p>\r\n            <p>to view and manage their attendance calendar</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* EDIT MODAL / SIDEBAR */}\r\n      {selectedDate && selectedEmployeeId && (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden\">\r\n            <div className=\"p-4 bg-gray-100 border-b flex justify-between items-center\">\r\n              <h3 className=\"font-black text-lg\">\r\n                {new Date(selectedDate).toDateString()}\r\n              </h3>\r\n              <button \r\n                onClick={() => setSelectedDate(null)}\r\n                className=\"text-gray-500 hover:text-black font-bold\"\r\n              >\r\n                ✕\r\n              </button>\r\n            </div>\r\n            \r\n            <form onSubmit={handleSave} className=\"p-6 space-y-4\">\r\n              <div>\r\n                <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Status</label>\r\n                <select\r\n                  className=\"w-full border rounded-lg px-3 py-2 font-bold\"\r\n                  value={formData.status}\r\n                  onChange={(e) => setFormData({ ...formData, status: e.target.value })}\r\n                >\r\n                  <option value=\"PRESENT\">Present</option>\r\n                  <option value=\"ABSENT\">Absent</option>\r\n                  <option value=\"LEAVE\">Leave</option>\r\n                  <option value=\"HALF_DAY\">Half Day</option>\r\n                  <option value=\"LATE\">Late</option>\r\n                  <option value=\"HOLIDAY\">Holiday</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"flex gap-3\">\r\n                <div className=\"flex-1\">\r\n                  <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Check In</label>\r\n                  <input\r\n                    type=\"time\"\r\n                    className=\"w-full border rounded-lg px-3 py-2\"\r\n                    value={formData.checkIn}\r\n                    onChange={(e) => setFormData({ ...formData, checkIn: e.target.value })}\r\n                  />\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Check Out</label>\r\n                  <input\r\n                    type=\"time\"\r\n                    className=\"w-full border rounded-lg px-3 py-2\"\r\n                    value={formData.checkOut}\r\n                    onChange={(e) => setFormData({ ...formData, checkOut: e.target.value })}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Remarks</label>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Optional note...\"\r\n                  className=\"w-full border rounded-lg px-3 py-2\"\r\n                  value={formData.remarks}\r\n                  onChange={(e) => setFormData({ ...formData, remarks: e.target.value })}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"pt-2\">\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={loading}\r\n                  className=\"w-full bg-black text-white py-3 rounded-xl font-black hover:bg-gray-800 transition-colors disabled:opacity-50\"\r\n                >\r\n                  {loading ? \"Saving...\" : \"Save Record\"}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\backup-restore\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PERMISSIONS' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":21,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"PERMISSIONS"},"fix":{"range":[109,157],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":74,"column":3,"nodeType":"Identifier","endLine":74,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadBackups'. Either include it or remove the dependency array.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadBackups]","fix":{"range":[1792,1794],"text":"[loadBackups]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":122,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":122,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\ntype AuthUser = {\r\n  id?: string;\r\n  role?: string;\r\n  permissions?: (string | { permission?: string })[];\r\n  rolePermissions?: (string | { permission?: string })[];\r\n};\r\n\r\n\r\nfunction userHasPerm(user: AuthUser | null, perm: string): boolean {\r\n  if (!user) return false;\r\n\r\n  const p = perm.toUpperCase();\r\n\r\n  if (user.role === \"ADMIN\") return true;\r\n\r\n  if (\r\n    user.permissions?.some(\r\n      (x) =>\r\n        (typeof x === \"string\"\r\n          ? x.toUpperCase()\r\n          : (x.permission || \"\").toUpperCase()) === p\r\n    )\r\n  ) {\r\n    return true;\r\n  }\r\n\r\n  if (\r\n    user.rolePermissions?.some(\r\n      (x) =>\r\n        (typeof x === \"string\"\r\n          ? x.toUpperCase()\r\n          : (x.permission || \"\").toUpperCase()) === p\r\n    )\r\n  ) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n\r\ntype Backup = {\r\n  id: string;\r\n  fileName: string;\r\n  fileSize?: number;\r\n  backupType: string;\r\n  status: string;\r\n  createdAt: string;\r\n};\r\n\r\nexport default function BackupRestorePage() {\r\n  const [backups, setBackups] = useState<Backup[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [creating, setCreating] = useState(false);\r\n\r\n  const user = getCurrentUser();\r\n\r\n  if (!userHasPerm(user, 'BACKUP_RESTORE')) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\r\n          <h2 className=\"text-xl font-bold text-red-600 mb-2\">❌ Access Denied</h2>\r\n          <p className=\"text-red-700\">You do not have permission to access backup & restore.</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadBackups();\r\n  }, []);\r\n\r\n  async function loadBackups() {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/api/backup\", {\r\n        headers: {\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n      });\r\n      const data = await res.json();\r\n      if (Array.isArray(data)) {\r\n        setBackups(data);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Load error:\", e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function createBackup() {\r\n    if (!confirm(\"Create a full backup of all system data?\")) {\r\n      return;\r\n    }\r\n\r\n    setCreating(true);\r\n    try {\r\n      const res = await fetch(\"/api/backup\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n        body: JSON.stringify({ backupType: \"FULL\" }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        alert(\"Backup created successfully!\");\r\n        await loadBackups();\r\n      } else {\r\n        const error = await res.json();\r\n        alert(error.error || \"Backup failed\");\r\n      }\r\n    } catch (e) {\r\n      alert(\"Backup failed\");\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  }\r\n\r\n  async function restoreBackup(backupId: string, fileName: string) {\r\n    if (!confirm(`Restore from \"${fileName}\"?\\n\\nThis will replace ALL current data!`)) {\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      console.log(\"Starting restore from:\", backupId);\r\n      const res = await fetch(\"/api/backup/restore\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n        body: JSON.stringify({ backupId }),\r\n      });\r\n\r\n      console.log(\"Restore response status:\", res.status);\r\n      const result = await res.json();\r\n      console.log(\"Restore result:\", result);\r\n\r\n      if (res.ok) {\r\n        alert(\"Data restored successfully! Page will refresh...\");\r\n        // Reload page to show restored data\r\n        setTimeout(() => {\r\n          window.location.reload();\r\n        }, 1000);\r\n      } else {\r\n        alert(\"Restore failed: \" + (result.error || \"Unknown error\"));\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Restore error:\", e);\r\n      alert(\"Restore failed: \" + (e as Error).message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  function formatFileSize(bytes?: number): string {\r\n    if (!bytes) return \"N/A\";\r\n    if (bytes < 1024) return bytes + \" B\";\r\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + \" KB\";\r\n    return (bytes / (1024 * 1024)).toFixed(2) + \" MB\";\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-2xl font-bold\">Data Backup & Restore</h1>\r\n        <button\r\n          onClick={createBackup}\r\n          disabled={creating}\r\n          className=\"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50\"\r\n        >\r\n          {creating ? \"Creating Backup...\" : \"+ Create Backup\"}\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"bg-yellow-50 border border-yellow-200 p-4 rounded\">\r\n        <p className=\"text-sm text-yellow-800\">\r\n          <strong>Note:</strong> Backups are stored locally. For production use,\r\n          configure cloud storage (AWS S3, Google Cloud Storage, etc.) for\r\n          automatic backups.\r\n        </p>\r\n      </div>\r\n\r\n      <div className=\"bg-white border rounded overflow-hidden\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-100\">\r\n            <tr>\r\n              <th className=\"p-3 text-left\">File Name</th>\r\n              <th className=\"p-3 text-left\">Type</th>\r\n              <th className=\"p-3 text-right\">Size</th>\r\n              <th className=\"p-3 text-center\">Status</th>\r\n              <th className=\"p-3 text-left\">Created</th>\r\n              <th className=\"p-3 text-center\">Action</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {loading ? (\r\n              <tr>\r\n                <td colSpan={6} className=\"p-4 text-center\">\r\n                  Loading...\r\n                </td>\r\n              </tr>\r\n            ) : backups.length === 0 ? (\r\n              <tr>\r\n                <td colSpan={6} className=\"p-4 text-center text-gray-400\">\r\n                  No backups found\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              backups.map((b) => (\r\n                <tr key={b.id} className=\"border-t\">\r\n                  <td className=\"p-3\">{b.fileName}</td>\r\n                  <td className=\"p-3\">{b.backupType}</td>\r\n                  <td className=\"p-3 text-right\">{formatFileSize(b.fileSize)}</td>\r\n                  <td className=\"p-3 text-center\">\r\n                    <span\r\n                      className={`px-2 py-1 rounded text-xs ${\r\n                        b.status === \"COMPLETED\"\r\n                          ? \"bg-green-100 text-green-800\"\r\n                          : b.status === \"FAILED\"\r\n                          ? \"bg-red-100 text-red-800\"\r\n                          : \"bg-yellow-100 text-yellow-800\"\r\n                      }`}\r\n                    >\r\n                      {b.status}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"p-3\">\r\n                    {new Date(b.createdAt).toLocaleString()}\r\n                  </td>\r\n                  <td className=\"p-3 text-center\">\r\n                    {b.status === \"COMPLETED\" && (\r\n                      <button\r\n                        onClick={() => restoreBackup(b.id, b.fileName)}\r\n                        disabled={loading}\r\n                        className=\"bg-green-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50 hover:bg-green-700\"\r\n                      >\r\n                        {loading ? \"Restoring...\" : \"Restore\"}\r\n                      </button>\r\n                    )}\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\bank-reconciliation\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStatements'. Either include it or remove the dependency array.","line":75,"column":6,"nodeType":"ArrayExpression","endLine":75,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [selectedAccount, bankAccounts, fetchStatements]","fix":{"range":[2186,2217],"text":"[selectedAccount, bankAccounts, fetchStatements]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\budget\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadBudgets'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadBudgets, year]","fix":{"range":[875,881],"text":"[loadBudgets, year]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { exportToCSV } from \"@/lib/export\";\n\ntype Account = {\n  id: string;\n  name: string;\n  code: string;\n};\n\ntype Budget = {\n  id: string;\n  accountId: string;\n  account: Account;\n  year: number;\n  amount: number;\n  notes?: string | null;\n};\n\nexport default function BudgetPage() {\n  const currentYear = new Date().getFullYear();\n  const [accounts, setAccounts] = useState<Account[]>([]);\n  const [budgets, setBudgets] = useState<Budget[]>([]);\n  const [year, setYear] = useState(currentYear.toString());\n  const [selectedAccount, setSelectedAccount] = useState(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [notes, setNotes] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    loadAccounts();\n    loadBudgets();\n  }, [year]);\n\n  async function loadAccounts() {\n    const user = getCurrentUser();\n    if (!user) return;\n\n    try {\n      const res = await fetch(\"/api/accounts\", {\n        headers: { \"x-user-role\": user.role },\n      });\n      const data = await res.json();\n      setAccounts(Array.isArray(data) ? data : data.accounts || []);\n    } catch (e) {\n      console.error(\"Error loading accounts:\", e);\n    }\n  }\n\n  async function loadBudgets() {\n    setLoading(true);\n    try {\n      const user = getCurrentUser();\n      const res = await fetch(`/api/budget?year=${year}`, {\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n      });\n      const data = await res.json();\n      setBudgets(Array.isArray(data) ? data : []);\n    } catch (e) {\n      console.error(\"Error loading budgets:\", e);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function saveBudget() {\n    if (!selectedAccount || !amount) {\n      alert(\"Account and amount required\");\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const user = getCurrentUser();\n      const res = await fetch(\"/api/budget\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"ADMIN\",\n        },\n        body: JSON.stringify({\n          accountId: selectedAccount,\n          year: parseInt(year),\n          amount: parseFloat(amount),\n          description: notes || null,\n        }),\n      });\n\n      const data = await res.json();\n      if (res.ok) {\n        alert(\"Budget saved successfully!\");\n        setSelectedAccount(\"\");\n        setAmount(\"\");\n        setNotes(\"\");\n        loadBudgets();\n      } else {\n        alert(data.error || \"Failed to save budget\");\n      }\n    } catch (e) {\n      console.error(\"Error saving budget:\", e);\n      alert(\"Error saving budget\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function deleteBudget(id: string) {\n    if (!confirm(\"Are you sure you want to delete this budget?\")) return;\n\n    try {\n      const user = getCurrentUser();\n      const res = await fetch(`/api/budget?id=${id}`, {\n        method: \"DELETE\",\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n      });\n\n      if (res.ok) {\n        alert(\"Budget deleted successfully!\");\n        loadBudgets();\n      } else {\n        const data = await res.json();\n        alert(data.error || \"Failed to delete budget\");\n      }\n    } catch (e) {\n      console.error(\"Error deleting budget:\", e);\n      alert(\"Error deleting budget\");\n    }\n  }\n\n  function exportBudgets() {\n    const exportData = budgets.map((b) => ({\n      account: b.account.name,\n      code: b.account.code,\n      year: b.year,\n      budget: b.amount,\n      notes: b.notes || \"\",\n    }));\n    exportToCSV(exportData, `budget-${year}`);\n  }\n\n  return (\n    <div className=\"p-6 max-w-6xl mx-auto space-y-6\">\n      <h1 className=\"text-2xl font-bold\">Budget Planning</h1>\n\n      {/* FILTERS */}\n      <div className=\"bg-white border rounded-lg p-4 flex gap-4 items-end\">\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">Year</label>\n          <input\n            type=\"number\"\n            value={year}\n            onChange={(e) => setYear(e.target.value)}\n            className=\"border rounded px-3 py-2\"\n            min=\"2020\"\n            max=\"2100\"\n          />\n        </div>\n        {budgets.length > 0 && (\n          <button\n            onClick={exportBudgets}\n            className=\"bg-green-600 text-white px-6 py-2 rounded font-bold\"\n          >\n            📥 Export CSV\n          </button>\n        )}\n      </div>\n\n      {/* ADD BUDGET FORM */}\n      <div className=\"bg-white border rounded-lg p-6 space-y-4\">\n        <h2 className=\"text-xl font-bold\">Add/Update Budget</h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">Account</label>\n            <select\n              value={selectedAccount}\n              onChange={(e) => setSelectedAccount(e.target.value)}\n              className=\"w-full border rounded px-3 py-2\"\n            >\n              <option value=\"\">Select Account</option>\n              {accounts.map((acc) => (\n                <option key={acc.id} value={acc.id}>\n                  {acc.code} - {acc.name}\n                </option>\n              ))}\n            </select>\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">Amount</label>\n            <input\n              type=\"number\"\n              value={amount}\n              onChange={(e) => setAmount(e.target.value)}\n              placeholder=\"0.00\"\n              className=\"w-full border rounded px-3 py-2\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">Notes</label>\n            <input\n              type=\"text\"\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              placeholder=\"Optional notes\"\n              className=\"w-full border rounded px-3 py-2\"\n            />\n          </div>\n        </div>\n        <button\n          onClick={saveBudget}\n          disabled={loading || !selectedAccount || !amount}\n          className=\"bg-blue-600 text-white px-6 py-2 rounded font-bold disabled:bg-gray-400\"\n        >\n          {loading ? \"Saving...\" : \"Save Budget\"}\n        </button>\n      </div>\n\n      {/* BUDGETS LIST */}\n      <div className=\"bg-white border rounded-lg p-6\">\n        <h2 className=\"text-xl font-bold mb-4\">Budgets for {year}</h2>\n        {loading ? (\n          <div className=\"text-center py-8\">Loading...</div>\n        ) : budgets.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500\">\n            No budgets set for {year}\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full border\">\n              <thead>\n                <tr className=\"bg-gray-100\">\n                  <th className=\"border p-2 text-left\">Account</th>\n                  <th className=\"border p-2 text-left\">Code</th>\n                  <th className=\"border p-2 text-right\">Budget Amount</th>\n                  <th className=\"border p-2 text-left\">Notes</th>\n                  <th className=\"border p-2 text-center\">Action</th>\n                </tr>\n              </thead>\n              <tbody>\n                {budgets.map((budget) => (\n                  <tr key={budget.id}>\n                    <td className=\"border p-2\">{budget.account.name}</td>\n                    <td className=\"border p-2\">{budget.account.code}</td>\n                    <td className=\"border p-2 text-right font-bold\">\n                      {budget.amount.toLocaleString()}\n                    </td>\n                    <td className=\"border p-2\">{budget.notes || \"-\"}</td>\n                    <td className=\"border p-2 text-center\">\n                      <button\n                        onClick={() => deleteBudget(budget.id)}\n                        className=\"text-red-600 hover:text-red-800\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n              <tfoot>\n                <tr className=\"bg-gray-50 font-bold\">\n                  <td colSpan={2} className=\"border p-2 text-right\">\n                    Total:\n                  </td>\n                  <td className=\"border p-2 text-right\">\n                    {budgets.reduce((sum, b) => sum + b.amount, 0).toLocaleString()}\n                  </td>\n                  <td colSpan={2} className=\"border p-2\"></td>\n                </tr>\n              </tfoot>\n            </table>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\contra\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ResponsiveForm' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":24,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ResponsiveForm"},"fix":{"range":[206,221],"text":""},"desc":"Remove unused variable \"ResponsiveForm\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormField' is defined but never used.","line":7,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":35,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FormField"},"fix":{"range":[220,231],"text":""},"desc":"Remove unused variable \"FormField\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormActions' is defined but never used.","line":7,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":48,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"FormActions"},"fix":{"range":[197,285],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MobileTable' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MobileTable"},"fix":{"range":[299,311],"text":""},"desc":"Remove unused variable \"MobileTable\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MobileCard' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MobileCard"},"fix":{"range":[310,325],"text":""},"desc":"Remove unused variable \"MobileCard\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MobileCardRow' is defined but never used.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MobileCardRow"},"fix":{"range":[325,343],"text":""},"desc":"Remove unused variable \"MobileCardRow\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'accounts' is assigned a value but never used.","line":34,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showForm' is assigned a value but never used.","line":36,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setFormData' is assigned a value but never used.","line":38,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleSubmit' is assigned a value but never used.","line":67,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":67,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport toast from 'react-hot-toast';\r\n\r\nimport { ResponsiveContainer, PageHeader, Card } from '@/components/ui/ResponsiveContainer';\r\nimport { ResponsiveForm, FormField, FormActions } from '@/components/ui/ResponsiveForm';\r\nimport {\r\n  MobileTable,\r\n  MobileCard,\r\n  MobileCardRow,\r\n  DesktopTable,\r\n  EmptyState,\r\n} from '@/components/ui/MobileTable';\r\n\r\ninterface ContraEntry {\r\n  id: string;\r\n  contraNumber: string;\r\n  date: string;\r\n  amount: number;\r\n  narration?: string;\r\n  fromAccount?: { name: string };\r\n  toAccount?: { name: string };\r\n}\r\n\r\ninterface Account {\r\n  id: string;\r\n  name: string;\r\n  accountType: string;\r\n}\r\n\r\nexport default function ContraPage() {\r\n  const [entries, setEntries] = useState<ContraEntry[]>([]);\r\n  const [accounts, setAccounts] = useState<Account[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showForm, setShowForm] = useState(false);\r\n\r\n  const [formData, setFormData] = useState({\r\n    date: new Date().toISOString().split('T')[0],\r\n    fromAccountId: '',\r\n    toAccountId: '',\r\n    amount: '',\r\n    narration: '',\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchEntries();\r\n    fetchAccounts();\r\n  }, []);\r\n\r\n  const fetchEntries = async () => {\r\n    try {\r\n      const res = await fetch('/api/contra');\r\n      if (res.ok) setEntries(await res.json());\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchAccounts = async () => {\r\n    const res = await fetch('/api/accounts');\r\n    if (!res.ok) return;\r\n    const data = await res.json();\r\n    setAccounts(data.filter((a: Account) => a.accountType === 'CASH' || a.accountType === 'BANK'));\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (formData.fromAccountId === formData.toAccountId) {\r\n      toast.error('From & To account same nahi ho sakte');\r\n      return;\r\n    }\r\n\r\n    const res = await fetch('/api/contra', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ ...formData, amount: Number(formData.amount) }),\r\n    });\r\n\r\n    if (res.ok) {\r\n      toast.success('Contra entry created');\r\n      setShowForm(false);\r\n      fetchEntries();\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <ResponsiveContainer>\r\n        <div className=\"h-64 flex items-center justify-center\">Loading…</div>\r\n      </ResponsiveContainer>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ResponsiveContainer>\r\n      <PageHeader\r\n        title=\"Contra Entry\"\r\n        description=\"Cash / Bank transfers\"\r\n        action={{ label: 'New Entry', onClick: () => setShowForm(true) }}\r\n      />\r\n\r\n      <Card>\r\n        {entries.length === 0 ? (\r\n          <EmptyState message=\"No contra entries\" onAction={() => setShowForm(true)} />\r\n        ) : (\r\n          <DesktopTable>\r\n            <tbody>\r\n              {entries.map(e => (\r\n                <tr key={e.id}>\r\n                  <td>{e.contraNumber}</td>\r\n                  <td>{e.fromAccount?.name}</td>\r\n                  <td>{e.toAccount?.name}</td>\r\n                  <td>{e.amount}</td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </DesktopTable>\r\n        )}\r\n      </Card>\r\n    </ResponsiveContainer>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\cpv\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[661,664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[661,664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1184,1187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1184,1187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadAccounts', 'loadVouchers', and 'user'. Either include them or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadAccounts, loadVouchers, user]","fix":{"range":[1587,1589],"text":"[loadAccounts, loadVouchers, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2604,2607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2604,2607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2797,2800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2797,2800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4740,4743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4740,4743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":216,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":216,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { toast } from \"react-hot-toast\";\n\ntype Account = {\n  id: string;\n  name: string;\n  phone?: string | null;\n  partyType?: string | null;\n};\n\ntype Voucher = {\n  id: string;\n  voucherNo: string;\n  date: string;\n  narration: string;\n  accountName: string;\n  accountId: string;\n  amount: number;\n  paymentMode: string;\n  paymentAccountId: string;\n};\n\nexport default function CPVPage() {\n  const today = new Date().toISOString().split(\"T\")[0];\n\n  const [accounts, setAccounts] = useState<Account[]>([]);\n  const [bankAccounts, setBankAccounts] = useState<any[]>([]);\n  const [vouchers, setVouchers] = useState<Voucher[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<Voucher | null>(null);\n\n  const [accountId, setAccountId] = useState(\"\");\n  const [bankAccountId, setBankAccountId] = useState(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [date, setDate] = useState(today);\n  const [narration, setNarration] = useState(\"\");\n  const [voucher, setVoucher] = useState<any>(null);\n  const [saving, setSaving] = useState(false);\n  const [selectedName, setSelectedName] = useState(\"\");\n  const [selectedPhone, setSelectedPhone] = useState(\"\");\n\n  const user = getCurrentUser();\n\n  /* ================= LOAD DATA ================= */\n  useEffect(() => {\n    if (!user) {\n      toast.error(\"Session expired\");\n      return;\n    }\n\n    loadVouchers();\n    loadAccounts();\n  }, []);\n\n  async function loadVouchers() {\n    try {\n      const res = await fetch(\"/api/cpv\", {\n        headers: { \"x-user-role\": user?.role || \"\" },\n      });\n      const data = await res.json();\n      if (Array.isArray(data)) {\n        setVouchers(data);\n      }\n    } catch (e) {\n      console.error(\"Load vouchers error:\", e);\n    }\n  }\n\n  async function loadAccounts() {\n    Promise.all([\n      fetch(\"/api/accounts\", {\n        method: \"GET\",\n        headers: { \"x-user-role\": user?.role || \"\" },\n      }),\n      fetch(\"/api/bank-accounts\", { method: \"GET\" }),\n    ])\n      .then(async ([accountsRes, banksRes]) => {\n        const accountsData = await accountsRes.json();\n        const banksData = await banksRes.json();\n\n        if (Array.isArray(accountsData)) {\n          // CPV میں SUPPLIER + BANKS + دوسرے non-customer accounts\n          setAccounts(\n            accountsData.filter(a =>\n              !a.partyType || (a.partyType !== \"CUSTOMER\")\n            )\n          );\n        }\n\n        const allBanks: any[] = [];\n        // Removed manual addition of banks from accountsData as banksData already includes them\n        \n        if (Array.isArray(banksData)) {\n          banksData.forEach((bank: any) => {\n            allBanks.push({\n              id: bank.id,\n              accountId: bank.accountId,\n              name: bank.accountName || `${bank.bankName} - ${bank.accountNo}`,\n              bankName: bank.bankName,\n              accountNo: bank.accountNo,\n            });\n          });\n        }\n        setBankAccounts(allBanks);\n      })\n      .catch(err => {\n        console.error(\"Accounts load error:\", err);\n      });\n  }\n\n  /* ================= SAVE/UPDATE CPV ================= */\n  async function saveCPV() {\n    if (!accountId) {\n      toast.error(\"Account select karein\");\n      return;\n    }\n\n    const amountNum = Number(amount);\n    if (!amount || amount.trim() === \"\" || isNaN(amountNum) || amountNum <= 0) {\n      toast.error(\"Valid amount enter karein (0 se zyada)\");\n      return;\n    }\n\n    setSaving(true);\n\n    try {\n      const url = editing ? \"/api/cpv\" : \"/api/cpv\";\n      const method = editing ? \"PUT\" : \"POST\";\n\n      const res = await fetch(url, {\n        method,\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"\",\n        },\n        body: JSON.stringify(editing ? {\n          id: editing.id,\n          accountId,\n          bankAccountId: bankAccountId || null,\n          paymentMode: bankAccountId ? \"BANK\" : \"CASH\",\n          amount,\n          date,\n          narration,\n        } : {\n          accountId,\n          bankAccountId: bankAccountId || null,\n          paymentMode: bankAccountId ? \"BANK\" : \"CASH\",\n          amount,\n          date,\n          narration,\n        }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        alert(`Error: ${data?.error || \"Save failed\"}`);\n        return;\n      }\n\n      setVoucher(data);\n      alert(editing ? \"CPV updated successfully!\" : \"CPV saved successfully!\");\n      await loadVouchers();\n      resetForm();\n      setShowForm(false);\n      setEditing(null);\n    } catch (e: any) {\n      alert(`Error: ${e.message || \"Failed to save\"}`);\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  function resetForm() {\n    setAccountId(\"\");\n    setBankAccountId(\"\");\n    setAmount(\"\");\n    setNarration(\"\");\n    setSelectedName(\"\");\n    setSelectedPhone(\"\");\n  }\n\n  function startEdit(v: Voucher) {\n    setEditing(v);\n    setAccountId(v.accountId);\n    setBankAccountId(v.paymentAccountId || \"\");\n    setAmount(v.amount.toString());\n    setDate(v.date);\n    setNarration(v.narration);\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deleteVoucher(id: string) {\n    if (!confirm(\"Are you sure you want to delete this CPV?\")) {\n      return;\n    }\n\n    try {\n      const res = await fetch(`/api/cpv?id=${id}`, {\n        method: \"DELETE\",\n        headers: { \"x-user-role\": user?.role || \"\" },\n      });\n\n      if (res.ok) {\n        alert(\"CPV deleted successfully!\");\n        await loadVouchers();\n      } else {\n        const data = await res.json();\n        alert(data.error || \"Delete failed\");\n      }\n    } catch (e) {\n      alert(\"Delete failed\");\n    }\n  }\n\n  function printVoucher() {\n    window.print();\n  }\n\n  function sendWhatsApp() {\n    const phoneNo = voucher?.phone || selectedPhone;\n    if (!phoneNo) {\n      toast.error(\"Party ka phone number nahi mila\");\n      return;\n    }\n\n    const phone = String(phoneNo).replace(/\\D/g, \"\");\n    const finalPhone = phone.startsWith('0') ? '92' + phone.substring(1) : phone;\n\n    if (finalPhone.length < 10) {\n      toast.error(\"Phone number theek nahi hai\");\n      return;\n    }\n\n    const msg =\n      `*US TRADERS - PAYMENT ADVICE*\\n` +\n      `--------------------------\\n` +\n      `*Voucher No:* ${voucher.voucherNo}\\n` +\n      `*Paid To:* ${selectedName || voucher.accountName}\\n` +\n      `*Amount:* Rs. ${Number(voucher.amount || amount || 0).toLocaleString()}/-\\n` +\n      `*Date:* ${voucher.date?.split('T')[0] || date}\\n` +\n      `*Narration:* ${narration || \"N/A\"}\\n` +\n      `--------------------------\\n` +\n      `_This is a computer generated confirmation._`;\n\n    window.open(\n      `https://wa.me/${finalPhone}?text=${encodeURIComponent(msg)}`,\n      \"_blank\"\n    );\n  }\n\n  /* ================= UI ================= */\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-2xl font-bold\">Cash Payment Voucher (CPV)</h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => {\n              setShowList(!showList);\n              setShowForm(!showForm);\n              setEditing(null);\n            }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => {\n              setShowForm(true);\n              setShowList(false);\n              setEditing(null);\n              resetForm();\n            }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New CPV\n          </button>\n        </div>\n      </div>\n\n      {/* VOUCHER LIST */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-x-auto\">\n          <table className=\"w-full text-sm min-w-[800px]\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">Voucher No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Paid To</th>\n                <th className=\"p-3 text-right\">Amount</th>\n                <th className=\"p-3 text-left\">Payment Mode</th>\n                <th className=\"p-3 text-left\">Narration</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {vouchers.length === 0 ? (\n                <tr>\n                  <td colSpan={7} className=\"p-4 text-center text-gray-400\">\n                    No CPVs found\n                  </td>\n                </tr>\n              ) : (\n                vouchers.map((v) => (\n                  <tr key={v.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">{v.voucherNo}</td>\n                    <td className=\"p-3\">{v.date}</td>\n                    <td className=\"p-3\">{v.accountName}</td>\n                    <td className=\"p-3 text-right\">{v.amount.toLocaleString()}</td>\n                    <td className=\"p-3\">{v.paymentMode}</td>\n                    <td className=\"p-3\">{v.narration}</td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(v)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deleteVoucher(v.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <div className=\"border p-4 space-y-3 bg-white print:hidden\">\n          <h2 className=\"text-xl font-bold\">\n            {editing ? \"Edit CPV\" : \"New CPV\"}\n          </h2>\n\n          <select\n            className=\"border px-3 py-2 w-full\"\n            value={accountId}\n            onChange={(e) => {\n              const id = e.target.value;\n              setAccountId(id);\n              const acc = accounts.find(a => a.id === id);\n              setSelectedName(acc?.name || \"\");\n              setSelectedPhone(acc?.phone || \"\");\n            }}\n          >\n            <option value=\"\">Paid To (Supplier / Bank / Expense)</option>\n            {accounts.map(a => (\n              <option key={a.id} value={a.id}>\n                {a.name} {a.phone ? `(${a.phone})` : \"\"}\n              </option>\n            ))}\n          </select>\n\n          <div>\n            <label className=\"block text-sm font-semibold mb-1\">Payment Method</label>\n            <select\n              className=\"border px-3 py-2 w-full\"\n              value={bankAccountId}\n              onChange={(e) => setBankAccountId(e.target.value)}\n            >\n              <option value=\"\">Cash</option>\n              {bankAccounts.map(bank => (\n                <option key={bank.id} value={bank.id}>\n                  {bank.name}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <input\n            className=\"border px-3 py-2 w-full\"\n            placeholder=\"Amount\"\n            type=\"number\"\n            step=\"0.01\"\n            value={amount}\n            onChange={(e) => setAmount(e.target.value)}\n          />\n\n          <input\n            type=\"date\"\n            className=\"border px-3 py-2 w-full\"\n            value={date}\n            onChange={(e) => setDate(e.target.value)}\n          />\n\n          <textarea\n            className=\"border px-3 py-2 w-full\"\n            placeholder=\"Narration\"\n            value={narration}\n            onChange={(e) => setNarration(e.target.value)}\n          />\n\n          <div className=\"flex gap-2\">\n            <button\n              onClick={saveCPV}\n              disabled={saving}\n              className=\"bg-black text-white px-4 py-2 flex-1\"\n            >\n              {saving ? \"Saving...\" : editing ? \"Update CPV\" : \"Save CPV\"}\n            </button>\n            <button\n              onClick={() => {\n                setShowForm(false);\n                setEditing(null);\n                resetForm();\n              }}\n              className=\"bg-gray-600 text-white px-4 py-2\"\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* PRINT PREVIEW */}\n      {voucher && (\n        <div className=\"overflow-x-auto\">\n          <div className=\"invoice-print max-w-[210mm] mx-auto bg-white p-8 border-2 border-black text-black shadow-lg min-w-[700px]\">\n            <div className=\"flex justify-between items-start border-b-4 border-black pb-4 mb-8\">\n            <div>\n              <h1 className=\"text-4xl font-black italic tracking-tighter uppercase\">US TRADERS</h1>\n              <p className=\"text-[10px] font-bold tracking-[3px] text-gray-600 uppercase\">Industrial Goods & Services</p>\n            </div>\n            <div className=\"text-right\">\n              <h2 className=\"text-2xl font-black uppercase underline decoration-2 underline-offset-4\">\n                Payment Voucher\n              </h2>\n              <div className=\"mt-2 text-sm font-bold space-y-1\">\n                <p>No: <span className=\"font-mono\">{voucher.voucherNo}</span></p>\n                <p>Date: {voucher.date?.split('T')[0] || date}</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-8 my-10\">\n            <div className=\"flex items-end gap-4 border-b border-gray-300 pb-2\">\n              <span className=\"text-xs font-black uppercase w-32 shrink-0\">Paid To:</span>\n              <span className=\"text-xl font-bold uppercase flex-1 border-b-2 border-black px-2\">\n                {selectedName || voucher.accountName}\n              </span>\n            </div>\n\n            <div className=\"flex items-end gap-4 border-b border-gray-300 pb-2\">\n              <span className=\"text-xs font-black uppercase w-32 shrink-0\">Amount (PKR):</span>\n              <span className=\"text-xl font-bold italic flex-1 border-b-2 border-black px-2\">\n                Rs. {Number(voucher.amount || amount || 0).toLocaleString()}/-\n              </span>\n            </div>\n\n            <div className=\"flex items-start gap-4 border-b border-gray-300 pb-2\">\n              <span className=\"text-xs font-black uppercase w-32 shrink-0\">Description:</span>\n              <span className=\"text-sm font-medium flex-1 border-b border-black px-2 italic\">\n                {narration || \"Official transaction recorded.\"}\n              </span>\n            </div>\n          </div>\n\n          <div className=\"mt-16 flex justify-between items-end px-2\">\n            <div className=\"bg-gray-100 border-4 border-black p-4 flex flex-col min-w-[200px]\">\n              <span className=\"text-[10px] font-black uppercase border-b border-black mb-1\">Net Amount Paid</span>\n              <span className=\"text-3xl font-black italic\">\n                {Number(voucher.amount || amount || 0).toLocaleString()}\n              </span>\n            </div>\n            <div className=\"flex gap-12\">\n              <div className=\"text-center w-32 border-t-2 border-black mt-12 pt-1 font-bold text-[10px] uppercase\">Receiver Sign</div>\n              <div className=\"text-center w-32 border-t-2 border-black mt-12 pt-1 font-bold text-[10px] uppercase\">Accountant</div>\n            </div>\n          </div>\n\n          <div className=\"mt-12 text-[9px] text-gray-400 text-center border-t pt-2 italic\">\n            This is a computer generated voucher for US TRADERS. No signature required if stamped.\n          </div>\n\n          <div className=\"flex gap-3 mt-10 print:hidden justify-center\">\n            <button onClick={printVoucher} className=\"bg-black text-white px-8 py-2 font-bold hover:bg-gray-800 transition-all shadow-md\">\n              Print Now\n            </button>\n            <button onClick={sendWhatsApp} className=\"bg-green-600 text-white px-8 py-2 font-bold hover:bg-green-700 transition-all shadow-md\">\n              WhatsApp\n            </button>\n            <button onClick={() => { setVoucher(null); resetForm(); }} className=\"bg-white text-black border-2 border-black px-8 py-2 font-bold hover:bg-gray-100\">\n              New Entry\n            </button>\n          </div>\n        </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\credit-note\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\crm\\contacts\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchContacts'. Either include it or remove the dependency array.","line":32,"column":6,"nodeType":"ArrayExpression","endLine":32,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [fetchContacts, filterType]","fix":{"range":[726,738],"text":"[fetchContacts, filterType]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\n\r\ninterface Contact {\r\n  id: string;\r\n  name: string;\r\n  email?: string;\r\n  phone: string;\r\n  company: string;\r\n  position?: string;\r\n  type: string;\r\n  isActive: boolean;\r\n}\r\n\r\nexport default function CrmContactsPage() {\r\n  const [contacts, setContacts] = useState<Contact[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [editing, setEditing] = useState<string | null>(null);\r\n  const [filterType, setFilterType] = useState(\"ALL\");\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    email: \"\",\r\n    phone: \"\",\r\n    company: \"\",\r\n    position: \"\",\r\n    type: \"CUSTOMER\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchContacts();\r\n  }, [filterType]);\r\n\r\n  const fetchContacts = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const url =\r\n        filterType === \"ALL\"\r\n          ? \"/api/crm/contacts\"\r\n          : `/api/crm/contacts?type=${filterType}`;\r\n      const response = await fetch(url);\r\n      if (!response.ok) {\r\n        throw new Error(\"Failed to fetch contacts\");\r\n      }\r\n      const data = await response.json();\r\n      setContacts(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching contacts:\", error);\r\n      setContacts([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      const url = editing\r\n        ? `/api/crm/contacts?id=${editing}`\r\n        : \"/api/crm/contacts\";\r\n      const method = editing ? \"PUT\" : \"POST\";\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      if (response.ok) {\r\n        fetchContacts();\r\n        resetForm();\r\n      } else {\r\n        const error = await response.json();\r\n        alert(error.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving contact:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm(\"Are you sure you want to delete this contact?\")) return;\r\n\r\n    try {\r\n      await fetch(`/api/crm/contacts?id=${id}`, { method: \"DELETE\" });\r\n      fetchContacts();\r\n    } catch (error) {\r\n      console.error(\"Error deleting contact:\", error);\r\n    }\r\n  };\r\n\r\n  const handleEdit = (contact: Contact) => {\r\n    setEditing(contact.id);\r\n    setFormData({\r\n      name: contact.name,\r\n      email: contact.email || \"\",\r\n      phone: contact.phone,\r\n      company: contact.company,\r\n      position: contact.position || \"\",\r\n      type: contact.type,\r\n    });\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      name: \"\",\r\n      email: \"\",\r\n      phone: \"\",\r\n      company: \"\",\r\n      position: \"\",\r\n      type: \"CUSTOMER\",\r\n    });\r\n    setEditing(null);\r\n  };\r\n\r\n  const getTypeColor = (type: string) => {\r\n    switch (type) {\r\n      case \"CUSTOMER\":\r\n        return \"bg-blue-100 text-blue-800\";\r\n      case \"SUPPLIER\":\r\n        return \"bg-green-100 text-green-800\";\r\n      case \"LEAD\":\r\n        return \"bg-yellow-100 text-yellow-800\";\r\n      case \"PARTNER\":\r\n        return \"bg-purple-100 text-purple-800\";\r\n      default:\r\n        return \"bg-gray-100 text-gray-800\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gray-50 min-h-screen\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">\r\n          📇 CRM Contacts Management\r\n        </h1>\r\n\r\n        {/* Form */}\r\n        <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Name\"\r\n                value={formData.name}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, name: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"email\"\r\n                placeholder=\"Email\"\r\n                value={formData.email}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, email: e.target.value })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"tel\"\r\n                placeholder=\"Phone\"\r\n                value={formData.phone}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, phone: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Compaany\"\r\n                value={formData.company}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, company: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Position\"\r\n                value={formData.position}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, position: e.target.value })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <select\r\n                value={formData.type}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, type: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              >\r\n                <option value=\"CUSTOMER\">Customer</option>\r\n                <option value=\"SUPPLIER\">Supplier</option>\r\n                <option value=\"LEAD\">Lead</option>\r\n                <option value=\"PARTNER\">Partner</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className=\"flex-1 bg-blue-600 text-white py-2 rounded font-semibold hover:bg-blue-700\"\r\n              >\r\n                {loading\r\n                  ? \"Loading...\"\r\n                  : editing\r\n                    ? \"Update\"\r\n                    : \"Add\"}\r\n              </button>\r\n              {editing && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={resetForm}\r\n                  className=\"px-6 bg-gray-400 text-white py-2 rounded font-semibold hover:bg-gray-500\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n              )}\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* Filter */}\r\n        <div className=\"mb-6 flex gap-2 flex-wrap\">\r\n          {[\"ALL\", \"CUSTOMER\", \"SUPPLIER\", \"LEAD\", \"PARTNER\"].map((type) => (\r\n            <button\r\n              key={type}\r\n              onClick={() => setFilterType(type)}\r\n              className={`px-4 py-2 rounded font-semibold ${\r\n                filterType === type\r\n                  ? \"bg-blue-600 text-white\"\r\n                  : \"bg-white text-gray-700 border\"\r\n              }`}\r\n            >\r\n              {type === \"ALL\" ? \"All\" : type}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Table */}\r\n        {loading ? (\r\n          <div className=\"text-center py-8\">Loading...</div>\r\n        ) : (\r\n          <div className=\"bg-white rounded-lg shadow overflow-x-auto\">\r\n            <table className=\"w-full min-w-[1000px]\">\r\n              <thead className=\"bg-gray-100 border-b\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left\">Name</th>\r\n                  <th className=\"px-6 py-3 text-left\">Phone</th>\r\n                  <th className=\"px-6 py-3 text-left\">Email</th>\r\n                  <th className=\"px-6 py-3 text-left\">Company</th>\r\n                  <th className=\"px-6 py-3 text-left\">Position</th>\r\n                  <th className=\"px-6 py-3 text-left\">Type</th>\r\n                  <th className=\"px-6 py-3 text-center\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {contacts.map((contact) => (\r\n                  <tr key={contact.id} className=\"border-b hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-3 font-semibold\">{contact.name}</td>\r\n                    <td className=\"px-6 py-3\">{contact.phone}</td>\r\n                    <td className=\"px-6 py-3\">{contact.email || \"-\"}</td>\r\n                    <td className=\"px-6 py-3\">{contact.company}</td>\r\n                    <td className=\"px-6 py-3\">{contact.position || \"-\"}</td>\r\n                    <td className=\"px-6 py-3\">\r\n                      <span className={`px-3 py-1 rounded text-sm font-semibold ${getTypeColor(contact.type)}`}>\r\n                        {contact.type}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-6 py-3 text-center space-x-2\">\r\n                      <button\r\n                        onClick={() => handleEdit(contact)}\r\n                        className=\"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600\"\r\n                      >\r\n                        Edit\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDelete(contact.id)}\r\n                        className=\"px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\crm\\interactions\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[426,429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[426,429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchInteractions'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [fetchInteractions, filterType]","fix":{"range":[916,928],"text":"[fetchInteractions, filterType]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\n\r\ninterface Interaction {\r\n  id: string;\r\n  type: string;\r\n  date: string;\r\n  subject: string;\r\n  description: string;\r\n  outcome?: string;\r\n  nextFollowUp?: string;\r\n  contact: { name: string };\r\n}\r\n\r\nexport default function InteractionsPage() {\r\n  const [interactions, setInteractions] = useState<Interaction[]>([]);\r\n  const [contacts, setContacts] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [editing, setEditing] = useState<string | null>(null);\r\n  const [filterType, setFilterType] = useState(\"ALL\");\r\n  const [formData, setFormData] = useState({\r\n    contactId: \"\",\r\n    type: \"CALL\",\r\n    date: new Date().toISOString().split(\"T\")[0],\r\n    subject: \"\",\r\n    description: \"\",\r\n    outcome: \"NEUTRAL\",\r\n    nextFollowUp: \"\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchContacts();\r\n    fetchInteractions();\r\n  }, [filterType]);\r\n\r\n  const fetchContacts = async () => {\r\n    try {\r\n      const response = await fetch(\"/api/crm/contacts\");\r\n      if (!response.ok) {\r\n        throw new Error(\"Failed to fetch contacts\");\r\n      }\r\n      const data = await response.json();\r\n      setContacts(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching contacts:\", error);\r\n      setContacts([]);\r\n    }\r\n  };\r\n\r\n  const fetchInteractions = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const url =\r\n        filterType === \"ALL\"\r\n          ? \"/api/crm/interactions\"\r\n          : `/api/crm/interactions?type=${filterType}`;\r\n      const response = await fetch(url);\r\n      if (!response.ok) {\r\n        throw new Error(\"Failed to fetch interactions\");\r\n      }\r\n      const data = await response.json();\r\n      setInteractions(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching interactions:\", error);\r\n      setInteractions([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      const url = editing\r\n        ? `/api/crm/interactions?id=${editing}`\r\n        : \"/api/crm/interactions\";\r\n      const method = editing ? \"PUT\" : \"POST\";\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      if (response.ok) {\r\n        fetchInteractions();\r\n        resetForm();\r\n      } else {\r\n        const error = await response.json();\r\n        alert(error.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving interaction:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm(\"Are you sure you want to delete this interaction?\")) return;\r\n\r\n    try {\r\n      await fetch(`/api/crm/interactions?id=${id}`, { method: \"DELETE\" });\r\n      fetchInteractions();\r\n    } catch (error) {\r\n      console.error(\"Error deleting interaction:\", error);\r\n    }\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      contactId: \"\",\r\n      type: \"CALL\",\r\n      date: new Date().toISOString().split(\"T\")[0],\r\n      subject: \"\",\r\n      description: \"\",\r\n      outcome: \"NEUTRAL\",\r\n      nextFollowUp: \"\",\r\n    });\r\n    setEditing(null);\r\n  };\r\n\r\n  const types = [\"CALL\", \"EMAIL\", \"MEETING\", \"MESSAGE\", \"VISIT\"];\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gray-50 min-h-screen\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">\r\n          📞 CRM Interaction History\r\n        </h1>\r\n\r\n        {/* Form */}\r\n        <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n              <select\r\n                value={formData.contactId}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, contactId: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              >\r\n                <option value=\"\">Select Contact</option>\r\n                {contacts.map((contact) => (\r\n                  <option key={contact.id} value={contact.id}>\r\n                    {contact.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n\r\n              <select\r\n                value={formData.type}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, type: e.target.value })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              >\r\n                {types.map((type) => (\r\n                  <option key={type} value={type}>\r\n                    {type}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n\r\n              <input\r\n                type=\"date\"\r\n                value={formData.date}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, date: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n\r\n              <select\r\n                value={formData.outcome}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, outcome: e.target.value })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              >\r\n                <option value=\"POSITIVE\">Positive</option>\r\n                <option value=\"NEUTRAL\">Neutral</option>\r\n                <option value=\"NEGATIVE\">Negative</option>\r\n              </select>\r\n            </div>\r\n\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Subject\"\r\n              value={formData.subject}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, subject: e.target.value })\r\n              }\r\n              required\r\n              className=\"w-full px-3 py-2 border rounded\"\r\n            />\r\n\r\n            <textarea\r\n              placeholder=\"Description\"\r\n              value={formData.description}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, description: e.target.value })\r\n              }\r\n              className=\"w-full px-3 py-2 border rounded\"\r\n              rows={3}\r\n            />\r\n\r\n            <input\r\n              type=\"date\"\r\n              placeholder=\"Next Follow-up Date\"\r\n              value={formData.nextFollowUp}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, nextFollowUp: e.target.value })\r\n              }\r\n              className=\"w-full px-3 py-2 border rounded\"\r\n            />\r\n\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className=\"flex-1 bg-blue-600 text-white py-2 rounded font-semibold hover:bg-blue-700\"\r\n              >\r\n                {loading\r\n                  ? \"Loading...\"\r\n                  : editing\r\n                    ? \"Update\"\r\n                    : \"Add\"}\r\n              </button>\r\n              {editing && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={resetForm}\r\n                  className=\"px-6 bg-gray-400 text-white py-2 rounded font-semibold hover:bg-gray-500\"\r\n                >\r\n                 Cancel\r\n                </button>\r\n              )}\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* Filter */}\r\n        <div className=\"mb-6 flex gap-2 flex-wrap\">\r\n          {[\"ALL\", ...types].map((type) => (\r\n            <button\r\n              key={type}\r\n              onClick={() => setFilterType(type)}\r\n              className={`px-4 py-2 rounded font-semibold ${\r\n                filterType === type\r\n                  ? \"bg-blue-600 text-white\"\r\n                  : \"bg-white text-gray-700 border\"\r\n              }`}\r\n            >\r\n              {type === \"ALL\" ? \"All\" : type}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Table */}\r\n        {loading ? (\r\n          <div className=\"text-center py-8\">Loading...</div>\r\n        ) : (\r\n          <div className=\"bg-white rounded-lg shadow overflow-x-auto\">\r\n            <table className=\"w-full min-w-[1000px]\">\r\n              <thead className=\"bg-gray-100 border-b\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left\">Name</th>\r\n                  <th className=\"px-6 py-3 text-left\">Type</th>\r\n                  <th className=\"px-6 py-3 text-left\">Subject</th>\r\n                  <th className=\"px-6 py-3 text-left\">Date</th>\r\n                  <th className=\"px-6 py-3 text-left\">Outcome</th>\r\n                  <th className=\"px-6 py-3 text-left\">Next Follow-up</th>\r\n                  <th className=\"px-6 py-3 text-center\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {interactions.map((interaction) => (\r\n                  <tr key={interaction.id} className=\"border-b hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-3 font-semibold\">\r\n                      {interaction.contact.name}\r\n                    </td>\r\n                    <td className=\"px-6 py-3\">{interaction.type}</td>\r\n                    <td className=\"px-6 py-3\">{interaction.subject}</td>\r\n                    <td className=\"px-6 py-3\">\r\n                      {new Date(interaction.date).toLocaleDateString(\"ur-PK\")}\r\n                    </td>\r\n                    <td className=\"px-6 py-3\">\r\n                      <span\r\n                        className={`px-2 py-1 rounded text-sm font-semibold ${\r\n                          interaction.outcome === \"POSITIVE\"\r\n                            ? \"bg-green-100 text-green-800\"\r\n                            : interaction.outcome === \"NEGATIVE\"\r\n                              ? \"bg-red-100 text-red-800\"\r\n                              : \"bg-gray-100 text-gray-800\"\r\n                        }`}\r\n                      >\r\n                        {interaction.outcome}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-6 py-3\">\r\n                      {interaction.nextFollowUp\r\n                        ? new Date(interaction.nextFollowUp).toLocaleDateString(\r\n                            \"en-PK\"\r\n                          )\r\n                        : \"-\"}\r\n                    </td>\r\n                    <td className=\"px-6 py-3 text-center space-x-2\">\r\n                      <button\r\n                        onClick={() => setEditing(interaction.id)}\r\n                        className=\"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600\"\r\n                      >\r\n                        Edit\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDelete(interaction.id)}\r\n                        className=\"px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600\"\r\n                      >\r\n                       Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\crm\\opportunities\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[453,456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[453,456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchOpportunities'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOpportunities, filterStage]","fix":{"range":[911,924],"text":"[fetchOpportunities, filterStage]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\n\r\ninterface Opportunity {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  value: number;\r\n  probability: number;\r\n  stage: string;\r\n  expectedCloseDate: string;\r\n  contact: { name: string; company: string };\r\n}\r\n\r\nexport default function OpportunitiesPage() {\r\n  const [opportunities, setOpportunities] = useState<Opportunity[]>([]);\r\n  const [contacts, setContacts] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [editing, setEditing] = useState<string | null>(null);\r\n  const [filterStage, setFilterStage] = useState(\"ALL\");\r\n  const [formData, setFormData] = useState({\r\n    contactId: \"\",\r\n    title: \"\",\r\n    description: \"\",\r\n    value: 0,\r\n    probability: 50,\r\n    stage: \"LEAD\",\r\n    expectedCloseDate: \"\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchContacts();\r\n    fetchOpportunities();\r\n  }, [filterStage]);\r\n\r\n  const fetchContacts = async () => {\r\n    try {\r\n      const response = await fetch(\"/api/crm/contacts\");\r\n      if (!response.ok) {\r\n        throw new Error(\"Failed to fetch contacts\");\r\n      }\r\n      const data = await response.json();\r\n      setContacts(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching contacts:\", error);\r\n      setContacts([]);\r\n    }\r\n  };\r\n\r\n  const fetchOpportunities = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const url =\r\n        filterStage === \"ALL\"\r\n          ? \"/api/crm/opportunities\"\r\n          : `/api/crm/opportunities?stage=${filterStage}`;\r\n      const response = await fetch(url);\r\n      if (!response.ok) {\r\n        throw new Error(\"Failed to fetch opportunities\");\r\n      }\r\n      const data = await response.json();\r\n      setOpportunities(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching opportunities:\", error);\r\n      setOpportunities([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      const url = editing\r\n        ? `/api/crm/opportunities?id=${editing}`\r\n        : \"/api/crm/opportunities\";\r\n      const method = editing ? \"PUT\" : \"POST\";\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          ...formData,\r\n          value: parseFloat(formData.value.toString()),\r\n          probability: parseInt(formData.probability.toString()),\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        fetchOpportunities();\r\n        resetForm();\r\n      } else {\r\n        const error = await response.json();\r\n        alert(error.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving opportunity:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm(\"Are you sure you want to delete this opportunity?\")) return;\r\n\r\n    try {\r\n      await fetch(`/api/crm/opportunities?id=${id}`, { method: \"DELETE\" });\r\n      fetchOpportunities();\r\n    } catch (error) {\r\n      console.error(\"Error deleting opportunity:\", error);\r\n    }\r\n  };\r\n\r\n  const handleEdit = (opp: Opportunity) => {\r\n    setEditing(opp.id);\r\n    setFormData({\r\n      contactId: opp.contact.name,\r\n      title: opp.title,\r\n      description: opp.description,\r\n      value: opp.value,\r\n      probability: opp.probability,\r\n      stage: opp.stage,\r\n      expectedCloseDate: opp.expectedCloseDate.split(\"T\")[0],\r\n    });\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      contactId: \"\",\r\n      title: \"\",\r\n      description: \"\",\r\n      value: 0,\r\n      probability: 50,\r\n      stage: \"LEAD\",\r\n      expectedCloseDate: \"\",\r\n    });\r\n    setEditing(null);\r\n  };\r\n\r\n  const stages = [\"LEAD\", \"PROSPECT\", \"NEGOTIATION\", \"CLOSE\", \"WON\", \"LOST\"];\r\n  const totalValue = opportunities.reduce((sum, opp) => sum + opp.value, 0);\r\n  const weightedValue = opportunities.reduce(\r\n    (sum, opp) => sum + (opp.value * opp.probability) / 100,\r\n    0\r\n  );\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gray-50 min-h-screen\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">\r\n          💼 CRM Opportunities\r\n        </h1>\r\n\r\n        {/* Stats */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\r\n          <div className=\"bg-white p-4 rounded-lg shadow\">\r\n            <div className=\"text-gray-600 text-sm\">Total Opportunities</div>\r\n            <div className=\"text-2xl font-bold text-blue-600\">\r\n              {opportunities.length}\r\n            </div>\r\n          </div>\r\n          <div className=\"bg-white p-4 rounded-lg shadow\">\r\n            <div className=\"text-gray-600 text-sm\">Total Value</div>\r\n            <div className=\"text-2xl font-bold text-green-600\">\r\n              {totalValue.toLocaleString()}\r\n            </div>\r\n          </div>\r\n          <div className=\"bg-white p-4 rounded-lg shadow\">\r\n            <div className=\"text-gray-600 text-sm\">Weighted Value</div>\r\n            <div className=\"text-2xl font-bold text-purple-600\">\r\n              {weightedValue.toLocaleString()}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Form */}\r\n        <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n              <select\r\n                value={formData.contactId}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, contactId: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              >\r\n                <option value=\"\">Select Contact</option>\r\n                {contacts.map((contact) => (\r\n                  <option key={contact.id} value={contact.id}>\r\n                    {contact.name} - {contact.company}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Title\"\r\n                value={formData.title}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, title: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n\r\n              <input\r\n                type=\"number\"\r\n                placeholder=\"Value\"\r\n                step=\"0.01\"\r\n                value={formData.value}\r\n                onChange={(e) =>\r\n                  setFormData({\r\n                    ...formData,\r\n                    value: parseFloat(e.target.value),\r\n                  })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n            </div>\r\n\r\n            <textarea\r\n              placeholder=\"Description\"\r\n              value={formData.description}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, description: e.target.value })\r\n              }\r\n              className=\"w-full px-3 py-2 border rounded\"\r\n            />\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n              <select\r\n                value={formData.stage}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, stage: e.target.value })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              >\r\n                {stages.map((stage) => (\r\n                  <option key={stage} value={stage}>\r\n                    {stage}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n\r\n              <input\r\n                type=\"number\"\r\n                placeholder=\"Chances (%)\"\r\n                min=\"0\"\r\n                max=\"100\"\r\n                value={formData.probability}\r\n                onChange={(e) =>\r\n                  setFormData({\r\n                    ...formData,\r\n                    probability: parseInt(e.target.value),\r\n                  })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n\r\n              <input\r\n                type=\"date\"\r\n                value={formData.expectedCloseDate}\r\n                onChange={(e) =>\r\n                  setFormData({\r\n                    ...formData,\r\n                    expectedCloseDate: e.target.value,\r\n                  })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded col-span-2\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className=\"flex-1 bg-blue-600 text-white py-2 rounded font-semibold hover:bg-blue-700\"\r\n              >\r\n                {loading\r\n                  ? \"Loading...\"\r\n                  : editing\r\n                    ? \"Update\"\r\n                    : \"Add\"}\r\n              </button>\r\n              {editing && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={resetForm}\r\n                  className=\"px-6 bg-gray-400 text-white py-2 rounded font-semibold hover:bg-gray-500\"\r\n                >\r\n                 Cancel\r\n                </button>\r\n              )}\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* Filter */}\r\n        <div className=\"mb-6 flex gap-2 flex-wrap\">\r\n          {[\"ALL\", ...stages].map((stage) => (\r\n            <button\r\n              key={stage}\r\n              onClick={() => setFilterStage(stage)}\r\n              className={`px-4 py-2 rounded font-semibold ${\r\n                filterStage === stage\r\n                  ? \"bg-blue-600 text-white\"\r\n                  : \"bg-white text-gray-700 border\"\r\n              }`}\r\n            >\r\n              {stage === \"ALL\" ? \"All\" : stage}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Table */}\r\n        {loading ? (\r\n          <div className=\"text-center py-8\">Loading...</div>\r\n        ) : (\r\n          <div className=\"bg-white rounded-lg shadow overflow-x-auto\">\r\n            <table className=\"w-full min-w-[1000px]\">\r\n              <thead className=\"bg-gray-100 border-b\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left\">Title</th>\r\n                  <th className=\"px-6 py-3 text-left\">Contact</th>\r\n                  <th className=\"px-6 py-3 text-left\">Value</th>\r\n                  <th className=\"px-6 py-3 text-left\">Chances (%)</th>\r\n                  <th className=\"px-6 py-3 text-left\">Stage</th>\r\n                  <th className=\"px-6 py-3 text-left\">Expected Close Date</th>\r\n                  <th className=\"px-6 py-3 text-center\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {opportunities.map((opp) => (\r\n                  <tr key={opp.id} className=\"border-b hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-3 font-semibold\">{opp.title}</td>\r\n                    <td className=\"px-6 py-3\">\r\n                      {opp.contact.name} ({opp.contact.company})\r\n                    </td>\r\n                    <td className=\"px-6 py-3\">\r\n                      {opp.value.toLocaleString()}\r\n                    </td>\r\n                    <td className=\"px-6 py-3\">\r\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                        <div\r\n                          className=\"bg-blue-600 h-2 rounded-full\"\r\n                          style={{ width: `${opp.probability}%` }}\r\n                        ></div>\r\n                      </div>\r\n                      <span className=\"text-xs\">{opp.probability}%</span>\r\n                    </td>\r\n                    <td className=\"px-6 py-3\">{opp.stage}</td>\r\n                    <td className=\"px-6 py-3\">\r\n                      {new Date(opp.expectedCloseDate).toLocaleDateString(\r\n                        \"ur-PK\"\r\n                      )}\r\n                    </td>\r\n                    <td className=\"px-6 py-3 text-center space-x-2\">\r\n                      <button\r\n                        onClick={() => handleEdit(opp)}\r\n                        className=\"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600\"\r\n                      >\r\n                        Edit\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDelete(opp.id)}\r\n                        className=\"px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\crv\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[798,801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[798,801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1321,1324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1321,1324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadAccounts', 'loadVouchers', and 'user'. Either include them or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadAccounts, loadVouchers, user]","fix":{"range":[1670,1672],"text":"[loadAccounts, loadVouchers, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2710,2713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2710,2713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4642,4645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4642,4645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":221,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":221,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { toast } from \"react-hot-toast\";\n\ntype Account = {\n  id: string;\n  name: string;\n  phone?: string | null;\n  partyType?: string | null;\n};\n\ntype Voucher = {\n  id: string;\n  voucherNo: string;\n  date: string;\n  narration: string;\n  accountName: string;\n  accountId: string;\n  amount: number;\n  paymentMode: string;\n  paymentAccountId: string;\n};\ntype BankAccount = {\n  id: string;\n  accountId?: string | null;\n  bankName?: string;\n  accountNo?: string;\n  accountName?: string;\n};\n\n\nexport default function CRVPage() {\n  const today = new Date().toISOString().split(\"T\")[0];\n\n  const [customers, setCustomers] = useState<Account[]>([]);\n  const [bankAccounts, setBankAccounts] = useState<any[]>([]);\n  const [vouchers, setVouchers] = useState<Voucher[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<Voucher | null>(null);\n\n  const [accountId, setAccountId] = useState(\"\");\n  const [bankAccountId, setBankAccountId] = useState(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [date, setDate] = useState(today);\n  const [narration, setNarration] = useState(\"\");\n  const [voucher, setVoucher] = useState<any>(null);\n  const [saving, setSaving] = useState(false);\n  const [selectedName, setSelectedName] = useState(\"\");\n  const [selectedPhone, setSelectedPhone] = useState(\"\");\n\n  const user = getCurrentUser();\n\n  useEffect(() => {\n    if (!user) {\n      toast.error(\"Session expired\");\n      return;\n    }\n\n    loadVouchers();\n    loadAccounts();\n  }, []);\n\n  async function loadVouchers() {\n    try {\n      const res = await fetch(\"/api/crv\", {\n        headers: { \"x-user-role\": user?.role || \"\" },\n      });\n      const data = await res.json();\n      if (Array.isArray(data)) {\n        setVouchers(data);\n      }\n    } catch (e) {\n      console.error(\"Load vouchers error:\", e);\n    }\n  }\n\n  async function loadAccounts() {\n    Promise.all([\n      fetch(\"/api/accounts\", {\n        method: \"GET\",\n        headers: { \"x-user-role\": user?.role || \"\" },\n      }),\n      fetch(\"/api/bank-accounts\", { method: \"GET\" }),\n    ])\n      .then(async ([accountsRes, banksRes]) => {\n        const accountsData = await accountsRes.json();\n        const banksData = await banksRes.json();\n\n        if (Array.isArray(accountsData)) {\n          // CRV میں CUSTOMER + BANKS دونوں ہونے چاہیے\n          const filtered = accountsData.filter(a => \n            a.partyType === \"CUSTOMER\" || a.partyType === \"BANKS\" || !a.partyType\n          );\n          setCustomers(filtered);\n        }\n\n        const allBanks: any[] = [];\n        // Removed manual addition of banks from accountsData as banksData already includes them\n\n        if (Array.isArray(banksData)) {\n  banksData.forEach((bank: BankAccount) => {\n    allBanks.push({\n      id: `BANK-${bank.id}`,\n      rawId: bank.id,\n      source: \"BANK\",\n      name: bank.accountName || `${bank.bankName} - ${bank.accountNo}`,\n    });\n  });\n}\n\n        setBankAccounts(allBanks);\n      })\n      .catch(err => {\n        console.error(\"Accounts load error:\", err);\n      });\n  }\n\n  async function saveCRV() {\n    if (!accountId) {\n      toast.error(\"Customer select karein\");\n      return;\n    }\n\n    const amountNum = Number(amount);\n    if (!amount || amount.trim() === \"\" || isNaN(amountNum) || amountNum <= 0) {\n      toast.error(\"Valid amount enter karein (0 se zyada)\");\n      return;\n    }\n\n    setSaving(true);\n\n    try {\n      const url = \"/api/crv\";\n      const method = editing ? \"PUT\" : \"POST\";\n\n      const res = await fetch(url, {\n        method,\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"\",\n        },\n        body: JSON.stringify(editing ? {\n          id: editing.id,\n          accountId,\n          bankAccountId: bankAccountId || null,\n          paymentMode: bankAccountId ? \"BANK\" : \"CASH\",\n          amount,\n          date,\n          narration,\n        } : {\n          accountId,\n          bankAccountId: bankAccountId || null,\n          paymentMode: bankAccountId ? \"BANK\" : \"CASH\",\n          amount,\n          date,\n          narration,\n        }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        alert(`Error: ${data?.error || \"Save failed\"}`);\n        return;\n      }\n\n      setVoucher(data);\n      alert(editing ? \"CRV updated successfully!\" : \"CRV saved successfully!\");\n      await loadVouchers();\n      resetForm();\n      setShowForm(false);\n      setEditing(null);\n    } catch (e: any) {\n      alert(`Error: ${e.message || \"Failed to save\"}`);\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  function resetForm() {\n    setAccountId(\"\");\n    setBankAccountId(\"\");\n    setAmount(\"\");\n    setNarration(\"\");\n    setSelectedName(\"\");\n    setSelectedPhone(\"\");\n  }\n\n  function startEdit(v: Voucher) {\n    setEditing(v);\n    setAccountId(v.accountId);\n    setBankAccountId(v.paymentAccountId || \"\");\n    setAmount(v.amount.toString());\n    setDate(v.date);\n    setNarration(v.narration);\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deleteVoucher(id: string) {\n    if (!confirm(\"Are you sure you want to delete this CRV?\")) {\n      return;\n    }\n\n    try {\n      const res = await fetch(`/api/crv?id=${id}`, {\n        method: \"DELETE\",\n        headers: { \"x-user-role\": user?.role || \"\" },\n      });\n\n      if (res.ok) {\n        alert(\"CRV deleted successfully!\");\n        await loadVouchers();\n      } else {\n        const data = await res.json();\n        alert(data.error || \"Delete failed\");\n      }\n    } catch (e) {\n      alert(\"Delete failed\");\n    }\n  }\n\n  function printVoucher() {\n    window.print();\n  }\n\n  function sendWhatsApp() {\n    const phoneNo = voucher?.phone || selectedPhone;\n    if (!phoneNo) {\n      toast.error(\"Party ka phone number nahi mila\");\n      return;\n    }\n\n    const phone = String(phoneNo).replace(/\\D/g, \"\");\n    const finalPhone = phone.startsWith('0') ? '92' + phone.substring(1) : phone;\n\n    if (finalPhone.length < 10) {\n      toast.error(\"Phone number theek nahi hai\");\n      return;\n    }\n\n    const msg =\n      `*Cash Receipt Voucher*\\n\\n` +\n      `*Received From:* ${voucher.accountName || selectedName}\\n` +\n      `*Amount:* Rs. ${Number(voucher.amount || amount || 0).toLocaleString()}/-\\n` +\n      `*Date:* ${voucher.date?.split('T')[0] || date}\\n` +\n      `*Voucher No:* ${voucher.voucherNo}\\n\\n` +\n      `_US TRADERS_`;\n\n    window.open(\n      `https://wa.me/${finalPhone}?text=${encodeURIComponent(msg)}`,\n      \"_blank\"\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-2xl font-bold\">Cash Receipt Voucher (CRV)</h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => {\n              setShowList(!showList);\n              setShowForm(!showForm);\n              setEditing(null);\n            }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => {\n              setShowForm(true);\n              setShowList(false);\n              setEditing(null);\n              resetForm();\n            }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New CRV\n          </button>\n        </div>\n      </div>\n\n      {/* VOUCHER LIST */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-x-auto\">\n          <table className=\"w-full text-sm min-w-[800px]\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">Voucher No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Received From</th>\n                <th className=\"p-3 text-right\">Amount</th>\n                <th className=\"p-3 text-left\">Payment Mode</th>\n                <th className=\"p-3 text-left\">Narration</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {vouchers.length === 0 ? (\n                <tr>\n                  <td colSpan={7} className=\"p-4 text-center text-gray-400\">\n                    No CRVs found\n                  </td>\n                </tr>\n              ) : (\n                vouchers.map((v) => (\n                  <tr key={v.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">{v.voucherNo}</td>\n                    <td className=\"p-3\">{v.date}</td>\n                    <td className=\"p-3\">{v.accountName}</td>\n                    <td className=\"p-3 text-right\">{v.amount.toLocaleString()}</td>\n                    <td className=\"p-3\">{v.paymentMode}</td>\n                    <td className=\"p-3\">{v.narration}</td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(v)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deleteVoucher(v.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <div className=\"border p-4 space-y-3 bg-white print:hidden\">\n          <h2 className=\"text-xl font-bold\">\n            {editing ? \"Edit CRV\" : \"New CRV\"}\n          </h2>\n\n          <select\n            className=\"border px-3 py-2 w-full\"\n            value={accountId}\n            onChange={(e) => {\n              const id = e.target.value;\n              setAccountId(id);\n              const acc = customers.find(c => c.id === id);\n              setSelectedName(acc?.name || \"\");\n              setSelectedPhone(acc?.phone || \"\");\n            }}\n          >\n            <option value=\"\">Received From (Customer/Bank)</option>\n            {customers.map(c => (\n              <option key={c.id} value={c.id}>\n                {c.name}\n              </option>\n            ))}\n          </select>\n\n          <div>\n            <label className=\"block text-sm font-semibold mb-1\">Payment Method</label>\n            <select\n              className=\"border px-3 py-2 w-full\"\n              value={bankAccountId}\n              onChange={(e) => setBankAccountId(e.target.value)}\n            >\n              <option value=\"\">Cash</option>\n              {bankAccounts.map(bank => (\n               <option key={bank.id} value={bank.rawId}>\n  {bank.name}\n</option>\n\n              ))}\n            </select>\n          </div>\n\n          <input\n            className=\"border px-3 py-2 w-full\"\n            placeholder=\"Amount\"\n            type=\"number\"\n            step=\"0.01\"\n            value={amount}\n            onChange={(e) => setAmount(e.target.value)}\n          />\n\n          <input\n            type=\"date\"\n            className=\"border px-3 py-2 w-full\"\n            value={date}\n            onChange={(e) => setDate(e.target.value)}\n          />\n\n          <textarea\n            className=\"border px-3 py-2 w-full\"\n            placeholder=\"Narration\"\n            value={narration}\n            onChange={(e) => setNarration(e.target.value)}\n          />\n\n          <div className=\"flex gap-2\">\n            <button\n              onClick={saveCRV}\n              disabled={saving}\n              className=\"bg-black text-white px-4 py-2 flex-1\"\n            >\n              {saving ? \"Saving...\" : editing ? \"Update CRV\" : \"Save CRV\"}\n            </button>\n            <button\n              onClick={() => {\n                setShowForm(false);\n                setEditing(null);\n                resetForm();\n              }}\n              className=\"bg-gray-600 text-white px-4 py-2\"\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* PRINT PREVIEW */}\n      {voucher && (\n        <div className=\"overflow-x-auto\">\n          <div className=\"invoice-print max-w-[210mm] mx-auto bg-white p-8 border-2 border-black text-black shadow-lg min-w-[700px]\">\n            <div className=\"flex justify-between items-start border-b-4 border-black pb-4 mb-8\">\n            <div>\n              <h1 className=\"text-4xl font-black italic tracking-tighter uppercase\">US TRADERS</h1>\n              <p className=\"text-[10px] font-bold tracking-[3px] text-gray-600 uppercase\">Industrial Goods & Services</p>\n            </div>\n            <div className=\"text-right\">\n              <h2 className=\"text-2xl font-black uppercase underline decoration-2 underline-offset-4\">\n                Receipt Voucher\n              </h2>\n              <div className=\"mt-2 text-sm font-bold space-y-1\">\n                <p>No: <span className=\"font-mono\">{voucher.voucherNo}</span></p>\n                <p>Date: {voucher.date?.split('T')[0] || date}</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-8 my-10\">\n            <div className=\"flex items-end gap-4 border-b border-gray-300 pb-2\">\n              <span className=\"text-xs font-black uppercase w-32 shrink-0\">Received From:</span>\n              <span className=\"text-xl font-bold uppercase flex-1 border-b-2 border-black px-2\">\n                {voucher.accountName || selectedName}\n              </span>\n            </div>\n\n            <div className=\"flex items-end gap-4 border-b border-gray-300 pb-2\">\n              <span className=\"text-xs font-black uppercase w-32 shrink-0\">Amount (PKR):</span>\n              <span className=\"text-xl font-bold italic flex-1 border-b-2 border-black px-2\">\n                Rs. {Number(voucher.amount || amount || 0).toLocaleString()}/-\n              </span>\n            </div>\n\n            <div className=\"flex items-start gap-4 border-b border-gray-300 pb-2\">\n              <span className=\"text-xs font-black uppercase w-32 shrink-0\">Description:</span>\n              <span className=\"text-sm font-medium flex-1 border-b border-black px-2 italic\">\n                {narration || \"Official transaction recorded.\"}\n              </span>\n            </div>\n          </div>\n\n          <div className=\"mt-16 flex justify-between items-end px-2\">\n            <div className=\"bg-gray-100 border-4 border-black p-4 flex flex-col min-w-[200px]\">\n              <span className=\"text-[10px] font-black uppercase border-b border-black mb-1\">Net Amount Rec</span>\n              <span className=\"text-3xl font-black italic\">\n                {Number(voucher.amount || amount || 0).toLocaleString()}\n              </span>\n            </div>\n            <div className=\"flex gap-12\">\n              <div className=\"text-center w-32 border-t-2 border-black mt-12 pt-1 font-bold text-[10px] uppercase\">Receiver Sign</div>\n              <div className=\"text-center w-32 border-t-2 border-black mt-12 pt-1 font-bold text-[10px] uppercase\">Accountant</div>\n            </div>\n          </div>\n\n          <div className=\"flex gap-3 mt-10 print:hidden justify-center\">\n            <button onClick={printVoucher} className=\"bg-black text-white px-8 py-2 font-bold hover:bg-gray-800 transition-all shadow-md\">\n              Print Now\n            </button>\n            <button onClick={sendWhatsApp} className=\"bg-green-600 text-white px-8 py-2 font-bold hover:bg-green-700 transition-all shadow-md\">\n              WhatsApp\n            </button>\n            <button onClick={() => { setVoucher(null); resetForm(); }} className=\"bg-white text-black border-2 border-black px-8 py-2 font-bold hover:bg-gray-100\">\n              New Entry\n            </button>\n          </div>\n        </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\currencies\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[465,468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[465,468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\n\r\ninterface Currency {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n  symbol: string;\r\n  exchangeRate: number;\r\n  isActive: boolean;\r\n}\r\n\r\nexport default function CurrenciesPage() {\r\n  const [currencies, setCurrencies] = useState<Currency[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [editing, setEditing] = useState<string | null>(null);\r\n  const [user, setUser] = useState<any>(null);\r\n  const [formData, setFormData] = useState({\r\n    code: \"\",\r\n    name: \"\",\r\n    symbol: \"\",\r\n    exchangeRate: 1,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const stored = localStorage.getItem(\"user\");\r\n    if (stored) {\r\n      try {\r\n        setUser(JSON.parse(stored));\r\n      } catch (e) {\r\n        console.error(\"Failed to parse user\", e);\r\n      }\r\n    }\r\n    fetchCurrencies();\r\n  }, []);\r\n\r\n  const fetchCurrencies = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await fetch(\"/api/currencies\");\r\n      if (!response.ok) {\r\n        throw new Error(\"Failed to fetch currencies\");\r\n      }\r\n      const data = await response.json();\r\n      // Ensure data is an array\r\n      setCurrencies(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching currencies:\", error);\r\n      setCurrencies([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!user) {\r\n      alert(\"Please login first\");\r\n      return;\r\n    }\r\n    setLoading(true);\r\n\r\n    try {\r\n      const url = editing\r\n        ? `/api/currencies?id=${editing}`\r\n        : \"/api/currencies\";\r\n      const method = editing ? \"PUT\" : \"POST\";\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: { \r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": user.role || \"\",\r\n          \"x-user-id\": user.id || \"\",\r\n        },\r\n        body: JSON.stringify({\r\n          ...formData,\r\n          exchangeRate: parseFloat(formData.exchangeRate.toString()),\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        alert(editing ? \"Currency updated!\" : \"Currency added!\");\r\n        fetchCurrencies();\r\n        setFormData({ code: \"\", name: \"\", symbol: \"\", exchangeRate: 1 });\r\n        setEditing(null);\r\n      } else {\r\n        const data = await response.json();\r\n        alert(\"Error: \" + (data.error || \"Failed to save\"));\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving currency:\", error);\r\n      alert(\"Network error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm(\"Are you sure you want to delete this currency?\")) return;\r\n    if (!user) return alert(\"Please login first\");\r\n\r\n    try {\r\n      const response = await fetch(`/api/currencies?id=${id}`, { \r\n        method: \"DELETE\",\r\n        headers: {\r\n          \"x-user-role\": user.role || \"\",\r\n          \"x-user-id\": user.id || \"\",\r\n        }\r\n      });\r\n      \r\n      if (response.ok) {\r\n        alert(\"Currency deleted\");\r\n        fetchCurrencies();\r\n      } else {\r\n        const data = await response.json();\r\n        alert(\"Error: \" + (data.error || \"Failed to delete\"));\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error deleting currency:\", error);\r\n      alert(\"Network error\");\r\n    }\r\n  };\r\n\r\n  const handleEdit = (currency: Currency) => {\r\n    setEditing(currency.id);\r\n    setFormData({\r\n      code: currency.code,\r\n      name: currency.name,\r\n      symbol: currency.symbol,\r\n      exchangeRate: currency.exchangeRate,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gray-50 min-h-screen\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">\r\n          💱 Currency Management\r\n        </h1>\r\n\r\n        {/* Form */}\r\n        <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Code (e.g., USD)\"\r\n                value={formData.code}\r\n                onChange={(e) =>\r\n                  setFormData({\r\n                    ...formData,\r\n                    code: e.target.value.toUpperCase(),\r\n                  })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Name (e.g., US Dollar)\"\r\n                value={formData.name}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, name: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Symbol ($)\"\r\n                value={formData.symbol}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, symbol: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"number\"\r\n                placeholder=\"Exchange Rate\"\r\n                step=\"0.01\"\r\n                value={formData.exchangeRate}\r\n                onChange={(e) =>\r\n                  setFormData({\r\n                    ...formData,\r\n                    exchangeRate: parseFloat(e.target.value),\r\n                  })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className=\"flex-1 bg-blue-600 text-white py-2 rounded font-semibold hover:bg-blue-700\"\r\n              >\r\n                {loading\r\n                  ? \"Loading...\"\r\n                  : editing\r\n                    ? \"Update\"\r\n                    : \"Add\"}\r\n              </button>\r\n              {editing && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => {\r\n                    setEditing(null);\r\n                    setFormData({\r\n                      code: \"\",\r\n                      name: \"\",\r\n                      symbol: \"\",\r\n                      exchangeRate: 1,\r\n                    });\r\n                  }}\r\n                  className=\"px-6 bg-gray-400 text-white py-2 rounded font-semibold hover:bg-gray-500\"\r\n                >\r\n                 Cancel\r\n                </button>\r\n              )}\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* Table */}\r\n        {loading ? (\r\n          <div className=\"text-center py-8\">Loading...</div>\r\n        ) : (\r\n          <div className=\"bg-white rounded-lg shadow overflow-x-auto\">\r\n            <table className=\"w-full min-w-[600px]\">\r\n              <thead className=\"bg-gray-100 border-b\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left\">Code</th>\r\n                  <th className=\"px-6 py-3 text-left\">Name</th>\r\n                  <th className=\"px-6 py-3 text-left\">Symbol</th>\r\n                  <th className=\"px-6 py-3 text-left\">Exchange Rate</th>\r\n                  <th className=\"px-6 py-3 text-center\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {currencies.map((currency) => (\r\n                  <tr key={currency.id} className=\"border-b hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-3 font-semibold\">\r\n                      {currency.code}\r\n                    </td>\r\n                    <td className=\"px-6 py-3\">{currency.name}</td>\r\n                    <td className=\"px-6 py-3\">{currency.symbol}</td>\r\n                    <td className=\"px-6 py-3\">\r\n                      {currency.exchangeRate.toFixed(2)}\r\n                    </td>\r\n                    <td className=\"px-6 py-3 text-center space-x-2\">\r\n                      <button\r\n                        onClick={() => handleEdit(currency)}\r\n                        className=\"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600\"\r\n                      >\r\n                        Edit  \r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDelete(currency.id)}\r\n                        className=\"px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600\"\r\n                      >\r\n                       Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\debit-note\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\delivery-challan\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":41,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'authorized' is assigned a value but never used.","line":45,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSearchTerm' is assigned a value but never used.","line":62,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2182,2185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2182,2185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3028,3031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3028,3031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'d' is defined but never used.","line":108,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":108,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadChallans' and 'user'. Either include them or remove the dependency array.","line":113,"column":6,"nodeType":"ArrayExpression","endLine":113,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadChallans, user]","fix":{"range":[3521,3523],"text":"[loadChallans, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7562,7565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7562,7565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":270,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8058,8061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8058,8061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":299,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":299,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":331,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9930,9933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9930,9933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport toast from \"react-hot-toast\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { hasPermission } from \"@/lib/hasPermission\";\nimport { PERMISSIONS } from \"@/lib/permissions\";\nimport { useRouter } from \"next/navigation\";\n\n\ntype Account = { id: string; name: string };\ntype Item = {\n  id: string;\n  name: string;\n  description?: string;\n  availableQty: number;\n};\ntype Row = {\n  itemId: string;\n  name: string;\n  description: string;\n  availableQty: number;\n  qty: number | \"\";\n  rate: number | \"\";\n};\n\ntype DeliveryChallan = {\n  id: string;\n  challanNo: string;\n  date: string;\n  customerId: string;\n  customer?: { name: string };\n  driverName?: string;\n  vehicleNo?: string;\n  remarks?: string;\n  items: Array<{ item: { name: string; description?: string }; qty: number; rate?: number }>;\n  status: string;\n};\n\nexport default function DeliveryChallanPage() {\n  const router = useRouter();\n  const today = new Date().toISOString().slice(0, 10);\n  const user = getCurrentUser();\n\n  const [authorized, setAuthorized] = useState(false);\n  const [loading, setLoading] = useState(true);\n\n  const [customers, setCustomers] = useState<Account[]>([]);\n  const [items, setItems] = useState<Item[]>([]);\n  const [challans, setChallans] = useState<DeliveryChallan[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<DeliveryChallan | null>(null);\n\n  const [challanNo, setChallanNo] = useState(\"\");\n  const [customerId, setCustomerId] = useState(\"\");\n  const [customerName, setCustomerName] = useState(\"\");\n  const [date, setDate] = useState(today);\n  const [driverName, setDriverName] = useState(\"\");\n  const [vehicleNo, setVehicleNo] = useState(\"\");\n  const [remarks, setRemarks] = useState(\"\");\nconst [searchTerm, setSearchTerm] = useState(\"\");\n\n\n  const [rows, setRows] = useState<Row[]>([{\n    itemId: \"\", name: \"\", description: \"\", availableQty: 0, qty: \"\", rate: \"\",\n  }]);\n  const [saving, setSaving] = useState(false);\n  const [preview, setPreview] = useState(false);\n  const [savedChallan, setSavedChallan] = useState<any>(null);\n\n  useEffect(() => {\n    if (!user) {\n      setLoading(false);\n      return;\n    }\n    // Using CREATE_QUOTATION as a proxy permission or if there's a specific one like CREATE_DELIVERY_CHALLAN\n    // Assuming if they can create quotation/invoice, they can create challan.\n    // Ideally we should add CREATE_DELIVERY_CHALLAN to permissions, but for now reuse or check role.\n    if (!hasPermission(user, PERMISSIONS.CREATE_QUOTATION)) { // Fallback permission check\n       // You might want to update permissions lib later\n    }\n    setAuthorized(true);\n    \n    // Load initial data\n    loadChallans();\n    \n    fetch(\"/api/accounts\", {\n      headers: { \"x-user-role\": user.role },\n    })\n      .then(r => r.json())\n      .then(d => {\n        const list = Array.isArray(d) ? d : d.accounts || [];\n        setCustomers(list.filter((a: any) => a.partyType === \"CUSTOMER\"));\n      });\n\n    fetch(\"/api/stock-available-for-sale\")\n      .then(r => r.json())\n      .then(d => setItems(Array.isArray(d) ? d : []));\n\n    fetch(\"/api/delivery-challan\", {\n        headers: {\n            \"x-user-role\": user.role || \"\",\n            \"x-user-id\": user.id || \"\"\n        }\n    })\n    .then(r => r.json())\n    .then(d => {\n        // If there's logic to get nextNo from API, otherwise just handle in state\n    });\n\n    setLoading(false);\n  }, []);\n  const shareOnSMS = () => {\n  const msg = \"Your delivery challan details\";\n  window.open(`sms:?body=${encodeURIComponent(msg)}`);\n};\n\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    function handleKeyPress(e: KeyboardEvent) {\n      if (e.code === \"F7\" || e.key === \"F7\") {\n        e.preventDefault();\n        if (showForm && !preview) {\n          setDate(today);\n          setCustomerId(\"\");\n          setCustomerName(\"\");\n          setDriverName(\"\");\n          setVehicleNo(\"\");\n          setRemarks(\"\");\n        }\n      }\n      if (e.code === \"F8\" || e.key === \"F8\") {\n        e.preventDefault();\n        if (showForm && !preview) {\n          const query = prompt(\"Enter search query (Challan No, Customer Name, etc.):\");\n          if (query) {\n            const foundCustomer = customers.find(c => \n              c.name.toLowerCase().includes(query.toLowerCase())\n            );\n            if (foundCustomer) {\n              setCustomerId(foundCustomer.id);\n              setCustomerName(foundCustomer.name);\n            } else {\n              toast.error(`No customer found matching \"${query}\"`);\n            }\n          }\n        }\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyPress, true);\n    return () => document.removeEventListener(\"keydown\", handleKeyPress, true);\n  }, [today, showForm, preview, customers]);\n\n  async function loadChallans() {\n    try {\n      const res = await fetch(\"/api/delivery-challan\", {\n        headers: {\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        }\n      });\n      const data = await res.json();\n      if (Array.isArray(data)) {\n        setChallans(data);\n      }\n    } catch (e) {\n      console.error(\"Load challans error:\", e);\n    }\n  }\n\n  function addRow() {\n    setRows(r => [\n      ...r,\n      { itemId: \"\", name: \"\", description: \"\", availableQty: 0, qty: \"\", rate: \"\" },\n    ]);\n  }\n\n  function selectItem(index: number, itemId: string) {\n    const item = items.find(i => i.id === itemId);\n    if (!item) return;\n    const copy = [...rows];\n    copy[index] = {\n      ...copy[index],\n      itemId: item.id,\n      name: item.name,\n      description: item.description || \"\",\n      availableQty: item.availableQty,\n      qty: \"\",\n    };\n    setRows(copy);\n  }\n\n  function updateRow(index: number, key: \"qty\" | \"rate\", val: string) {\n    const copy = [...rows];\n    const num = val === \"\" ? \"\" : Number(val);\n    copy[index][key] = num;\n    setRows(copy);\n  }\n\n  async function saveChallan() {\n    const clean = rows.filter(r => r.itemId && r.qty);\n    if (!customerId || !clean.length) {\n      toast.error(\"Customer aur items zaroori hain\");\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const method = editing ? \"PUT\" : \"POST\";\n      const baseBody = {\n        challanNo,\n        customerId,\n        date,\n        driverName: driverName || null,\n        vehicleNo: vehicleNo || null,\n        remarks: remarks || null,\n        items: clean.map(r => ({ itemId: r.itemId, qty: Number(r.qty), rate: Number(r.rate) || 0 })),\n      };\n      const body = editing ? { id: editing.id, ...baseBody } : baseBody;\n\n      const res = await fetch(\"/api/delivery-challan\", {\n        method,\n        headers: { \n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        },\n        body: JSON.stringify(body),\n      });\n      \n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || \"Save failed\");\n      }\n      \n      const data = await res.json();\n      \n      if (data) {\n        setSavedChallan(data);\n        setChallanNo(data.challanNo || challanNo);\n        setCustomerName(customers.find(c => c.id === customerId)?.name || customerName);\n      }\n      \n      setPreview(true);\n      await loadChallans();\n      if (editing) {\n        setEditing(null);\n        setShowForm(false);\n        setShowList(true);\n      }\n      toast.success(\"Delivery Challan saved successfully!\");\n    } catch (e: any) {\n      toast.error(\"Saving failed: \" + (e.message || \"Unknown error\"));\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  function startEdit(c: DeliveryChallan) {\n    setEditing(c);\n    setChallanNo(c.challanNo);\n    setCustomerId(c.customerId);\n    setCustomerName(c.customer?.name || \"\");\n    setDate(new Date(c.date).toISOString().slice(0, 10));\n    setDriverName(c.driverName || \"\");\n    setVehicleNo(c.vehicleNo || \"\");\n    setRemarks(c.remarks || \"\");\n    setRows(c.items.map((it: any) => ({\n      itemId: it.itemId || \"\",\n      name: it.item?.name || \"\",\n      description: it.item?.description || \"\",\n      availableQty: 0, // Not needed for edit\n      qty: it.qty.toString(),\n      rate: it.rate ? it.rate.toString() : \"\",\n    })));\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deleteChallan(id: string) {\n    if (!confirm(\"Are you sure you want to delete this delivery challan?\")) return;\n    try {\n      const res = await fetch(`/api/delivery-challan?id=${id}`, {\n        method: \"DELETE\",\n        headers: {\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        },\n      });\n      if (res.ok) {\n        toast.success(\"Delivery Challan deleted successfully\");\n        await loadChallans();\n      } else {\n        const err = await res.json();\n        toast.error(err.error || \"Delete failed\");\n      }\n    } catch (e) {\n      toast.error(\"Delete failed\");\n    }\n  }\n\n  function resetForm() {\n    setEditing(null);\n    setCustomerId(\"\");\n    setCustomerName(\"\");\n    setDate(today);\n    setDriverName(\"\");\n    setVehicleNo(\"\");\n    setRemarks(\"\");\n    setRows([{ itemId: \"\", name: \"\", description: \"\", availableQty: 0, qty: \"\", rate: \"\" }]);\n    setPreview(false);\n  }\n\n  // Share on WhatsApp\n  const shareOnWhatsApp = () => {\n    if (!savedChallan) {\n      toast.error(\"Please save the challan first\");\n      return;\n    }\n    \n    // Construct a message\n    let message = `*Delivery Challan: ${savedChallan.challanNo}*\\n`;\n    message += `Date: ${new Date(savedChallan.date).toLocaleDateString()}\\n`;\n    message += `Customer: ${customerName}\\n`;\n    if (savedChallan.driverName) message += `Driver: ${savedChallan.driverName}\\n`;\n    if (savedChallan.vehicleNo) message += `Vehicle: ${savedChallan.vehicleNo}\\n`;\n    message += `\\n*Items:*\\n`;\n    \n    savedChallan.items.forEach((item: any, index: number) => {\n      // Fetch item name from local items if possible, or use from savedChallan if populated\n      // savedChallan.items might not have item details fully if not populated in response, but let's assume API returns it or we use logic\n      // Actually API returns items with included item details in GET but create/update response might vary.\n      // Ideally use local items map if needed or ensure API returns included.\n      // The API create/update returns just the main object usually, but let's trust we can reconstruct or refetch.\n      // Wait, create/update response in my API route above does NOT include relation `items` fully populated with `item` name.\n      // It returns `items` array of created objects.\n      // I should rely on `rows` state for names if savedChallan is fresh, or fetch proper object.\n      // For simplicity, let's use `rows` since it matches the saved state.\n      \n      const row = rows[index];\n      message += `${index + 1}. ${row.name} x ${item.qty} ${row.description ? `(${row.description})` : ''}\\n`;\n    });\n    \n    const url = `https://wa.me/?text=${encodeURIComponent(message)}`;\n    window.open(url, '_blank');\n  };\n\n  if (loading) return <div className=\"p-6\">Loading...</div>;\n  // if (!authorized) return <div className=\"p-6 text-red-600\">Access Denied</div>;\n\n  const filteredChallans = challans.filter(c => {\n  const term = searchTerm.toLowerCase();\n\n  return (\n    c.challanNo?.toLowerCase().includes(term) ||\n    c.customer?.name?.toLowerCase().includes(term) ||\n    c.date?.toLowerCase().includes(term)\n  );\n});\n\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-2xl font-bold\">Delivery Challan</h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => { setShowList(!showList); setShowForm(!showForm); setEditing(null); }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => { setShowForm(true); setShowList(false); resetForm(); loadChallans(); }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New Challan\n          </button>\n        </div>\n      </div>\n\n      {/* LIST VIEW */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-hidden overflow-x-auto\">\n          <table className=\"w-full text-sm min-w-[600px]\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">Challan No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Customer</th>\n                <th className=\"p-3 text-left\">Vehicle/Driver</th>\n                <th className=\"p-3 text-left\">Status</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredChallans.length === 0 ? (\n                <tr>\n                  <td colSpan={7} className=\"p-4 text-center text-gray-400\">No challans found</td>\n                </tr>\n              ) : (\n                filteredChallans.map(c => (\n                  <tr key={c.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">{c.challanNo}</td>\n                    <td className=\"p-3\">{new Date(c.date).toLocaleDateString()}</td>\n                    <td className=\"p-3\">{c.customer?.name || \"N/A\"}</td>\n                    <td className=\"p-3\">\n                        {c.vehicleNo && <span className=\"block text-xs\">🚗 {c.vehicleNo}</span>}\n                        {c.driverName && <span className=\"block text-xs\">👤 {c.driverName}</span>}\n                    </td>\n                    <td className=\"p-3\">\n                      <span className={`px-2 py-1 rounded text-xs ${c.status === 'DELIVERED' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}`}>\n                        {c.status}\n                      </span>\n                    </td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(c)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deleteChallan(c.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <>\n          <div className=\"flex flex-col md:flex-row justify-between items-center bg-gray-50 p-4 border rounded print:hidden gap-4\">\n            <h1 className=\"text-2xl font-bold\">Delivery Challan ({challanNo || \"New\"})</h1>\n            {!preview ? (\n              <div className=\"flex flex-wrap gap-2\">\n                <button onClick={saveChallan} disabled={saving} className=\"bg-blue-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  {saving ? \"Saving...\" : editing ? \"Update Challan\" : \"Save & Preview\"}\n                </button>\n                <button onClick={() => { setShowForm(false); setEditing(null); resetForm(); }} className=\"bg-gray-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  Cancel\n                </button>\n              </div>\n            ) : (\n              <div className=\"flex flex-wrap gap-2\">\n                <button onClick={() => window.print()} className=\"bg-green-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  Print\n                </button>\n                <button \n                  onClick={shareOnWhatsApp}\n                  className=\"bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 flex-1 md:flex-none\"\n                >\n                  📱 WhatsApp\n                </button>\n                <button \n                  onClick={shareOnSMS}\n                  className=\"bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 flex-1 md:flex-none\"\n                >\n                  💬 SMS\n                </button>\n                <button onClick={() => setPreview(false)} className=\"bg-yellow-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  Edit\n                </button>\n                <button onClick={() => { setPreview(false); resetForm(); }} className=\"bg-gray-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  New Challan\n                </button>\n              </div>\n            )}\n          </div>\n\n          {!preview && (\n            <div className=\"bg-white border p-6 rounded space-y-4\">\n              <div className=\"mb-2 text-xs text-gray-500 italic\">\n                💡 Keyboard Shortcuts: <strong>F7</strong> = Clear Form | <strong>F8</strong> = Search Customer\n              </div>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <input value={challanNo} readOnly className=\"border p-2 bg-gray-100\" placeholder=\"Challan No (Auto)\" />\n                <div>\n                  <label className=\"text-xs font-bold\">Customer</label>\n                  <select className=\"border p-2 w-full\" value={customerId} onChange={e => {\n                    setCustomerId(e.target.value);\n                    setCustomerName(customers.find(c => c.id === e.target.value)?.name || \"\");\n                  }}>\n                    <option value=\"\">Select Customer</option>\n                    {customers.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}\n                  </select>\n                </div>\n                <div>\n                  <label className=\"text-xs font-bold\">Date</label>\n                  <input type=\"date\" className=\"border p-2 w-full\" value={date} onChange={e => setDate(e.target.value)} />\n                </div>\n                <div>\n                  <label className=\"text-xs font-bold\">Status</label>\n                   <input type=\"text\" value=\"PENDING\" disabled className=\"border p-2 w-full bg-gray-100\" />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                 <div>\n                    <label className=\"text-xs font-bold\">Driver Name</label>\n                    <input className=\"border p-2 w-full\" value={driverName} onChange={e => setDriverName(e.target.value)} placeholder=\"Driver Name\" />\n                 </div>\n                 <div>\n                    <label className=\"text-xs font-bold\">Vehicle No</label>\n                    <input className=\"border p-2 w-full\" value={vehicleNo} onChange={e => setVehicleNo(e.target.value)} placeholder=\"Vehicle No\" />\n                 </div>\n                 <div>\n                    <label className=\"text-xs font-bold\">Remarks</label>\n                    <input className=\"border p-2 w-full\" value={remarks} onChange={e => setRemarks(e.target.value)} placeholder=\"Any remarks...\" />\n                 </div>\n              </div>\n\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full border mt-4 text-sm min-w-[600px]\">\n                  <thead className=\"bg-gray-100\">\n                    <tr>\n                      <th className=\"border p-2 text-left\">Item</th>\n                      <th className=\"border p-2 w-24\">Qty</th>\n                      <th className=\"border p-2 w-32\">Rate (Opt)</th>\n                      <th className=\"border p-2 w-32 text-right\">Amount (Est)</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {rows.map((r, i) => (\n                      <tr key={i}>\n                        <td className=\"border p-2\">\n                          <select className=\"w-full\" value={r.itemId} onChange={e => selectItem(i, e.target.value)}>\n                            <option value=\"\">Select Item</option>\n                            {items.map(it => (\n                              <option key={it.id} value={it.id}>\n                                {it.name} ({it.description})\n                              </option>\n                            ))}\n                          </select>\n                        </td>\n                        <td className=\"border p-2\">\n                          <input type=\"number\" value={r.qty} className=\"w-full text-center\" onChange={e => updateRow(i, \"qty\", e.target.value)} />\n                        </td>\n                        <td className=\"border p-2\">\n                          <input type=\"number\" value={r.rate} className=\"w-full text-center\" onChange={e => updateRow(i, \"rate\", e.target.value)} placeholder=\"Optional\" />\n                        </td>\n                        <td className=\"border p-2 text-right\">\n                          {(Number(r.qty) * Number(r.rate) || 0).toLocaleString()}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n              <button onClick={addRow} className=\"bg-gray-100 px-4 py-1 rounded\">+ Add Row</button>\n            </div>\n          )}\n\n          {/* PREVIEW */}\n          {preview && (\n            <div className=\"bg-white border p-8 rounded shadow-lg mt-6 print:border-none print:shadow-none\" id=\"print-area\">\n              <div className=\"text-center mb-8\">\n                <h1 className=\"text-3xl font-bold uppercase tracking-wide\">Delivery Challan</h1>\n                <p className=\"text-gray-500\">No: {savedChallan?.challanNo || challanNo}</p>\n              </div>\n\n              <div className=\"flex justify-between mb-8\">\n                <div>\n                  <h3 className=\"font-bold text-gray-700\">Customer:</h3>\n                  <p className=\"text-xl font-bold\">{customerName}</p>\n                  <p className=\"text-sm text-gray-500\">ID: {customerId}</p>\n                </div>\n                <div className=\"text-right\">\n                  <h3 className=\"font-bold text-gray-700\">Details:</h3>\n                  <p>Date: {new Date(date).toLocaleDateString()}</p>\n                  {driverName && <p>Driver: {driverName}</p>}\n                  {vehicleNo && <p>Vehicle: {vehicleNo}</p>}\n                </div>\n              </div>\n\n              <table className=\"w-full mb-8\">\n                <thead>\n                  <tr className=\"bg-gray-800 text-white\">\n                    <th className=\"p-3 text-left\">#</th>\n                    <th className=\"p-3 text-left\">Item Description</th>\n                    <th className=\"p-3 text-right\">Qty</th>\n                    <th className=\"p-3 text-right\">Rate</th>\n                    <th className=\"p-3 text-right\">Amount</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rows.map((row, index) => (\n                    <tr key={index} className=\"border-b\">\n                      <td className=\"p-3\">{index + 1}</td>\n                      <td className=\"p-3\">\n                        <span className=\"font-bold block\">{row.name}</span>\n                        <span className=\"text-sm text-gray-500\">{row.description}</span>\n                      </td>\n                      <td className=\"p-3 text-right font-bold\">{row.qty}</td>\n                      <td className=\"p-3 text-right\">{row.rate || \"-\"}</td>\n                      <td className=\"p-3 text-right\">{(Number(row.qty) * Number(row.rate) || 0).toLocaleString()}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n\n              {remarks && (\n                <div className=\"mb-8\">\n                  <h3 className=\"font-bold text-gray-700\">Remarks:</h3>\n                  <p className=\"text-gray-600\">{remarks}</p>\n                </div>\n              )}\n\n              <div className=\"flex justify-between mt-12 pt-8 border-t\">\n                <div className=\"text-center w-32\">\n                    <p className=\"border-t border-gray-400 mt-8 pt-2\">Prepared By</p>\n                </div>\n                <div className=\"text-center w-32\">\n                    <p className=\"border-t border-gray-400 mt-8 pt-2\">Checked By</p>\n                </div>\n                <div className=\"text-center w-32\">\n                    <p className=\"border-t border-gray-400 mt-8 pt-2\">Received By</p>\n                </div>\n              </div>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\email-settings\\page.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":15,"column":35,"nodeType":"Identifier","endLine":15,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":16,"column":35,"nodeType":"Identifier","endLine":16,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":17,"column":35,"nodeType":"Identifier","endLine":17,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":18,"column":35,"nodeType":"Identifier","endLine":18,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":19,"column":35,"nodeType":"Identifier","endLine":19,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":20,"column":39,"nodeType":"Identifier","endLine":20,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":21,"column":33,"nodeType":"Identifier","endLine":21,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":22,"column":39,"nodeType":"Identifier","endLine":22,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":24,"column":3,"nodeType":"Identifier","endLine":24,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":59,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":19},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":207,"column":49,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[6908,6946],"text":"Generate a new App Password for &quot;Mail\""},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[6908,6946],"text":"Generate a new App Password for &ldquo;Mail\""},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[6908,6946],"text":"Generate a new App Password for &#34;Mail\""},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[6908,6946],"text":"Generate a new App Password for &rdquo;Mail\""},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":207,"column":54,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[6908,6946],"text":"Generate a new App Password for \"Mail&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[6908,6946],"text":"Generate a new App Password for \"Mail&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[6908,6946],"text":"Generate a new App Password for \"Mail&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[6908,6946],"text":"Generate a new App Password for \"Mail&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { hasPermission } from \"@/lib/hasPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nexport default function EmailSettingsPage() {\r\n  const user = getCurrentUser();\r\n\r\n  if (!hasPermission(user, PERMISSIONS.EMAIL_SETTINGS)) {\r\n    return <div className=\"p-6 text-red-600\">Access Denied</div>;\r\n  }\r\n\r\n  const [smtpHost, setSmtpHost] = useState(\"\");\r\n  const [smtpPort, setSmtpPort] = useState(\"\");\r\n  const [smtpUser, setSmtpUser] = useState(\"\");\r\n  const [smtpPass, setSmtpPass] = useState(\"\");\r\n  const [smtpFrom, setSmtpFrom] = useState(\"\");\r\n  const [smtpSecure, setSmtpSecure] = useState(false);\r\n  const [testing, setTesting] = useState(false);\r\n  const [testResult, setTestResult] = useState<{ success: boolean; message: string } | null>(null);\r\n\r\n  useEffect(() => {\r\n    // Load from localStorage (in production, this should be from API/database)\r\n    const saved = localStorage.getItem(\"emailConfig\");\r\n    if (saved) {\r\n      try {\r\n        const config = JSON.parse(saved);\r\n        setSmtpHost(config.host || \"smtp.gmail.com\");\r\n        setSmtpPort(config.port || \"587\");\r\n        setSmtpUser(config.user || \"\");\r\n        setSmtpPass(config.pass || \"\");\r\n        setSmtpFrom(config.from || \"\");\r\n        setSmtpSecure(config.secure || false);\r\n      } catch (e) {\r\n        console.error(\"Failed to load email config:\", e);\r\n      }\r\n    } else {\r\n      // Default values\r\n      setSmtpHost(\"smtp.gmail.com\");\r\n      setSmtpPort(\"587\");\r\n      setSmtpSecure(false);\r\n    }\r\n  }, []);\r\n\r\n  async function testEmail() {\r\n    setTesting(true);\r\n    setTestResult(null);\r\n    try {\r\n      const res = await fetch(\"/api/email/test\", {\r\n        headers: {\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n      });\r\n      const data = await res.json();\r\n      setTestResult(data);\r\n    } catch (error) {\r\n      setTestResult({\r\n        success: false,\r\n        message: \"Failed to test email configuration\",\r\n      });\r\n    } finally {\r\n      setTesting(false);\r\n    }\r\n  }\r\n\r\n  function saveConfig() {\r\n    const config = {\r\n      host: smtpHost,\r\n      port: smtpPort,\r\n      user: smtpUser,\r\n      pass: smtpPass,\r\n      from: smtpFrom,\r\n      secure: smtpSecure,\r\n    };\r\n    localStorage.setItem(\"emailConfig\", JSON.stringify(config));\r\n    alert(\"Configuration saved! Note: In production, configure these in .env file.\");\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-4xl mx-auto\">\r\n      <h1 className=\"text-2xl font-bold mb-6\">Email Configuration</h1>\r\n\r\n      <div className=\"bg-yellow-50 border border-yellow-200 p-4 rounded mb-6\">\r\n        <p className=\"text-sm text-yellow-800\">\r\n          <strong>⚠️ Important:</strong> For production, configure email settings in the <code>.env</code> file:\r\n        </p>\r\n        <pre className=\"mt-2 text-xs bg-yellow-100 p-2 rounded overflow-x-auto\">\r\n{`SMTP_HOST=smtp.gmail.com\r\nSMTP_PORT=587\r\nSMTP_SECURE=false\r\nSMTP_USER=your-email@gmail.com\r\nSMTP_PASS=your-app-password\r\nSMTP_FROM=noreply@ustraders.com`}\r\n        </pre>\r\n      </div>\r\n\r\n      <div className=\"bg-white border rounded p-6 space-y-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">SMTP Host</label>\r\n          <input\r\n            type=\"text\"\r\n            value={smtpHost}\r\n            onChange={(e) => setSmtpHost(e.target.value)}\r\n            className=\"border p-2 w-full\"\r\n            placeholder=\"smtp.gmail.com\"\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">SMTP Port</label>\r\n          <input\r\n            type=\"text\"\r\n            value={smtpPort}\r\n            onChange={(e) => setSmtpPort(e.target.value)}\r\n            className=\"border p-2 w-full\"\r\n            placeholder=\"587\"\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">SMTP User (Email)</label>\r\n          <input\r\n            type=\"email\"\r\n            value={smtpUser}\r\n            onChange={(e) => setSmtpUser(e.target.value)}\r\n            className=\"border p-2 w-full\"\r\n            placeholder=\"your-email@gmail.com\"\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">SMTP Password (App Password)</label>\r\n          <input\r\n            type=\"password\"\r\n            value={smtpPass}\r\n            onChange={(e) => setSmtpPass(e.target.value)}\r\n            className=\"border p-2 w-full\"\r\n            placeholder=\"Your app password\"\r\n          />\r\n          <p className=\"text-xs text-gray-500 mt-1\">\r\n            For Gmail, use App Password (not your regular password)\r\n          </p>\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">From Email</label>\r\n          <input\r\n            type=\"email\"\r\n            value={smtpFrom}\r\n            onChange={(e) => setSmtpFrom(e.target.value)}\r\n            className=\"border p-2 w-full\"\r\n            placeholder=\"noreply@ustraders.com\"\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"flex items-center gap-2\">\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={smtpSecure}\r\n              onChange={(e) => setSmtpSecure(e.target.checked)}\r\n            />\r\n            <span className=\"text-sm font-bold\">Use Secure Connection (SSL/TLS)</span>\r\n          </label>\r\n          <p className=\"text-xs text-gray-500 mt-1\">\r\n            Check for port 465, uncheck for port 587\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"flex gap-2 pt-4\">\r\n          <button\r\n            onClick={saveConfig}\r\n            className=\"bg-blue-600 text-white px-6 py-2 rounded\"\r\n          >\r\n            Save Configuration\r\n          </button>\r\n          <button\r\n            onClick={testEmail}\r\n            disabled={testing}\r\n            className=\"bg-green-600 text-white px-6 py-2 rounded disabled:bg-gray-400\"\r\n          >\r\n            {testing ? \"Testing...\" : \"Test Email\"}\r\n          </button>\r\n        </div>\r\n\r\n        {testResult && (\r\n          <div\r\n            className={`p-4 rounded ${\r\n              testResult.success\r\n                ? \"bg-green-50 text-green-800 border border-green-200\"\r\n                : \"bg-red-50 text-red-800 border border-red-200\"\r\n            }`}\r\n          >\r\n            <p className=\"font-bold\">{testResult.success ? \"✅\" : \"❌\"}</p>\r\n            <p>{testResult.message}</p>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"mt-6 p-4 bg-gray-50 rounded\">\r\n          <h3 className=\"font-bold mb-2\">Gmail Setup Instructions:</h3>\r\n          <ol className=\"text-sm space-y-1 list-decimal list-inside\">\r\n            <li>Enable 2-Step Verification on your Google account</li>\r\n            <li>Go to Google Account → Security → App Passwords</li>\r\n            <li>Generate a new App Password for \"Mail\"</li>\r\n            <li>Use that App Password in SMTP Password field</li>\r\n            <li>Set SMTP Host: smtp.gmail.com</li>\r\n            <li>Set SMTP Port: 587 (or 465 for SSL)</li>\r\n          </ol>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\employees\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'today' is assigned a value but never used.","line":24,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\ninterface Employee {\r\n  id: string;\r\n  employeeId: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  phone?: string;\r\n  designations: string;\r\n  department: string;\r\n  dateOfJoining: string;\r\n  salary: number;\r\n  salaryFrequency: string;\r\n  isActive: boolean;\r\n}\r\n\r\nexport default function EmployeesPage() {\r\n  const [employees, setEmployees] = useState<Employee[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [editing, setEditing] = useState<string | null>(null);\r\n  const today = new Date().toISOString().slice(0, 10);\r\n  const [formData, setFormData] = useState({\r\n    employeeId: \"\",\r\n    firstName: \"\",\r\n    lastName: \"\",\r\n    email: \"\",\r\n    phone: \"\",\r\n    designations: \"\",\r\n    department: \"\",\r\n    dateOfJoining: \"\",\r\n    salary: 0,\r\n    salaryFrequency: \"MONTHLY\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchEmployees();\r\n  }, []);\r\n\r\n  const fetchEmployees = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const user = getCurrentUser();\r\n      if (!user) {\r\n        alert(\"Session expired. Please login again.\");\r\n        setEmployees([]);\r\n        return;\r\n      }\r\n\r\n      const response = await fetch(\"/api/employees\", {\r\n        headers: {\r\n          \"x-user-role\": user.role,\r\n          \"x-user-id\": user.id,\r\n        },\r\n      });\r\n      const data = await response.json();\r\n      setEmployees(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching employees:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      const user = getCurrentUser();\r\n      if (!user) {\r\n        alert(\"Session expired. Please login again.\");\r\n        return;\r\n      }\r\n\r\n      const url = editing\r\n        ? `/api/employees?id=${editing}`\r\n        : \"/api/employees\";\r\n      const method = editing ? \"PUT\" : \"POST\";\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": user.role,\r\n          \"x-user-id\": user.id,\r\n        },\r\n        body: JSON.stringify({\r\n          ...formData,\r\n          salary: parseFloat(formData.salary.toString()),\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        fetchEmployees();\r\n        resetForm();\r\n      } else {\r\n        const error = await response.json();\r\n        alert(error.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving employee:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm(\"Are you sure you want to delete this employee?\")) return;\r\n\r\n    try {\r\n      const user = getCurrentUser();\r\n      if (!user) {\r\n        alert(\"Session expired. Please login again.\");\r\n        return;\r\n      }\r\n\r\n      await fetch(`/api/employees?id=${id}`, {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          \"x-user-role\": user.role,\r\n          \"x-user-id\": user.id,\r\n        },\r\n      });\r\n      fetchEmployees();\r\n    } catch (error) {\r\n      console.error(\"Error deleting employee:\", error);\r\n    }\r\n  };\r\n\r\n  const handleEdit = (employee: Employee) => {\r\n    setEditing(employee.id);\r\n    setFormData({\r\n      employeeId: employee.employeeId,\r\n      firstName: employee.firstName,\r\n      lastName: employee.lastName,\r\n      email: employee.email,\r\n      phone: employee.phone || \"\",\r\n      designations: employee.designations,\r\n      department: employee.department,\r\n      dateOfJoining: employee.dateOfJoining.split(\"T\")[0],\r\n      salary: employee.salary,\r\n      salaryFrequency: employee.salaryFrequency,\r\n    });\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      employeeId: \"\",\r\n      firstName: \"\",\r\n      lastName: \"\",\r\n      email: \"\",\r\n      phone: \"\",\r\n      designations: \"\",\r\n      department: \"\",\r\n      dateOfJoining: \"\",\r\n      salary: 0,\r\n      salaryFrequency: \"MONTHLY\",\r\n    });\r\n    setEditing(null);\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gray-50 min-h-screen\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">\r\n          👥 Employees Management\r\n        </h1>\r\n\r\n        {/* Form */}\r\n        <div className=\"bg-white p-6 rounded-lg shadow mb-6\">\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Employee ID\"\r\n                value={formData.employeeId}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, employeeId: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"First Name\"\r\n                value={formData.firstName}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, firstName: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Last Name\"\r\n                value={formData.lastName}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, lastName: e.target.value })\r\n                }\r\n                \r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"email\"\r\n                placeholder=\"Email\"\r\n                value={formData.email}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, email: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"tel\"\r\n                placeholder=\"Phone\"\r\n                value={formData.phone}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, phone: e.target.value })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Designations\"\r\n                value={formData.designations}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, designations: e.target.value })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <select\r\n                value={formData.department}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, department: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              >\r\n                <option value=\"\">Select Department</option>\r\n                <option value=\"ACCOUNTS\">Accounts</option>\r\n                <option value=\"GODOWN\">Godown</option>\r\n                <option value=\"HR\">Human Resources</option>\r\n                <option value=\"OPERATIONS\">Operations</option>\r\n                <option value=\"GATE\">Gate</option>\r\n                <option value=\"SECURITY\">Security</option>\r\n                <option value=\"SALES\">Sales</option>\r\n                <option value=\"IT\">IT</option>\r\n              </select>\r\n              <input\r\n                type=\"date\"\r\n                value={formData.dateOfJoining}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, dateOfJoining: e.target.value })\r\n                }\r\n                required\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <input\r\n                type=\"number\"\r\n                placeholder=\"Salary\"\r\n                value={formData.salary}\r\n                onChange={(e) =>\r\n                  setFormData({\r\n                    ...formData,\r\n                    salary: parseFloat(e.target.value),\r\n                  })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              />\r\n              <select\r\n                value={formData.salaryFrequency}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, salaryFrequency: e.target.value })\r\n                }\r\n                className=\"px-3 py-2 border rounded\"\r\n              >\r\n                <option value=\"MONTHLY\">Monthly</option>\r\n                <option value=\"WEEKLY\">Weekly</option>\r\n                <option value=\"HOURLY\">Hourly</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className=\"flex-1 bg-blue-600 text-white py-2 rounded font-semibold hover:bg-blue-700\"\r\n              >\r\n                {loading\r\n                  ? \"Loading...\"\r\n                  : editing\r\n                    ? \"Update\"\r\n                    : \"Add Employee\"}\r\n              </button>\r\n              {editing && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={resetForm}\r\n                  className=\"px-6 bg-gray-400 text-white py-2 rounded font-semibold hover:bg-gray-500\"\r\n                >\r\n                  منسوخ کریں\r\n                </button>\r\n              )}\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* Table */}\r\n        {loading ? (\r\n          <div className=\"text-center py-8\">Loading...</div>\r\n        ) : (\r\n          <div className=\"bg-white rounded-lg shadow overflow-x-auto\">\r\n            <table className=\"w-full min-w-[1000px]\">\r\n              <thead className=\"bg-gray-100 border-b\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left\">ID</th>\r\n                  <th className=\"px-6 py-3 text-left\">Name</th>\r\n                  <th className=\"px-6 py-3 text-left\">Email</th>\r\n                  <th className=\"px-6 py-3 text-left\">Designation</th>\r\n                  <th className=\"px-6 py-3 text-left\">Department</th>\r\n                  <th className=\"px-6 py-3 text-left\">Salary</th>\r\n                  <th className=\"px-6 py-3 text-center\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {employees.map((emp) => (\r\n                  <tr key={emp.id} className=\"border-b hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-3 font-semibold\">{emp.employeeId}</td>\r\n                    <td className=\"px-6 py-3\">\r\n                      {emp.firstName} {emp.lastName}\r\n                    </td>\r\n                    <td className=\"px-6 py-3\">{emp.email}</td>\r\n                    <td className=\"px-6 py-3\">{emp.designations}</td>\r\n                    <td className=\"px-6 py-3\">{emp.department}</td>\r\n                    <td className=\"px-6 py-3\">{emp.salary.toLocaleString()}</td>\r\n                    <td className=\"px-6 py-3 text-center space-x-2\">\r\n                      <button\r\n                        onClick={() => handleEdit(emp)}\r\n                        className=\"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600\"\r\n                      >\r\n                    Edit\r\n                                          </button>\r\n                      <button\r\n                        onClick={() => handleDelete(emp.id)}\r\n                        className=\"px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\expense-vouchers\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchVouchers'. Either include it or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchVouchers, statusFilter]","fix":{"range":[1412,1426],"text":"[fetchVouchers, statusFilter]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2700,2703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2700,2703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\n\r\ninterface ExpenseVoucher {\r\n  id: string;\r\n  voucherNo: string;\r\n  date: string;\r\n  description: string;\r\n  totalAmount: number;\r\n  approvalStatus: string;\r\n  expenseAccount?: { id: string; name: string };\r\n  paymentAccount?: { id: string; name: string };\r\n  items?: ExpenseItem[];\r\n}\r\n\r\n\r\n\r\ninterface ExpenseItem {\r\n  description: string;\r\n  amount: number;\r\n  category: string;\r\n}\r\ntype AccountWithMeta = {\r\n  id: string;\r\n  code?: string;\r\n  name: string;\r\n  type?: string | null;\r\n  partyType?: string | null;\r\n};\r\n\r\n\r\n\r\n\r\nexport default function ExpenseVouchersPage() {\r\n  const [vouchers, setVouchers] = useState<ExpenseVoucher[]>([]);\r\n  const [accounts, setAccounts] = useState<AccountWithMeta[]>([]);\r\n  const [showForm, setShowForm] = useState(true);\r\n  const [items, setItems] = useState<ExpenseItem[]>([\r\n    { description: '', amount: 0, category: '' },\r\n  ]);\r\n  const [formData, setFormData] = useState({\r\n    voucherNo: '',\r\n    date: new Date().toISOString().split('T')[0],\r\n    description: '',\r\n    expenseAccountId: '',\r\n    paymentAccountId: '',\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [statusFilter, setStatusFilter] = useState('');\r\n  const [editingId, setEditingId] = useState('');\r\n\r\n  useEffect(() => {\r\n    fetchVouchers();\r\n    fetchAccounts();\r\n  }, [statusFilter]);\r\n\r\n  const fetchVouchers = async () => {\r\n    try {\r\n      let url = '/api/expense-vouchers';\r\n      if (statusFilter) url += `?status=${statusFilter}`;\r\n      const response = await fetch(url);\r\n      const data = await response.json();\r\n      setVouchers(data);\r\n    } catch (error) {\r\n      console.error('Error fetching vouchers:', error);\r\n    }\r\n  };\r\n\r\n  const fetchAccounts = async () => {\r\n    try {\r\n      // User role header zaroori hai warna API data nahi degi\r\n      const user = JSON.parse(localStorage.getItem('user') || '{}');\r\n      const role = (user.role || user?.user?.role || 'ADMIN').toUpperCase();\r\n      const response = await fetch('/api/accounts', {\r\n        headers: { 'x-user-role': role }\r\n      });\r\n      const data = await response.json();\r\n      setAccounts(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error('Error fetching accounts:', error);\r\n      setAccounts([]);\r\n    }\r\n  };\r\n\r\n  const handleAddItem = () => {\r\n    setItems([\r\n      ...items,\r\n      { description: '', amount: 0, category: '' },\r\n    ]);\r\n  };\r\n\r\n  const handleRemoveItem = (index: number) => {\r\n    setItems(items.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleItemChange = (\r\n    index: number,\r\n    field: string,\r\n    value: any\r\n  ) => {\r\n    const newItems = [...items];\r\n    newItems[index] = { ...newItems[index], [field]: value };\r\n    setItems(newItems);\r\n  };\r\n\r\n  const totalAmount = items.reduce((sum, item) => sum + item.amount, 0);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    try {\r\n      const method = editingId ? 'PUT' : 'POST';\r\n      const url = editingId ? `/api/expense-vouchers?id=${editingId}` : '/api/expense-vouchers';\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          id: editingId,\r\n          ...formData,\r\n          totalAmount,\r\n          items: items.map(item => ({\r\n            ...item,\r\n            amount: parseFloat(item.amount.toString()),\r\n          })),\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        alert(editingId ? 'Expense voucher updated successfully' : 'Expense voucher saved successfully');\r\n        setFormData({\r\n          voucherNo: '',\r\n          date: new Date().toISOString().split('T')[0],\r\n          description: '',\r\n          expenseAccountId: '',\r\n          paymentAccountId: '',\r\n        });\r\n        setItems([{ description: '', amount: 0, category: '' }]);\r\n        setEditingId('');\r\n        setShowForm(false);\r\n        fetchVouchers();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving voucher:', error);\r\n      alert('Error: Failed to save voucher');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleEdit = (voucher: ExpenseVoucher) => {\r\n    setEditingId(voucher.id);\r\n    setFormData({\r\n      voucherNo: voucher.voucherNo,\r\n      date: new Date(voucher.date).toISOString().split('T')[0],\r\n      description: voucher.description,\r\n      expenseAccountId: voucher.expenseAccount?.id || '',\r\n      paymentAccountId: voucher.paymentAccount?.id || '',\r\n    });\r\n    // Load items if available\r\n    if (voucher.items && voucher.items.length > 0) {\r\n      setItems(voucher.items.map(item => ({\r\n        description: item.description || '',\r\n        amount: item.amount || 0,\r\n        category: item.category || '',\r\n      })));\r\n    }\r\n    setShowForm(true);\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm('Are you sure? This cannot be undone.')) return;\r\n\r\n    try {\r\n      const response = await fetch(`/api/expense-vouchers?id=${id}`, {\r\n        method: 'DELETE',\r\n      });\r\n\r\n      if (response.ok) {\r\n        alert('Expense voucher deleted successfully');\r\n        fetchVouchers();\r\n      } else {\r\n        alert('Error: Failed to delete voucher');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting voucher:', error);\r\n      alert('Error: Failed to delete voucher');\r\n    }\r\n  };\r\n\r\n  const handleStatusChange = async (id: string, newStatus: string) => {\r\n    try {\r\n      const response = await fetch(`/api/expense-vouchers?id=${id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ id, approvalStatus: newStatus }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        toast.success(`Status changed to ${newStatus}`);\r\n        fetchVouchers();\r\n      } else {\r\n        toast.error('Error: Failed to update status');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating status:', error);\r\n      toast.error('Error: Failed to update status');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-6xl mx-auto\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h1 className=\"text-3xl font-bold\">Expense Vouchers</h1>\r\n        <button\r\n          onClick={() => setShowForm(!showForm)}\r\n          className=\"bg-green-500 text-white px-6 py-2 rounded font-semibold hover:bg-green-600\"\r\n        >\r\n          {showForm ? 'Expense List' : 'New Expense'}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Form */}\r\n      {showForm && (\r\n        <form\r\n          onSubmit={handleSubmit}\r\n          className=\"bg-white p-6 rounded-lg shadow mb-6\"\r\n        >\r\n          {/* Debug: Accounts data show karo */}\r\n          {/* <pre style={{background:'#eee',padding:'8px',marginBottom:'8px',fontSize:'12px',overflow:'auto'}}>{JSON.stringify(accounts, null, 2)}</pre> */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-semibold mb-2\">Voucher No</label>\r\n              <input\r\n                type=\"text\"\r\n                required\r\n                value={formData.voucherNo}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, voucherNo: e.target.value })\r\n                }\r\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-semibold mb-2\">Date</label>\r\n              <input\r\n                type=\"date\"\r\n                required\r\n                value={formData.date}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, date: e.target.value })\r\n                }\r\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-semibold mb-2\">Expense Account</label>\r\n              <select\r\n                required\r\n                value={formData.expenseAccountId}\r\n                onChange={(e) =>\r\n                  setFormData({\r\n                    ...formData,\r\n                    expenseAccountId: e.target.value,\r\n                  })\r\n                }\r\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n              >\r\n                <option value=\"\">Select</option>\r\n                {Array.isArray(accounts) &&\r\n                  accounts\r\n                    .filter((acc: AccountWithMeta) => {\r\n                      const n = acc.name.toLowerCase();\r\n                      const t = (acc.type ?? '').toLowerCase();\r\n                      const p = (acc.partyType ?? '').toLowerCase();\r\n\r\n                      return (\r\n                        n.includes('expense') ||\r\n                        t.includes('expense') ||\r\n                        p.includes('expense')\r\n                      );\r\n                    })\r\n\r\n                    .map((account) => (\r\n                      <option key={account.id} value={account.id}>\r\n                        {account.name}\r\n                      </option>\r\n                    ))}\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-semibold mb-2\">Payment Account</label>\r\n              <select\r\n                required\r\n                value={formData.paymentAccountId}\r\n                onChange={(e) =>\r\n                  setFormData({\r\n                    ...formData,\r\n                    paymentAccountId: e.target.value,\r\n                  })\r\n                }\r\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n              >\r\n                <option value=\"\">Select</option>\r\n                {Array.isArray(accounts) &&\r\n                  accounts\r\n                    .filter((acc) => {\r\n                      const n = acc.name.toLowerCase();\r\n                      const t = (acc.type || '').toLowerCase();\r\n                      const p = (acc.partyType || '').toLowerCase();\r\n                      return (\r\n                        n.includes('cash') ||\r\n                        n.includes('bank') ||\r\n                        t.includes('cash') ||\r\n                        t.includes('bank') ||\r\n                        p.includes('bank')\r\n                      );\r\n                    })\r\n                    .map((account) => (\r\n                      <option key={account.id} value={account.id}>\r\n                        {account.name}\r\n                      </option>\r\n                    ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"mb-4\">\r\n            <label className=\"block text-sm font-semibold mb-2\">Description</label>\r\n            <textarea\r\n              value={formData.description}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, description: e.target.value })\r\n              }\r\n              className=\"w-full border border-gray-300 rounded px-3 py-2\"\r\n              rows={2}\r\n            />\r\n          </div>\r\n\r\n          {/* Items */}\r\n          <div className=\"mb-4\">\r\n            <h3 className=\"font-semibold mb-3\">Expense Details</h3>\r\n            <table className=\"w-full border border-gray-300 rounded\">\r\n              <thead className=\"bg-gray-100\">\r\n                <tr>\r\n                  <th className=\"border px-3 py-2 text-left\">Description</th>\r\n                  <th className=\"border px-3 py-2 text-left\">Category</th>\r\n                  <th className=\"border px-3 py-2 text-right\">Amount</th>\r\n                  <th className=\"border px-3 py-2\">Action</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {items.map((item, index) => (\r\n                  <tr key={index}>\r\n                    <td className=\"border px-3 py-2\">\r\n                      <input\r\n                        type=\"text\"\r\n                        value={item.description}\r\n                        onChange={(e) =>\r\n                          handleItemChange(index, 'description', e.target.value)\r\n                        }\r\n                        className=\"w-full border border-gray-300 rounded px-2 py-1\"\r\n                        placeholder=\"Description\"\r\n                      />\r\n                    </td>\r\n                    <td className=\"border px-3 py-2\">\r\n                      <select\r\n                        value={item.category}\r\n                        onChange={(e) =>\r\n                          handleItemChange(index, 'category', e.target.value)\r\n                        }\r\n                        className=\"w-full border border-gray-300 rounded px-2 py-1\"\r\n                      >\r\n                        <option value=\"\">Select</option>\r\n                        <option value=\"TRAVEL\">Travel</option>\r\n                        <option value=\"FOOD\">Food</option>\r\n                        <option value=\"SUPPLIES\">Supplies</option>\r\n                        <option value=\"UTILITIES\">Utilities</option>\r\n                        <option value=\"OTHER\">Other</option>\r\n                      </select>\r\n                    </td>\r\n                    <td className=\"border px-3 py-2\">\r\n                      <input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        value={item.amount}\r\n                        onChange={(e) =>\r\n                          handleItemChange(index, 'amount', parseFloat(e.target.value))\r\n                        }\r\n                        className=\"w-full border border-gray-300 rounded px-2 py-1 text-right\"\r\n                        placeholder=\"0.00\"\r\n                      />\r\n                    </td>\r\n                    <td className=\"border px-3 py-2\">\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => handleRemoveItem(index)}\r\n                        className=\"text-red-500 hover:text-red-700\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleAddItem}\r\n              className=\"mt-2 text-blue-500 hover:text-blue-700 font-semibold\"\r\n            >\r\n              + Add Item\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"mb-4 text-right\">\r\n            <span className=\"font-semibold text-lg\">\r\n              Total: {totalAmount.toFixed(2)}\r\n            </span>\r\n          </div>\r\n\r\n          <div className=\"flex gap-4\">\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"bg-blue-500 text-white px-6 py-2 rounded font-semibold hover:bg-blue-600 disabled:opacity-50\"\r\n            >\r\n              {loading ? 'Saving...' : editingId ? 'Update' : 'Save'}\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                setShowForm(false);\r\n                setEditingId('');\r\n                setFormData({\r\n                  voucherNo: '',\r\n                  date: new Date().toISOString().split('T')[0],\r\n                  description: '',\r\n                  expenseAccountId: '',\r\n                  paymentAccountId: '',\r\n                });\r\n                setItems([{ description: '', amount: 0, category: '' }]);\r\n              }}\r\n              className=\"bg-gray-500 text-white px-6 py-2 rounded font-semibold hover:bg-gray-600\"\r\n            >\r\n              Cancel\r\n            </button>\r\n          </div>\r\n        </form>\r\n      )}\r\n\r\n      {/* Filter */}\r\n      <div className=\"mb-6\">\r\n        <select\r\n          value={statusFilter}\r\n          onChange={(e) => setStatusFilter(e.target.value)}\r\n          className=\"border border-gray-300 rounded px-4 py-2\"\r\n        >\r\n          <option value=\"\">All Status</option>\r\n          <option value=\"DRAFT\">Draft</option>\r\n          <option value=\"PENDING\">Pending</option>\r\n          <option value=\"APPROVED\">Approved</option>\r\n          <option value=\"REJECTED\">Rejected</option>\r\n        </select>\r\n      </div>\r\n\r\n      {/* List */}\r\n      <div className=\"bg-white rounded-lg shadow overflow-x-auto\">\r\n        <table className=\"w-full min-w-[800px]\">\r\n          <thead className=\"bg-gray-100\">\r\n            <tr>\r\n              <th className=\"px-6 py-3 text-left\">Voucher No</th>\r\n              <th className=\"px-6 py-3 text-left\">Date</th>\r\n              <th className=\"px-6 py-3 text-left\">Amount</th>\r\n              <th className=\"px-6 py-3 text-left\">Status</th>\r\n              <th className=\"px-6 py-3 text-left\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {vouchers.map((voucher) => (\r\n              <tr key={voucher.id} className=\"border-b hover:bg-gray-50\">\r\n                <td className=\"px-6 py-3 font-semibold\">{voucher.voucherNo}</td>\r\n                <td className=\"px-6 py-3\">\r\n                  {new Date(voucher.date).toLocaleDateString()}\r\n                </td>\r\n                <td className=\"px-6 py-3\">{voucher.totalAmount.toFixed(2)}</td>\r\n                <td className=\"px-6 py-3\">\r\n                  <span className={`px-3 py-1 rounded text-white text-sm ${voucher.approvalStatus === 'DRAFT' ? 'bg-gray-500' :\r\n                      voucher.approvalStatus === 'PENDING' ? 'bg-yellow-500' :\r\n                        voucher.approvalStatus === 'APPROVED' ? 'bg-green-500' :\r\n                          'bg-red-500'\r\n                    }`}>\r\n                    {voucher.approvalStatus}\r\n                  </span>\r\n                </td>\r\n                <td className=\"px-6 py-3 space-x-2\">\r\n                  <button\r\n                    onClick={() => handleEdit(voucher)}\r\n                    className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\r\n                  >\r\n                    Edit\r\n                  </button>\r\n                  {voucher.approvalStatus === 'DRAFT' && (\r\n                    <button\r\n                      onClick={() => handleStatusChange(voucher.id, 'PENDING')}\r\n                      className=\"text-yellow-600 hover:text-yellow-800 font-medium text-sm\"\r\n                    >\r\n                      Submit\r\n                    </button>\r\n                  )}\r\n                  {voucher.approvalStatus === 'PENDING' && (\r\n                    <button\r\n                      onClick={() => handleStatusChange(voucher.id, 'APPROVED')}\r\n                      className=\"text-green-600 hover:text-green-800 font-medium text-sm\"\r\n                    >\r\n                      Approve\r\n                    </button>\r\n                  )}\r\n                  <button\r\n                    onClick={() => handleDelete(voucher.id)}\r\n                    className=\"text-red-500 hover:text-red-700 font-medium text-sm\"\r\n                  >\r\n                    Delete\r\n                  </button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\financial-year\\page.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":35,"column":3,"nodeType":"Identifier","endLine":35,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadYears'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadYears]","fix":{"range":[987,989],"text":"[loadYears]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":89,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":89,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":115,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":115,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { hasPermission } from \"@/lib/hasPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\ntype FinancialYear = {\r\n  id: string;\r\n  year: number;\r\n  startDate: string;\r\n  endDate: string;\r\n  isActive: boolean;\r\n  isClosed: boolean;\r\n  closedAt?: string;\r\n};\r\n\r\nexport default function FinancialYearPage() {\r\n  const [years, setYears] = useState<FinancialYear[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [showForm, setShowForm] = useState(false);\r\n\r\n  const [formData, setFormData] = useState({\r\n    year: new Date().getFullYear().toString(),\r\n    startDate: `${new Date().getFullYear()}-01-01`,\r\n    endDate: `${new Date().getFullYear()}-12-31`,\r\n  });\r\n\r\n  const user = getCurrentUser();\r\n\r\n  if (!hasPermission(user, PERMISSIONS.FINANCIAL_YEAR)) {\r\n    return <div>Access Denied</div>;\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadYears();\r\n  }, []);\r\n\r\n  async function loadYears() {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/api/financial-year\", {\r\n        headers: {\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n      });\r\n      const data = await res.json();\r\n      if (Array.isArray(data)) {\r\n        setYears(data);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Load error:\", e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function saveYear() {\r\n    if (!formData.year || !formData.startDate || !formData.endDate) {\r\n      alert(\"Please fill all fields\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/api/financial-year\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      if (res.ok) {\r\n        await loadYears();\r\n        setShowForm(false);\r\n        setFormData({\r\n          year: new Date().getFullYear().toString(),\r\n          startDate: `${new Date().getFullYear()}-01-01`,\r\n          endDate: `${new Date().getFullYear()}-12-31`,\r\n        });\r\n      } else {\r\n        const error = await res.json();\r\n        alert(error.error || \"Save failed\");\r\n      }\r\n    } catch (e) {\r\n      alert(\"Save failed\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function closeYear(id: string) {\r\n    if (!confirm(\"Are you sure you want to close this financial year? This action cannot be undone.\")) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(\"/api/financial-year\", {\r\n        method: \"PUT\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n        body: JSON.stringify({ id, isClosed: true, closedBy: user?.id }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        await loadYears();\r\n      }\r\n    } catch (e) {\r\n      alert(\"Close failed\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-2xl font-bold\">Financial Year Management</h1>\r\n        <button\r\n          onClick={() => setShowForm(true)}\r\n          className=\"bg-blue-600 text-white px-4 py-2 rounded\"\r\n        >\r\n          + Add Financial Year\r\n        </button>\r\n      </div>\r\n\r\n      {showForm && (\r\n        <div className=\"bg-white border p-6 rounded space-y-4\">\r\n          <h2 className=\"text-xl font-bold\">New Financial Year</h2>\r\n\r\n          <div className=\"grid grid-cols-3 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-bold mb-1\">Year *</label>\r\n              <input\r\n                type=\"number\"\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.year}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, year: e.target.value })\r\n                }\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-bold mb-1\">\r\n                Start Date *\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.startDate}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, startDate: e.target.value })\r\n                }\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-bold mb-1\">End Date *</label>\r\n              <input\r\n                type=\"date\"\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.endDate}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, endDate: e.target.value })\r\n                }\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={saveYear}\r\n              disabled={loading}\r\n              className=\"bg-green-600 text-white px-6 py-2 rounded\"\r\n            >\r\n              {loading ? \"Saving...\" : \"Save\"}\r\n            </button>\r\n            <button\r\n              onClick={() => setShowForm(false)}\r\n              className=\"bg-gray-600 text-white px-6 py-2 rounded\"\r\n            >\r\n              Cancel\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"bg-white border rounded overflow-hidden\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-100\">\r\n            <tr>\r\n              <th className=\"p-3 text-left\">Year</th>\r\n              <th className=\"p-3 text-left\">Start Date</th>\r\n              <th className=\"p-3 text-left\">End Date</th>\r\n              <th className=\"p-3 text-center\">Status</th>\r\n              <th className=\"p-3 text-center\">Closed</th>\r\n              <th className=\"p-3 text-center\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {loading ? (\r\n              <tr>\r\n                <td colSpan={6} className=\"p-4 text-center\">\r\n                  Loading...\r\n                </td>\r\n              </tr>\r\n            ) : years.length === 0 ? (\r\n              <tr>\r\n                <td colSpan={6} className=\"p-4 text-center text-gray-400\">\r\n                  No financial years found\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              years.map((y) => (\r\n                <tr key={y.id} className=\"border-t\">\r\n                  <td className=\"p-3 font-bold\">{y.year}</td>\r\n                  <td className=\"p-3\">\r\n                    {new Date(y.startDate).toLocaleDateString()}\r\n                  </td>\r\n                  <td className=\"p-3\">\r\n                    {new Date(y.endDate).toLocaleDateString()}\r\n                  </td>\r\n                  <td className=\"p-3 text-center\">\r\n                    <span\r\n                      className={`px-2 py-1 rounded text-xs ${\r\n                        y.isActive\r\n                          ? \"bg-green-100 text-green-800\"\r\n                          : \"bg-gray-100 text-gray-800\"\r\n                      }`}\r\n                    >\r\n                      {y.isActive ? \"Active\" : \"Inactive\"}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"p-3 text-center\">\r\n                    <span\r\n                      className={`px-2 py-1 rounded text-xs ${\r\n                        y.isClosed\r\n                          ? \"bg-red-100 text-red-800\"\r\n                          : \"bg-yellow-100 text-yellow-800\"\r\n                      }`}\r\n                    >\r\n                      {y.isClosed ? \"Closed\" : \"Open\"}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"p-3 text-center\">\r\n                    {!y.isClosed && (\r\n                      <button\r\n                        onClick={() => closeYear(y.id)}\r\n                        className=\"text-red-600 hover:underline\"\r\n                      >\r\n                        Close Year\r\n                      </button>\r\n                    )}\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\fixed-assets\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\inventory\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\items-new\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UNITS' is assigned a value but never used.","line":26,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2240,2243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2240,2243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3341,3344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3341,3344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\n\r\ntype Item = {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n  unit: string;\r\n  rate: number;\r\n  minStock: number; \r\n  barcode?: string | null;\r\n  description?: string | null;\r\n};\r\n\r\nexport default function ItemsNewPage() {\r\n  const [items, setItems] = useState<Item[]>([]);\r\n  const [name, setName] = useState(\"\");\r\n  const [unit, setUnit] = useState(\"\");\r\n  const [rate, setRate] = useState(\"\");\r\n  const [minStock, setMinStock] = useState(\"\");\r\n  const [barcode, setBarcode] = useState(\"\");\r\n  const [description, setDescription] = useState(\"\");\r\n  const [saving, setSaving] = useState(false);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  const UNITS = [\"PCS\", \"KG\", \"GM\", \"LTR\", \"ML\", \"MTR\", \"FT\", \"BOX\", \"PACK\"];\r\n\r\n\r\n  async function loadItems() {\r\n    try {\r\n      const res = await fetch(\"/api/items-new\", {\r\n        headers: {\r\n          \"x-user-role\": \"ADMIN\",\r\n        },\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (Array.isArray(data)) setItems(data);\r\n      else setItems([]);\r\n    } catch {\r\n      setItems([]);\r\n    }\r\n  }\r\n\r\n\r\n  useEffect(() => {\r\n    loadItems();\r\n  }, []);\r\n\r\n  async function saveItem() {\r\n    if (!name || !unit) {\r\n      alert(\"Item name aur unit zaroori hai\");\r\n      return;\r\n    }\r\n\r\n    setSaving(true);\r\n\r\n    try {\r\n      const method = editingId ? \"PUT\" : \"POST\";\r\n      const res = await fetch(\"/api/items-new\", {\r\n        method,\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": \"ADMIN\",\r\n        },\r\n        body: JSON.stringify({\r\n          id: editingId,\r\n          name,\r\n          unit,\r\n          rate,\r\n          minStock,\r\n          barcode,\r\n          description\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const err = await res.json();\r\n        throw new Error(err.error || \"Save failed\");\r\n      }\r\n\r\n      // Reset form\r\n      setName(\"\");\r\n      setUnit(\"\");\r\n      setRate(\"\");\r\n      setMinStock(\"\");\r\n      setBarcode(\"\");\r\n      setDescription(\"\");\r\n      setEditingId(null);\r\n\r\n      await loadItems();\r\n      alert(editingId ? \"Item updated successfully\" : \"Item saved successfully\");\r\n    } catch (err: any) {\r\n      alert(err.message);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  function handleEdit(item: Item) {\r\n    setEditingId(item.id);\r\n    setName(item.name);\r\n    setUnit(item.unit);\r\n    setRate(String(item.rate || \"\"));\r\n    setMinStock(String(item.minStock || \"\"));\r\n    setBarcode(item.barcode || \"\");\r\n    setDescription(item.description || \"\");\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n  }\r\n\r\n  function resetForm() {\r\n    setEditingId(null);\r\n    setName(\"\");\r\n    setUnit(\"\");\r\n    setRate(\"\");\r\n    setMinStock(\"\");\r\n    setDescription(\"\");\r\n  }\r\n\r\n  async function handleDelete(id: string) {\r\n    if (!confirm(\"Are you sure? This cannot be undone.\")) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/items-new?id=${id}`, {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          \"x-user-role\": \"ADMIN\",\r\n        },\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const err = await res.json();\r\n        throw new Error(err.error || \"Delete failed\");\r\n      }\r\n\r\n      await loadItems();\r\n      alert(\"Item deleted successfully\");\r\n    } catch (err: any) {\r\n      alert(err.message);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-5xl p-6 space-y-6 mx-auto\">\r\n      <h1 className=\"text-2xl font-bold\">Item Coding</h1>\r\n\r\n      {/* FORM */}\r\n      <div className=\"bg-white border p-4 rounded grid grid-cols-2 gap-3 shadow-sm\">\r\n        <input\r\n          className=\"border p-2 rounded\"\r\n          placeholder=\"Item Name\"\r\n          value={name}\r\n          onChange={(e) => setName(e.target.value)}\r\n        />\r\n\r\n        <select\r\n  className=\"border p-2 rounded\"\r\n  value={unit}\r\n  onChange={(e) => setUnit(e.target.value)}\r\n>\r\n  <option value=\"\">Select Unit</option>\r\n  <option value=\"PCS\">Pieces</option>\r\n  <option value=\"KG\">Kilogram</option>\r\n  <option value=\"GM\">Gram</option>\r\n  <option value=\"LTR\">Liter</option>\r\n  <option value=\"ML\">Milliliter</option>\r\n  <option value=\"MTR\">Meter</option>\r\n  <option value=\"FT\">Feet</option>\r\n  <option value=\"BOX\">Box</option>\r\n  <option value=\"PACK\">Pack</option>\r\n</select>\r\n\r\n\r\n        <input\r\n          className=\"border p-2 rounded\"\r\n          type=\"number\"\r\n          placeholder=\"Standard Rate\"\r\n          value={rate}\r\n          onChange={(e) => setRate(e.target.value)}\r\n        />\r\n\r\n        {/* 📉 MIN STOCK INPUT */}\r\n        <input\r\n          className=\"border p-2 rounded bg-yellow-50\"\r\n          type=\"number\"\r\n          placeholder=\"Low Stock Alert Level (Min Stock)\"\r\n          value={minStock}\r\n          onChange={(e) => setMinStock(e.target.value)}\r\n        />\r\n\r\n        {/* 📟 BARCODE INPUT */}\r\n        <input\r\n          className=\"border p-2 rounded bg-gray-50\"\r\n          placeholder=\"Scan Barcode / SKU\"\r\n          value={barcode}\r\n          onChange={(e) => setBarcode(e.target.value)}\r\n        />\r\n\r\n        <input\r\n          className=\"border p-2 rounded col-span-2\"\r\n          placeholder=\"Description\"\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n        />\r\n\r\n        <div className=\"col-span-2 flex gap-2\">\r\n          <button\r\n            onClick={saveItem}\r\n            disabled={saving}\r\n            className=\"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50 font-bold flex-1\"\r\n          >\r\n            {saving ? \"Saving...\" : editingId ? \"Update Item\" : \"Save Item\"}\r\n          </button>\r\n          {editingId && (\r\n            <button\r\n              onClick={resetForm}\r\n              className=\"bg-gray-500 text-white px-4 py-2 rounded font-bold\"\r\n            >\r\n              Cancel\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* LIST */}\r\n      <div className=\"overflow-x-auto border rounded\">\r\n        <table className=\"w-full text-sm text-left min-w-[800px]\">\r\n          <thead className=\"bg-gray-100 border-b\">\r\n            <tr>\r\n              <th className=\"p-3\">Code</th>\r\n              <th className=\"p-3\">Name</th>\r\n              <th className=\"p-3\">Barcode</th>\r\n              <th className=\"p-3\">Unit</th>\r\n              <th className=\"p-3 text-right\">Rate</th>\r\n              <th className=\"p-3 text-right text-red-600\">Min Stock</th>\r\n              <th className=\"p-3\">Description</th>\r\n              <th className=\"p-3 text-center\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {items.map((i) => (\r\n              <tr key={i.id} className=\"border-b hover:bg-gray-50\">\r\n                <td className=\"p-3 font-mono text-xs\">{i.code}</td>\r\n                <td className=\"p-3 font-bold\">{i.name}</td>\r\n                <td className=\"p-3 font-mono text-xs text-gray-600\">{i.barcode || \"-\"}</td>\r\n                <td className=\"p-3\">{i.unit}</td>\r\n                <td className=\"p-3 text-right\">{i.rate}</td>\r\n                <td className=\"p-3 text-right font-bold text-red-500\">{i.minStock}</td>\r\n                <td className=\"p-3 text-gray-500 text-xs\">{i.description}</td>\r\n                <td className=\"p-3 text-center space-x-2\">\r\n                  <button\r\n                    onClick={() => handleEdit(i)}\r\n                    className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\r\n                  >\r\n                    Edit\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleDelete(i.id)}\r\n                    className=\"text-red-500 hover:text-red-700 font-medium text-sm\"\r\n                  >\r\n                    Delete\r\n                  </button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\jv\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1305,1308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1305,1308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadAccounts', 'loadVouchers', and 'user'. Either include them or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadAccounts, loadVouchers, user]","fix":{"range":[1540,1542],"text":"[loadAccounts, loadVouchers, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2786,2789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2786,2789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5883,5886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5883,5886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":285,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":285,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":551,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":551,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17476,17479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17476,17479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { toast } from \"react-hot-toast\";\n\ntype Account = {\n  id: string;\n  name: string;\n  code: string;\n  type: string;\n};\n\ntype Entry = {\n  id: string;\n  accountId: string;\n  accountName: string;\n  amount: string;\n  type: \"DEBIT\" | \"CREDIT\";\n};\n\ntype Voucher = {\n  id: string;\n  voucherNo: string;\n  date: string;\n  narration: string;\n  entries: Array<{\n    accountId: string;\n    accountName: string;\n    amount: number;\n  }>;\n  totalDebit: number;\n  totalCredit: number;\n};\n\nexport default function JVPage() {\n  const today = new Date().toISOString().split(\"T\")[0];\n\n  const [accounts, setAccounts] = useState<Account[]>([]);\n  const [vouchers, setVouchers] = useState<Voucher[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<Voucher | null>(null);\n\n  const [entries, setEntries] = useState<Entry[]>([\n    { id: \"1\", accountId: \"\", accountName: \"\", amount: \"\", type: \"DEBIT\" },\n    { id: \"2\", accountId: \"\", accountName: \"\", amount: \"\", type: \"CREDIT\" },\n  ]);\n  const [date, setDate] = useState(today);\n  const [narration, setNarration] = useState(\"\");\n  const [voucher, setVoucher] = useState<any>(null);\n  const [saving, setSaving] = useState(false);\n\n  const user = getCurrentUser();\n\n  useEffect(() => {\n    if (!user) {\n      toast.error(\"Session expired\");\n      return;\n    }\n\n    loadVouchers();\n    loadAccounts();\n  }, []);\n\n  async function loadVouchers() {\n    try {\n      const res = await fetch(\"/api/jv\", {\n        headers: { \"x-user-role\": user?.role || \"\" },\n      });\n      const data = await res.json();\n      if (Array.isArray(data)) {\n        setVouchers(data);\n      }\n    } catch (e) {\n      console.error(\"Load vouchers error:\", e);\n    }\n  }\n\n  async function loadAccounts() {\n    fetch(\"/api/accounts\", {\n      method: \"GET\",\n      headers: { \"x-user-role\": user?.role || \"\" },\n    })\n      .then((res) => res.json())\n      .then((data) => {\n        if (Array.isArray(data)) {\n          setAccounts(data);\n        } else {\n          setAccounts(data.accounts || []);\n        }\n      })\n      .catch((err) => {\n        console.error(\"Accounts load error:\", err);\n      });\n  }\n\n  function addEntry() {\n    setEntries([\n      ...entries,\n      {\n        id: Date.now().toString(),\n        accountId: \"\",\n        accountName: \"\",\n        amount: \"\",\n        type: \"DEBIT\",\n      },\n    ]);\n  }\n\n  function removeEntry(id: string) {\n    if (entries.length <= 2) {\n      toast.error(\"At least 2 entries required\");\n      return;\n    }\n    setEntries(entries.filter((e) => e.id !== id));\n  }\n\n  function updateEntry(id: string, field: keyof Entry, value: any) {\n    setEntries(\n      entries.map((e) => {\n        if (e.id === id) {\n          if (field === \"accountId\") {\n            const account = accounts.find((a) => a.id === value);\n            return {\n              ...e,\n              accountId: value,\n              accountName: account?.name || \"\",\n            };\n          }\n          if (field === \"type\") {\n            const currentAmount = Number(e.amount) || 0;\n            return {\n              ...e,\n              type: value,\n              amount:\n                value === \"DEBIT\"\n                  ? Math.abs(currentAmount).toString()\n                  : (-Math.abs(currentAmount)).toString(),\n            };\n          }\n          if (field === \"amount\") {\n            const numValue = Number(value);\n            if (isNaN(numValue)) {\n              return { ...e, amount: \"\" };\n            }\n            const absValue = Math.abs(numValue);\n            return {\n              ...e,\n              amount:\n                e.type === \"DEBIT\" ? absValue.toString() : (-absValue).toString(),\n            };\n          }\n          return { ...e, [field]: value };\n        }\n        return e;\n      })\n    );\n  }\n\n  const totalDebit = entries.reduce((sum, e) => {\n    const amount = Number(e.amount) || 0;\n    return sum + (amount > 0 ? amount : 0);\n  }, 0);\n\n  const totalCredit = entries.reduce((sum, e) => {\n    const amount = Number(e.amount) || 0;\n    return sum + (amount < 0 ? Math.abs(amount) : 0);\n  }, 0);\n\n  const isBalanced = Math.abs(totalDebit - totalCredit) < 0.01;\n\n  async function saveJV() {\n    if (!isBalanced) {\n      alert(`Debit (${totalDebit}) and Credit (${totalCredit}) must be equal`);\n      return;\n    }\n\n    for (const entry of entries) {\n      if (!entry.accountId) {\n        alert(\"All entries must have an account\");\n        return;\n      }\n      const amount = Number(entry.amount);\n      if (isNaN(amount) || amount === 0) {\n        alert(\"All entries must have non-zero amount\");\n        return;\n      }\n    }\n\n    setSaving(true);\n\n    try {\n      const url = \"/api/jv\";\n      const method = editing ? \"PUT\" : \"POST\";\n\n      const res = await fetch(url, {\n        method,\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"\",\n        },\n        body: JSON.stringify(editing ? {\n          id: editing.id,\n          entries: entries.map((e) => ({\n            accountId: e.accountId,\n            amount: Number(e.amount),\n          })),\n          date,\n          narration,\n        } : {\n          entries: entries.map((e) => ({\n            accountId: e.accountId,\n            amount: Number(e.amount),\n          })),\n          date,\n          narration,\n        }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        alert(`Error: ${data?.error || \"Save failed\"}`);\n        return;\n      }\n\n      setVoucher(data);\n      alert(editing ? \"JV updated successfully!\" : \"Journal Voucher saved successfully!\");\n      await loadVouchers();\n      resetForm();\n      setShowForm(false);\n      setEditing(null);\n    } catch (error: any) {\n      alert(`Error: ${error.message || \"Failed to save JV\"}`);\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  function resetForm() {\n    setEntries([\n      { id: \"1\", accountId: \"\", accountName: \"\", amount: \"\", type: \"DEBIT\" },\n      { id: \"2\", accountId: \"\", accountName: \"\", amount: \"\", type: \"CREDIT\" },\n    ]);\n    setNarration(\"\");\n    setDate(today);\n  }\n\n  function startEdit(v: Voucher) {\n    setEditing(v);\n    setDate(v.date);\n    setNarration(v.narration);\n    setEntries(\n      v.entries.map((e, idx) => ({\n        id: (idx + 1).toString(),\n        accountId: e.accountId,\n        accountName: e.accountName,\n        amount: e.amount.toString(),\n        type: e.amount > 0 ? \"DEBIT\" : \"CREDIT\",\n      }))\n    );\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deleteVoucher(id: string) {\n    if (!confirm(\"Are you sure you want to delete this JV?\")) {\n      return;\n    }\n\n    try {\n      const res = await fetch(`/api/jv?id=${id}`, {\n        method: \"DELETE\",\n        headers: { \"x-user-role\": user?.role || \"\" },\n      });\n\n      if (res.ok) {\n        toast.success(\"JV deleted successfully!\");\n        await loadVouchers();\n      } else {\n        const data = await res.json();\n        toast.error(data.error || \"Delete failed\");\n      }\n    } catch (e) {\n      toast.error(\"Delete failed\");\n    }\n  }\n\n  return (\n    <div className=\"p-6 max-w-6xl mx-auto space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-2xl font-bold\">Journal Voucher (JV)</h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => {\n              setShowList(!showList);\n              setShowForm(!showForm);\n              setEditing(null);\n            }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => {\n              setShowForm(true);\n              setShowList(false);\n              setEditing(null);\n              resetForm();\n            }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New JV\n          </button>\n        </div>\n      </div>\n\n      {/* VOUCHER LIST */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-x-auto\">\n          <table className=\"w-full text-sm min-w-[800px]\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">Voucher No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Narration</th>\n                <th className=\"p-3 text-right\">Debit</th>\n                <th className=\"p-3 text-right\">Credit</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {vouchers.length === 0 ? (\n                <tr>\n                  <td colSpan={6} className=\"p-4 text-center text-gray-400\">\n                    No JVs found\n                  </td>\n                </tr>\n              ) : (\n                vouchers.map((v) => (\n                  <tr key={v.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">{v.voucherNo}</td>\n                    <td className=\"p-3\">{v.date}</td>\n                    <td className=\"p-3\">{v.narration}</td>\n                    <td className=\"p-3 text-right\">{v.totalDebit.toLocaleString()}</td>\n                    <td className=\"p-3 text-right\">{v.totalCredit.toLocaleString()}</td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(v)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deleteVoucher(v.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <div className=\"bg-white border rounded-lg p-6 space-y-4\">\n          <h2 className=\"text-xl font-bold\">\n            {editing ? \"Edit JV\" : \"New JV\"}\n          </h2>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Date</label>\n              <input\n                type=\"date\"\n                value={date}\n                onChange={(e) => setDate(e.target.value)}\n                className=\"w-full border rounded px-3 py-2\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Narration</label>\n              <input\n                type=\"text\"\n                value={narration}\n                onChange={(e) => setNarration(e.target.value)}\n                placeholder=\"Description of transaction\"\n                className=\"w-full border rounded px-3 py-2\"\n              />\n            </div>\n          </div>\n\n          <div className=\"mt-6\">\n            <div className=\"flex justify-between items-center mb-3\">\n              <h3 className=\"font-bold\">Entries</h3>\n              <button\n                onClick={addEntry}\n                className=\"bg-blue-600 text-white px-4 py-1 rounded text-sm\"\n              >\n                + Add Entry\n              </button>\n            </div>\n\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full border min-w-[600px]\">\n                <thead>\n                  <tr className=\"bg-gray-100\">\n                    <th className=\"border p-2 text-left\">Account</th>\n                    <th className=\"border p-2 text-center w-24\">Type</th>\n                    <th className=\"border p-2 text-right\">Amount</th>\n                    <th className=\"border p-2 text-center w-20\">Action</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {entries.map((entry) => (\n                    <tr key={entry.id}>\n                      <td className=\"border p-2\">\n                        <select\n                          value={entry.accountId}\n                          onChange={(e) =>\n                            updateEntry(entry.id, \"accountId\", e.target.value)\n                          }\n                          className=\"w-full border rounded px-2 py-1\"\n                        >\n                          <option value=\"\">Select Account</option>\n                          {accounts.map((acc) => (\n                            <option key={acc.id} value={acc.id}>\n                              {acc.code} - {acc.name}\n                            </option>\n                          ))}\n                        </select>\n                      </td>\n                      <td className=\"border p-2\">\n                        <select\n                          value={entry.type}\n                          onChange={(e) =>\n                            updateEntry(entry.id, \"type\", e.target.value as \"DEBIT\" | \"CREDIT\")\n                          }\n                          className=\"w-full border rounded px-2 py-1\"\n                        >\n                          <option value=\"DEBIT\">Debit</option>\n                          <option value=\"CREDIT\">Credit</option>\n                        </select>\n                      </td>\n                      <td className=\"border p-2\">\n                        <input\n                          type=\"number\"\n                          value={entry.amount}\n                          onChange={(e) =>\n                            updateEntry(entry.id, \"amount\", e.target.value)\n                          }\n                          placeholder=\"0.00\"\n                          className=\"w-full border rounded px-2 py-1 text-right\"\n                        />\n                      </td>\n                      <td className=\"border p-2 text-center\">\n                        {entries.length > 2 && (\n                          <button\n                            onClick={() => removeEntry(entry.id)}\n                            className=\"text-red-600 hover:text-red-800\"\n                          >\n                            ✕\n                          </button>\n                        )}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr className=\"bg-gray-50 font-bold\">\n                    <td colSpan={2} className=\"border p-2 text-right\">\n                      Total:\n                    </td>\n                    <td className=\"border p-2 text-right\">\n                      <div className=\"space-y-1\">\n                        <div>\n                          Debit: <span className=\"text-green-600\">{totalDebit.toFixed(2)}</span>\n                        </div>\n                        <div>\n                          Credit: <span className=\"text-blue-600\">{totalCredit.toFixed(2)}</span>\n                        </div>\n                        <div\n                          className={\n                            isBalanced ? \"text-green-600\" : \"text-red-600\"\n                          }\n                        >\n                          {isBalanced ? \"✓ Balanced\" : \"✗ Not Balanced\"}\n                        </div>\n                      </div>\n                    </td>\n                    <td className=\"border p-2\"></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n\n          <div className=\"flex justify-end gap-2\">\n            <button\n              onClick={() => {\n                setShowForm(false);\n                setEditing(null);\n                resetForm();\n              }}\n              className=\"bg-gray-600 text-white px-6 py-2 rounded font-bold\"\n            >\n              Cancel\n            </button>\n            <button\n              onClick={saveJV}\n              disabled={saving || !isBalanced}\n              className=\"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-6 py-2 rounded font-bold\"\n            >\n              {saving ? \"Saving...\" : editing ? \"Update JV\" : \"Save JV\"}\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* VOUCHER PREVIEW */}\n      {voucher && (\n        <div className=\"bg-white border rounded-lg p-6\">\n          <h2 className=\"text-xl font-bold mb-4\">Journal Voucher Saved</h2>\n          <div className=\"space-y-2\">\n            <p>\n              <strong>Voucher No:</strong> {voucher.voucherNo}\n            </p>\n            <p>\n              <strong>Date:</strong> {voucher.date}\n            </p>\n            <p>\n              <strong>Narration:</strong> {voucher.narration}\n            </p>\n            <div className=\"mt-4\">\n              <h3 className=\"font-bold mb-2\">Entries:</h3>\n              <table className=\"w-full border\">\n                <thead>\n                  <tr className=\"bg-gray-100\">\n                    <th className=\"border p-2 text-left\">Account</th>\n                    <th className=\"border p-2 text-right\">Debit</th>\n                    <th className=\"border p-2 text-right\">Credit</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {voucher.entries?.map((entry: any, idx: number) => (\n                    <tr key={idx}>\n                      <td className=\"border p-2\">{entry.account?.name || entry.accountName || \"N/A\"}</td>\n                      <td className=\"border p-2 text-right\">\n                        {entry.amount > 0 ? entry.amount.toFixed(2) : \"-\"}\n                      </td>\n                      <td className=\"border p-2 text-right\">\n                        {entry.amount < 0 ? Math.abs(entry.amount).toFixed(2) : \"-\"}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr className=\"bg-gray-50 font-bold\">\n                    <td className=\"border p-2 text-right\">Total:</td>\n                    <td className=\"border p-2 text-right\">{totalDebit.toFixed(2)}</td>\n                    <td className=\"border p-2 text-right\">{totalCredit.toFixed(2)}</td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n            <div className=\"mt-4\">\n              <button\n                onClick={() => window.print()}\n                className=\"bg-blue-600 text-white px-4 py-2 rounded mr-2\"\n              >\n                Print\n              </button>\n              <button\n                onClick={() => {\n                  setVoucher(null);\n                  resetForm();\n                }}\n                className=\"bg-gray-200 text-gray-800 px-4 py-2 rounded\"\n              >\n                New JV\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\loans\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\outward\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[607,610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[607,610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[678,681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[678,681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1421,1424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1421,1424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleInvoiceChange'. Either include it or remove the dependency array.","line":84,"column":6,"nodeType":"ArrayExpression","endLine":84,"endColumn":65,"suggestions":[{"desc":"Update the dependencies array to be: [today, showForm, showPreview, customers, customerInvoices, handleInvoiceChange]","fix":{"range":[2950,3009],"text":"[today, showForm, showPreview, customers, customerInvoices, handleInvoiceChange]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3359,3362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3359,3362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadOutwards'. Either include it or remove the dependency array.","line":103,"column":6,"nodeType":"ArrayExpression","endLine":103,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadOutwards]","fix":{"range":[3542,3544],"text":"[loadOutwards]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4655,4658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4655,4658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5509,5512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5509,5512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5909,5912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5909,5912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5946,5949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5946,5949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":223,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7094,7097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7094,7097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7477,7480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7477,7480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":261,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":261,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":304,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9568,9571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9568,9571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\n\ntype Row = { itemId: string; name: string; qty: number | \"\"; maxQty: number };\n\ntype Outward = {\n  id: string;\n  outwardNo: number;\n  date: string;\n  customerId: string;\n  customer?: { name: string };\n  driverName?: string;\n  vehicleNo?: string;\n  remarks?: string;\n  items: Array<{ item: { name: string }; qty: number }>;\n};\n\nexport default function OutwardPage() {\n  const today = new Date().toISOString().slice(0, 10);\n  const user = getCurrentUser();\n\n  const [customers, setCustomers] = useState<any[]>([]);\n  const [customerInvoices, setCustomerInvoices] = useState<any[]>([]);\n  const [outwards, setOutwards] = useState<Outward[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<Outward | null>(null);\n\n  const [selectedInvoiceId, setSelectedInvoiceId] = useState(\"\");\n  const [customerId, setCustomerId] = useState(\"\");\n  const [date, setDate] = useState(today);\n  const [driverName, setDriverName] = useState(\"\");\n  const [vehicleNo, setVehicleNo] = useState(\"\");\n  const [remarks, setRemarks] = useState(\"\");\n  const [rows, setRows] = useState<Row[]>([]);\n\n  const [saving, setSaving] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [savedData, setSavedData] = useState<any>(null);\n\n  // Keyboard shortcuts - F7: Clear date/customer, F8: Query dialog\n  useEffect(() => {\n    function handleKeyPress(e: KeyboardEvent) {\n      if (e.code === \"F7\" || e.key === \"F7\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !showPreview) {\n          setDate(today);\n          setCustomerId(\"\");\n          setSelectedInvoiceId(\"\");\n          setRows([]);\n        }\n      }\n      if (e.code === \"F8\" || e.key === \"F8\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !showPreview) {\n          const query = prompt(\"Enter search query (Customer Name, Invoice No, etc.):\");\n          if (query) {\n            const foundCustomer = customers.find(c => \n              c.name.toLowerCase().includes(query.toLowerCase())\n            );\n            if (foundCustomer) {\n              setCustomerId(foundCustomer.id);\n            } else {\n              const foundInvoice = customerInvoices.find(inv =>\n                inv.invoiceNo.toLowerCase().includes(query.toLowerCase())\n              );\n              if (foundInvoice) {\n                setCustomerId(foundInvoice.customerId);\n                handleInvoiceChange(foundInvoice.id);\n              } else {\n                alert(`No customer or invoice found matching \"${query}\"`);\n              }\n            }\n          }\n        }\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyPress, true);\n    return () => document.removeEventListener(\"keydown\", handleKeyPress, true);\n  }, [today, showForm, showPreview, customers, customerInvoices]);\n\n  useEffect(() => {\n    loadOutwards();\n    const user = getCurrentUser();\n    fetch(\"/api/accounts?type=CUSTOMER\", { \n      headers: { \n        \"x-user-role\": user?.role || \"ADMIN\" \n      } \n    })\n      .then(r => r.json())\n      .then(d => {\n        const data = Array.isArray(d) ? d : (d.accounts || []);\n        setCustomers(data.filter((a: any) => a.partyType === \"CUSTOMER\"));\n      })\n      .catch(err => {\n        console.error(\"Error loading customers:\", err);\n        alert(\"Failed to load customers\");\n      });\n  }, []);\n\n  async function loadOutwards() {\n    try {\n      const res = await fetch(\"/api/outward\", {\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n      });\n      const data = await res.json();\n      if (Array.isArray(data)) {\n        setOutwards(data);\n      }\n    } catch (e) {\n      console.error(\"Load outwards error:\", e);\n    }\n  }\n\n  useEffect(() => {\n    if (!customerId) {\n      setCustomerInvoices([]);\n      return;\n    }\n\n    const user = getCurrentUser();\n    if (!user) {\n      alert(\"Session expired. Please login again.\");\n      return;\n    }\n\n    fetch(\"/api/sales-invoice\", {\n      headers: {\n        \"x-user-role\": user.role || \"\",\n        \"x-user-id\": user.id || \"\"\n      }\n    })\n      .then(r => {\n        if (!r.ok) {\n          if (r.status === 403) {\n            alert(\"You don't have permission to view sales invoices\");\n            return { invoices: [] };\n          }\n          throw new Error(`Failed to load invoices: ${r.status}`);\n        }\n        return r.json();\n      })\n      .then(d => {\n        if (d?.invoices) {\n          const filtered = d.invoices.filter((inv: any) => \n            inv.customerId === customerId && inv.status !== \"RETURNED\"\n          );\n          setCustomerInvoices(filtered);\n        } else if (d?.error) {\n          alert(`Error: ${d.error}`);\n        } else {\n          console.error(\"Unexpected response format:\", d);\n          setCustomerInvoices([]);\n        }\n      })\n      .catch(err => {\n        console.error(\"Error loading invoices:\", err);\n        alert(`Failed to load invoices: ${err.message || \"Unknown error\"}`);\n        setCustomerInvoices([]);\n      });\n  }, [customerId]);\n\n  async function handleInvoiceChange(invId: string) {\n    setSelectedInvoiceId(invId);\n    if (!invId) {\n      setRows([]);\n      return;\n    }\n\n    const inv = customerInvoices.find(i => i.id === invId);\n    if (inv && inv.items && Array.isArray(inv.items)) {\n      const autoRows = inv.items.map((it: any) => ({\n        itemId: it.itemId,\n        name: it.item?.name || it.name || \"Unknown Item\",\n        qty: it.qty,\n        maxQty: it.qty,\n      }));\n      setRows(autoRows);\n    } else {\n      console.error(\"Invoice not found or items missing:\", inv);\n      alert(\"Invoice items not found. Please try selecting the invoice again.\");\n    }\n  }\n\n  function updateRow(i: number, key: keyof Row, val: any) {\n    const copy = [...rows] as any;\n    copy[i][key] = val;\n    setRows(copy);\n  }\n\n  async function saveOutward() {\n    const clean = rows.filter(r => r.itemId && Number(r.qty) > 0);\n    if (!customerId || clean.length === 0) return alert(\"Select Customer and Items\");\n\n    setSaving(true);\n    try {\n      const method = editing ? \"PUT\" : \"POST\";\n      const body = editing\n        ? { id: editing.id, customerId, invoiceId: selectedInvoiceId, date, driverName, vehicleNo, remarks, items: clean }\n        : { customerId, invoiceId: selectedInvoiceId, date, driverName, vehicleNo, remarks, items: clean };\n\n      const res = await fetch(\"/api/outward\", {\n        method,\n        headers: { \"Content-Type\": \"application/json\", \"x-user-role\": user?.role || \"ADMIN\" },\n        body: JSON.stringify(body),\n      });\n\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error);\n\n      setSavedData({ ...data, customerName: customers.find(c => c.id === customerId)?.name });\n      setShowPreview(true);\n      await loadOutwards();\n      if (editing) {\n        setEditing(null);\n        setShowForm(false);\n        setShowList(true);\n      }\n    } catch (err: any) {\n      alert(err.message);\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  function startEdit(out: Outward) {\n    setEditing(out);\n    setCustomerId(out.customerId);\n    setDate(new Date(out.date).toISOString().slice(0, 10));\n    setDriverName(out.driverName || \"\");\n    setVehicleNo(out.vehicleNo || \"\");\n    setRemarks(out.remarks || \"\");\n    setRows(out.items.map((it: any) => ({\n      itemId: it.itemId || \"\",\n      name: it.item?.name || \"\",\n      qty: it.qty.toString(),\n      maxQty: it.qty,\n    })));\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deleteOutward(id: string) {\n    if (!confirm(\"Are you sure you want to delete this outward?\")) return;\n    try {\n      const res = await fetch(`/api/outward?id=${id}`, {\n        method: \"DELETE\",\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n      });\n      if (res.ok) {\n        alert(\"Outward deleted successfully\");\n        await loadOutwards();\n      } else {\n        const err = await res.json();\n        alert(err.error || \"Delete failed\");\n      }\n    } catch (e) {\n      alert(\"Delete failed\");\n    }\n  }\n\n  function resetForm() {\n    setEditing(null);\n    setCustomerId(\"\");\n    setSelectedInvoiceId(\"\");\n    setDate(today);\n    setDriverName(\"\");\n    setVehicleNo(\"\");\n    setRemarks(\"\");\n    setRows([]);\n    setShowPreview(false);\n  }\n\n  if (showPreview) {\n    return (\n      <div className=\"invoice-print p-10 bg-white min-h-screen\">\n        <div className=\"max-w-4xl mx-auto border-2 border-black p-8\">\n           <div className=\"text-center border-b-4 border-black pb-4 mb-6\">\n             <h1 className=\"text-4xl font-black\">US TRADERS</h1>\n             <p className=\"font-bold\">OUTWARD GATE PASS #{savedData.outwardNo}</p>\n           </div>\n           <div className=\"grid grid-cols-1 md:grid-cols-2 mb-6 font-bold\">\n             <div>\n               <p>CUSTOMER: {savedData.customerName}</p>\n               <p>DATE: {date}</p>\n             </div>\n             <div className=\"text-right\">\n               <p>VEHICLE: {vehicleNo}</p>\n               <p>DRIVER: {driverName}</p>\n             </div>\n           </div>\n           <table className=\"w-full border-2 border-black\">\n             <thead>\n               <tr className=\"bg-gray-100\">\n                 <th className=\"border-2 p-2\">Item</th>\n                 <th className=\"border-2 p-2\">Qty</th>\n               </tr>\n             </thead>\n             <tbody>\n               {savedData.items.map((it: any, i: number) => (\n                 <tr key={i}>\n                   <td className=\"border-2 p-2 font-bold\">{rows[i]?.name}</td>\n                   <td className=\"border-2 p-2 text-center text-xl font-black\">{it.qty}</td>\n                 </tr>\n               ))}\n             </tbody>\n           </table>\n           <div className=\"mt-20 flex justify-between\">\n             <div className=\"border-t-2 border-black w-40 text-center\">Receiver Sign</div>\n             <div className=\"border-t-2 border-black w-40 text-center\">Authorized Sign</div>\n           </div>\n        </div>\n        <div className=\"mt-8 flex gap-4 justify-center no-print\">\n          <button onClick={() => window.print()} className=\"bg-green-600 text-white px-8 py-2 font-bold\">PRINT</button>\n          <button onClick={() => { setShowPreview(false); resetForm(); }} className=\"bg-blue-600 text-white px-8 py-2 font-bold\">NEW</button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 max-w-4xl mx-auto bg-white border shadow-xl rounded-xl\">\n      <div className=\"flex justify-between items-center mb-4\">\n        <h1 className=\"text-3xl font-black border-b-4 border-black pb-2 uppercase\">\n          Outward Gate Pass\n        </h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => { setShowList(!showList); setShowForm(!showForm); setEditing(null); }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => { setShowForm(true); setShowList(false); resetForm(); }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New Outward\n          </button>\n        </div>\n      </div>\n\n      {/* LIST VIEW */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-x-auto mb-4\">\n          <table className=\"w-full text-sm min-w-[800px]\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">Outward No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Customer</th>\n                <th className=\"p-3 text-left\">Vehicle</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {outwards.length === 0 ? (\n                <tr>\n                  <td colSpan={5} className=\"p-4 text-center text-gray-400\">No outwards found</td>\n                </tr>\n              ) : (\n                outwards.map(out => (\n                  <tr key={out.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">#{out.outwardNo}</td>\n                    <td className=\"p-3\">{new Date(out.date).toLocaleDateString()}</td>\n                    <td className=\"p-3\">{out.customer?.name || \"N/A\"}</td>\n                    <td className=\"p-3\">{out.vehicleNo || \"N/A\"}</td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(out)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deleteOutward(out.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <>\n          <div className=\"mb-2 text-xs text-gray-500 italic\">\n            💡 Keyboard Shortcuts: <strong>F7</strong> = Clear Date & Customer | <strong>F8</strong> = Search Query\n          </div>\n          <div className=\"grid grid-cols-2 gap-4 mb-6\">\n            <div className=\"flex flex-col\">\n              <label className=\"text-xs font-bold uppercase\">Customer (F7: Clear, F8: Query)</label>\n              <select\n                className=\"border-2 p-3 rounded font-bold\"\n                value={customerId}\n                onChange={e => { setCustomerId(e.target.value); setSelectedInvoiceId(\"\"); setRows([]); }}\n              >\n                <option value=\"\">Select Customer</option>\n                {customers.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}\n              </select>\n            </div>\n\n            <div className=\"flex flex-col\">\n              <label className=\"text-xs font-bold uppercase\">Select Reference Invoice</label>\n              <select\n                className=\"border-2 p-3 rounded font-bold bg-blue-50\"\n                value={selectedInvoiceId}\n                onChange={e => handleInvoiceChange(e.target.value)}\n                disabled={!customerId}\n              >\n                <option value=\"\">-- Choose Sales Invoice --</option>\n                {customerInvoices.map(inv => (\n                  <option key={inv.id} value={inv.id}>{inv.invoiceNo} (Items: {inv.items.length})</option>\n                ))}\n              </select>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n            <div>\n              <label className=\"text-xs font-bold uppercase\">Date (F7: Clear)</label>\n              <input type=\"date\" className=\"border-2 p-3 rounded font-bold w-full\" value={date} onChange={e => setDate(e.target.value)} />\n            </div>\n            <input className=\"border-2 p-3 rounded font-bold\" placeholder=\"Driver Name\" value={driverName} onChange={e => setDriverName(e.target.value)} />\n            <input className=\"border-2 p-3 rounded font-bold\" placeholder=\"Vehicle No\" value={vehicleNo} onChange={e => setVehicleNo(e.target.value)} />\n          </div>\n\n          <table className=\"w-full border-2 border-black mb-4\">\n            <thead className=\"bg-black text-white text-xs\">\n              <tr>\n                <th className=\"p-3 text-left\">Item Name</th>\n                <th className=\"p-3 w-32 text-center\">Inv Qty</th>\n                <th className=\"p-3 w-32 text-center\">Dispatch Qty</th>\n              </tr>\n            </thead>\n            <tbody>\n              {rows.map((r, i) => (\n                <tr key={i}>\n                  <td className=\"p-2 font-bold border\">{r.name}</td>\n                  <td className=\"p-2 text-center border bg-gray-50\">{r.maxQty}</td>\n                  <td className=\"p-2 border\">\n                    <input\n                      type=\"number\"\n                      className=\"w-full p-2 text-center font-black bg-yellow-50\"\n                      value={r.qty}\n                      onChange={e => updateRow(i, \"qty\", Number(e.target.value))}\n                    />\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n\n          <textarea className=\"w-full border-2 p-3 rounded mb-6\" placeholder=\"Remarks\" value={remarks} onChange={e => setRemarks(e.target.value)} />\n\n          <div className=\"flex gap-2\">\n            <button\n              onClick={saveOutward}\n              disabled={saving || rows.length === 0}\n              className=\"w-full bg-blue-700 text-white font-black py-4 rounded-xl text-xl uppercase\"\n            >\n              {saving ? \"Processing...\" : editing ? \"Update Gate Pass\" : \"Save & Print Gate Pass\"}\n            </button>\n            <button\n              onClick={() => { setShowForm(false); setEditing(null); resetForm(); }}\n              className=\"bg-gray-600 text-white px-6 py-2 rounded\"\n            >\n              Cancel\n            </button>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\parties\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\projects\\smart-business-accounts\\app\\dashboard\\parties\\page.tsx:27:5\n  25 |\n  26 |   useEffect(() => {\n> 27 |     loadAccounts();\n     |     ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  28 |   }, []);\n  29 |\n  30 |   async function saveParty() {","line":27,"column":5,"nodeType":null,"endLine":27,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[921,924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[921,924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\n\r\ntype Account = {\r\n  id: string;\r\n  name: string;\r\n  partyType: \"CUSTOMER\" | \"SUPPLIER\" | null;\r\n};\r\n\r\nexport default function PartyAccounts() {\r\n  const [accounts, setAccounts] = useState<Account[]>([]);\r\n  const [name, setName] = useState(\"\");\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [partyType, setPartyType] =\r\n    useState<\"CUSTOMER\" | \"SUPPLIER\">(\"CUSTOMER\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n\r\n  async function loadAccounts() {\r\n    const res = await fetch(\"/api/accounts\");\r\n    const data = await res.json();\r\n    setAccounts(data);\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadAccounts();\r\n  }, []);\r\n\r\n  async function saveParty() {\r\n    if (!name.trim()) return;\r\n\r\n    setLoading(true);\r\n\r\n    const method = editingId ? \"PUT\" : \"POST\";\r\n    const body: any = {\r\n      name,\r\n      type: partyType === \"CUSTOMER\" ? \"ASSET\" : \"LIABILITY\",\r\n      partyType,\r\n    };\r\n\r\n    if (editingId) {\r\n      body.id = editingId;\r\n    } else {\r\n      body.code = `${partyType[0]}-${Date.now()}`;\r\n    }\r\n\r\n    await fetch(\"/api/accounts\", {\r\n      method,\r\n      headers: { \"Content-Type\": \"application/json\", \"x-user-role\": \"ADMIN\" },\r\n      body: JSON.stringify(body),\r\n    });\r\n\r\n    setName(\"\");\r\n    setPartyType(\"CUSTOMER\");\r\n    setEditingId(null);\r\n    setLoading(false);\r\n    loadAccounts();\r\n  }\r\n\r\n  function handleEdit(account: Account) {\r\n    setEditingId(account.id);\r\n    setName(account.name);\r\n    setPartyType(account.partyType === \"CUSTOMER\" ? \"CUSTOMER\" : \"SUPPLIER\");\r\n  }\r\n\r\n  function resetForm() {\r\n    setEditingId(null);\r\n    setName(\"\");\r\n    setPartyType(\"CUSTOMER\");\r\n  }\r\n\r\n  async function deleteParty(id: string) {\r\n    if (!confirm(\"Delete this party? This cannot be undone.\")) return;\r\n\r\n    await fetch(`/api/accounts?id=${id}`, {\r\n      method: \"DELETE\",\r\n      headers: { \"x-user-role\": \"ADMIN\" },\r\n    });\r\n\r\n    loadAccounts();\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-xl space-y-6\">\r\n      <h2 className=\"text-xl font-semibold\">Party Accounts</h2>\r\n\r\n      {/* Add Party */}\r\n      <div className=\"bg-white border rounded-lg p-4 space-y-3\">\r\n        <input\r\n          className=\"border rounded px-3 py-2 w-full\"\r\n          placeholder=\"Party Name\"\r\n          value={name}\r\n          onChange={(e) => setName(e.target.value)}\r\n        />\r\n\r\n        <input\r\n          className=\"border rounded px-3 py-2 w-full\"\r\n          placeholder=\"Phone (Optional)\"\r\n          value={phone}\r\n          onChange={(e) => setPhone(e.target.value)}\r\n        />\r\n\r\n        <select\r\n          className=\"border rounded px-3 py-2 w-full\"\r\n          value={partyType}\r\n          onChange={(e) =>\r\n            setPartyType(e.target.value as \"CUSTOMER\" | \"SUPPLIER\")\r\n          }\r\n        >\r\n          <option value=\"CUSTOMER\">Customer</option>\r\n          <option value=\"SUPPLIER\">Supplier</option>\r\n        </select>\r\n\r\n        <div className=\"flex gap-2\">\r\n          <button\r\n            onClick={saveParty}\r\n            disabled={loading}\r\n            className=\"bg-blue-600 text-white px-4 py-2 rounded flex-1 disabled:opacity-50\"\r\n          >\r\n            {loading ? \"Saving...\" : editingId ? \"Update Party\" : \"Add Party\"}\r\n          </button>\r\n          {editingId && (\r\n            <button\r\n              onClick={resetForm}\r\n              className=\"bg-gray-500 text-white px-4 py-2 rounded\"\r\n            >\r\n              Cancel\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Party List */}\r\n      <div className=\"bg-white border rounded-lg divide-y\">\r\n        {accounts.filter(a => a.partyType).length === 0 && (\r\n          <div className=\"p-4 text-sm text-gray-500\">\r\n            No parties added yet\r\n          </div>\r\n        )}\r\n\r\n        {accounts\r\n          .filter((a) => a.partyType)\r\n          .map((a) => (\r\n            <div\r\n              key={a.id}\r\n              className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 gap-2\"\r\n            >\r\n              <div>\r\n                <div className=\"font-medium\">{a.name}</div>\r\n                <div className=\"text-xs text-gray-500\">\r\n                  {a.partyType}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={() => handleEdit(a)}\r\n                  className=\"text-blue-600 text-sm hover:underline font-medium\"\r\n                >\r\n                  Edit\r\n                </button>\r\n                <button\r\n                  onClick={() => deleteParty(a.id)}\r\n                  className=\"text-red-600 text-sm hover:underline font-medium\"\r\n                >\r\n                  Delete\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\payment-receipts\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchBankAccounts', 'fetchParties', and 'fetchReceipts'. Either include them or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchBankAccounts, fetchParties, fetchReceipts, statusFilter]","fix":{"range":[1383,1397],"text":"[fetchBankAccounts, fetchParties, fetchReceipts, statusFilter]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3670,3673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3670,3673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { getCurrentUser } from '@/lib/auth';\n\ninterface PaymentReceipt {\n  id: string;\n  receiptNo: string;\n  date: string;\n  amount: number;\n  paymentMode: string;\n  referenceNo?: string;\n  status: string;\n  narration?: string;\n  party?: { id: string; name: string };\n}\n\ninterface Party {\n  id: string;\n  code: string;\n  name: string;\n  phone?: string;\n}\n\ninterface BankAccount {\n  id: string;\n  accountNo: string;\n  bankName: string;\n  accountName: string;\n}\n\nexport default function PaymentReceiptsPage() {\n  const user = getCurrentUser();\n  const [receipts, setReceipts] = useState<PaymentReceipt[]>([]);\n  const [parties, setParties] = useState<Party[]>([]);\n  const [bankAccounts, setBankAccounts] = useState<BankAccount[]>([]);\n  const [showForm, setShowForm] = useState(true);\n  const [showList, setShowList] = useState(false);\n  const [formData, setFormData] = useState({\n    receiptNo: '',\n    date: new Date().toISOString().split('T')[0],\n    amount: 0,\n    paymentMode: 'CASH',\n    partyId: '',\n    bankAccountId: '',\n    referenceNo: '',\n    narration: '',\n  });\n  const [loading, setLoading] = useState(false);\n  const [statusFilter, setStatusFilter] = useState('');\n  const [editingId, setEditingId] = useState('');\n\n  useEffect(() => {\n    fetchReceipts();\n    fetchParties();\n    fetchBankAccounts();\n  }, [statusFilter]);\n\n  const fetchBankAccounts = async () => {\n    try {\n      const response = await fetch('/api/bank-accounts', {\n        headers: {\n          'x-user-role': user?.role || 'ADMIN',\n          'x-user-id': user?.id || '',\n        },\n      });\n      \n      if (!response.ok) {\n        console.error('Bank accounts API error:', response.status, response.statusText);\n        setBankAccounts([]);\n        return;\n      }\n      \n      const data = await response.json();\n      if (!Array.isArray(data)) {\n        console.error('Bank accounts API did not return an array:', data);\n        setBankAccounts([]);\n        return;\n      }\n      \n      setBankAccounts(data);\n    } catch (error) {\n      console.error('Error fetching bank accounts:', error);\n      setBankAccounts([]);\n    }\n  };\n\n  const fetchReceipts = async () => {\n    try {\n      let url = '/api/payment-receipts';\n      if (statusFilter) url += `?status=${statusFilter}`;\n      const response = await fetch(url, {\n        headers: {\n          'x-user-role': user?.role || 'ADMIN',\n          'x-user-id': user?.id || '',\n        },\n      });\n      \n      if (!response.ok) {\n        console.error('Payment receipts API error:', response.status, response.statusText);\n        setReceipts([]);\n        return;\n      }\n      \n      const data = await response.json();\n      if (!Array.isArray(data)) {\n        console.error('Payment receipts API did not return an array:', data);\n        setReceipts([]);\n        return;\n      }\n      \n      setReceipts(data);\n    } catch (error) {\n      console.error('Error fetching receipts:', error);\n      setReceipts([]);\n    }\n  };\n\n  const fetchParties = async () => {\n    try {\n      const response = await fetch('/api/accounts', {\n        headers: {\n          'x-user-role': user?.role || 'ADMIN',\n          'x-user-id': user?.id || '',\n        },\n      });\n      \n      if (!response.ok) {\n        console.error('Accounts API error:', response.status, response.statusText);\n        setParties([]);\n        return;\n      }\n      \n      const data = await response.json();\n      if (!Array.isArray(data)) {\n        console.error('Accounts API did not return an array:', data);\n        setParties([]);\n        return;\n      }\n      \n      const filtered = data.filter((acc: any) => \n        acc.partyType === 'CUSTOMER' || !acc.partyType\n      );\n      setParties(filtered);\n    } catch (error) {\n      console.error('Error fetching parties:', error);\n      setParties([]);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    try {\n      const method = editingId ? 'PUT' : 'POST';\n      const url = editingId ? `/api/payment-receipts?id=${editingId}` : '/api/payment-receipts';\n      \n      const response = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ id: editingId, ...formData }),\n      });\n\n      if (response.ok) {\n        alert(editingId ? 'Payment receipt updated successfully' : 'Payment receipt saved successfully');\n        setFormData({\n          receiptNo: '',\n          date: new Date().toISOString().split('T')[0],\n          amount: 0,\n          paymentMode: 'CASH',\n          partyId: '',\n          bankAccountId: '',\n          referenceNo: '',\n          narration: '',\n        });\n        setEditingId('');\n        setShowForm(true);\n        setShowList(false);\n        fetchReceipts();\n      }\n    } catch (error) {\n      console.error('Error saving receipt:', error);\n      alert('Error: Failed to save receipt');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleEdit = (receipt: PaymentReceipt) => {\n    setEditingId(receipt.id);\n    setFormData({\n      receiptNo: receipt.receiptNo,\n      date: new Date(receipt.date).toISOString().split('T')[0],\n      amount: receipt.amount,\n      paymentMode: receipt.paymentMode,\n      partyId: receipt.party?.id || '',\n      bankAccountId: '',\n      referenceNo: receipt.referenceNo || '',\n      narration: receipt.narration || '',\n    });\n    setShowForm(true);\n    setShowList(false);\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Are you sure? This cannot be undone.')) return;\n    \n    try {\n      const response = await fetch(`/api/payment-receipts?id=${id}`, {\n        method: 'DELETE',\n      });\n\n      if (response.ok) {\n        alert('Payment receipt deleted successfully');\n        fetchReceipts();\n      } else {\n        alert('Error: Failed to delete receipt');\n      }\n    } catch (error) {\n      console.error('Error deleting receipt:', error);\n      alert('Error: Failed to delete receipt');\n    }\n  };\n\n  const handleClearCheque = async (receipt: PaymentReceipt) => {\n    if (!confirm(`Clear cheque ${receipt.referenceNo || receipt.receiptNo}?`)) return;\n    \n    try {\n      const response = await fetch(`/api/payment-receipts?id=${receipt.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          id: receipt.id, \n          status: 'CLEARED',\n          date: receipt.date,\n          amount: receipt.amount,\n          paymentMode: receipt.paymentMode,\n          partyId: receipt.party?.id,\n          referenceNo: receipt.referenceNo,\n          narration: receipt.narration,\n        }),\n      });\n\n      if (response.ok) {\n        alert('Cheque marked as cleared');\n        fetchReceipts();\n      } else {\n        alert('Error: Failed to clear cheque');\n      }\n    } catch (error) {\n      console.error('Error clearing cheque:', error);\n      alert('Error: Failed to clear cheque');\n    }\n  };\n\n  return (\n    <div className=\"p-6 max-w-6xl mx-auto\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-3xl font-bold\">Payment Receipts</h1>\n        <button\n          onClick={() => {\n            setShowList(!showList);\n            setShowForm(!showForm);\n          }}\n          className=\"bg-gray-600 text-white px-6 py-2 rounded font-semibold hover:bg-gray-700\"\n        >\n          {showList ? \"Back to Form\" : \"View List\"}\n        </button>\n      </div>\n\n      {/* Form */}\n      {showForm && (\n        <form\n          onSubmit={handleSubmit}\n          className=\"bg-white p-6 rounded-lg shadow mb-6\"\n        >\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n            <div>\n              <label className=\"block text-sm font-semibold mb-2\">\n                Receipt No <span className=\"text-gray-500 text-xs\">(Auto-generated if empty)</span>\n              </label>\n              <input\n                type=\"text\"\n                value={formData.receiptNo}\n                onChange={(e) =>\n                  setFormData({ ...formData, receiptNo: e.target.value })\n                }\n                placeholder=\"Leave empty for auto-generation\"\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-semibold mb-2\">Date</label>\n              <input\n                type=\"date\"\n                required\n                value={formData.date}\n                onChange={(e) =>\n                  setFormData({ ...formData, date: e.target.value })\n                }\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-semibold mb-2\">Amount</label>\n              <input\n                type=\"number\"\n                required\n                step=\"0.01\"\n                value={formData.amount}\n                onChange={(e) =>\n                  setFormData({\n                    ...formData,\n                    amount: parseFloat(e.target.value),\n                  })\n                }\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-semibold mb-2\">Payment Mode</label>\n              <select\n                value={formData.paymentMode}\n                onChange={(e) =>\n                  setFormData({ ...formData, paymentMode: e.target.value, bankAccountId: e.target.value === 'CASH' ? '' : formData.bankAccountId })\n                }\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\n              >\n                <option value=\"CASH\">Cash</option>\n                <option value=\"CHEQUE\">Cheque</option>\n                <option value=\"BANK_TRANSFER\">Bank Transfer</option>\n              </select>\n            </div>\n            {(formData.paymentMode === 'CHEQUE' || formData.paymentMode === 'BANK_TRANSFER') && (\n              <div>\n                <label className=\"block text-sm font-semibold mb-2\">Bank Account *</label>\n                <select\n                  required\n                  value={formData.bankAccountId}\n                  onChange={(e) =>\n                    setFormData({ ...formData, bankAccountId: e.target.value })\n                  }\n                  className=\"w-full border border-gray-300 rounded px-3 py-2\"\n                >\n                  <option value=\"\">Select Bank Account</option>\n                  {bankAccounts.map((bank) => (\n                    <option key={bank.id} value={bank.id}>\n                      {bank.bankName} - {bank.accountNo} ({bank.accountName})\n                    </option>\n                  ))}\n                </select>\n              </div>\n            )}\n            <div>\n              <label className=\"block text-sm font-semibold mb-2\">Party</label>\n              <select\n                value={formData.partyId}\n                onChange={(e) =>\n                  setFormData({ ...formData, partyId: e.target.value })\n                }\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\n              >\n                <option value=\"\">Select</option>\n                {parties.map((party) => (\n                  <option key={party.id} value={party.id}>\n                    {party.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div>\n              <label className=\"block text-sm font-semibold mb-2\">Reference No</label>\n              <input\n                type=\"text\"\n                value={formData.referenceNo}\n                onChange={(e) =>\n                  setFormData({ ...formData, referenceNo: e.target.value })\n                }\n                placeholder=\"Cheque No or Transaction ID\"\n                className=\"w-full border border-gray-300 rounded px-3 py-2\"\n              />\n            </div>\n          </div>\n          <div className=\"mb-4\">\n            <label className=\"block text-sm font-semibold mb-2\">Description</label>\n            <textarea\n              value={formData.narration}\n              onChange={(e) =>\n                setFormData({ ...formData, narration: e.target.value })\n              }\n              className=\"w-full border border-gray-300 rounded px-3 py-2\"\n              rows={3}\n            />\n          </div>\n          <div className=\"flex gap-4\">\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"bg-blue-500 text-white px-6 py-2 rounded font-semibold hover:bg-blue-600 disabled:opacity-50\"\n            >\n              {loading ? 'Saving...' : editingId ? 'Update' : 'Save'}\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => {\n                setShowForm(false);\n                setShowList(true);\n                setEditingId('');\n                setFormData({\n                  receiptNo: '',\n                  date: new Date().toISOString().split('T')[0],\n                  amount: 0,\n                  paymentMode: 'CASH',\n                  partyId: '',\n                  bankAccountId: '',\n                  referenceNo: '',\n                  narration: '',\n                });\n              }}\n              className=\"bg-gray-500 text-white px-6 py-2 rounded font-semibold hover:bg-gray-600\"\n            >\n              Clear\n            </button>\n          </div>\n        </form>\n      )}\n\n      {/* Filter */}\n      {showList && (\n        <div className=\"mb-6\">\n          <select\n            value={statusFilter}\n            onChange={(e) => setStatusFilter(e.target.value)}\n            className=\"border border-gray-300 rounded px-4 py-2\"\n          >\n            <option value=\"\">All Status</option>\n            <option value=\"PENDING\">Pending</option>\n            <option value=\"CLEARED\">Cleared</option>\n            <option value=\"BOUNCED\">Bounced</option>\n          </select>\n        </div>\n      )}\n\n      {/* List */}\n      {showList && (\n        <div className=\"bg-white rounded-lg shadow overflow-x-auto\">\n          <table className=\"w-full min-w-[800px]\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"px-6 py-3 text-left\">Receipt No</th>\n                <th className=\"px-6 py-3 text-left\">Date</th>\n                <th className=\"px-6 py-3 text-left\">Amount</th>\n                <th className=\"px-6 py-3 text-left\">Mode</th>\n                <th className=\"px-6 py-3 text-left\">Party</th>\n                <th className=\"px-6 py-3 text-left\">Status</th>\n                <th className=\"px-6 py-3 text-left\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {receipts.map((receipt) => (\n                <tr key={receipt.id} className=\"border-b hover:bg-gray-50\">\n                  <td className=\"px-6 py-3 font-semibold\">{receipt.receiptNo}</td>\n                  <td className=\"px-6 py-3\">\n                    {new Date(receipt.date).toLocaleDateString()}\n                  </td>\n                  <td className=\"px-6 py-3\">{receipt.amount.toFixed(2)}</td>\n                  <td className=\"px-6 py-3\">{receipt.paymentMode}</td>\n                  <td className=\"px-6 py-3\">{receipt.party?.name || '-'}</td>\n                  <td className=\"px-6 py-3\">\n                    <span className={`px-3 py-1 rounded text-white text-sm ${\n                      receipt.status === 'PENDING' ? 'bg-yellow-500' :\n                      receipt.status === 'CLEARED' ? 'bg-green-500' :\n                      'bg-red-500'\n                    }`}>\n                      {receipt.status}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-3 space-x-2\">\n                    {receipt.status === 'PENDING' && receipt.paymentMode === 'CHEQUE' && (\n                      <button\n                        onClick={() => handleClearCheque(receipt)}\n                        className=\"text-green-600 hover:text-green-800 font-medium text-sm\"\n                      >\n                        Clear ✓\n                      </button>\n                    )}\n                    <button\n                      onClick={() => handleEdit(receipt)}\n                      className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                    >\n                      Edit\n                    </button>\n                    <button\n                      onClick={() => handleDelete(receipt.id)}\n                      className=\"text-red-500 hover:text-red-700 font-medium text-sm\"\n                    >\n                      Delete\n                    </button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\payroll\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[622,625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[622,625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPayroll'. Either include it or remove the dependency array.","line":53,"column":6,"nodeType":"ArrayExpression","endLine":53,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPayroll, monthYear]","fix":{"range":[1574,1585],"text":"[fetchPayroll, monthYear]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'calculateAutoDeductions'. Either include it or remove the dependency array.","line":61,"column":6,"nodeType":"ArrayExpression","endLine":61,"endColumn":68,"suggestions":[{"desc":"Update the dependencies array to be: [formData.employeeId, formData.monthYear, formData.baseSalary, calculateAutoDeductions]","fix":{"range":[1756,1818],"text":"[formData.employeeId, formData.monthYear, formData.baseSalary, calculateAutoDeductions]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2217,2220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2217,2220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2633,2636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2633,2636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\ninterface Payroll {\r\n  id: string;\r\n  employeeId: string;\r\n  monthYear: string;\r\n  baseSalary: number;\r\n  allowances: number;\r\n  deductions: number;\r\n  deductionReason?: string;\r\n  additionalCash: number;\r\n  netSalary: number;\r\n  paymentStatus: string;\r\n  employee: { firstName: string; lastName: string; employeeId: string };\r\n}\r\n\r\nexport default function PayrollPage() {\r\n  const user = getCurrentUser();\r\n  const [payroll, setPayroll] = useState<Payroll[]>([]);\r\n  const [employees, setEmployees] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  const [monthYear, setMonthYear] = useState(() => {\r\n    const d = new Date();\r\n    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}`;\r\n  });\r\n  const [detectedAdvance, setDetectedAdvance] = useState(0);\r\n\r\n  // Preview State\r\n  const [showPreview, setShowPreview] = useState(false);\r\n\r\n  const [formData, setFormData] = useState({\r\n    employeeId: \"\",\r\n    monthYear: (() => {\r\n      const d = new Date();\r\n      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}`;\r\n    })(),\r\n    baseSalary: 0,\r\n    allowances: 0,\r\n    deductions: 0,\r\n    deductionReason: \"\",\r\n    additionalCash: 0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchEmployees();\r\n    fetchPayroll();\r\n    // Sync form date with view date for convenience\r\n    setFormData((prev) => ({ ...prev, monthYear }));\r\n  }, [monthYear]);\r\n\r\n  useEffect(() => {\r\n    if (formData.employeeId && formData.monthYear) {\r\n      calculateAutoDeductions();\r\n    } else {\r\n      setDetectedAdvance(0);\r\n    }\r\n  }, [formData.employeeId, formData.monthYear, formData.baseSalary]);\r\n\r\n  async function calculateAutoDeductions() {\r\n    try {\r\n      // 1. Fetch Advances\r\n      const resAdvance = await fetch(\r\n        `/api/advance?employeeId=${formData.employeeId}&status=PENDING&monthYear=${formData.monthYear}`,\r\n      );\r\n      const dataAdvance = await resAdvance.json();\r\n      const advanceTotal = Array.isArray(dataAdvance)\r\n        ? dataAdvance.reduce((sum: number, a: any) => sum + a.amount, 0)\r\n        : 0;\r\n\r\n      setDetectedAdvance(advanceTotal);\r\n\r\n      // 2. Fetch Attendance (Absents)\r\n      const resAttendance = await fetch(\r\n        `/api/attendance?employeeId=${formData.employeeId}&month=${formData.monthYear}`,\r\n      );\r\n      const dataAttendance = await resAttendance.json();\r\n      const absents = Array.isArray(dataAttendance)\r\n        ? dataAttendance.filter((r: any) => r.status === \"ABSENT\").length\r\n        : 0;\r\n\r\n      // 3. Check Previous Month Balance (Carry Forward)\r\n      let prevBalanceDeduction = 0;\r\n      try {\r\n        const [year, month] = formData.monthYear.split(\"-\").map(Number);\r\n        \r\n        // Robust previous month calculation avoiding timezone issues\r\n        let prevYear = year;\r\n        let prevMonth = month - 1;\r\n        if (prevMonth === 0) {\r\n          prevMonth = 12;\r\n          prevYear -= 1;\r\n        }\r\n        const prevMonthStr = `${prevYear}-${prevMonth.toString().padStart(2, \"0\")}`;\r\n\r\n        const resPrev = await fetch(\r\n          `/api/payroll?employeeId=${formData.employeeId}&monthYear=${prevMonthStr}`,\r\n          { cache: \"no-store\" },\r\n        );\r\n        const dataPrev = await resPrev.json();\r\n\r\n        if (Array.isArray(dataPrev) && dataPrev.length > 0) {\r\n          const prevRecord = dataPrev[0];\r\n\r\n          // Recalculate Net Salary strictly as (Earnings - Deductions) to ignore any DB inconsistencies\r\n          const prevNetSalary =\r\n            prevRecord.baseSalary +\r\n            (prevRecord.allowances || 0) -\r\n            (prevRecord.deductions || 0);\r\n\r\n          // Actual Balance = Net Salary - Additional Cash\r\n          const prevActualBalance =\r\n            prevNetSalary - (prevRecord.additionalCash || 0);\r\n\r\n          // If Actual Balance is negative, it means they owe us money (Carry Forward)\r\n          if (prevActualBalance < 0) {\r\n            prevBalanceDeduction = Math.abs(prevActualBalance);\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Error checking previous balance\", e);\r\n      }\r\n\r\n      // 4. Calculate Total Deduction\r\n      // Assumption: 30 days per month\r\n      const perDaySalary =\r\n        formData.baseSalary > 0 ? formData.baseSalary / 30 : 0;\r\n      const absentDeduction = Math.round(absents * perDaySalary);\r\n\r\n      const totalDeduction =\r\n        advanceTotal + absentDeduction + prevBalanceDeduction;\r\n\r\n      // 5. Generate Reason\r\n      const parts = [];\r\n      if (prevBalanceDeduction > 0)\r\n        parts.push(`Prev Bal: ${prevBalanceDeduction}`);\r\n      if (absents > 0) parts.push(`${absents} Absent`);\r\n      if (advanceTotal > 0) parts.push(\"Advance\");\r\n\r\n      const reason = parts.join(\", \");\r\n\r\n      // 6. Update Form\r\n      if (totalDeduction > 0) {\r\n        setFormData((prev) => ({\r\n          ...prev,\r\n          deductions: totalDeduction,\r\n          deductionReason: reason,\r\n        }));\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error calculating deductions\", error);\r\n    }\r\n  }\r\n\r\n  async function fetchEmployees() {\r\n    try {\r\n      const res = await fetch(\"/api/employees\");\r\n      const data = await res.json();\r\n      setEmployees(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching employees\", error);\r\n      setEmployees([]);\r\n    }\r\n  }\r\n\r\n  async function fetchPayroll() {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(`/api/payroll?monthYear=${monthYear}`, {\r\n        cache: \"no-store\",\r\n      });\r\n      const data = await res.json();\r\n      setPayroll(Array.isArray(data) ? data : []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching payroll\", error);\r\n      setPayroll([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    if (!user) return alert(\"Login required\");\r\n    setLoading(true);\r\n    await fetch(editingId ? `/api/payroll?id=${editingId}` : \"/api/payroll\", {\r\n      method: editingId ? \"PUT\" : \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"x-user-role\": user.role,\r\n        \"x-user-id\": user.id,\r\n      },\r\n      body: JSON.stringify(formData),\r\n    });\r\n    setEditingId(null);\r\n    setFormData({\r\n      employeeId: \"\",\r\n      monthYear,\r\n      baseSalary: 0,\r\n      allowances: 0,\r\n      deductions: 0,\r\n      deductionReason: \"\",\r\n      additionalCash: 0,\r\n    });\r\n    await fetchPayroll();\r\n    setLoading(false);\r\n  }\r\n\r\n  function handleEdit(p: Payroll) {\r\n    setEditingId(p.id);\r\n    setFormData({\r\n      employeeId: p.employeeId,\r\n      monthYear: p.monthYear,\r\n      baseSalary: p.baseSalary,\r\n      allowances: p.allowances,\r\n      deductions: p.deductions,\r\n      deductionReason: p.deductionReason || \"\",\r\n      additionalCash: p.additionalCash || 0,\r\n    });\r\n  }\r\n\r\n  async function handleDelete(id: string) {\r\n    if (!confirm(\"Delete this payroll record?\") || !user) return;\r\n    await fetch(`/api/payroll?id=${id}`, {\r\n      method: \"DELETE\",\r\n      headers: { \"x-user-role\": user.role, \"x-user-id\": user.id },\r\n    });\r\n    await fetchPayroll();\r\n  }\r\n\r\n  /* ================= PAYSLIP PRINT ================= */\r\n\r\n  function handlePrintPayslip(p: Payroll) {\r\n    const printWindow = window.open(\"\", \"_blank\");\r\n    if (!printWindow) return alert(\"Please allow popups\");\r\n\r\n    const html = `\r\n      <html>\r\n        <head>\r\n          <title>Payslip - ${p.employee.firstName}</title>\r\n          <style>\r\n            body { font-family: sans-serif; padding: 40px; max-width: 600px; margin: 0 auto; border: 1px solid #ccc; }\r\n            .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 10px; }\r\n            .row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 5px; }\r\n            .label { font-weight: bold; color: #555; }\r\n            .amount { font-family: monospace; font-size: 1.1em; }\r\n            .net-pay { margin-top: 20px; border-top: 2px solid #333; padding-top: 10px; font-size: 1.3em; font-weight: bold; }\r\n            .footer { margin-top: 40px; text-align: center; font-size: 0.8em; color: #888; }\r\n            @media print { body { border: none; } }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"header\">\r\n            <h1>Payslip</h1>\r\n            <p>Period: ${p.monthYear}</p>\r\n          </div>\r\n          <div class=\"row\">\r\n            <span class=\"label\">Employee ID:</span>\r\n            <span>${p.employee.employeeId}</span>\r\n          </div>\r\n          <div class=\"row\">\r\n            <span class=\"label\">Employee Name:</span>\r\n            <span>${p.employee.firstName} ${p.employee.lastName}</span>\r\n          </div>\r\n          <div class=\"row\">\r\n            <span class=\"label\">Basic Salary:</span>\r\n            <span class=\"amount\">${p.baseSalary.toLocaleString()}</span>\r\n          </div>\r\n          <div class=\"row\">\r\n            <span class=\"label\">Allowances:</span>\r\n            <span class=\"amount\">${p.allowances.toLocaleString()}</span>\r\n          </div>\r\n          <div class=\"row\">\r\n            <span class=\"label\">Deductions:</span>\r\n            <span class=\"amount\">-${p.deductions.toLocaleString()}</span>\r\n          </div>\r\n          <div className=\"row net-pay\">\r\n            <span class=\"label\">Pay:</span>\r\n            <span class=\"amount\">${(p.baseSalary + p.allowances - p.deductions).toLocaleString()}</span>\r\n          </div>\r\n          ${\r\n            p.additionalCash > 0\r\n              ? `\r\n            <div class=\"row\">\r\n                <span class=\"label\">Additional Cash (Manual):</span>\r\n                <span class=\"amount\">-${p.additionalCash.toLocaleString()}</span>\r\n            </div>\r\n          `\r\n              : \"\"\r\n          }\r\n          <div class=\"row\" style=\"font-weight: bold; border-top: 1px solid #eee; padding-top: 5px;\">\r\n              <span class=\"label\">Next Month:</span>\r\n              <span class=\"amount\">${(p.baseSalary + p.allowances - p.deductions - (p.additionalCash || 0)).toLocaleString()}</span>\r\n          </div>\r\n          ${\r\n            p.baseSalary +\r\n              p.allowances -\r\n              p.deductions -\r\n              (p.additionalCash || 0) <\r\n            0\r\n              ? `\r\n            <div class=\"row\" style=\"color: red; margin-top: 5px;\">\r\n                <span class=\"label\">Carry Forward to Next Month:</span>\r\n                <span class=\"amount\">${(p.baseSalary + p.allowances - p.deductions - (p.additionalCash || 0)).toLocaleString()}</span>\r\n            </div>\r\n          `\r\n              : \"\"\r\n          }\r\n          <div class=\"row\">\r\n            <span class=\"label\">Reason/Remarks:</span>\r\n            <span>${p.deductionReason || \"-\"}</span>\r\n          </div>\r\n          <div class=\"footer\">\r\n            <p>System Generated Payslip</p>\r\n          </div>\r\n          <script>window.print();</script>\r\n        </body>\r\n      </html>\r\n    `;\r\n    printWindow.document.write(html);\r\n    printWindow.document.close();\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gray-100 min-h-screen print:bg-white print:p-0\">\r\n      <div className=\"max-w-6xl mx-auto space-y-6 print:hidden\">\r\n        {/* HEADER */}\r\n        <div className=\"flex flex-col md:flex-row justify-between items-center gap-4\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <h1 className=\"text-3xl font-black text-gray-800\">💰 Payroll</h1>\r\n            <input\r\n              type=\"month\"\r\n              value={monthYear}\r\n              onChange={(e) => setMonthYear(e.target.value)}\r\n              className=\"border-2 border-blue-500 text-blue-800 font-bold px-3 py-1 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n            />\r\n          </div>\r\n          <div className=\"flex gap-3\">\r\n            <button\r\n              onClick={() => setShowPreview(true)}\r\n              className=\"bg-gray-800 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-black transition-all\"\r\n            >\r\n              👁️ Show Preview\r\n            </button>\r\n            <button\r\n              onClick={() => window.print()}\r\n              className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-bold shadow-md transition-all\"\r\n            >\r\n              🖨️ Print Now\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* FORM */}\r\n        <div className=\"bg-white p-6 rounded-xl shadow-sm border\">\r\n          <form\r\n            onSubmit={handleSubmit}\r\n            className=\"grid grid-cols-1 md:grid-cols-4 gap-4\"\r\n          >\r\n            <select\r\n              required\r\n              value={formData.employeeId}\r\n              onChange={(e) => {\r\n                const emp = employees.find((x) => x.id === e.target.value);\r\n                setFormData({\r\n                  ...formData,\r\n                  employeeId: e.target.value,\r\n                  baseSalary: emp?.salary || 0,\r\n                });\r\n              }}\r\n              className=\"border p-2 rounded-lg outline-none\"\r\n            >\r\n              <option value=\"\">Select Employee</option>\r\n              {employees.map((e) => (\r\n                <option key={e.id} value={e.id}>\r\n                  {e.employeeId} - {e.firstName} {e.lastName}\r\n                </option>\r\n              ))}\r\n            </select>\r\n\r\n            <input\r\n              type=\"month\"\r\n              value={formData.monthYear}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, monthYear: e.target.value })\r\n              }\r\n              className=\"border p-2 rounded-lg\"\r\n            />\r\n            <input\r\n              type=\"number\"\r\n              placeholder=\"Basic Salary\"\r\n              value={formData.baseSalary}\r\n              onChange={(e) =>\r\n                setFormData({ ...formData, baseSalary: +e.target.value || 0 })\r\n              }\r\n              className=\"border p-2 rounded-lg\"\r\n            />\r\n            <button\r\n              disabled={loading}\r\n              className=\"bg-black text-white rounded-lg font-bold py-2 px-4 transition-colors\"\r\n            >\r\n              {editingId ? \"Update Record\" : \"Save Record\"}\r\n            </button>\r\n\r\n            <div className=\"col-span-1 md:col-span-4 grid grid-cols-2 gap-4 mt-2\">\r\n              <input\r\n                type=\"number\"\r\n                placeholder=\"Allowances\"\r\n                value={formData.allowances}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, allowances: +e.target.value || 0 })\r\n                }\r\n                className=\"border p-2 rounded-lg\"\r\n              />\r\n              <div className=\"grid grid-cols-2 gap-2\">\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"number\"\r\n                    placeholder=\"Deductions\"\r\n                    value={formData.deductions}\r\n                    onChange={(e) =>\r\n                      setFormData({\r\n                        ...formData,\r\n                        deductions: +e.target.value || 0,\r\n                      })\r\n                    }\r\n                    className=\"border p-2 rounded-lg w-full\"\r\n                  />\r\n                  {detectedAdvance > 0 && (\r\n                    <span className=\"text-xs text-red-500 absolute -bottom-5 left-0\">\r\n                      Advance: {detectedAdvance}\r\n                    </span>\r\n                  )}\r\n                </div>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Reason (e.g. Advance)\"\r\n                  value={formData.deductionReason}\r\n                  onChange={(e) =>\r\n                    setFormData({\r\n                      ...formData,\r\n                      deductionReason: e.target.value,\r\n                    })\r\n                  }\r\n                  className=\"border p-2 rounded-lg w-full\"\r\n                />\r\n              </div>\r\n\r\n              {/* NEW FIELD: Additional Cash */}\r\n              <div className=\"col-span-2 mt-2\">\r\n                <label className=\"text-sm font-bold text-gray-700\">\r\n                  Additional Cash (Manual Add):\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  placeholder=\"e.g. 1000\"\r\n                  value={formData.additionalCash}\r\n                  onChange={(e) =>\r\n                    setFormData({\r\n                      ...formData,\r\n                      additionalCash: +e.target.value || 0,\r\n                    })\r\n                  }\r\n                  className=\"border p-2 rounded-lg w-full border-green-500\"\r\n                />\r\n                <p className=\"text-xs text-gray-500\">\r\n                  This amount is subtracted from Net Salary (increasing\r\n                  deduction/debt). Final Balance carries forward.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* MAIN TABLE (Non-Print View) */}\r\n        <div className=\"bg-white rounded-xl shadow border overflow-x-auto\">\r\n          <table className=\"w-full min-w-[800px]\">\r\n            <thead className=\"bg-gray-50 border-b\">\r\n              <tr>\r\n                <th className=\"p-3 text-left\">Emp ID</th>\r\n                <th className=\"p-3 text-left\">Name</th>\r\n                <th className=\"p-3 text-left\">Basic Salary</th>\r\n                <th className=\"p-3 text-center\">Deductions</th>\r\n                <th className=\"p-3 text-center\">Deduction Reason</th>\r\n                <th className=\"p-3 text-center\">Pay</th>\r\n                <th className=\"p-3 text-center\">Paid</th>\r\n                <th className=\"p-3 text-center bg-red-50 text-red-800\">\r\n                  Next Month\r\n                </th>\r\n                <th className=\"p-3 text-center\">Action</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {payroll.map((p) => (\r\n                <tr key={p.id} className=\"border-b\">\r\n                  <td className=\"p-3 font-medium\">{p.employee.employeeId}</td>\r\n                  <td className=\"p-3\">\r\n                    {p.employee.firstName} {p.employee.lastName}\r\n                  </td>\r\n                  <td className=\"p-3\">{p.baseSalary.toLocaleString()}</td>\r\n                  <td className=\"p-3 text-center font-bold text-red-700\">\r\n                    {p.deductions > 0\r\n                      ? `-${p.deductions.toLocaleString()}`\r\n                      : p.deductions}\r\n                  </td>\r\n                  <td className=\"p-3 text-center font-bold text-red-700\">\r\n                    {p.deductionReason}\r\n                  </td>\r\n                  <td className=\"p-3 text-center font-bold text-gray-700\">\r\n                    {(\r\n                      p.baseSalary +\r\n                      p.allowances -\r\n                      p.deductions\r\n                    ).toLocaleString()}\r\n                  </td>\r\n                  <td className=\"p-3 text-center font-bold text-blue-700\">\r\n                    {p.additionalCash > 0\r\n                      ? `${p.additionalCash.toLocaleString()}`\r\n                      : \"-\"}\r\n                  </td>\r\n                  <td className=\"p-3 text-center font-bold text-green-700 bg-red-50\">\r\n                    {p.baseSalary +\r\n                      p.allowances -\r\n                      p.deductions -\r\n                      (p.additionalCash || 0) <\r\n                    0 ? (\r\n                      <div className=\"bg-red-100 text-red-700 px-2 py-1 rounded-md border border-red-200\">\r\n                        <p className=\"text-[10px] uppercase\">\r\n                          {(\r\n                            p.baseSalary +\r\n                            p.allowances -\r\n                            p.deductions -\r\n                            (p.additionalCash || 0)\r\n                          ).toLocaleString()}\r\n                        </p>\r\n                      </div>\r\n                    ) : (\r\n                      (\r\n                        p.baseSalary +\r\n                        p.allowances -\r\n                        p.deductions -\r\n                        (p.additionalCash || 0)\r\n                      ).toLocaleString()\r\n                    )}\r\n                  </td>\r\n                  <td className=\"p-3 text-center space-x-2 flex justify-center items-center\">\r\n                    <button\r\n                      onClick={() => handlePrintPayslip(p)}\r\n                      className=\"text-gray-600 font-bold bg-gray-200 px-2 py-1 rounded text-xs hover:bg-gray-300\"\r\n                    >\r\n                      Slip\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleEdit(p)}\r\n                      className=\"text-blue-600 font-bold\"\r\n                    >\r\n                      Edit\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleDelete(p.id)}\r\n                      className=\"text-red-600 font-bold\"\r\n                    >\r\n                      Delete\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n            <tfoot>\r\n              <tr className=\"bg-gray-100 font-bold\">\r\n                <td\r\n                  colSpan={2}\r\n                  className=\"border border-gray-400 p-2 text-right\"\r\n                >\r\n                  TOTALS:\r\n                </td>\r\n                <td className=\"border border-gray-400 p-2 text-center\">\r\n                  {payroll\r\n                    .reduce((sum, p) => sum + p.baseSalary, 0)\r\n                    .toLocaleString()}\r\n                </td>\r\n                <td className=\"border border-gray-400 p-2 text-center text-red-600\">\r\n                  -\r\n                  {payroll\r\n                    .reduce((sum, p) => sum + p.deductions, 0)\r\n                    .toLocaleString()}\r\n                </td>\r\n\r\n                <td className=\"border border-gray-400 p-2\"></td>\r\n                <td className=\"border border-gray-400 p-2\"></td>\r\n                <td className=\"border border-gray-400 p-2 text-center text-blue-600\">\r\n                  {payroll\r\n                    .reduce((sum, p) => sum + (p.additionalCash || 0), 0)\r\n                    .toLocaleString()}\r\n                </td>\r\n                <td className=\"border border-gray-400 p-2 text-center text-red-800 bg-gray-50\">\r\n                  {payroll\r\n                    .reduce((sum, p) => {\r\n                      const pay = p.baseSalary + p.allowances - p.deductions;\r\n                      const balance = pay - (p.additionalCash || 0);\r\n                      return balance < 0 ? sum + balance : sum;\r\n                    }, 0)\r\n                    .toLocaleString()}\r\n                </td>\r\n              </tr>\r\n            </tfoot>\r\n          </table>\r\n        </div>\r\n      </div>\r\n\r\n      {/* --- ACTUAL PRINTING CONTENT (Hidden on screen, shown on print) --- */}\r\n      <div className=\"invoice-print hidden print:block font-serif text-black p-8\">\r\n        <div className=\"text-center mb-8\">\r\n          <h1 className=\"text-3xl font-bold uppercase tracking-widest\">\r\n            Payroll Report\r\n          </h1>\r\n          <p className=\"text-lg\">\r\n            For the Month of:{\" \"}\r\n            <span className=\"font-bold underline\">{monthYear}</span>\r\n          </p>\r\n        </div>\r\n        <table className=\"w-full border-2 border-black\">\r\n          <thead>\r\n            <tr className=\"bg-gray-200\">\r\n              <th className=\"border-2 border-black p-2\">ID</th>\r\n              <th className=\"border-2 border-black p-2\">Employee Name</th>\r\n              <th className=\"border-2 border-black p-2\">Basic</th>\r\n              <th className=\"border-2 border-black p-2\">Deductions</th>\r\n              <th className=\"border-2 border-black p-2\">Deduction reason</th>\r\n\r\n              <th className=\"border-2 border-black p-2\">Pay</th>\r\n              <th className=\"border-2 border-black p-2\">Paid</th>\r\n              <th className=\"border-2 border-black p-2 bg-red-100\">\r\n                Next Month\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {payroll.map((p) => (\r\n              <tr key={p.id}>\r\n                <td className=\"border-2 border-black p-2 text-center\">\r\n                  {p.employee.employeeId}\r\n                </td>\r\n                <td className=\"border-2 border-black p-2\">\r\n                  {p.employee.firstName} {p.employee.lastName}\r\n                </td>\r\n                <td className=\"border-2 border-black p-2 text-center\">\r\n                  {p.baseSalary.toLocaleString()}\r\n                </td>\r\n                <td className=\"border-2 border-black p-2 text-center text-red-600 font-bold\">\r\n                  {p.deductions > 0\r\n                    ? `-${p.deductions.toLocaleString()}`\r\n                    : p.deductions}\r\n                </td>\r\n                {/* {p.deductions > 0 ? p.deductions.toLocaleString() : \"-\"} */}\r\n                <td className=\"border-2 border-black p-2 text-center\">\r\n                  {p.deductionReason || \"-\"}\r\n                </td>\r\n                <td className=\"border-2 border-black p-2 text-center font-bold\">\r\n                  {(\r\n                    p.baseSalary +\r\n                    p.allowances -\r\n                    p.deductions\r\n                  ).toLocaleString()}\r\n                </td>\r\n                <td className=\"border-2 border-black p-2 text-center text-blue-600 font-bold\">\r\n                  {p.additionalCash > 0\r\n                    ? p.additionalCash.toLocaleString()\r\n                    : \"-\"}\r\n                </td>\r\n                <td className=\"border-2 border-black p-2 text-center text-red-800 font-bold bg-red-50\">\r\n                  {p.baseSalary +\r\n                    p.allowances -\r\n                    p.deductions -\r\n                    (p.additionalCash || 0) <\r\n                  0 ? (\r\n                    <div className=\"flex flex-col items-center\">\r\n                      {/* <span className=\"text-black\">0</span> */}\r\n                      <span className=\"text-red-600 text-[10px] whitespace-nowrap\">\r\n                        {(\r\n                          p.baseSalary +\r\n                          p.allowances -\r\n                          p.deductions -\r\n                          (p.additionalCash || 0)\r\n                        ).toLocaleString()}\r\n                      </span>\r\n                    </div>\r\n                  ) : (\r\n                    (\r\n                      p.baseSalary +\r\n                      p.allowances -\r\n                      p.deductions -\r\n                      (p.additionalCash || 0)\r\n                    ).toLocaleString()\r\n                  )}\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n          <tfoot>\r\n            <tr className=\"bg-gray-100 font-bold\">\r\n              <td colSpan={2} className=\"border border-gray-400 p-2 text-right\">\r\n                TOTALS:\r\n              </td>\r\n              <td className=\"border border-gray-400 p-2 text-center\">\r\n                {payroll\r\n                  .reduce((sum, p) => sum + p.baseSalary, 0)\r\n                  .toLocaleString()}\r\n              </td>\r\n              <td className=\"border border-gray-400 p-2 text-center text-red-600\">\r\n                -\r\n                {payroll\r\n                  .reduce((sum, p) => sum + p.deductions, 0)\r\n                  .toLocaleString()}\r\n              </td>\r\n\r\n              <td className=\"border border-gray-400 p-2\"></td>\r\n              <td className=\"border border-gray-400 p-2\"></td>\r\n              <td className=\"border border-gray-400 p-2 text-center text-blue-600\">\r\n                {payroll\r\n                  .reduce((sum, p) => sum + (p.additionalCash || 0), 0)\r\n                  .toLocaleString()}\r\n              </td>\r\n\r\n              <td className=\"border border-gray-400 p-2 text-center text-red-800 bg-gray-50\">\r\n                {payroll\r\n                  .reduce((sum, p) => {\r\n                    const pay = p.baseSalary + p.allowances - p.deductions;\r\n                    const balance = pay - (p.additionalCash || 0);\r\n                    return balance < 0 ? sum + balance : sum;\r\n                  }, 0)\r\n                  .toLocaleString()}\r\n              </td>\r\n            </tr>\r\n          </tfoot>\r\n        </table>\r\n        <div className=\"flex justify-between mt-20 px-10\">\r\n          <div className=\"border-t-2 border-black w-40 text-center pt-2 font-bold\">\r\n            Prepared By\r\n          </div>\r\n          <div className=\"border-t-2 border-black w-40 text-center pt-2 font-bold\">\r\n            Approved By\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* --- PREVIEW MODAL --- */}\r\n      {showPreview && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-70 z-50 flex flex-col items-center overflow-auto p-4 md:p-10 print:hidden\">\r\n          <div className=\"flex w-full max-w-[210mm] justify-between mb-4\">\r\n            <h2 className=\"text-white text-xl font-bold italic\">\r\n              Print Preview (A4 View)\r\n            </h2>\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={() => window.print()}\r\n                className=\"bg-blue-500 text-white px-4 py-1 rounded shadow font-bold\"\r\n              >\r\n                Print Now\r\n              </button>\r\n              <button\r\n                onClick={() => setShowPreview(false)}\r\n                className=\"bg-red-500 text-white px-4 py-1 rounded shadow font-bold\"\r\n              >\r\n                Close\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* This mimics the paper */}\r\n          <div className=\"bg-white w-full max-w-[210mm] min-h-[297mm] p-[20mm] shadow-2xl rounded-sm text-black\">\r\n            <div className=\"text-center mb-8 border-b-2 border-gray-100 pb-4\">\r\n              <h1 className=\"text-2xl font-bold uppercase tracking-widest text-gray-800\">\r\n                Payroll Report\r\n              </h1>\r\n              <p className=\"text-gray-600 mt-1\">\r\n                Month Year: <span className=\"font-bold\">{monthYear}</span>\r\n              </p>\r\n            </div>\r\n\r\n            <table className=\"w-full border-collapse border border-gray-400\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"border border-gray-400 p-2 text-sm\">ID</th>\r\n                  <th className=\"border border-gray-400 p-2 text-sm text-left\">\r\n                    Employee\r\n                  </th>\r\n                  <th className=\"border border-gray-400 p-2 text-sm\">Basic</th>\r\n                  <th className=\"border border-gray-400 p-2 text-sm text-red-600\">\r\n                    Deduction\r\n                  </th>\r\n                  <th className=\"border border-gray-400 p-2 text-sm text-red-600\">\r\n                    Deduction Reason\r\n                  </th>\r\n\r\n                  <th className=\"border border-gray-400 p-2 text-sm\">Net</th>\r\n                  <th className=\"border border-gray-400 p-2 text-sm text-blue-600\">\r\n                    Paid\r\n                  </th>\r\n                  <th className=\"border border-gray-400 p-2 text-sm text-red-800\">\r\n                    Next Month\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {payroll.map((p) => (\r\n                  <tr key={p.id}>\r\n                    <td className=\"border border-gray-400 p-2 text-center text-sm\">\r\n                      {p.employee.employeeId}\r\n                    </td>\r\n                    <td className=\"border border-gray-400 p-2 text-sm\">\r\n                      {p.employee.firstName} {p.employee.lastName}\r\n                    </td>\r\n                    <td className=\"border border-gray-400 p-2 text-center text-sm\">\r\n                      {p.baseSalary.toLocaleString()}\r\n                    </td>\r\n                    <td className=\"border border-gray-400 p-2 text-center text-sm text-red-600\">\r\n                      {p.deductions > 0\r\n                        ? `-${p.deductions.toLocaleString()}`\r\n                        : p.deductions}\r\n                    </td>\r\n                    <td className=\"border border-gray-400 p-2 text-center text-sm text-red-600\">\r\n                      {p.deductionReason}\r\n                    </td>\r\n                    <td className=\"border border-gray-400 p-2 text-center text-sm font-bold\">\r\n                      {(\r\n                        p.baseSalary +\r\n                        p.allowances -\r\n                        p.deductions\r\n                      ).toLocaleString()}\r\n                    </td>\r\n                    <td className=\"border border-gray-400 p-2 text-center text-sm text-blue-600 font-bold\">\r\n                      {p.additionalCash > 0\r\n                        ? `${p.additionalCash.toLocaleString()}`\r\n                        : \"-\"}\r\n                    </td>\r\n\r\n                    <td className=\"border border-gray-400 p-2 text-center text-sm text-red-800 font-bold bg-gray-50\">\r\n                      {p.baseSalary +\r\n                        p.allowances -\r\n                        p.deductions -\r\n                        (p.additionalCash || 0) <\r\n                      0 ? (\r\n                        <div className=\"flex flex-col items-center\">\r\n                          {/* <span className=\"text-black\">0</span> */}\r\n                          <span className=\"text-red-600 text-sm font-bold whitespace-nowrap\">\r\n                            {(\r\n                              p.baseSalary +\r\n                              p.allowances -\r\n                              p.deductions -\r\n                              (p.additionalCash || 0)\r\n                            ).toLocaleString()}\r\n                          </span>\r\n                        </div>\r\n                      ) : (\r\n                        (\r\n                          p.baseSalary +\r\n                          p.allowances -\r\n                          p.deductions -\r\n                          (p.additionalCash || 0)\r\n                        ).toLocaleString()\r\n                      )}\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n              <tfoot>\r\n                <tr className=\"bg-gray-100 font-bold\">\r\n                  <td\r\n                    colSpan={2}\r\n                    className=\"border border-gray-400 p-2 text-right\"\r\n                  >\r\n                    TOTALS:\r\n                  </td>\r\n                  <td className=\"border border-gray-400 p-2 text-center\">\r\n                    {payroll\r\n                      .reduce((sum, p) => sum + p.baseSalary, 0)\r\n                      .toLocaleString()}\r\n                  </td>\r\n                  <td className=\"border border-gray-400 p-2 text-center text-red-600\">\r\n                    -\r\n                    {payroll\r\n                      .reduce((sum, p) => sum + p.deductions, 0)\r\n                      .toLocaleString()}\r\n                  </td>\r\n\r\n                  <td className=\"border border-gray-400 p-2\"></td>\r\n                  <td className=\"border border-gray-400 p-2\"></td>\r\n                  <td className=\"border border-gray-400 p-2 text-center text-blue-600\">\r\n                    {payroll\r\n                      .reduce((sum, p) => sum + (p.additionalCash || 0), 0)\r\n                      .toLocaleString()}\r\n                  </td>\r\n\r\n                  <td className=\"border border-gray-400 p-2 text-center text-red-800 bg-gray-50\">\r\n                    {payroll\r\n                      .reduce((sum, p) => {\r\n                        const pay = p.baseSalary + p.allowances - p.deductions;\r\n                        const balance = pay - (p.additionalCash || 0);\r\n                        return balance < 0 ? sum + balance : sum;\r\n                      }, 0)\r\n                      .toLocaleString()}\r\n                  </td>\r\n                </tr>\r\n              </tfoot>\r\n            </table>\r\n\r\n            <div className=\"flex justify-between mt-32 px-5\">\r\n              <div className=\"border-t border-black w-32 text-center pt-1 text-xs font-bold uppercase\">\r\n                Prepared By\r\n              </div>\r\n              <div className=\"border-t border-black w-32 text-center pt-1 text-xs font-bold uppercase\">\r\n                Approved By\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mt-20 text-[10px] text-gray-400 text-center\">\r\n              System Generated Report - {new Date().toLocaleString()}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\petty-cash\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\phase1-guide\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\purchase-invoice\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleSupplierChange'. Either include it or remove the dependency array.","line":143,"column":6,"nodeType":"ArrayExpression","endLine":143,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [today, showForm, showPreview, suppliers, handleSupplierChange]","fix":{"range":[4235,4276],"text":"[today, showForm, showPreview, suppliers, handleSupplierChange]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4541,4544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4541,4544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadInvoices' and 'user?.role'. Either include them or remove the dependency array.","line":167,"column":6,"nodeType":"ArrayExpression","endLine":167,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadInvoices, user?.role]","fix":{"range":[5014,5016],"text":"[loadInvoices, user?.role]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'user?.role'. Either include it or remove the dependency array.","line":182,"column":6,"nodeType":"ArrayExpression","endLine":182,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [queryId, user?.role]","fix":{"range":[5388,5397],"text":"[queryId, user?.role]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7964,7967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7964,7967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9072,9075],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9072,9075],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9454,9457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9454,9457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":339,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":339,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":393,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":393,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { Suspense, useEffect, useRef, useState } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport toast from \"react-hot-toast\";\nimport dynamic from \"next/dynamic\";\nimport { getCurrentUser } from \"@/lib/auth\";\n\nconst Barcode = dynamic(() => import(\"react-barcode\"), { \n  ssr: false,\n  loading: () => <p>Loading Barcode...</p>\n});\nimport { QRCodeSVG } from \"qrcode.react\";\n\ntype Supplier = { id: string; name: string; partyType: string };\n\ntype POItem = {\n  itemId: string;\n  qty: number;\n  rate: number;\n  invoicedQty: number;\n  item: {\n    id: string;\n    name: string;\n    description?: string | null;\n  };\n};\n\ntype PurchaseOrder = {\n  id: string;\n  poNo: string;\n  supplierId: string;\n  items: POItem[];\n};\n\ntype PurchaseInvoice = {\n  id: string;\n  invoiceNo: string;\n  date: string;\n  supplierId: string;\n  supplier?: { name: string };\n  total: number;\n  items: Array<{ item: { name: string }; qty: number; rate: number }>;\n};\n\ntype Row = {\n  itemId: string;\n  name: string;\n  description?: string | null;\n  qty: number | \"\";\n  rate: number | \"\";\n};\n\ntype TaxConfig = {\n  id: string;\n  taxType: string;\n  taxCode: string;\n  taxRate: number;\n  description?: string;\n};\n\nfunction PurchaseInvoiceContent() {\n  const searchParams = useSearchParams();\n  const queryId = searchParams.get(\"id\");\n  const today = new Date().toISOString().slice(0, 10);\n  const user = getCurrentUser();\n\n  const [suppliers, setSuppliers] = useState<Supplier[]>([]);\n  const [allPOs, setAllPOs] = useState<PurchaseOrder[]>([]);\n  const [filteredPOs, setFilteredPOs] = useState<PurchaseOrder[]>([]);\n  const [invoices, setInvoices] = useState<PurchaseInvoice[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<PurchaseInvoice | null>(null);\n\nconst [searchTerm, setSearchTerm] = useState(\"\");\n\n\n  const [supplierId, setSupplierId] = useState(\"\");\n  const [supplierName, setSupplierName] = useState(\"\");\n  const [selectedPoId, setSelectedPoId] = useState(\"\");\n  const [invoiceId, setInvoiceId] = useState(\"\");\n  const [date, setDate] = useState(today);\n  const [location, setLocation] = useState(\"MAIN\");\n  const [freight, setFreight] = useState<number | \"\">(\"\");\n\n  const [rows, setRows] = useState<Row[]>([\n    { itemId: \"\", name: \"\", description: \"\", qty: \"\", rate: \"\" },\n  ]);\n\n  const [saving, setSaving] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [origin, setOrigin] = useState(\"\");\n\n  useEffect(() => {\n    setOrigin(window.location.origin);\n  }, []);\n\n  const [sendingEmail, setSendingEmail] = useState(false);\n  const [savedInvoiceId, setSavedInvoiceId] = useState<string | null>(null);\n  \n  // Tax states\n  const [applyTax, setApplyTax] = useState(false);\n  const [selectedTaxId, setSelectedTaxId] = useState(\"\");\n  const [taxes, setTaxes] = useState<TaxConfig[]>([]);\n\n  const supplierRef = useRef<HTMLSelectElement>(null);\n\n  // Keyboard shortcuts - F7: Clear date/supplier, F8: Query dialog\n  useEffect(() => {\n    function handleKeyPress(e: KeyboardEvent) {\n      if (e.code === \"F7\" || e.key === \"F7\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !showPreview) {\n          setDate(today);\n          setSupplierId(\"\");\n          setSupplierName(\"\");\n        }\n      }\n      if (e.code === \"F8\" || e.key === \"F8\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !showPreview) {\n          const query = prompt(\"Enter search query (Invoice No, Supplier Name, etc.):\");\n          if (query) {\n            const foundSupplier = suppliers.find(s => \n              s.name.toLowerCase().includes(query.toLowerCase())\n            );\n            if (foundSupplier) {\n              setSupplierId(foundSupplier.id);\n              setSupplierName(foundSupplier.name);\n              handleSupplierChange(foundSupplier.id);\n            } else {\n              toast.error(`No supplier found matching \"${query}\"`);\n            }\n          }\n        }\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyPress, true);\n    return () => document.removeEventListener(\"keydown\", handleKeyPress, true);\n  }, [today, showForm, showPreview, suppliers]);\n\n  useEffect(() => {\n    loadInvoices();\n    fetch(\"/api/accounts\", { headers: { \"x-user-role\": user?.role || \"ADMIN\" } })\n      .then(r => r.json())\n      .then(d => {\n        const list = Array.isArray(d) ? d : d.accounts;\n        setSuppliers(list.filter((a: any) => a.partyType === \"SUPPLIER\"));\n      });\n\n    // Load tax configurations\n    fetch(\"/api/tax-configuration\")\n      .then(r => r.json())\n      .then(d => setTaxes(Array.isArray(d) ? d : []))\n      .catch(err => console.log(\"Tax config error:\", err));\n\n    fetch(\"/api/purchase-invoice\", {\n      headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n    })\n      .then(r => r.json())\n      .then(data => {\n        if (Array.isArray(data)) setAllPOs(data);\n      });\n  }, []);\n\n  useEffect(() => {\n    if (queryId) {\n      fetch(`/api/purchase-invoice?id=${queryId}`, {\n         headers: { \"x-user-role\": user?.role || \"ADMIN\" }\n      })\n      .then(r => r.json())\n      .then(data => {\n         if (data && !data.error) {\n            startEdit(data);\n         }\n      })\n      .catch(e => console.error(\"Error loading invoice:\", e));\n    }\n  }, [queryId]);\n\n  async function loadInvoices() {\n    try {\n      const res = await fetch(\"/api/purchase-invoice?type=invoices\", {\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n      });\n      const data = await res.json();\n      if (Array.isArray(data)) {\n        setInvoices(data);\n      }\n    } catch (e) {\n      console.error(\"Load invoices error:\", e);\n    }\n  }\n\n  function handleSupplierChange(id: string) {\n    setSupplierId(id);\n    const s = suppliers.find(x => x.id === id);\n    setSupplierName(s?.name || \"\");\n    const pos = allPOs.filter(p => p.supplierId === id);\n    setFilteredPOs(pos);\n    setSelectedPoId(\"\");\n    setRows([{ itemId: \"\", name: \"\", description: \"\", qty: \"\", rate: \"\" }]);\n  }\n\n  function handlePoSelection(poId: string) {\n    setSelectedPoId(poId);\n    const po = filteredPOs.find(p => p.id === poId);\n    if (!po) return;\n\n    setRows(\n      po.items\n        .map(pi => ({\n          itemId: pi.itemId,\n          name: pi.item.name,\n          description: pi.item.description || \"\",\n          qty: Math.max(0, pi.qty - pi.invoicedQty),\n          rate: pi.rate,\n        }))\n        .filter(r => r.qty > 0)\n    );\n  }\n\n  function updateRow(index: number, key: \"qty\" | \"rate\", value: string) {\n    const copy = [...rows];\n    copy[index][key] = value === \"\" ? \"\" : Number(value);\n    setRows(copy);\n  }\n\n  const total = rows.reduce((s, r) => s + (Number(r.qty) * Number(r.rate) || 0), 0);\n  const selectedTax = taxes.find(t => t.id === selectedTaxId);\n  const taxAmount = applyTax && selectedTax ? (total * (selectedTax.taxRate / 100)) : 0;\n  const netTotal = total + (Number(freight) || 0) + taxAmount;\n\n  async function saveInvoice() {\n    const clean = rows.filter(r => r.itemId && r.qty !== \"\" && Number(r.qty) > 0);\n    if (!supplierId || clean.length === 0) {\n      toast.error(\"Supplier and item are required\");\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const method = editing ? \"PUT\" : \"POST\";\n      const baseBody = {\n        supplierId,\n        poId: selectedPoId,\n        date,\n        location,\n        freight: Number(freight) || 0,\n        items: clean,\n        applyTax,\n        taxConfigId: applyTax ? selectedTaxId : null,\n      };\n      const body = editing ? { id: editing.id, ...baseBody } : baseBody;\n\n      const res = await fetch(\"/api/purchase-invoice\", {\n        method,\n        headers: { \"Content-Type\": \"application/json\", \"x-user-role\": user?.role || \"ADMIN\" },\n        body: JSON.stringify(body),\n      });\n\n      const contentType = res.headers.get(\"content-type\") || \"\";\n      let data: any = null;\n      if (contentType.includes(\"application/json\")) {\n        try {\n          data = await res.json();\n        } catch {\n          data = null;\n        }\n      } else {\n        try {\n          const text = await res.text();\n          data = text || null;\n        } catch {\n          data = null;\n        }\n      }\n      if (res.ok && data) {\n        setInvoiceId((typeof data === \"object\" && data.invoiceNo) ? data.invoiceNo : (data?.id || invoiceId));\n        setSavedInvoiceId((typeof data === \"object\" && data.id) ? data.id : (editing?.id || null));\n        setShowPreview(true);\n        await loadInvoices();\n        if (editing) {\n          setEditing(null);\n          setShowForm(false);\n          setShowList(true);\n        }\n        toast.success(\"Invoice saved successfully!\");\n      } else {\n        const msg = (data && typeof data === \"object\" && data.error)\n          ? data.error\n          : (typeof data === \"string\" && data.trim().length > 0)\n            ? data\n            : \"Save failed (empty/invalid response)\";\n        toast.error(\"Error: \" + msg);\n      }\n    } catch (err: any) {\n      toast.error(\"System Error: \" + err.message);\n    } finally {\n      setSaving(false);\n    }\n  }\n\n\n  function startEdit(inv: PurchaseInvoice) {\n    setEditing(inv);\n    setInvoiceId(inv.invoiceNo);\n    setSupplierId(inv.supplierId);\n    setSupplierName(inv.supplier?.name || \"\");\n    setDate(new Date(inv.date).toISOString().slice(0, 10));\n    setRows(inv.items.map((it: any) => ({\n      itemId: it.itemId || \"\",\n      name: it.item?.name || \"\",\n      description: it.item?.description || \"\",\n      qty: it.qty.toString(),\n      rate: it.rate.toString(),\n    })));\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deleteInvoice(id: string) {\n    if (!confirm(\"Are you sure you want to delete this invoice?\")) return;\n    try {\n      const res = await fetch(`/api/purchase-invoice?id=${id}`, {\n        method: \"DELETE\",\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n      });\n      if (res.ok) {\n        toast.success(\"Invoice deleted successfully\");\n        await loadInvoices();\n      } else {\n        const err = await res.json();\n        toast.error(err.error || \"Delete failed\");\n      }\n    } catch (e) {\n      toast.error(\"Delete failed\");\n    }\n  }\n\n  function resetForm() {\n    setEditing(null);\n    setSupplierId(\"\");\n    setSupplierName(\"\");\n    setSelectedPoId(\"\");\n    setDate(today);\n    setLocation(\"MAIN\");\n    setFreight(\"\");\n    setRows([{ itemId: \"\", name: \"\", description: \"\", qty: \"\", rate: \"\" }]);\n    setApplyTax(false);\n    setSelectedTaxId(\"\");\n    setShowPreview(false);\n    setSavedInvoiceId(null);\n  }\n\n  async function sendInvoiceEmail() {\n    if (!savedInvoiceId) {\n      toast.error(\"Please save the invoice first\");\n      return;\n    }\n\n    const supplierEmail = prompt(\"Enter supplier email address:\");\n    if (!supplierEmail || !supplierEmail.includes(\"@\")) {\n      toast.error(\"Please enter a valid email address\");\n      return;\n    }\n\n    setSendingEmail(true);\n    try {\n      const res = await fetch(\"/api/email/send\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\",\n        },\n        body: JSON.stringify({\n          type: \"purchase-invoice\",\n          invoiceId: savedInvoiceId,\n          to: supplierEmail,\n        }),\n      });\n\n      const data = await res.json();\n      if (res.ok) {\n        toast.success(\"✅ Email sent successfully!\");\n      } else {\n        toast.error(`❌ Failed to send email: ${data.error || \"Unknown error\"}`);\n      }\n    } catch (error) {\n      toast.error(\"❌ Failed to send email. Please check email configuration.\");\n    } finally {\n      setSendingEmail(false);\n    }\n  }\n  const filteredInvoices = invoices.filter(inv => {\n  if (!searchTerm.trim()) return true;\n\n  const term = searchTerm.toLowerCase();\n\n  return (\n    inv.invoiceNo?.toLowerCase().includes(term) ||\n    inv.supplier?.name?.toLowerCase().includes(term) ||\n    inv.date?.toLowerCase().includes(term)\n  );\n});\n\n\n  return (\n    <div className=\"p-6 max-w-6xl mx-auto space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-xl font-bold\">Purchase Invoice</h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => { setShowList(!showList); setShowForm(!showForm); setEditing(null); }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => { setShowForm(true); setShowList(false); resetForm(); }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New Invoice\n          </button>\n        </div>\n      </div>\n\n      {/* LIST VIEW */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-x-auto\">\n          <table className=\"w-full text-sm min-w-[800px]\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">Invoice No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Supplier</th>\n                <th className=\"p-3 text-right\">Total</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredInvoices.length === 0 ? (\n                <tr>\n                  <td colSpan={5} className=\"p-4 text-center text-gray-400\">No invoices found</td>\n                </tr>\n              ) : (\n                filteredInvoices.map(inv => (\n                  <tr key={inv.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">{inv.invoiceNo}</td>\n                    <td className=\"p-3\">{new Date(inv.date).toLocaleDateString()}</td>\n                    <td className=\"p-3\">{inv.supplier?.name || \"N/A\"}</td>\n                    <td className=\"p-3 text-right\">{inv.total.toLocaleString()}</td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(inv)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deleteInvoice(inv.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <>\n          <div className=\"flex justify-between items-center bg-gray-50 p-4 border rounded print:hidden\">\n            <div>\n              <h1 className=\"text-xl font-bold\">\n                {editing ? \"Edit Invoice\" : \"Purchase Invoice\"}\n              </h1>\n              {invoiceId && (\n                <div className=\"mt-1\">\n                   <Barcode value={invoiceId} width={1} height={30} fontSize={12} displayValue={true} />\n                </div>\n              )}\n            </div>\n            <div className=\"flex gap-3\">\n              {!showPreview ? (\n                <button onClick={saveInvoice} disabled={saving} className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-bold shadow-md transition-all\">\n                  {saving ? \"Saving...\" : editing ? \"Update Invoice\" : \"Save & Preview\"}\n                </button>\n              ) : (\n              \n                <>\n\n                <input\n  type=\"text\"\n  placeholder=\"Search invoices...\"\n  value={searchTerm}\n  onChange={(e) => setSearchTerm(e.target.value)}\n  className=\"border px-3 py-2 rounded w-full md:w-64\"\n/>\n\n                  <button onClick={() => window.print()} className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-bold shadow-md\">\n                    Print / Download PDF\n                  </button>\n                  <button \n                    onClick={sendInvoiceEmail} \n                    disabled={sendingEmail}\n                    className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-bold shadow-md disabled:bg-gray-400\"\n                  >\n                    {sendingEmail ? \"Sending...\" : \"📧 Email\"}\n                  </button>\n                  <button onClick={() => setShowPreview(false)} className=\"bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded border font-bold\">\n                    Back to Edit\n                  </button>\n                </>\n              )}\n              <button onClick={() => { setShowForm(false); setEditing(null); resetForm(); }} className=\"bg-gray-600 text-white px-6 py-2 rounded font-bold\">\n                Cancel\n              </button>\n            </div>\n          </div>\n\n          {!showPreview && (\n            <div className=\"bg-white border p-6 rounded space-y-6 shadow-sm\">\n              <div className=\"mb-2 text-xs text-gray-500 italic\">\n                💡 Keyboard Shortcuts: <strong>F7</strong> = Clear Date & Supplier | <strong>F8</strong> = Search Query\n              </div>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4\">\n                <div>\n                  <label className=\"text-xs font-bold\">Supplier (F7: Clear, F8: Query)</label>\n                  <select ref={supplierRef} className=\"border p-2 rounded w-full\" value={supplierId} onChange={e => handleSupplierChange(e.target.value)}>\n                    <option value=\"\">Select Supplier</option>\n                    {suppliers.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}\n                  </select>\n                </div>\n\n                <select className=\"border p-2 bg-yellow-50 rounded\" value={selectedPoId} onChange={e => handlePoSelection(e.target.value)}>\n                  <option value=\"\">-- Select PO --</option>\n                  {filteredPOs.map(p => <option key={p.id} value={p.id}>{p.poNo}</option>)}\n                </select>\n\n                <div>\n                  <label className=\"text-xs font-bold\">Date (F7: Clear)</label>\n                  <input type=\"date\" className=\"border p-2 rounded w-full\" value={date} onChange={e => setDate(e.target.value)} />\n                </div>\n\n                <select className=\"border p-2 rounded\" value={location} onChange={e => setLocation(e.target.value)}>\n                  <option value=\"MAIN\">Main</option>\n                  <option value=\"SHOP\">Shop</option>\n                </select>\n              </div>\n\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full border text-sm min-w-[600px]\">\n                  <thead className=\"bg-gray-100 font-bold\">\n                  <tr>\n                    <th className=\"border p-2 text-left\">Item</th>\n                    <th className=\"border p-2 w-24 text-center\">Qty</th>\n                    <th className=\"border p-2 w-32 text-center\">Rate</th>\n                    <th className=\"border p-2 w-32 text-right\">Amount</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rows.map((r, i) => (\n                    <tr key={i} className=\"hover:bg-gray-50\">\n                      <td className=\"border p-2\">\n                        <div className=\"font-medium uppercase\">{r.name}</div>\n                        {r.description && <div className=\"text-xs text-gray-500\">{r.description}</div>}\n                      </td>\n                      <td className=\"border p-2\">\n                        <input type=\"number\" className=\"w-full text-center outline-none\" value={r.qty} onChange={e => updateRow(i, \"qty\", e.target.value)} />\n                      </td>\n                      <td className=\"border p-2\">\n                        <input type=\"number\" className=\"w-full text-center outline-none\" value={r.rate} onChange={e => updateRow(i, \"rate\", e.target.value)} />\n                      </td>\n                      <td className=\"border p-2 text-right font-mono font-bold\">{(Number(r.qty) * Number(r.rate) || 0).toLocaleString()}</td>\n                    </tr>\n                  ))}\n                </tbody>\n                </table>\n              </div>\n\n              <div className=\"flex justify-end\">\n                <div className=\"w-80 p-4 border bg-gray-50 rounded space-y-2\">\n                  <div className=\"flex justify-between text-sm\"><span>Gross Total:</span><span>{total.toLocaleString()}</span></div>\n                  <div className=\"flex justify-between items-center text-sm\">\n                    <span>Freight:</span>\n                    <input type=\"number\" className=\"border w-32 text-right p-1 rounded\" value={freight} onChange={e => setFreight(e.target.value === \"\" ? \"\" : Number(e.target.value))} />\n                  </div>\n                  \n                  {/* Tax Section */}\n                  <div className=\"border-t pt-2 space-y-2\">\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        setApplyTax(!applyTax);\n                        if (!applyTax) setSelectedTaxId(\"\");\n                      }}\n                      className={`w-full py-1 px-2 rounded font-semibold text-sm ${\n                        applyTax ? \"bg-blue-600 text-white\" : \"bg-gray-200 text-gray-700\"\n                      }`}\n                    >\n                      {applyTax ? \"✓ Tax Applied\" : \"+ Add Tax\"}\n                    </button>\n                    \n                    {applyTax && (\n                      <div className=\"space-y-2\">\n                        <select\n                          value={selectedTaxId}\n                          onChange={e => setSelectedTaxId(e.target.value)}\n                          className=\"w-full border p-1 text-sm\"\n                        >\n                          <option value=\"\">Select Tax</option>\n                          {taxes.map(tax => (\n                            <option key={tax.id} value={tax.id}>\n                              {tax.taxType} ({tax.taxCode}) - {tax.taxRate}%\n                            </option>\n                          ))}\n                        </select>\n                        {selectedTax && (\n                          <div className=\"flex justify-between text-sm text-blue-600\">\n                            <span>{selectedTax.taxType} ({selectedTax.taxRate}%)</span>\n                            <span>{taxAmount.toLocaleString()}</span>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                  \n                  <div className=\"flex justify-between font-black text-lg border-t pt-2 text-blue-900 uppercase\"><span>Net Payable:</span><span>{netTotal.toLocaleString()}</span></div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* PREVIEW */}\n          {showPreview && (\n            <div className=\"invoice-print bg-white mx-auto text-black\">\n              <div className=\"flex justify-between border-b-4 border-black pb-4 mb-6\">\n                <div>\n                  <h1 className=\"text-4xl font-black italic tracking-tighter\">US TRADERS</h1>\n                  <p className=\"text-[10px] font-bold uppercase tracking-[3px] text-gray-600\">Industrial Goods & Services</p>\n                </div>\n                <div className=\"text-right\">\n                  <h2 className=\"text-2xl font-black uppercase underline\">Purchase Invoice</h2>\n                  <p className=\"text-sm font-bold mt-1\">INV #: {invoiceId}</p>\n                  <p className=\"text-sm\">Date: {date}</p>\n                  {invoiceId && (\n                    <div className=\"flex flex-col items-end gap-2 mt-2\">\n                      <div className=\"text-center\">\n                        <Barcode value={invoiceId} width={1.5} height={40} fontSize={14} displayValue={false} />\n                        <span className=\"text-[10px] font-bold\">INV ID: {invoiceId}</span>\n                      </div>\n                      \n                      {origin && (\n                        <div className=\"flex flex-col items-center mt-2 border-t pt-2\">\n                          <QRCodeSVG value={`${origin}/view/purchase-invoice?id=${invoiceId}`} size={80} />\n                          <span className=\"text-[10px] font-bold mt-1 bg-black text-white px-1\">SCAN FOR ONLINE BILL</span>\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"mb-6\">\n                <p className=\"text-[10px] uppercase font-bold text-gray-400\">Vendor / Supplier:</p>\n                <p className=\"text-xl font-black uppercase\">{supplierName}</p>\n                <p className=\"text-xs font-bold italic\">Location: {location}</p>\n              </div>\n\n              <table className=\"w-full text-sm border-collapse border border-black\">\n                <thead>\n                  <tr className=\"bg-black text-white border border-black uppercase text-[10px]\">\n                    <th className=\"p-2 border border-black text-center w-12\">Sr.</th>\n                    <th className=\"p-2 border border-black text-left\">Description of Items</th>\n                    <th className=\"p-2 border border-black text-center w-24\">Qty</th>\n                    <th className=\"p-2 border border-black text-center w-32\">Rate</th>\n                    <th className=\"p-2 border border-black text-right w-36\">Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rows.map((r, i) => (\n                    <tr key={i} className=\"border border-black font-bold\">\n                      <td className=\"p-3 border border-black text-center\">{i + 1}</td>\n                      <td className=\"p-3 border border-black\">\n                        <div className=\"uppercase\">{r.name}</div>\n                        {r.description && <div className=\"text-[10px] font-normal leading-tight lowercase text-gray-600\">{r.description}</div>}\n                      </td>\n                      <td className=\"p-3 border border-black text-center\">{r.qty}</td>\n                      <td className=\"p-3 border border-black text-center\">{Number(r.rate).toLocaleString()}</td>\n                      <td className=\"p-3 border border-black text-right font-mono\">{(Number(r.qty) * Number(r.rate)).toLocaleString()}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n\n              <div className=\"flex justify-end mt-4\">\n                <div className=\"w-72 space-y-1\">\n                  <div className=\"flex justify-between text-[11px] font-bold border-b border-black pb-1\"><span>SUB-TOTAL:</span><span>{total.toLocaleString()}</span></div>\n                  <div className=\"flex justify-between text-[11px] font-bold border-b border-black pb-1\"><span>FREIGHT:</span><span>{Number(freight || 0).toLocaleString()}</span></div>\n                  {selectedTax && (\n                    <div className=\"flex justify-between text-[11px] font-bold border-b border-black pb-1\">\n                      <span>{selectedTax.taxType.toUpperCase()} ({selectedTax.taxRate}%):</span>\n                      <span>{taxAmount.toLocaleString()}</span>\n                    </div>\n                  )}\n                  <div className=\"flex justify-between text-2xl font-black border-t-2 border-black pt-1 bg-gray-50 p-2\">\n                    <span>NET:</span>\n                    <span>{netTotal.toLocaleString()}</span>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"mt-32 flex justify-between px-10\">\n                <div className=\"text-center w-48 border-t-2 border-black pt-1 text-[10px] font-bold uppercase\">Prepared By</div>\n                <div className=\"text-center w-48 border-t-2 border-black pt-1 text-[10px] font-bold uppercase\">Authorized Sign</div>\n              </div>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function PurchaseInvoicePage() {\n  return (\n    <Suspense fallback={<div className=\"p-4 text-center\">Loading Invoice...</div>}>\n      <PurchaseInvoiceContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\purchase-order\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[528,531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[528,531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[577,580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[577,580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3104,3107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3104,3107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadPOs' and 'user?.role'. Either include them or remove the dependency array.","line":94,"column":6,"nodeType":"ArrayExpression","endLine":94,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadPOs, user?.role]","fix":{"range":[3291,3293],"text":"[loadPOs, user?.role]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3939,3942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3939,3942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3990,3993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3990,3993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":158,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":158,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5632,5635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5632,5635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":194,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":194,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":250,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":250,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport { useEffect, useState } from \"react\";\nimport toast from \"react-hot-toast\";\nimport { getCurrentUser } from \"@/lib/auth\";\n\ntype PO = {\n  id: string;\n  poNo: string;\n  date: string;\n  supplierId: string;\n  supplier?: { name: string };\n  remarks?: string;\n  items: Array<{ item: { name: string }; qty: number; rate: number }>;\n};\n\nexport default function PurchaseOrderPage() {\n  const today = new Date().toISOString().slice(0, 10);\n  const user = getCurrentUser();\n\n  const [suppliers, setSuppliers] = useState<any[]>([]);\n  const [items, setItems] = useState<any[]>([]);\n  const [pos, setPos] = useState<PO[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<PO | null>(null);\n\n  const [poNo, setPoNo] = useState(\"\");\n  const [supplierId, setSupplierId] = useState(\"\");\n  const [supplierName, setSupplierName] = useState(\"\");\n  const [date, setDate] = useState(today);\n  const [remarks, setRemarks] = useState(\"\");\n  const [rows, setRows] = useState([{ itemId: \"\", name: \"\", desc: \"\", qty: \"\", rate: \"\" }]);\n  const [saving, setSaving] = useState(false);\n  const [preview, setPreview] = useState(false);\n  const [sendingEmail, setSendingEmail] = useState(false);\n  const [savedPO, setSavedPO] = useState<PO | null>(null);\n\n  // Email Modal State\n  const [emailModalOpen, setEmailModalOpen] = useState(false);\n  const [recipientEmail, setRecipientEmail] = useState(\"\");\n\n\n  // Keyboard shortcuts - F7: Clear date/customer, F8: Query dialog\n  useEffect(() => {\n    function handleKeyPress(e: KeyboardEvent) {\n      // Use code for function keys\n      if (e.code === \"F7\" || e.key === \"F7\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !preview) {\n          setDate(today);\n          setSupplierId(\"\");\n          setSupplierName(\"\");\n        }\n      }\n      if (e.code === \"F8\" || e.key === \"F8\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !preview) {\n          // Open query/search dialog\n          const query = prompt(\"Enter search query (Invoice No, Supplier Name, etc.):\");\n          if (query) {\n            // Search in suppliers\n            const foundSupplier = suppliers.find(s =>\n              s.name.toLowerCase().includes(query.toLowerCase())\n            );\n            if (foundSupplier) {\n              setSupplierId(foundSupplier.id);\n              setSupplierName(foundSupplier.name);\n            } else {\n              toast.error(`No supplier found matching \"${query}\"`);\n            }\n          }\n        }\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyPress, true);\n    return () => document.removeEventListener(\"keydown\", handleKeyPress, true);\n  }, [today, showForm, preview, suppliers]);\n\n  /* LOAD DATA */\n  useEffect(() => {\n    loadPOs();\n    fetch(\"/api/accounts\", { headers: { \"x-user-role\": user?.role || \"ADMIN\" } })\n      .then(r => r.json())\n      .then(d => {\n        const list = Array.isArray(d) ? d : d.accounts;\n        setSuppliers((list || []).filter((a: any) => a.partyType === \"SUPPLIER\"));\n      });\n\n    fetch(\"/api/items-new\", { headers: { \"x-user-role\": user?.role || \"ADMIN\" } })\n      .then(r => r.json())\n      .then(setItems);\n  }, []);\n\n  async function loadPOs() {\n    try {\n      // Load next PO number\n      const nextRes = await fetch(\"/api/purchase-order?nextNo=true\", { headers: { \"x-user-role\": user?.role || \"ADMIN\" } });\n      const nextData = await nextRes.json();\n      if (nextData?.poNo) setPoNo(nextData.poNo);\n\n      // Load all POs\n      const res = await fetch(\"/api/purchase-order\", { headers: { \"x-user-role\": user?.role || \"ADMIN\" } });\n      const data = await res.json();\n      if (Array.isArray(data)) {\n        setPos(data);\n      }\n    } catch (e) {\n      console.error(\"Load POs error:\", e);\n    }\n  }\n\n  function updateRow(i: number, key: string, val: any) {\n    const copy = [...rows];\n    (copy[i] as any)[key] = val;\n    setRows(copy);\n  }\n\n  function addRow() {\n    setRows([...rows, { itemId: \"\", name: \"\", desc: \"\", qty: \"\", rate: \"\" }]);\n  }\n\n  const total = rows.reduce((s, r) => s + (r.qty && r.rate ? Number(r.qty) * Number(r.rate) : 0), 0);\n\n  async function savePO() {\n    const clean = rows.filter(r => r.itemId && r.qty);\n    if (!supplierId || clean.length === 0) { toast.error(\"Supplier aur items zaroori hain\"); return; }\n    setSaving(true);\n    try {\n      const method = editing ? \"PUT\" : \"POST\";\n      const body = editing\n        ? { id: editing.id, poNo, supplierId, date, remarks, items: clean }\n        : { poNo, supplierId, date, remarks, items: clean };\n\n      const res = await fetch(\"/api/purchase-order\", {\n        method,\n        headers: { \"Content-Type\": \"application/json\", \"x-user-role\": user?.role || \"ADMIN\" },\n        body: JSON.stringify(body),\n      });\n      if (res.ok) {\n        const data = await res.json();\n        setSavedPO(data);   // 🔥 IMPORTANT\n        setPreview(true);\n        await loadPOs();\n\n\n        if (editing) {\n          setEditing(null);\n          setShowForm(false);\n          setShowList(true);\n        }\n      }\n      else {\n        const err = await res.json();\n        alert(err.error || \"Saving failed\");\n      }\n    } catch (err) { alert(\"Error saving PO\"); }\n    finally { setSaving(false); }\n  }\n\n  function startEdit(po: PO) {\n    setEditing(po);\n    setPoNo(po.poNo);\n    setSupplierId(po.supplierId);\n    setSupplierName(po.supplier?.name || \"\");\n    setDate(new Date(po.date).toISOString().slice(0, 10));\n    setRemarks(po.remarks || \"\");\n    setRows(po.items.map((it: any) => ({\n      itemId: it.itemId || \"\",\n      name: it.item?.name || \"\",\n      desc: it.item?.description || \"\",\n      qty: it.qty.toString(),\n      rate: it.rate.toString(),\n    })));\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deletePO(id: string) {\n    if (!confirm(\"Are you sure you want to delete this PO?\")) return;\n    try {\n      const res = await fetch(`/api/purchase-order?id=${id}`, {\n        method: \"DELETE\",\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n      });\n      if (res.ok) {\n        alert(\"PO deleted successfully\");\n        await loadPOs();\n      } else {\n        const err = await res.json();\n        alert(err.error || \"Delete failed\");\n      }\n    } catch (e) {\n      alert(\"Delete failed\");\n    }\n  }\n\n  function resetForm() {\n    setEditing(null);\n    setPoNo(\"\");\n    setSupplierId(\"\");\n    setSupplierName(\"\");\n    setDate(today);\n    setRemarks(\"\");\n    setRows([{ itemId: \"\", name: \"\", desc: \"\", qty: \"\", rate: \"\" }]);\n    setPreview(false);\n  }\n\n  function openEmailModal() {\n    if (!preview) {\n      toast.error(\"Please save and preview the PO first\");\n      return;\n    }\n    // Try to find supplier email\n    const supplier = suppliers.find(s => s.id === supplierId);\n    setRecipientEmail(supplier?.email || \"\");\n    setEmailModalOpen(true);\n  }\n\n  async function confirmSendEmail() {\n    if (!recipientEmail || !recipientEmail.includes(\"@\")) {\n      toast.error(\"Please enter a valid email address\");\n      return;\n    }\n\n    setSendingEmail(true);\n    try {\n      const res = await fetch(\"/api/email/send\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\",\n        },\n        body: JSON.stringify({\n          type: \"purchase-order\",\n          invoiceId: savedPO?.id,\n          to: recipientEmail,\n        }),\n      });\n\n      const data = await res.json();\n      if (res.ok) {\n        toast.success(\"✅ Email sent successfully!\");\n        setEmailModalOpen(false);\n      } else {\n        toast.error(data.error || \"Failed to send email\");\n      }\n    } catch (error) {\n      toast.error(\"Failed to send email. Please check email configuration.\");\n    } finally {\n      setSendingEmail(false);\n    }\n  }\n\n  return (\n    <div className=\"p-6 max-w-5xl mx-auto space-y-6 text-black\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-xl font-bold\">Purchase Order</h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => { setShowList(!showList); setShowForm(!showForm); setEditing(null); }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => { setShowForm(true); setShowList(false); resetForm(); loadPOs(); }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New PO\n          </button>\n        </div>\n      </div>\n\n      {/* LIST VIEW */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-x-auto\">\n          <table className=\"w-full text-sm min-w-[800px]\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">PO No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Supplier</th>\n                <th className=\"p-3 text-right\">Items</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {pos.length === 0 ? (\n                <tr>\n                  <td colSpan={5} className=\"p-4 text-center text-gray-400\">No POs found</td>\n                </tr>\n              ) : (\n                pos.map(po => (\n                  <tr key={po.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">{po.poNo}</td>\n                    <td className=\"p-3\">{new Date(po.date).toLocaleDateString()}</td>\n                    <td className=\"p-3\">{po.supplier?.name || \"N/A\"}</td>\n                    <td className=\"p-3 text-right\">{po.items?.length || 0}</td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(po)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deletePO(po.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <>\n          <div className=\"flex justify-between items-center bg-gray-50 p-4 border rounded-lg print:hidden font-sans\">\n            <h1 className=\"text-xl font-bold\">{editing ? \"Edit PO\" : \"Create Purchase Order\"}</h1>\n            <div className=\"flex gap-3\">\n              {!preview ? (\n                <button\n                  onClick={savePO}\n                  disabled={saving}\n                  className=\"bg-blue-600 text-white px-6 py-2 rounded font-bold uppercase\"\n                >\n                  {saving ? \"Saving...\" : editing ? \"Update PO\" : \"Save & Preview\"}\n                </button>\n              ) : (\n                <>\n                  <button\n                    onClick={() => window.print()}\n                    className=\"bg-green-600 text-white px-6 py-2 rounded font-bold uppercase\"\n                  >\n                    Print / Download PDF\n                  </button>\n                  <button\n                    onClick={openEmailModal}\n                    disabled={sendingEmail}\n                    className=\"bg-blue-600 text-white px-6 py-2 rounded font-bold uppercase disabled:bg-gray-400\"\n                  >\n                    {sendingEmail ? \"Sending...\" : \"📧 Email\"}\n                  </button>\n                  <button\n                    onClick={() => setPreview(false)}\n                    className=\"bg-gray-200 text-gray-800 px-6 py-2 rounded font-bold uppercase border\"\n                  >\n                    Back to Edit\n                  </button>\n                </>\n              )}\n              <button\n                onClick={() => {\n                  setShowForm(false);\n                  setEditing(null);\n                  resetForm();\n                }}\n                className=\"bg-gray-600 text-white px-6 py-2 rounded font-bold uppercase\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n\n          {!preview && (\n            <div className=\"bg-white border p-8 rounded-xl shadow-sm space-y-6\">\n              <div className=\"mb-2 text-xs text-gray-500 italic\">\n                💡 Keyboard Shortcuts: <strong>F7</strong> = Clear Date & Supplier | <strong>F8</strong> = Search Query\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 font-sans\">\n                <div><label className=\"text-xs font-bold uppercase text-gray-500\">PO Number</label><input className=\"border w-full p-2 bg-gray-50 rounded font-bold\" value={poNo} disabled /></div>\n                <div><label className=\"text-xs font-bold uppercase text-gray-500\">Order Date (F7: Clear)</label><input type=\"date\" className=\"border w-full p-2 rounded font-bold\" value={date} onChange={e => setDate(e.target.value)} /></div>\n              </div>\n              <div>\n                <label className=\"text-xs font-bold uppercase text-gray-500\">Select Supplier (F7: Clear, F8: Query)</label>\n                <select className=\"border p-2 w-full rounded font-bold\" value={supplierId} onChange={e => {\n                  setSupplierId(e.target.value);\n                  const s = suppliers.find(x => x.id === e.target.value);\n                  setSupplierName(s?.name || \"\");\n                }}>\n                  <option value=\"\">-- Choose Supplier --</option>\n                  {suppliers.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}\n                </select>\n              </div>\n\n              <table className=\"w-full text-left font-sans\">\n                <thead className=\"border-b-2\">\n                  <tr className=\"text-xs uppercase text-gray-400\">\n                    <th className=\"pb-2\">Item Description</th>\n                    <th className=\"w-24 text-center pb-2\">Qty</th>\n                    <th className=\"w-32 text-right pb-2\">Rate</th>\n                    <th className=\"w-32 text-right pb-2\">Amount</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rows.map((r, i) => (\n                    <tr key={i} className=\"border-b\">\n                      <td className=\"py-3\">\n                        <select className=\"w-full p-1 border rounded font-bold\" value={r.itemId} onChange={e => {\n                          const it = items.find(x => x.id === e.target.value);\n                          if (!it) return;\n                          updateRow(i, \"itemId\", it.id);\n                          updateRow(i, \"name\", it.name);\n                          updateRow(i, \"desc\", it.description || \"\");\n                        }}>\n                          <option value=\"\">Select Item</option>\n                          {items.map(it => <option key={it.id} value={it.id}>{it.name} ({it.description})</option>)}\n                        </select>\n                      </td>\n                      <td><input type=\"number\" className=\"w-full text-center border rounded p-1 font-bold\" value={r.qty} onChange={e => updateRow(i, \"qty\", e.target.value)} /></td>\n                      <td><input type=\"number\" className=\"w-full text-right border rounded p-1 font-bold\" value={r.rate} onChange={e => updateRow(i, \"rate\", e.target.value)} /></td>\n                      <td className=\"text-right font-black\">{(Number(r.qty) * Number(r.rate)).toLocaleString()}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n              <button onClick={addRow} className=\"text-blue-600 font-bold uppercase text-xs\">+ Add New Row</button>\n              <textarea className=\"border w-full p-3 rounded h-24 font-sans text-sm\" placeholder=\"Any Special Remarks...\" value={remarks} onChange={e => setRemarks(e.target.value)} />\n              <div className=\"text-right text-3xl font-black text-blue-700\">Rs. {total.toLocaleString()}</div>\n            </div>\n          )}\n\n          {/* PREVIEW */}\n          {preview && (\n            <div className=\"invoice-print bg-white border-2 p-12 shadow-2xl rounded-sm mx-auto min-h-[297mm] print:shadow-none print:border-0 print:p-0 text-black\">\n              <div className=\"flex justify-between items-start border-b-4 border-black pb-6 mb-8\">\n                <div>\n                  <h1 className=\"text-4xl font-black tracking-tighter\">US TRADERS</h1>\n                  <p className=\"text-xs uppercase tracking-widest font-bold text-gray-500\">Premium Quality Industrial Suppliers</p>\n                </div>\n                <div className=\"text-right\">\n                  <h2 className=\"text-2xl font-black uppercase italic\">Purchase Order</h2>\n                  <div className=\"mt-2 text-sm font-bold\">\n                    <p>{poNo}</p>\n                    <p>Date: {date}</p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"mb-10 bg-gray-100 p-4 border-l-8 border-black\">\n                <h3 className=\"text-[10px] uppercase font-black text-gray-400\">Vendor / Supplier:</h3>\n                <p className=\"text-xl font-black uppercase underline\">{supplierName}</p>\n              </div>\n\n              <table className=\"w-full border-collapse\">\n                <thead>\n                  <tr className=\"bg-black text-white text-xs uppercase\">\n                    <th className=\"p-3 text-left w-12\">#</th>\n                    <th className=\"p-3 text-left\">Item Name</th>\n                    <th className=\"p-3 text-left\">Description</th>\n                    <th className=\"p-3 text-center w-20\">Qty</th>\n                    <th className=\"p-3 text-right w-28\">Rate</th>\n                    <th className=\"p-3 text-right w-28\">Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rows.map((r, i) => (\n                    <tr key={i} className=\"border-b-2 border-black font-bold\">\n                      <td className=\"p-3 text-gray-500\">{i + 1}</td>\n                      <td className=\"p-3 uppercase\">{r.name}</td>\n                      <td className=\"p-3 text-xs text-gray-600 italic leading-tight\">{r.desc}</td>\n                      <td className=\"p-3 text-center\">{r.qty}</td>\n                      <td className=\"p-3 text-right\">{Number(r.rate).toLocaleString()}</td>\n                      <td className=\"p-3 text-right font-black\">{(Number(r.qty) * Number(r.rate)).toLocaleString()}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n\n              <div className=\"mt-12 grid grid-cols-1 md:grid-cols-2 gap-10\">\n                <div>\n                  {remarks && (\n                    <div className=\"space-y-1\">\n                      <h4 className=\"text-[10px] uppercase font-black text-gray-400\">Remarks:</h4>\n                      <p className=\"text-sm border-l-4 border-gray-300 pl-3 font-medium italic\">{remarks}</p>\n                    </div>\n                  )}\n                </div>\n                <div className=\"space-y-4\">\n                  <div className=\"flex justify-between items-center text-xl border-t-4 border-black pt-3 font-black uppercase\">\n                    <span>Net Total:</span>\n                    <span>Rs. {total.toLocaleString()}</span>\n                  </div>\n                  <div className=\"pt-20 flex justify-between gap-4\">\n                    <div className=\"flex-1 border-t-2 border-black text-center text-[9px] font-black uppercase pt-1\">Prepared By</div>\n                    <div className=\"flex-1 border-t-2 border-black text-center text-[9px] font-black uppercase pt-1\">Authorized</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </>\n      )}\n      {/* EMAIL MODAL */}\n      {emailModalOpen && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white p-6 rounded shadow-lg w-96\">\n            <h2 className=\"text-xl font-bold mb-4\">Send Email</h2>\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-bold mb-2\">Recipient Email</label>\n              <input\n                type=\"email\"\n                value={recipientEmail}\n                onChange={(e) => setRecipientEmail(e.target.value)}\n                className=\"w-full border p-2 rounded\"\n                placeholder=\"supplier@example.com\"\n              />\n            </div>\n            <div className=\"flex justify-end gap-2\">\n              <button\n                onClick={() => setEmailModalOpen(false)}\n                className=\"bg-gray-500 text-white px-4 py-2 rounded\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={confirmSendEmail}\n                disabled={sendingEmail}\n                className=\"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50\"\n              >\n                {sendingEmail ? \"Sending...\" : \"Send\"}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\purchase-print\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[469,472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[469,472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\projects\\smart-business-accounts\\app\\dashboard\\purchase-print\\page.tsx:20:5\n  18 |\n  19 |   useEffect(() => {\n> 20 |     setOrigin(window.location.origin);\n     |     ^^^^^^^^^ Avoid calling setState() directly within an effect\n  21 |     if (!id) return;\n  22 |     fetch(`/api/purchase-invoice?id=${id}`)\n  23 |       .then(r => r.json())","line":20,"column":5,"nodeType":null,"endLine":20,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2432,2435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2432,2435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useSearchParams } from \"next/navigation\";\r\nimport { useEffect, useState } from \"react\";\r\nimport dynamic from \"next/dynamic\";\r\n\r\nconst Barcode = dynamic(() => import(\"react-barcode\"), { \r\n  ssr: false,\r\n  loading: () => <p>Loading Barcode...</p>\r\n});\r\nimport { QRCodeSVG } from \"qrcode.react\";\r\n\r\nexport default function PurchasePrint() {\r\n  const params = useSearchParams();\r\n  const id = params.get(\"id\");\r\n  const [data, setData] = useState<any>(null);\r\n  const [origin, setOrigin] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    setOrigin(window.location.origin);\r\n    if (!id) return;\r\n    fetch(`/api/purchase-invoice?id=${id}`)\r\n      .then(r => r.json())\r\n      .then(setData);\r\n  }, [id]);\r\n\r\n  if (!data) return null;\r\n\r\n  return (\r\n    <div className=\"p-10 text-sm print:p-0\">\r\n      <h2 className=\"text-xl font-bold text-center mb-4\">\r\n        PURCHASE INVOICE\r\n      </h2>\r\n\r\n      <div className=\"flex justify-between mb-4 items-start\">\r\n        <div>\r\n            <div className=\"font-bold\">Supplier: {data.supplier.name}</div>\r\n        </div>\r\n        <div className=\"text-right flex flex-col items-end\">\r\n            <div>Date: {new Date(data.date).toLocaleDateString()}</div>\r\n            <div className=\"font-bold\">Invoice #: {data.invoiceNo}</div>\r\n            {data.invoiceNo && (\r\n                <div className=\"mt-1 flex flex-col items-end gap-2\">\r\n                    <div className=\"text-center\">\r\n                        <Barcode value={data.invoiceNo} width={1.5} height={40} fontSize={10} displayValue={false} />\r\n                        <span className=\"text-[10px] font-bold\">{data.invoiceNo}</span>\r\n                    </div>\r\n                    {origin && (\r\n                        <div className=\"flex flex-col items-center border-t pt-1 mt-1\">\r\n                            <QRCodeSVG value={`${origin}/view/purchase-invoice?id=${data.id}`} size={60} />\r\n                            <span className=\"text-[8px] font-bold mt-1 bg-black text-white px-1\">SCAN FOR ONLINE BILL</span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n      </div>\r\n\r\n      <table className=\"w-full border\">\r\n        <thead>\r\n          <tr>\r\n            <th>Item</th>\r\n            <th>Qty</th>\r\n            <th>Rate</th>\r\n            <th>Amount</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {data.items.map((i: any) => (\r\n            <tr key={i.id}>\r\n              <td>{i.item.name}</td>\r\n              <td>{i.qty}</td>\r\n              <td>{i.rate}</td>\r\n              <td>{i.amount}</td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n\r\n      <div className=\"text-right mt-4 font-bold\">\r\n        Total: {data.total}\r\n      </div>\r\n\r\n      <button\r\n        onClick={() => window.print()}\r\n        className=\"mt-6 print:hidden border px-4 py-2\"\r\n      >\r\n        Print\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\quotation\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":46,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSearchTerm' is assigned a value but never used.","line":68,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":68,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2145,2148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2145,2148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sendingEmail' is assigned a value but never used.","line":73,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSendingEmail' is assigned a value but never used.","line":73,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2950,2953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2950,2953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadQuotations' and 'user'. Either include them or remove the dependency array.","line":125,"column":6,"nodeType":"ArrayExpression","endLine":125,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadQuotations, user]","fix":{"range":[3570,3572],"text":"[loadQuotations, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":267,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7779,7782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7779,7782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8164,8167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8164,8167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":309,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":309,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":339,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9850,9853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9850,9853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":654,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":654,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24249,24252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24249,24252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport toast from \"react-hot-toast\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { hasPermission } from \"@/lib/hasPermission\";\nimport { PERMISSIONS } from \"@/lib/permissions\";\nimport { useRouter } from \"next/navigation\";\n\ntype Account = { id: string; name: string };\ntype Item = {\n  id: string;\n  name: string;\n  description?: string;\n  availableQty: number;\n};\ntype Row = {\n  itemId: string;\n  name: string;\n  description: string;\n  availableQty: number;\n  qty: number | \"\";\n  rate: number | \"\";\n};\n\ntype Quotation = {\n  id: string;\n  quotationNo: string;\n  date: string;\n  customerId: string;\n  customer?: { name: string };\n  total: number;\n  items: Array<{ item: { name: string; description?: string }; qty: number; rate: number }>;\n  status: string;\n};\n\ntype TaxConfig = {\n  id: string;\n  taxType: string;\n  taxCode: string;\n  taxRate: number;\n  description?: string;\n};\n\nexport default function QuotationPage() {\n  const router = useRouter();\n  const today = new Date().toISOString().slice(0, 10);\n  const user = getCurrentUser();\n\n  const [authorized, setAuthorized] = useState(false);\n  const [loading, setLoading] = useState(true);\n\n  const [customers, setCustomers] = useState<Account[]>([]);\n  const [items, setItems] = useState<Item[]>([]);\n  const [quotations, setQuotations] = useState<Quotation[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<Quotation | null>(null);\n\n  const [quotationNo, setQuotationNo] = useState(\"\");\n  const [customerId, setCustomerId] = useState(\"\");\n  const [customerName, setCustomerName] = useState(\"\");\n  const [date, setDate] = useState(today);\n  const [validUntil, setValidUntil] = useState(\"\");\n  const [rows, setRows] = useState<Row[]>([{\n    itemId: \"\", name: \"\", description: \"\", availableQty: 0, qty: \"\", rate: \"\",\n  }]);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  const [saving, setSaving] = useState(false);\n  const [preview, setPreview] = useState(false);\n  const [savedQuotation, setSavedQuotation] = useState<any>(null);\n  const [sendingEmail, setSendingEmail] = useState(false);\n  const [hideRates, setHideRates] = useState(false);\n  \n  // Tax states\n  const [applyTax, setApplyTax] = useState(false);\n  const [selectedTaxId, setSelectedTaxId] = useState(\"\");\n  const [taxes, setTaxes] = useState<TaxConfig[]>([]);\n\n  useEffect(() => {\n    if (!user) {\n      setLoading(false);\n      return;\n    }\n    if (!hasPermission(user, PERMISSIONS.CREATE_QUOTATION)) {\n      setLoading(false);\n      return;\n    }\n    setAuthorized(true);\n    \n    // Load initial data\n    loadQuotations();\n    \n    fetch(\"/api/accounts\", {\n      headers: { \"x-user-role\": user.role },\n    })\n      .then(r => r.json())\n      .then(d => {\n        const list = Array.isArray(d) ? d : d.accounts || [];\n        setCustomers(list.filter((a: any) => a.partyType === \"CUSTOMER\"));\n      });\n\n    fetch(\"/api/items-new\")\n      .then(r => r.json())\n      .then(d => setItems(Array.isArray(d) ? d : []));\n\n    fetch(\"/api/tax-configuration\")\n      .then(r => r.json())\n      .then(d => setTaxes(Array.isArray(d) ? d : []))\n      .catch(err => console.log(\"Tax config error:\", err));\n      \n    fetch(\"/api/quotation\", {\n        headers: {\n            \"x-user-role\": user.role || \"\",\n            \"x-user-id\": user.id || \"\"\n        }\n    })\n    .then(r => r.json())\n    .then(d => {\n        if(d?.nextNo) setQuotationNo(d.nextNo);\n    });\n\n    setLoading(false);\n  }, []);\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    function handleKeyPress(e: KeyboardEvent) {\n      if (e.code === \"F7\" || e.key === \"F7\") {\n        e.preventDefault();\n        if (showForm && !preview) {\n          setDate(today);\n          setCustomerId(\"\");\n          setCustomerName(\"\");\n        }\n      }\n      if (e.code === \"F8\" || e.key === \"F8\") {\n        e.preventDefault();\n        if (showForm && !preview) {\n          const query = prompt(\"Enter search query (Quotation No, Customer Name, etc.):\");\n          if (query) {\n            const foundCustomer = customers.find(c => \n              c.name.toLowerCase().includes(query.toLowerCase())\n            );\n            if (foundCustomer) {\n              setCustomerId(foundCustomer.id);\n              setCustomerName(foundCustomer.name);\n            } else {\n              toast.error(`No customer found matching \"${query}\"`);\n            }\n          }\n        }\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyPress, true);\n    return () => document.removeEventListener(\"keydown\", handleKeyPress, true);\n  }, [today, showForm, preview, customers]);\n\n  async function loadQuotations() {\n    try {\n      const res = await fetch(\"/api/quotation\", {\n        headers: {\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        }\n      });\n      const data = await res.json();\n      if (data?.quotations) {\n        setQuotations(data.quotations);\n      }\n    } catch (e) {\n      console.error(\"Load quotations error:\", e);\n    }\n  }\n\n  function addRow() {\n    setRows(r => [\n      ...r,\n      { itemId: \"\", name: \"\", description: \"\", availableQty: 0, qty: \"\", rate: \"\" },\n    ]);\n  }\n\n  function selectItem(index: number, itemId: string) {\n    const item = items.find(i => i.id === itemId);\n    if (!item) return;\n    const copy = [...rows];\n    copy[index] = {\n      ...copy[index],\n      itemId: item.id,\n      name: item.name,\n      description: item.description || \"\",\n      availableQty: item.availableQty,\n      qty: \"\",\n    };\n    setRows(copy);\n  }\n\n  function updateRow(index: number, key: \"qty\" | \"rate\", val: string) {\n    const copy = [...rows];\n    const num = val === \"\" ? \"\" : Number(val);\n    copy[index][key] = num;\n    setRows(copy);\n  }\n\n  const total = rows.reduce((s, r) => s + (Number(r.qty) * Number(r.rate) || 0), 0);\n  const selectedTax = taxes.find(t => t.id === selectedTaxId);\n  const taxAmount = applyTax && selectedTax ? (total * (selectedTax.taxRate / 100)) : 0;\n  const netTotal = total + taxAmount;\n\n  async function saveQuotation() {\n    const clean = rows.filter(r => r.itemId && r.qty && r.rate);\n    if (!customerId || !clean.length) {\n      toast.error(\"Customer aur items zaroori hain\");\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const method = editing ? \"PUT\" : \"POST\";\n      const baseBody = {\n        quotationNo,\n        customerId,\n        date,\n        validUntil: validUntil || null,\n        items: clean.map(r => {\n          const qty = Number(r.qty);\n          const rate = Number(r.rate);\n          return { itemId: r.itemId, qty, rate, amount: qty * rate };\n        }),\n        applyTax,\n        taxConfigId: applyTax ? selectedTaxId : null,\n      };\n      const body = editing ? { id: editing.id, ...baseBody } : baseBody;\n\n      const res = await fetch(\"/api/quotation\", {\n        method,\n        headers: { \n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        },\n        body: JSON.stringify(body),\n      });\n      \n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || \"Save failed\");\n      }\n      \n      const data = await res.json();\n      \n      if (data.quotation) {\n        setSavedQuotation(data.quotation);\n        setQuotationNo(data.quotationNo || quotationNo);\n        setCustomerName(data.quotation.customer?.name || customerName);\n      }\n      \n      setPreview(true);\n      await loadQuotations();\n      if (editing) {\n        setEditing(null);\n        setShowForm(false);\n        setShowList(true);\n      }\n      toast.success(\"Quotation saved successfully!\");\n    } catch (e: any) {\n      toast.error(\"Saving failed: \" + (e.message || \"Unknown error\"));\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  function startEdit(q: Quotation) {\n    setEditing(q);\n    setQuotationNo(q.quotationNo);\n    setCustomerId(q.customerId);\n    setCustomerName(q.customer?.name || \"\");\n    setDate(new Date(q.date).toISOString().slice(0, 10));\n    setRows(q.items.map((it: any) => ({\n      itemId: it.itemId || \"\",\n      name: it.item?.name || \"\",\n      description: it.item?.description || \"\",\n      availableQty: 0, // Not needed for edit\n      qty: it.qty.toString(),\n      rate: it.rate.toString(),\n    })));\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deleteQuotation(id: string) {\n    if (!confirm(\"Are you sure you want to delete this quotation?\")) return;\n    try {\n      const res = await fetch(`/api/quotation?id=${id}`, {\n        method: \"DELETE\",\n        headers: {\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        },\n      });\n      if (res.ok) {\n        toast.success(\"Quotation deleted successfully\");\n        await loadQuotations();\n      } else {\n        const err = await res.json();\n        toast.error(err.error || \"Delete failed\");\n      }\n    } catch (e) {\n      toast.error(\"Delete failed\");\n    }\n  }\n\n  function resetForm() {\n    setEditing(null);\n    setCustomerId(\"\");\n    setCustomerName(\"\");\n    setDate(today);\n    setValidUntil(\"\");\n    setRows([{ itemId: \"\", name: \"\", description: \"\", availableQty: 0, qty: \"\", rate: \"\" }]);\n    setApplyTax(false);\n    setSelectedTaxId(\"\");\n    setPreview(false);\n  }\n\n  // Share on WhatsApp\n  const shareOnWhatsApp = () => {\n    if (!savedQuotation) {\n      toast.error(\"Please save the quotation first\");\n      return;\n    }\n    \n    // Construct a message\n    let message = `*Quotation: ${savedQuotation.quotationNo}*\\n`;\n    message += `Date: ${new Date(savedQuotation.date).toLocaleDateString()}\\n`;\n    message += `Customer: ${customerName}\\n\\n`;\n    message += `*Items:*\\n`;\n    \n    savedQuotation.items.forEach((item: any, index: number) => {\n      message += `${index + 1}. ${item.item.name} x ${item.qty} @ ${item.rate} = ${(item.qty * item.rate).toLocaleString()}\\n`;\n    });\n    \n    message += `\\n*Total Amount: ${savedQuotation.total.toLocaleString()}*`;\n    \n    const url = `https://wa.me/?text=${encodeURIComponent(message)}`;\n    window.open(url, '_blank');\n  };\n\n  // Share on SMS\n  const shareOnSMS = () => {\n    if (!savedQuotation) {\n      toast.error(\"Please save the quotation first\");\n      return;\n    }\n    \n    // Construct a message (shorter for SMS)\n    let message = `Quotation: ${savedQuotation.quotationNo}\\n`;\n    message += `Date: ${new Date(savedQuotation.date).toLocaleDateString()}\\n`;\n    message += `Customer: ${customerName}\\n`;\n    message += `Total: ${savedQuotation.total.toLocaleString()}`;\n    \n    const url = `sms:?body=${encodeURIComponent(message)}`;\n    window.open(url, '_blank');\n  };\n\n  if (loading) return <div className=\"p-6\">Loading...</div>;\n  if (!authorized) return <div className=\"p-6 text-red-600\">Access Denied</div>;\n\n  const filteredQuotations = quotations.filter(q => {\n  if (!searchTerm.trim()) return true;\n\n  const term = searchTerm.toLowerCase();\n\n  return (\n    q.quotationNo?.toLowerCase().includes(term) ||\n    q.customer?.name?.toLowerCase().includes(term) ||\n    q.date?.toLowerCase().includes(term) ||\n    q.status?.toLowerCase().includes(term)\n  );\n});\n\n\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-2xl font-bold\">Quotation / Estimate</h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => { setShowList(!showList); setShowForm(!showForm); setEditing(null); }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => { setShowForm(true); setShowList(false); resetForm(); loadQuotations(); }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New Quotation\n          </button>\n        </div>\n      </div>\n\n      {/* LIST VIEW */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-hidden\">\n          <table className=\"w-full text-sm\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">Quotation No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Customer</th>\n                <th className=\"p-3 text-right\">Total</th>\n                <th className=\"p-3 text-left\">Status</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredQuotations.length === 0 ? (\n                <tr>\n                  <td colSpan={6} className=\"p-4 text-center text-gray-400\">No quotations found</td>\n                </tr>\n              ) : (\n                filteredQuotations.map(q => (\n                  <tr key={q.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">{q.quotationNo}</td>\n                    <td className=\"p-3\">{new Date(q.date).toLocaleDateString()}</td>\n                    <td className=\"p-3\">{q.customer?.name || \"N/A\"}</td>\n                    <td className=\"p-3 text-right\">{q.total.toLocaleString()}</td>\n                    <td className=\"p-3\">\n                      <span className={`px-2 py-1 rounded text-xs ${q.status === 'APPROVED' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}`}>\n                        {q.status}\n                      </span>\n                    </td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(q)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deleteQuotation(q.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <>\n          <div className=\"flex flex-col md:flex-row justify-between items-center bg-gray-50 p-4 border rounded print:hidden gap-4\">\n            <h1 className=\"text-2xl font-bold\">Quotation ({quotationNo})</h1>\n            {!preview ? (\n              <div className=\"flex flex-wrap gap-2\">\n                <button onClick={saveQuotation} disabled={saving} className=\"bg-blue-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  {saving ? \"Saving...\" : editing ? \"Update Quotation\" : \"Save & Preview\"}\n                </button>\n                <button onClick={() => { setShowForm(false); setEditing(null); resetForm(); }} className=\"bg-gray-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  Cancel\n                </button>\n              </div>\n            ) : (\n              <div className=\"flex flex-wrap gap-2\">\n                <button onClick={() => window.print()} className=\"bg-green-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  Print\n                </button>\n                <button \n                  onClick={() => setHideRates(!hideRates)} \n                  className=\"bg-purple-600 text-white px-6 py-2 rounded flex-1 md:flex-none\"\n                >\n                  {hideRates ? \"Show Rates\" : \"Hide Rates\"}\n                </button>\n                <button \n                  onClick={shareOnWhatsApp}\n                  className=\"bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 flex-1 md:flex-none\"\n                >\n                  📱 WhatsApp\n                </button>\n                <button \n                  onClick={shareOnSMS}\n                  className=\"bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 flex-1 md:flex-none\"\n                >\n                  💬 SMS\n                </button>\n                <button onClick={() => setPreview(false)} className=\"bg-yellow-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  Edit\n                </button>\n                <button onClick={() => { setPreview(false); resetForm(); }} className=\"bg-gray-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  New Quotation\n                </button>\n              </div>\n            )}\n          </div>\n\n          {!preview && (\n            <div className=\"bg-white border p-6 rounded space-y-4\">\n              <div className=\"mb-2 text-xs text-gray-500 italic\">\n                💡 Keyboard Shortcuts: <strong>F7</strong> = Clear Date & Customer | <strong>F8</strong> = Search Query\n              </div>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <input value={quotationNo} readOnly className=\"border p-2 bg-gray-100\" placeholder=\"Quotation No\" />\n                <div>\n                  <label className=\"text-xs font-bold\">Customer (F7: Clear, F8: Query)</label>\n                  <select className=\"border p-2 w-full\" value={customerId} onChange={e => {\n                    setCustomerId(e.target.value);\n                    setCustomerName(customers.find(c => c.id === e.target.value)?.name || \"\");\n                  }}>\n                    <option value=\"\">Select Customer</option>\n                    {customers.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}\n                  </select>\n                </div>\n                <div>\n                  <label className=\"text-xs font-bold\">Date</label>\n                  <input type=\"date\" className=\"border p-2 w-full\" value={date} onChange={e => setDate(e.target.value)} />\n                </div>\n                <div>\n                  <label className=\"text-xs font-bold\">Valid Until</label>\n                  <input type=\"date\" className=\"border p-2 w-full\" value={validUntil} onChange={e => setValidUntil(e.target.value)} />\n                </div>\n              </div>\n\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full border mt-4 text-sm min-w-[600px]\">\n                  <thead className=\"bg-gray-100\">\n                    <tr>\n                      <th className=\"border p-2 text-left\">Item</th>\n                      <th className=\"border p-2 w-24\">Qty</th>\n                      <th className=\"border p-2 w-32\">Rate</th>\n                      <th className=\"border p-2 w-32 text-right\">Amount</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {rows.map((r, i) => (\n                      <tr key={i}>\n                        <td className=\"border p-2\">\n                          <select className=\"w-full\" value={r.itemId} onChange={e => selectItem(i, e.target.value)}>\n                            <option value=\"\">Select Item</option>\n                            {items.map(it => (\n                              <option key={it.id} value={it.id}>\n                                {it.name} ({it.description})\n                              </option>\n                            ))}\n                          </select>\n                        </td>\n                        <td className=\"border p-2\">\n                          <input type=\"number\" value={r.qty} className=\"w-full text-center\" onChange={e => updateRow(i, \"qty\", e.target.value)} />\n                        </td>\n                        <td className=\"border p-2\">\n                          <input type=\"number\" value={r.rate} className=\"w-full text-center\" onChange={e => updateRow(i, \"rate\", e.target.value)} />\n                        </td>\n                        <td className=\"border p-2 text-right\">\n                          {(Number(r.qty) * Number(r.rate) || 0).toLocaleString()}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n              <button onClick={addRow} className=\"bg-gray-100 px-4 py-1 rounded\">+ Add Row</button>\n\n              <div className=\"flex justify-end pt-4\">\n                <div className=\"w-full md:w-64 space-y-2\">\n                  <div className=\"flex justify-between\"><span>Total</span><span>{total.toLocaleString()}</span></div>\n                  \n                  {/* Tax Section */}\n                  <div className=\"border-t pt-2 space-y-2\">\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        setApplyTax(!applyTax);\n                        if (!applyTax) setSelectedTaxId(\"\");\n                      }}\n                      className={`w-full py-1 px-2 rounded font-semibold text-sm ${\n                        applyTax ? \"bg-blue-600 text-white\" : \"bg-gray-200 text-gray-700\"\n                      }`}\n                    >\n                      {applyTax ? \"✓ Tax Applied\" : \"+ Add Tax\"}\n                    </button>\n                    \n                    {applyTax && (\n                      <div className=\"space-y-2\">\n                        <select\n                          value={selectedTaxId}\n                          onChange={e => setSelectedTaxId(e.target.value)}\n                          className=\"w-full border p-1 text-sm\"\n                        >\n                          <option value=\"\">Select Tax</option>\n                          {taxes.map(t => (\n                            <option key={t.id} value={t.id}>\n                              {t.taxType} - {t.taxCode} ({t.taxRate}%)\n                            </option>\n                          ))}\n                        </select>\n                        {selectedTax && (\n                           <div className=\"flex justify-between text-sm\">\n                             <span>Tax ({selectedTax.taxRate}%)</span>\n                             <span>{taxAmount.toLocaleString()}</span>\n                           </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"flex justify-between font-bold border-t pt-2\">\n                    <span>Net Total</span>\n                    <span>{netTotal.toLocaleString()}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* PREVIEW SECTION */}\n          {preview && savedQuotation && (\n            <div className=\"bg-white p-8 border rounded shadow-lg max-w-4xl mx-auto print:shadow-none print:border-none\">\n              <div className=\"text-center mb-8\">\n                <h1 className=\"text-3xl font-bold uppercase tracking-wider\">Quotation</h1>\n                <p className=\"text-gray-500\">Date: {new Date(savedQuotation.date).toLocaleDateString()}</p>\n                <p className=\"text-gray-500 font-bold\">#{savedQuotation.quotationNo}</p>\n              </div>\n\n              <div className=\"flex justify-between mb-8\">\n                <div>\n                  <h3 className=\"font-bold text-gray-700\">Bill To:</h3>\n                  <p className=\"text-lg font-semibold\">{customerName}</p>\n                </div>\n                <div className=\"text-right\">\n                  <h3 className=\"font-bold text-gray-700\">Details:</h3>\n                  {savedQuotation.validUntil && (\n                     <p>Valid Until: {new Date(savedQuotation.validUntil).toLocaleDateString()}</p>\n                  )}\n                </div>\n              </div>\n\n              <table className=\"w-full mb-8\">\n                <thead>\n                  <tr className=\"bg-gray-100 border-b-2 border-gray-300\">\n                    <th className=\"text-left py-2 px-4\">Item</th>\n                    <th className=\"text-center py-2 px-4\">Qty</th>\n                    {!hideRates && <th className=\"text-right py-2 px-4\">Rate</th>}\n                    {!hideRates && <th className=\"text-right py-2 px-4\">Amount</th>}\n                  </tr>\n                </thead>\n                <tbody>\n                  {savedQuotation.items.map((item: any, i: number) => (\n                    <tr key={i} className=\"border-b\">\n                      <td className=\"py-2 px-4\">\n                        <p className=\"font-bold\">{item.item.name}</p>\n                        {item.item.description && <p className=\"text-xs text-gray-500\">{item.item.description}</p>}\n                      </td>\n                      <td className=\"text-center py-2 px-4\">{item.qty}</td>\n                      {!hideRates && <td className=\"text-right py-2 px-4\">{item.rate.toLocaleString()}</td>}\n                      {!hideRates && <td className=\"text-right py-2 px-4\">{(item.qty * item.rate).toLocaleString()}</td>}\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n\n              {!hideRates && (\n              <div className=\"flex justify-end\">\n                <div className=\"w-64 space-y-2\">\n                  <div className=\"flex justify-between text-gray-600\">\n                    <span>Subtotal:</span>\n                    <span>{savedQuotation.total.toLocaleString()}</span>\n                  </div>\n                  {/* You might want to display tax here if saved in quotation */}\n                  <div className=\"flex justify-between font-bold text-xl border-t pt-2\">\n                    <span>Total:</span>\n                    <span>{savedQuotation.total.toLocaleString()}</span>\n                  </div>\n                </div>\n              </div>\n              )}\n              \n              <div className=\"mt-12 pt-8 border-t text-center text-gray-500 text-sm\">\n                <p>Thank you for your business!</p>\n              </div>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\recurring-transactions\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1086,1089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1086,1089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":46,"column":3,"nodeType":"Identifier","endLine":46,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadAccounts' and 'loadTransactions'. Either include them or remove the dependency array.","line":49,"column":6,"nodeType":"ArrayExpression","endLine":49,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadAccounts, loadTransactions]","fix":{"range":[1321,1323],"text":"[loadAccounts, loadTransactions]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":124,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":124,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":146,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":146,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":168,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":168,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { hasPermission } from \"@/lib/hasPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\ntype RecurringTransaction = {\r\n  id: string;\r\n  accountId: string;\r\n  account: { name: string };\r\n  type: string;\r\n  frequency: string;\r\n  amount: number;\r\n  description: string;\r\n  narration?: string;\r\n  nextDate: string;\r\n  lastRun?: string;\r\n  isActive: boolean;\r\n};\r\n\r\nexport default function RecurringTransactionsPage() {\r\n  const [transactions, setTransactions] = useState<RecurringTransaction[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [editing, setEditing] = useState<RecurringTransaction | null>(null);\r\n\r\n  const [formData, setFormData] = useState({\r\n    accountId: \"\",\r\n    type: \"EXPENSE\",\r\n    frequency: \"MONTHLY\",\r\n    amount: \"\",\r\n    description: \"\",\r\n    narration: \"\",\r\n    nextDate: new Date().toISOString().slice(0, 10),\r\n  });\r\n\r\n  const [accounts, setAccounts] = useState<any[]>([]);\r\n\r\n  const user = getCurrentUser();\r\n\r\n  if (!hasPermission(user, PERMISSIONS.RECURRING_TRANSACTIONS)) {\r\n    return <div>Access Denied</div>;\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadTransactions();\r\n    loadAccounts();\r\n  }, []);\r\n\r\n  async function loadTransactions() {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/api/recurring-transactions\", {\r\n        headers: {\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n      });\r\n      const data = await res.json();\r\n      if (Array.isArray(data)) {\r\n        setTransactions(data);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Load error:\", e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function loadAccounts() {\r\n    try {\r\n      const res = await fetch(\"/api/accounts\", {\r\n        headers: { \"x-user-role\": user?.role || \"\" },\r\n      });\r\n      const data = await res.json();\r\n      const list = Array.isArray(data) ? data : data.accounts || [];\r\n      setAccounts(list);\r\n    } catch (e) {\r\n      console.error(\"Accounts load error:\", e);\r\n    }\r\n  }\r\n\r\n  async function saveTransaction() {\r\n    if (!formData.accountId || !formData.amount || !formData.description) {\r\n      alert(\"Please fill all required fields\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const url = editing\r\n        ? \"/api/recurring-transactions\"\r\n        : \"/api/recurring-transactions\";\r\n      const method = editing ? \"PUT\" : \"POST\";\r\n\r\n      const res = await fetch(url, {\r\n        method,\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n        body: JSON.stringify(editing ? { id: editing.id, ...formData } : formData),\r\n      });\r\n\r\n      if (res.ok) {\r\n        await loadTransactions();\r\n        setShowForm(false);\r\n        setEditing(null);\r\n        setFormData({\r\n          accountId: \"\",\r\n          type: \"EXPENSE\",\r\n          frequency: \"MONTHLY\",\r\n          amount: \"\",\r\n          description: \"\",\r\n          narration: \"\",\r\n          nextDate: new Date().toISOString().slice(0, 10),\r\n        });\r\n      } else {\r\n        const error = await res.json();\r\n        alert(error.error || \"Save failed\");\r\n      }\r\n    } catch (e) {\r\n      alert(\"Save failed\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function toggleActive(id: string, currentStatus: boolean) {\r\n    try {\r\n      const res = await fetch(\"/api/recurring-transactions\", {\r\n        method: \"PUT\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n        body: JSON.stringify({ id, isActive: !currentStatus }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        await loadTransactions();\r\n      }\r\n    } catch (e) {\r\n      alert(\"Update failed\");\r\n    }\r\n  }\r\n\r\n  async function deleteTransaction(id: string) {\r\n    if (!confirm(\"Are you sure you want to delete this recurring transaction?\")) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(`/api/recurring-transactions?id=${id}`, {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          \"x-user-role\": user?.role || \"\",\r\n          \"x-user-id\": user?.id || \"\",\r\n        },\r\n      });\r\n\r\n      if (res.ok) {\r\n        await loadTransactions();\r\n      }\r\n    } catch (e) {\r\n      alert(\"Delete failed\");\r\n    }\r\n  }\r\n\r\n  function startEdit(t: RecurringTransaction) {\r\n    setEditing(t);\r\n    setFormData({\r\n      accountId: t.accountId,\r\n      type: t.type,\r\n      frequency: t.frequency,\r\n      amount: t.amount.toString(),\r\n      description: t.description,\r\n      narration: t.narration || \"\",\r\n      nextDate: new Date(t.nextDate).toISOString().slice(0, 10),\r\n    });\r\n    setShowForm(true);\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-2xl font-bold\">Recurring Transactions</h1>\r\n        <button\r\n          onClick={() => {\r\n            setShowForm(true);\r\n            setEditing(null);\r\n            setFormData({\r\n              accountId: \"\",\r\n              type: \"EXPENSE\",\r\n              frequency: \"MONTHLY\",\r\n              amount: \"\",\r\n              description: \"\",\r\n              narration: \"\",\r\n              nextDate: new Date().toISOString().slice(0, 10),\r\n            });\r\n          }}\r\n          className=\"bg-blue-600 text-white px-4 py-2 rounded\"\r\n        >\r\n          + Add Recurring Transaction\r\n        </button>\r\n      </div>\r\n\r\n      {showForm && (\r\n        <div className=\"bg-white border p-6 rounded space-y-4\">\r\n          <h2 className=\"text-xl font-bold\">\r\n            {editing ? \"Edit\" : \"New\"} Recurring Transaction\r\n          </h2>\r\n\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-bold mb-1\">Account *</label>\r\n              <select\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.accountId}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, accountId: e.target.value })\r\n                }\r\n              >\r\n                <option value=\"\">Select Account</option>\r\n                {accounts.map((a) => (\r\n                  <option key={a.id} value={a.id}>\r\n                    {a.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-bold mb-1\">Type *</label>\r\n              <select\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.type}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, type: e.target.value })\r\n                }\r\n              >\r\n                <option value=\"CPV\">Cash Payment (CPV)</option>\r\n                <option value=\"CRV\">Cash Receipt (CRV)</option>\r\n                <option value=\"EXPENSE\">Expense</option>\r\n                <option value=\"PAYMENT\">Payment</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-bold mb-1\">\r\n                Frequency *\r\n              </label>\r\n              <select\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.frequency}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, frequency: e.target.value })\r\n                }\r\n              >\r\n                <option value=\"DAILY\">Daily</option>\r\n                <option value=\"WEEKLY\">Weekly</option>\r\n                <option value=\"MONTHLY\">Monthly</option>\r\n                <option value=\"QUARTERLY\">Quarterly</option>\r\n                <option value=\"YEARLY\">Yearly</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-bold mb-1\">Amount *</label>\r\n              <input\r\n                type=\"number\"\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.amount}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, amount: e.target.value })\r\n                }\r\n              />\r\n            </div>\r\n\r\n            <div className=\"col-span-2\">\r\n              <label className=\"block text-sm font-bold mb-1\">\r\n                Description *\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.description}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, description: e.target.value })\r\n                }\r\n              />\r\n            </div>\r\n\r\n            <div className=\"col-span-2\">\r\n              <label className=\"block text-sm font-bold mb-1\">Narration</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.narration}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, narration: e.target.value })\r\n                }\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-bold mb-1\">Next Date *</label>\r\n              <input\r\n                type=\"date\"\r\n                className=\"w-full border p-2 rounded\"\r\n                value={formData.nextDate}\r\n                onChange={(e) =>\r\n                  setFormData({ ...formData, nextDate: e.target.value })\r\n                }\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={saveTransaction}\r\n              disabled={loading}\r\n              className=\"bg-green-600 text-white px-6 py-2 rounded\"\r\n            >\r\n              {loading ? \"Saving...\" : \"Save\"}\r\n            </button>\r\n            <button\r\n              onClick={() => {\r\n                setShowForm(false);\r\n                setEditing(null);\r\n              }}\r\n              className=\"bg-gray-600 text-white px-6 py-2 rounded\"\r\n            >\r\n              Cancel\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"bg-white border rounded overflow-hidden\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-100\">\r\n            <tr>\r\n              <th className=\"p-3 text-left\">Account</th>\r\n              <th className=\"p-3 text-left\">Type</th>\r\n              <th className=\"p-3 text-left\">Frequency</th>\r\n              <th className=\"p-3 text-right\">Amount</th>\r\n              <th className=\"p-3 text-left\">Description</th>\r\n              <th className=\"p-3 text-left\">Next Date</th>\r\n              <th className=\"p-3 text-left\">Last Run</th>\r\n              <th className=\"p-3 text-center\">Status</th>\r\n              <th className=\"p-3 text-center\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {loading ? (\r\n              <tr>\r\n                <td colSpan={9} className=\"p-4 text-center\">\r\n                  Loading...\r\n                </td>\r\n              </tr>\r\n            ) : transactions.length === 0 ? (\r\n              <tr>\r\n                <td colSpan={9} className=\"p-4 text-center text-gray-400\">\r\n                  No recurring transactions found\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              transactions.map((t) => (\r\n                <tr key={t.id} className=\"border-t\">\r\n                  <td className=\"p-3\">{t.account.name}</td>\r\n                  <td className=\"p-3\">{t.type}</td>\r\n                  <td className=\"p-3\">{t.frequency}</td>\r\n                  <td className=\"p-3 text-right\">\r\n                    {t.amount.toLocaleString()}\r\n                  </td>\r\n                  <td className=\"p-3\">{t.description}</td>\r\n                  <td className=\"p-3\">\r\n                    {new Date(t.nextDate).toLocaleDateString()}\r\n                  </td>\r\n                  <td className=\"p-3\">\r\n                    {t.lastRun\r\n                      ? new Date(t.lastRun).toLocaleDateString()\r\n                      : \"Never\"}\r\n                  </td>\r\n                  <td className=\"p-3 text-center\">\r\n                    <span\r\n                      className={`px-2 py-1 rounded text-xs ${\r\n                        t.isActive\r\n                          ? \"bg-green-100 text-green-800\"\r\n                          : \"bg-gray-100 text-gray-800\"\r\n                      }`}\r\n                    >\r\n                      {t.isActive ? \"Active\" : \"Inactive\"}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"p-3 text-center\">\r\n                    <div className=\"flex gap-2 justify-center\">\r\n                      <button\r\n                        onClick={() => startEdit(t)}\r\n                        className=\"text-blue-600 hover:underline\"\r\n                      >\r\n                        Edit\r\n                      </button>\r\n                      <button\r\n                        onClick={() => toggleActive(t.id, t.isActive)}\r\n                        className=\"text-yellow-600 hover:underline\"\r\n                      >\r\n                        {t.isActive ? \"Deactivate\" : \"Activate\"}\r\n                      </button>\r\n                      <button\r\n                        onClick={() => deleteTransaction(t.id)}\r\n                        className=\"text-red-600 hover:underline\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\ageing\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1399,1402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1399,1402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3141,3144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3141,3144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\n\r\ntype Party = {\r\n  id: string;\r\n  name: string;\r\n};\r\n\r\ntype AgeingRow = {\r\n  numType: string;\r\n  date: string;\r\n  narration: string;\r\n  billAmount: number;\r\n  billBalance: number;\r\n  days: number;\r\n  totalBalance: number;\r\n};\r\n\r\nexport default function AgeingReportPage() {\r\n  const today = new Date().toISOString().slice(0, 10);\r\n\r\n  const [type, setType] = useState<\"customer\" | \"supplier\">(\"customer\");\r\n  const [asOnDate, setAsOnDate] = useState(today);\r\n  const [partyId, setPartyId] = useState(\"\");\r\n  const [parties, setParties] = useState<Party[]>([]);\r\n  const [data, setData] = useState<AgeingRow[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // 🔄 Load customers / suppliers\r\n  useEffect(() => {\r\n    const user = getCurrentUser();\r\n    if (!user || !user.role) {\r\n      console.log(\"Waiting for user session...\");\r\n      return;\r\n    }\r\n\r\n    setPartyId(\"\");\r\n    setData([]);\r\n\r\n    fetch(\"/api/accounts\", {\r\n      headers: {\r\n        \"x-user-role\": user.role, // یہ ہیڈر لازمی ہے\r\n      },\r\n    })\r\n      .then(r => r.json())\r\n      .then(d => {\r\n        const list = Array.isArray(d) ? d : (d.accounts || []);\r\n        console.log(\"📊 All Accounts:\", list);\r\n\r\n        // کیس سینسیٹیو فلٹرنگ (Case Sensitive Fix)\r\n        const filtered = list.filter((a: any) => {\r\n          const pType = a.partyType?.toUpperCase();\r\n          return type === \"customer\"\r\n            ? pType === \"CUSTOMER\"\r\n            : pType === \"SUPPLIER\";\r\n        });\r\n\r\n        console.log(`🔍 Filtered ${type}s:`, filtered);\r\n        setParties(filtered);\r\n      });\r\n  }, [type]);\r\n\r\n  async function loadData() {\r\n    if (!partyId) return;\r\n\r\n    setLoading(true);\r\n    setData([]);\r\n\r\n    const url =\r\n      type === \"customer\"\r\n        ? `/api/reports/ageing/customer?date=${asOnDate}&customerId=${partyId}`\r\n        : `/api/reports/ageing/supplier?date=${asOnDate}&supplierId=${partyId}`;\r\n\r\n    try {\r\n      const res = await fetch(url, {\r\n        headers: {\r\n          \"x-user-role\": \"ADMIN\", // 🔥 THIS WAS MISSING\r\n        },\r\n      });\r\n\r\n      const json = await res.json();\r\n      console.log(`📋 Ageing Data for ${type}:`, json);\r\n      setData(Array.isArray(json) ? json : []);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6 max-w-7xl mx-auto\">\r\n\r\n      <h1 className=\"text-2xl font-bold\">Bill Wise Ageing Report</h1>\r\n\r\n      {/* 🔹 FILTER BAR */}\r\n      <div className=\"flex gap-4 flex-wrap items-end\">\r\n\r\n        {/* DATE */}\r\n        <div>\r\n          <label className=\"block text-sm\">As On Date</label>\r\n          <input\r\n            type=\"date\"\r\n            className=\"border px-3 py-2\"\r\n            value={asOnDate}\r\n            onChange={e => setAsOnDate(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        {/* TYPE */}\r\n        <div>\r\n          <label className=\"block text-sm\">Type</label>\r\n          <select\r\n            className=\"border px-3 py-2\"\r\n            value={type}\r\n            onChange={e => setType(e.target.value as any)}\r\n          >\r\n            <option value=\"customer\">Customer</option>\r\n            <option value=\"supplier\">Supplier</option>\r\n          </select>\r\n        </div>\r\n\r\n        {/* PARTY */}\r\n        <div>\r\n          <label className=\"block text-sm\">\r\n            Select {type === \"customer\" ? \"Customer\" : \"Supplier\"}\r\n          </label>\r\n          <select\r\n            className=\"border px-3 py-2 min-w-[240px]\"\r\n            value={partyId}\r\n            onChange={e => setPartyId(e.target.value)}\r\n          >\r\n            <option value=\"\">Select</option>\r\n            {/* سلیکٹ مینو کے اندر میپنگ کو اس طرح محفوظ بنائیں */}\r\n            {Array.isArray(parties) && parties.map(p => (\r\n              <option key={p.id} value={p.id}>{p.name}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        <button\r\n          onClick={loadData}\r\n          className=\"bg-black text-white px-6 py-2\"\r\n        >\r\n          Show\r\n        </button>\r\n      </div>\r\n\r\n      {/* 🔹 TABLE */}\r\n      <div className=\"border bg-white overflow-x-auto\">\r\n        <table className=\"w-full text-sm border-collapse\">\r\n          <thead className=\"bg-gray-100\">\r\n            <tr>\r\n              <th className=\"border p-2\">Num & Typ</th>\r\n              <th className=\"border p-2\">Date</th>\r\n              <th className=\"border p-2\">Narration</th>\r\n              <th className=\"border p-2 text-right\">Bill Amount</th>\r\n              <th className=\"border p-2 text-right\">Bill Balance</th>\r\n              <th className=\"border p-2 text-right\">Days</th>\r\n              <th className=\"border p-2 text-right\">Total Balance</th>\r\n            </tr>\r\n          </thead>\r\n\r\n          <tbody>\r\n            {loading && (\r\n              <tr>\r\n                <td colSpan={7} className=\"p-4 text-center\">Loading…</td>\r\n              </tr>\r\n            )}\r\n\r\n            {!loading && data.length === 0 && (\r\n              <tr>\r\n                <td colSpan={7} className=\"p-4 text-center text-gray-500\">\r\n                  No data found\r\n                </td>\r\n              </tr>\r\n            )}\r\n\r\n            {data.map((r, i) => (\r\n              <tr key={i}>\r\n                <td className=\"border p-2\">{r.numType}</td>\r\n                <td className=\"border p-2\">{r.date}</td>\r\n                <td className=\"border p-2\">{r.narration}</td>\r\n                <td className=\"border p-2 text-right\">\r\n                  {r.billAmount.toLocaleString()}\r\n                </td>\r\n                <td className=\"border p-2 text-right text-red-600\">\r\n                  {r.billBalance >= 0 ? \"\" : \"-\"}{Math.abs(r.billBalance).toLocaleString()}\r\n                </td>\r\n                <td className=\"border p-2 text-right font-semibold\">\r\n                  {r.days}\r\n                </td>\r\n                <td className=\"border p-2 text-right font-bold\">\r\n                  {r.totalBalance >= 0 ? \"\" : \"-\"}{Math.abs(r.totalBalance).toLocaleString()}\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n\r\n        {/* Total Balance Summary */}\r\n        {data.length > 0 && (\r\n          <div className=\"mt-4 flex justify-end\">\r\n            <div className=\"border-2 border-black p-4 bg-gray-100 w-80\">\r\n              <div className=\"flex justify-between items-center gap-4\">\r\n                <span className=\"font-bold uppercase text-sm\">Total Balance:</span>\r\n                <span className=\"text-2xl font-black\">\r\n                  {data[data.length - 1].totalBalance >= 0 ? \"\" : \"-\"}{Math.abs(data[data.length - 1].totalBalance).toLocaleString()}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\annual-statements\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[400,403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[400,403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":18,"column":6,"nodeType":"ArrayExpression","endLine":18,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadReport, year]","fix":{"range":[546,552],"text":"[loadReport, year]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5905,5908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5905,5908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { exportToCSV } from \"@/lib/export\";\r\nimport { exportToPDF } from \"@/lib/pdf-export\";\r\n\r\nexport default function AnnualStatementsPage() {\r\n  const currentYear = new Date().getFullYear();\r\n  const [year, setYear] = useState(currentYear.toString());\r\n  const [data, setData] = useState<any>(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const user = getCurrentUser();\r\n\r\n  useEffect(() => {\r\n    loadReport();\r\n  }, [year]);\r\n\r\n  async function loadReport() {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(`/api/reports/annual-statements?year=${year}`, {\r\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\r\n      });\r\n      const result = await res.json();\r\n      if (result.year) {\r\n        setData(result);\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  if (!data) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <h1 className=\"text-2xl font-bold\">Annual Financial Statements</h1>\r\n        <div className=\"mt-4\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-2xl font-bold\">\r\n          Annual Financial Statements - {year}\r\n        </h1>\r\n        <div className=\"flex gap-2\">\r\n          <input\r\n            type=\"number\"\r\n            className=\"border p-2 rounded\"\r\n            value={year}\r\n            onChange={(e) => setYear(e.target.value)}\r\n            min=\"2020\"\r\n            max=\"2100\"\r\n          />\r\n          <button\r\n            onClick={loadReport}\r\n            className=\"bg-blue-600 text-white px-6 py-2 rounded\"\r\n          >\r\n            {loading ? \"Loading...\" : \"Load\"}\r\n          </button>\r\n          {data && (\r\n            <>\r\n              <button\r\n                onClick={() => exportToCSV(data.accounts, `annual-statements-${year}`)}\r\n                className=\"bg-green-600 text-white px-6 py-2 rounded\"\r\n              >\r\n                Export CSV\r\n              </button>\r\n              <button\r\n                onClick={() =>\r\n                  exportToPDF(\r\n                    data.accounts,\r\n                    `Annual Statements ${year}`,\r\n                    [\"code\", \"name\", \"type\", \"openingBalance\", \"transactions\", \"closingBalance\"]\r\n                  )\r\n                }\r\n                className=\"bg-red-600 text-white px-6 py-2 rounded\"\r\n              >\r\n                Export PDF\r\n              </button>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Balance Sheet Summary */}\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div className=\"bg-white border rounded p-4\">\r\n          <h2 className=\"text-xl font-bold mb-4\">Balance Sheet</h2>\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex justify-between\">\r\n              <span>Assets:</span>\r\n              <span className=\"font-bold\">\r\n                {data.balanceSheet.assets.toLocaleString()}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span>Liabilities:</span>\r\n              <span className=\"font-bold\">\r\n                {data.balanceSheet.liabilities.toLocaleString()}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span>Equity:</span>\r\n              <span className=\"font-bold\">\r\n                {data.balanceSheet.equity.toLocaleString()}\r\n              </span>\r\n            </div>\r\n            <div className=\"border-t pt-2 mt-2\">\r\n              <div className=\"flex justify-between font-bold\">\r\n                <span>Total:</span>\r\n                <span>{data.balanceSheet.total.toLocaleString()}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white border rounded p-4\">\r\n          <h2 className=\"text-xl font-bold mb-4\">Profit & Loss</h2>\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex justify-between\">\r\n              <span>Income:</span>\r\n              <span className=\"font-bold text-green-600\">\r\n                {data.profitLoss.income.toLocaleString()}\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between\">\r\n              <span>Expenses:</span>\r\n              <span className=\"font-bold text-red-600\">\r\n                {data.profitLoss.expenses.toLocaleString()}\r\n              </span>\r\n            </div>\r\n            <div className=\"border-t pt-2 mt-2\">\r\n              <div className=\"flex justify-between font-bold\">\r\n                <span>Net Profit:</span>\r\n                <span\r\n                  className={\r\n                    data.profitLoss.netProfit >= 0\r\n                      ? \"text-green-600\"\r\n                      : \"text-red-600\"\r\n                  }\r\n                >\r\n                  {data.profitLoss.netProfit.toLocaleString()}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Account Details */}\r\n      <div className=\"bg-white border rounded overflow-hidden\">\r\n        <h2 className=\"text-xl font-bold p-4 border-b\">Account Details</h2>\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-100\">\r\n            <tr>\r\n              <th className=\"p-3 text-left\">Code</th>\r\n              <th className=\"p-3 text-left\">Account Name</th>\r\n              <th className=\"p-3 text-left\">Type</th>\r\n              <th className=\"p-3 text-right\">Opening</th>\r\n              <th className=\"p-3 text-right\">Transactions</th>\r\n              <th className=\"p-3 text-right\">Closing</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {data.accounts.map((acc: any, i: number) => (\r\n              <tr key={i} className=\"border-t\">\r\n                <td className=\"p-3\">{acc.code}</td>\r\n                <td className=\"p-3\">{acc.name}</td>\r\n                <td className=\"p-3\">{acc.type}</td>\r\n                <td className=\"p-3 text-right\">\r\n                  {acc.openingBalance.toLocaleString()}\r\n                </td>\r\n                <td className=\"p-3 text-right\">\r\n                  {acc.transactions.toLocaleString()}\r\n                </td>\r\n                <td className=\"p-3 text-right font-bold\">\r\n                  {acc.closingBalance.toLocaleString()}\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\balance-sheet\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[270,273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[270,273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","line":21,"column":6,"nodeType":"ArrayExpression","endLine":21,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [date, load]","fix":{"range":[642,648],"text":"[date, load]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":76,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4257,4260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4257,4260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5922,5925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5922,5925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6358,6361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6358,6361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\nexport default function DetailedBalanceSheet() {\r\n  const [date, setDate] = useState(new Date().toISOString().slice(0, 10));\r\n  const [data, setData] = useState<any>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [sendingEmail, setSendingEmail] = useState(false);\r\n\r\n  const load = async () => {\r\n    setLoading(true);\r\n    const res = await fetch(`/api/reports/balance-sheet?date=${date}`);\r\n    const d = await res.json();\r\n    setData(d);\r\n    setLoading(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    load();\r\n  }, [date]);\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-4xl mx-auto bg-white border shadow-lg font-sans text-sm\">\r\n      <div className=\"flex justify-between items-center border-b-4 border-black pb-2 mb-4\">\r\n        <div className=\"text-left\">\r\n          <h1 className=\"text-2xl font-black uppercase\">US TRADERS</h1>\r\n          <h2 className=\"text-md font-bold italic\">Final Balance Sheet Statement</h2>\r\n        </div>\r\n        <div className=\"flex gap-1 print:hidden\">\r\n          <input\r\n            type=\"date\"\r\n            value={date}\r\n            onChange={e => setDate(e.target.value)}\r\n            className=\"border-2 border-black p-1 text-xs font-bold\"\r\n          />\r\n          <button\r\n            onClick={load}\r\n            className=\"bg-black text-white px-4 py-1 text-xs font-bold uppercase\"\r\n          >\r\n            Search\r\n          </button>\r\n          <button\r\n            onClick={() => window.print()}\r\n            className=\"bg-blue-600 text-white px-4 py-1 text-xs font-bold uppercase\"\r\n          >\r\n            Print\r\n          </button>\r\n          <button\r\n            onClick={async () => {\r\n              const email = window.prompt(\"Report email kis address par bhejni hai?\");\r\n              if (!email || !email.includes(\"@\")) return;\r\n              setSendingEmail(true);\r\n              try {\r\n                const user = getCurrentUser();\r\n                const res = await fetch(\"/api/email/send\", {\r\n                  method: \"POST\",\r\n                  headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    \"x-user-role\": user?.role || \"\",\r\n                    \"x-user-id\": user?.id || \"\",\r\n                  },\r\n                  body: JSON.stringify({\r\n                    type: \"custom\",\r\n                    to: email,\r\n                    subject: `Balance Sheet as on ${date}`,\r\n                    message: \"Balance Sheet report from US TRADERS system.\",\r\n                  }),\r\n                });\r\n                const data = await res.json();\r\n                if (res.ok) {\r\n                  alert(\"Email bhej di gayi hai\");\r\n                } else {\r\n                  alert(data.error || \"Email send nahi ho saki\");\r\n                }\r\n              } catch (e) {\r\n                alert(\"Email send karte waqt error aayi\");\r\n              } finally {\r\n                setSendingEmail(false);\r\n              }\r\n            }}\r\n            disabled={sendingEmail}\r\n            className=\"bg-green-600 text-white px-4 py-1 text-xs font-bold uppercase disabled:bg-gray-400\"\r\n          >\r\n            {sendingEmail ? \"Sending...\" : \"Email\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? <p className=\"text-center font-bold\">Syncing Records...</p> : (\r\n        <div className=\"space-y-6\">\r\n          \r\n          {/* TWO COLUMN FORMAT - Assets (DR) and Liabilities (CR) */}\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            \r\n            {/* LEFT SIDE - ASSETS (DEBIT) */}\r\n            <div className=\"border border-black\">\r\n              <h3 className=\"bg-blue-900 text-white px-2 py-1 font-bold uppercase italic text-center\">Assets & Receivables (DR)</h3>\r\n              <table className=\"w-full\">\r\n                <thead className=\"bg-gray-100 border-b border-black text-[10px]\">\r\n                  <tr>\r\n                    <th className=\"text-left p-2\">Particulars</th>\r\n                    <th className=\"text-right p-2 w-32\">Amount</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {data?.assets && data.assets.length > 0 ? data.assets.map((a: any, i: number) => (\r\n                    <tr key={i} className=\"border-b border-gray-100\">\r\n                      <td className=\"p-2 font-semibold uppercase text-[11px]\">{a.name}</td>\r\n                      <td className=\"p-2 text-right font-mono text-[11px]\">{Math.abs(a.amount).toLocaleString()}</td>\r\n                    </tr>\r\n                  )) : (\r\n                    <tr><td colSpan={2} className=\"p-2 text-center text-gray-400\">No Assets</td></tr>\r\n                  )}\r\n                </tbody>\r\n                <tfoot>\r\n                  <tr className=\"bg-blue-50 font-black border-t-2 border-black\">\r\n                    <td className=\"p-2 uppercase text-[12px]\">Total Assets</td>\r\n                    <td className=\"p-2 text-right font-mono text-[12px] border-t-2 border-black\">{data?.totalAssets ? data.totalAssets.toLocaleString() : '0'}</td>\r\n                  </tr>\r\n                </tfoot>\r\n              </table>\r\n            </div>\r\n\r\n            {/* RIGHT SIDE - LIABILITIES & EQUITY (CREDIT) */}\r\n            <div className=\"border border-black\">\r\n              <h3 className=\"bg-red-800 text-white px-2 py-1 font-bold uppercase italic text-center\">Liabilities & Equity (CR)</h3>\r\n              <table className=\"w-full\">\r\n                <thead className=\"bg-gray-100 border-b border-black text-[10px]\">\r\n                  <tr>\r\n                    <th className=\"text-left p-2\">Particulars</th>\r\n                    <th className=\"text-right p-2 w-32\">Amount</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {data?.liabilities && data.liabilities.length > 0 && data.liabilities.map((l: any, i: number) => (\r\n                    <tr key={i} className=\"border-b border-gray-100\">\r\n                      <td className=\"p-2 font-semibold uppercase text-[11px]\">{l.name}</td>\r\n                      <td className=\"p-2 text-right font-mono text-[11px]\">{Math.abs(l.amount).toLocaleString()}</td>\r\n                    </tr>\r\n                  ))}\r\n                  {data?.equity && data.equity.length > 0 && data.equity.map((e: any, i: number) => (\r\n                    <tr key={`eq-${i}`} className=\"border-b border-gray-100 bg-green-50\">\r\n                      <td className=\"p-2 font-semibold uppercase text-[11px]\">{e.name}</td>\r\n                      <td className=\"p-2 text-right font-mono text-[11px]\">{Math.abs(e.amount).toLocaleString()}</td>\r\n                    </tr>\r\n                  ))}\r\n                  {data?.netProfit !== undefined && (\r\n                    <tr className=\"border-b border-gray-100 bg-green-100\">\r\n                      <td className=\"p-2 font-semibold uppercase text-[11px]\">Net Profit/Loss</td>\r\n                      <td className=\"p-2 text-right font-mono text-[11px]\">{Math.abs(data.netProfit).toLocaleString()}</td>\r\n                    </tr>\r\n                  )}\r\n                </tbody>\r\n                <tfoot>\r\n                  <tr className=\"bg-red-50 font-black border-t-2 border-black\">\r\n                    <td className=\"p-2 uppercase text-[12px]\">Total Liabilities & Equity</td>\r\n                    <td className=\"p-2 text-right font-mono text-[12px] border-t-2 border-black\">\r\n                      {(data?.totalLiabilities || 0) + (data?.totalEquity || 0)}\r\n                    </td>\r\n                  </tr>\r\n                </tfoot>\r\n              </table>\r\n            </div>\r\n\r\n          </div>\r\n\r\n          <div className={`p-4 text-center border-2 border-black font-black uppercase text-xl rounded ${data?.isBalanced ? 'text-green-700 bg-green-100' : 'text-red-700 bg-red-100'}`}>\r\n            {data?.isBalanced\r\n              ? `✔ BALANCED - Assets = Liabilities + Equity`\r\n              : `❌ OUT OF BALANCE - Difference: ${Math.abs((data?.totalAssets || 0) - ((data?.totalLiabilities || 0) + (data?.totalEquity || 0))).toLocaleString()}`}\r\n          </div>\r\n\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\cash-flow\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[380,383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[380,383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":40,"column":6,"nodeType":"ArrayExpression","endLine":40,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadReport]","fix":{"range":[1099,1101],"text":"[loadReport]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1227,1230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1227,1230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1482,1485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1482,1485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1737,1740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1737,1740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { exportToCSV } from \"@/lib/export\";\r\n\r\nexport default function CashFlowPage() {\r\n  const today = new Date().toISOString().slice(0, 10);\r\n  const [from, setFrom] = useState(\"2026-01-01\");\r\n  const [to, setTo] = useState(today);\r\n  const [data, setData] = useState<any>(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  async function loadReport() {\r\n    setLoading(true);\r\n    try {\r\n      const user = getCurrentUser();\r\n      const res = await fetch(\r\n        `/api/reports/cash-flow?from=${from}&to=${to}`,\r\n        {\r\n          headers: { \"x-user-role\": user?.role || \"ADMIN\" },\r\n        }\r\n      );\r\n      const result = await res.json();\r\n      if (res.ok) {\r\n        setData(result);\r\n      } else {\r\n        alert(result.error || \"Failed to load cash flow\");\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Error loading cash flow report\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadReport();\r\n  }, []);\r\n\r\n  function exportReport() {\r\n    if (!data) return;\r\n    const exportData = [\r\n      ...data.operating.items.map((item: any) => ({\r\n        category: \"Operating\",\r\n        date: item.date,\r\n        voucherNo: item.voucherNo,\r\n        description: item.description,\r\n        type: item.type,\r\n        amount: item.amount,\r\n      })),\r\n      ...data.investing.items.map((item: any) => ({\r\n        category: \"Investing\",\r\n        date: item.date,\r\n        voucherNo: item.voucherNo,\r\n        description: item.description,\r\n        type: item.type,\r\n        amount: item.amount,\r\n      })),\r\n      ...data.financing.items.map((item: any) => ({\r\n        category: \"Financing\",\r\n        date: item.date,\r\n        voucherNo: item.voucherNo,\r\n        description: item.description,\r\n        type: item.type,\r\n        amount: item.amount,\r\n      })),\r\n    ];\r\n    exportToCSV(exportData, \"cash-flow-report\");\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-7xl mx-auto space-y-6\">\r\n      <h1 className=\"text-3xl font-bold\">Cash Flow Statement</h1>\r\n\r\n      {/* FILTERS */}\r\n      <div className=\"bg-white border rounded-lg p-4 flex gap-4 items-end print:hidden\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">From</label>\r\n          <input\r\n            type=\"date\"\r\n            value={from}\r\n            onChange={(e) => setFrom(e.target.value)}\r\n            className=\"border rounded px-3 py-2\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">To</label>\r\n          <input\r\n            type=\"date\"\r\n            value={to}\r\n            onChange={(e) => setTo(e.target.value)}\r\n            className=\"border rounded px-3 py-2\"\r\n          />\r\n        </div>\r\n        <button\r\n          onClick={loadReport}\r\n          disabled={loading}\r\n          className=\"bg-blue-600 text-white px-6 py-2 rounded font-bold\"\r\n        >\r\n          {loading ? \"Loading...\" : \"Load Report\"}\r\n        </button>\r\n        {data && (\r\n          <button\r\n            onClick={exportReport}\r\n            className=\"bg-green-600 text-white px-6 py-2 rounded font-bold\"\r\n          >\r\n            📥 Export CSV\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* REPORT */}\r\n      {data && (\r\n        <div className=\"bg-white border rounded-lg p-6 space-y-6\">\r\n          <div className=\"text-center border-b pb-4\">\r\n            <h2 className=\"text-2xl font-bold\">Cash Flow Statement</h2>\r\n            <p className=\"text-gray-600\">\r\n              {data.period.from} to {data.period.to}\r\n            </p>\r\n          </div>\r\n\r\n          {/* OPERATING ACTIVITIES */}\r\n          <div>\r\n            <h3 className=\"text-xl font-bold mb-3\">Operating Activities</h3>\r\n            <div className=\"space-y-2 mb-4\">\r\n              <div className=\"flex justify-between\">\r\n                <span>Cash Inflow:</span>\r\n                <span className=\"text-green-600 font-bold\">\r\n                  {data.operating.inflow.toFixed(2)}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span>Cash Outflow:</span>\r\n                <span className=\"text-red-600 font-bold\">\r\n                  {data.operating.outflow.toFixed(2)}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between border-t pt-2 font-bold\">\r\n                <span>Net Cash from Operations:</span>\r\n                <span\r\n                  className={\r\n                    data.operating.net >= 0 ? \"text-green-600\" : \"text-red-600\"\r\n                  }\r\n                >\r\n                  {data.operating.net.toFixed(2)}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* INVESTING ACTIVITIES */}\r\n          <div>\r\n            <h3 className=\"text-xl font-bold mb-3\">Investing Activities</h3>\r\n            <div className=\"space-y-2 mb-4\">\r\n              <div className=\"flex justify-between\">\r\n                <span>Cash Inflow:</span>\r\n                <span className=\"text-green-600 font-bold\">\r\n                  {data.investing.inflow.toFixed(2)}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span>Cash Outflow:</span>\r\n                <span className=\"text-red-600 font-bold\">\r\n                  {data.investing.outflow.toFixed(2)}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between border-t pt-2 font-bold\">\r\n                <span>Net Cash from Investing:</span>\r\n                <span\r\n                  className={\r\n                    data.investing.net >= 0 ? \"text-green-600\" : \"text-red-600\"\r\n                  }\r\n                >\r\n                  {data.investing.net.toFixed(2)}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* FINANCING ACTIVITIES */}\r\n          <div>\r\n            <h3 className=\"text-xl font-bold mb-3\">Financing Activities</h3>\r\n            <div className=\"space-y-2 mb-4\">\r\n              <div className=\"flex justify-between\">\r\n                <span>Cash Inflow:</span>\r\n                <span className=\"text-green-600 font-bold\">\r\n                  {data.financing.inflow.toFixed(2)}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span>Cash Outflow:</span>\r\n                <span className=\"text-red-600 font-bold\">\r\n                  {data.financing.outflow.toFixed(2)}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between border-t pt-2 font-bold\">\r\n                <span>Net Cash from Financing:</span>\r\n                <span\r\n                  className={\r\n                    data.financing.net >= 0 ? \"text-green-600\" : \"text-red-600\"\r\n                  }\r\n                >\r\n                  {data.financing.net.toFixed(2)}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* NET CASH FLOW */}\r\n          <div className=\"border-t-2 border-black pt-4\">\r\n            <div className=\"flex justify-between text-2xl font-bold\">\r\n              <span>Net Increase/Decrease in Cash:</span>\r\n              <span\r\n                className={data.netCashFlow >= 0 ? \"text-green-600\" : \"text-red-600\"}\r\n              >\r\n                {data.netCashFlow.toFixed(2)}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\inventory\\inward\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":40,"column":40,"nodeType":"ArrayExpression","endLine":40,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [loadReport]","fix":{"range":[1211,1213],"text":"[loadReport]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\ntype InwardRow = {\r\n    date: string;\r\n    type: string;\r\n    supplierName: string;\r\n    itemName: string;\r\n    description?: string;\r\n    qty: number;\r\n    rate: number;\r\n    amount: number;\r\n};\r\n\r\nexport default function InwardReportPage() {\r\n    const today = new Date().toISOString().slice(0, 10);\r\n    const [fromDate, setFromDate] = useState(\"2025-01-01\");\r\n    const [toDate, setToDate] = useState(today);\r\n    const [rows, setRows] = useState<InwardRow[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    async function loadReport() {\r\n        setLoading(true);\r\n        const user = getCurrentUser();\r\n        try {\r\n            const res = await fetch(`/api/reports/inventory/inward?from=${fromDate}&to=${toDate}`, {\r\n                headers: { \"x-user-role\": user?.role || \"ADMIN\" }\r\n            });\r\n            const json = await res.json();\r\n            setRows(Array.isArray(json) ? json : []);\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    useEffect(() => { loadReport(); }, []);\r\n\r\n    // 🛡️ Safe Calculation to avoid null errors\r\n    const totalQty = rows.reduce((s, r) => s + (Number(r.qty) || 0), 0);\r\n    const totalAmount = rows.reduce((s, r) => s + (Number(r.amount) || 0), 0);\r\n\r\n    return (\r\n        <div className=\"p-6 max-w-7xl mx-auto space-y-6 font-bold\">\r\n            <h1 className=\"text-3xl font-black uppercase italic border-b-4 border-black pb-2\">Inward Inventory Report</h1>\r\n\r\n            {/* FILTER BAR */}\r\n            <div className=\"flex gap-4 items-end flex-wrap bg-white p-4 border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]\">\r\n                <div className=\"flex flex-col gap-1\">\r\n                    <label className=\"text-xs font-bold uppercase\">From Date</label>\r\n                    <input type=\"date\" className=\"border-2 border-black px-3 py-2 outline-none\" value={fromDate} onChange={e => setFromDate(e.target.value)} />\r\n                </div>\r\n                <div className=\"flex flex-col gap-1\">\r\n                    <label className=\"text-xs font-bold uppercase\">To Date</label>\r\n                    <input type=\"date\" className=\"border-2 border-black px-3 py-2 outline-none\" value={toDate} onChange={e => setToDate(e.target.value)} />\r\n                </div>\r\n                <button onClick={loadReport} className=\"bg-black text-white px-8 py-2.5 font-bold uppercase hover:bg-gray-800\">\r\n                    Show Report\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"border-2 border-black bg-white overflow-hidden shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]\">\r\n                <table className=\"w-full text-sm\">\r\n                    <thead className=\"bg-black text-white\">\r\n                        <tr>\r\n                            <th className=\"p-3 text-left\">DATE</th>\r\n                            <th className=\"p-3 text-left\">SUPPLIER</th>\r\n                            <th className=\"p-3 text-left\">ITEM</th>\r\n                            <th className=\"p-3 text-right\">QTY</th>\r\n                            <th className=\"p-3 text-right\">RATE</th>\r\n                            <th className=\"p-3 text-right\">AMOUNT</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y-2 divide-black\">\r\n                        {loading ? (\r\n                            <tr><td colSpan={6} className=\"p-10 text-center animate-pulse\">LOADING...</td></tr>\r\n                        ) : rows.length === 0 ? (\r\n                            <tr><td colSpan={6} className=\"p-10 text-center text-gray-400\">NO DATA FOUND</td></tr>\r\n                        ) : (\r\n                            rows.map((r, i) => (\r\n                                <tr key={i} className=\"hover:bg-yellow-50\">\r\n                                    <td className=\"p-3 border-r-2 border-black uppercase\">{r.date}</td>\r\n                                    <td className=\"p-3 border-r-2 border-black text-blue-800 uppercase\">{r.supplierName}</td>\r\n                                    <td className=\"p-3 border-r-2 border-black uppercase\">{r.itemName} {r.description ? `(${r.description})` : \"\"}</td>\r\n                                    {/* 🛡️ Added Fallback || 0 to prevent crash */}\r\n                                    <td className=\"p-3 border-r-2 border-black text-right\">{(r.qty || 0).toLocaleString()}</td>\r\n                                    <td className=\"p-3 border-r-2 border-black text-right\">{(r.rate || 0).toLocaleString()}</td>\r\n                                    <td className=\"p-3 text-right bg-gray-50\">{(r.amount || 0).toLocaleString()}</td>\r\n                                </tr>\r\n                            ))\r\n                        )}\r\n                    </tbody>\r\n                    {!loading && rows.length > 0 && (\r\n                        <tfoot className=\"bg-black text-white font-black\">\r\n                            <tr>\r\n                                <td colSpan={3} className=\"p-3 text-right\">TOTAL INWARD</td>\r\n                                <td className=\"p-3 text-right\">{totalQty.toLocaleString()}</td>\r\n                                <td className=\"p-3\"></td>\r\n                                <td className=\"p-3 text-right\">{totalAmount.toLocaleString()}</td>\r\n                            </tr>\r\n                        </tfoot>\r\n                    )}\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\inventory\\stock-summary\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadStock'. Either include it or remove the dependency array.","line":36,"column":37,"nodeType":"ArrayExpression","endLine":36,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [asOnDate, loadStock]","fix":{"range":[978,988],"text":"[asOnDate, loadStock]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\ntype StockRow = {\r\n  itemId: string;\r\n  itemName: string;\r\n  description: string;\r\n  unit: string;\r\n  stockQty: number;\r\n};\r\n\r\nexport default function StockSummaryPage() {\r\n  const today = new Date().toISOString().slice(0, 10);\r\n  const [asOnDate, setAsOnDate] = useState(today);\r\n  const [rows, setRows] = useState<StockRow[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  async function loadStock() {\r\n    setLoading(true);\r\n    const user = getCurrentUser();\r\n    try {\r\n      const res = await fetch(`/api/reports/inventory/stock-summary?date=${asOnDate}`, {\r\n        headers: { \"x-user-role\": user?.role || \"\" }\r\n      });\r\n      const json = await res.json();\r\n      setRows(Array.isArray(json) ? json : []);\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => { loadStock(); }, [asOnDate]);\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-5xl mx-auto space-y-6\">\r\n      <div className=\"flex justify-between items-end border-b-4 border-black pb-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-black uppercase italic\">Current Stock Status</h1>\r\n          <p className=\"text-sm font-bold text-gray-500 uppercase tracking-widest\">Inventory Balance Report</p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <input type=\"date\" value={asOnDate} onChange={e => setAsOnDate(e.target.value)} className=\"border-2 border-black px-4 py-2 font-bold outline-none\" />\r\n          <button onClick={loadStock} className=\"bg-black text-white px-6 py-2 font-bold uppercase hover:bg-gray-800 transition-all\">Refresh</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"bg-white border-2 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] overflow-hidden\">\r\n        <table className=\"w-full text-sm border-collapse\">\r\n          <thead className=\"bg-black text-white uppercase font-black\">\r\n            <tr>\r\n              <th className=\"p-4 text-left border-r border-gray-700\">Item Description</th>\r\n              <th className=\"p-4 text-center border-r border-gray-700 w-32\">Unit</th>\r\n              <th className=\"p-4 text-right w-48\">Available Qty</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"font-bold uppercase\">\r\n            {loading ? (\r\n              <tr><td colSpan={3} className=\"p-10 text-center animate-pulse\">Checking Warehouse...</td></tr>\r\n            ) : rows.length === 0 ? (\r\n              <tr><td colSpan={3} className=\"p-10 text-center text-gray-400 italic\">No Stock Found.</td></tr>\r\n            ) : (\r\n              rows.map((r, i) => (\r\n                <tr key={i} className=\"border-b-2 border-black hover:bg-yellow-50 transition-colors\">\r\n                  <td className=\"p-4 border-r-2 border-black\">\r\n                    <div>{r.itemName}</div>\r\n                    <div className=\"text-[10px] text-gray-500 normal-case\">\r\n                      {r.description || \"\"}\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"p-4 text-center border-r-2 border-black text-gray-600\">{r.unit}</td>\r\n                  <td className={`p-4 text-right text-lg ${r.stockQty < 5 ? 'text-red-600 bg-red-50' : 'text-blue-700'}`}>\r\n                    {r.stockQty.toLocaleString()}\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\ledger\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalDebit' is assigned a value but never used.","line":57,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalCredit' is assigned a value but never used.","line":58,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'finalBalance' is assigned a value but never used.","line":59,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { exportToCSV } from \"@/lib/export\";\n\ntype Account = { id: string; name: string; };\ntype LedgerRow = {\n    date: string;\n    voucherNo: string;\n    narration: string;\n    debit?: number;\n    credit?: number;\n    balance: number;\n};\n\n\nexport default function LedgerReportPage() {\n    const today = new Date().toISOString().slice(0, 10);\n    const [accounts, setAccounts] = useState<Account[]>([]);\n    const [accountId, setAccountId] = useState(\"\");\n    const [fromDate, setFromDate] = useState(\"2026-01-01\");\n    const [toDate, setToDate] = useState(today);\n    const [rows, setRows] = useState<LedgerRow[]>([]);\n    const [loading, setLoading] = useState(false);\n\n    useEffect(() => {\n        const user = getCurrentUser();\n        if (!user) return;\n        fetch(\"/api/accounts\", { headers: { \"x-user-role\": user.role } })\n            .then(r => r.json())\n            .then(d => setAccounts(d));\n    }, []);\n\n    async function loadLedger() {\n        if (!accountId) return;\n        setLoading(true);\n        try {\n            const user = getCurrentUser();\n\n            const res = await fetch(\n                `/api/reports/ledger?accountId=${accountId}&from=${fromDate}&to=${toDate}`,\n                {\n                    headers: {\n                        \"x-user-role\": user?.role ?? \"\"\n                    }\n                }\n            );\n\n            const data = await res.json();\n            setRows(Array.isArray(data) ? data : []);\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    const totalDebit = rows.reduce((s, r) => s + (r.debit || 0), 0);\n    const totalCredit = rows.reduce((s, r) => s + (r.credit || 0), 0);\n    const finalBalance = rows.length ? rows[rows.length - 1].balance : 0;\n\n    return (\n        <div className=\"p-4 max-w-6xl mx-auto font-sans\">\n            <h1 className=\"text-2xl font-bold mb-6 print:hidden\">Ledger Report</h1>\n\n            {/* Filters */}\n            <div className=\"flex gap-3 mb-6 items-end print:hidden bg-white p-4 border rounded shadow-sm\">\n                <div className=\"flex-1\">\n                    <label className=\"block text-xs font-bold mb-1 uppercase\">Account</label>\n                    <select className=\"w-full border p-2 rounded\" value={accountId} onChange={e => setAccountId(e.target.value)}>\n                        <option value=\"\">Select Account</option>\n                        {accounts.map(a => <option key={a.id} value={a.id}>{a.name}</option>)}\n                    </select>\n                </div>\n                <div>\n                    <label className=\"block text-xs font-bold mb-1 uppercase\">From</label>\n                    <input type=\"date\" className=\"border p-2 rounded\" value={fromDate} onChange={e => setFromDate(e.target.value)} />\n                </div>\n                <div>\n                    <label className=\"block text-xs font-bold mb-1 uppercase\">To</label>\n                    <input type=\"date\" className=\"border p-2 rounded\" value={toDate} onChange={e => setToDate(e.target.value)} />\n                </div>\n                <button onClick={loadLedger} className=\"bg-blue-600 text-white px-6 py-2 rounded font-bold\">Search</button>\n                {rows.length > 0 && (\n                    <button\n                        onClick={() => exportToCSV(rows.map(r => ({\n                            date: r.date,\n                            voucherNo: r.voucherNo,\n                            narration: r.narration,\n                            debit: r.debit || 0,\n                            credit: r.credit || 0,\n                            balance: r.balance\n                        })), \"ledger-report\")}\n                        className=\"bg-green-600 text-white px-6 py-2 rounded font-bold\"\n                    >\n                        📥 Export CSV\n                    </button>\n                )}\n            </div>\n\n            {/* Ledger View */}\n            <div className=\"invoice-print bg-white border-2 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] overflow-hidden\">\n                {/* 📋 PROFESSIONAL HEADER */}\n                <div className=\"p-8 border-b-2 border-black bg-gray-50\">\n                    <div className=\"flex justify-between items-start\">\n                        <div>\n                            {/* کمپنی کا نام بڑے اور بولڈ فونٹ میں */}\n                            <h1 className=\"text-4xl font-black tracking-tighter text-black uppercase\">\n                                US TRADERS\n                            </h1>\n                            <p className=\"text-xs font-bold text-gray-500 mt-1 tracking-widest uppercase italic\">\n                                Wholesale & Distribution Management\n                            </p>\n                        </div>\n                        <div className=\"text-right border-l-4 border-black pl-4\">\n                            <h2 className=\"text-xl font-black uppercase text-blue-900\">\n                                Account Ledger\n                            </h2>\n                            <div className=\"mt-2 text-[10px] font-bold uppercase text-gray-500\">\n                                Reporting Period\n                                <span className=\"block text-sm text-black font-black italic\">\n                                    {fromDate} <span className=\"text-gray-400 font-normal\">TO</span> {toDate}\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"mt-10 flex justify-between items-end border-t-2 border-dashed border-black pt-6\">\n                        <div>\n                            <span className=\"text-[10px] font-black uppercase text-gray-400 block mb-1\">\n                                Statement For:\n                            </span>\n                            <h3 className=\"text-3xl font-black uppercase underline decoration-4 underline-offset-8 decoration-yellow-400\">\n                                {accounts.find(a => a.id === accountId)?.name || \"N/A\"}\n                            </h3>\n                        </div>\n                        <div className=\"text-right\">\n                            <p className=\"text-[10px] font-bold text-gray-400 uppercase\">System Date</p>\n                            <p className=\"text-sm font-black italic\">{new Date().toLocaleDateString()}</p>\n                        </div>\n                    </div>\n                </div>\n\n                {/* 💰 OPENING BALANCE SUMMARY - یہ ٹیبل کے اوپر الگ نظر آئے گا */}\n                {!loading && rows.length > 0 && (\n                    <div className=\"flex justify-between items-end mb-1 print:mt-4\">\n                        <div className=\"text-[10px] font-bold text-gray-500 uppercase italic\">\n                            * All amounts are in PKR\n                        </div>\n                        <div className=\"bg-white border-2 border-black p-2 px-6 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center gap-4\">\n                            <span className=\"text-[11px] font-black uppercase tracking-tighter text-gray-400\">\n                                Opening Balance B/F\n                            </span>\n                            <span className={`text-xl font-black ${rows[0].balance >= 0 ? \"text-green-700\" : \"text-red-700\"}`}>\n                                {rows[0].balance >= 0 ? \"\" : \"-\"}{Math.abs(rows[0].balance).toLocaleString()} {rows[0].balance >= 0 ? \"Dr\" : \"Cr\"}\n                            </span>\n                        </div>\n                    </div>\n                )}\n\n                {/* 📊 MAIN LEDGER TABLE */}\n                <div className=\"border-2 border-black overflow-hidden shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] bg-white\">\n                    <table className=\"w-full text-sm border-collapse\">\n                        <thead className=\"bg-black text-white uppercase text-[11px] font-bold\">\n                            <tr>\n                                <th className=\"p-3 border-r border-gray-700 text-left w-28\">Date</th>\n                                <th className=\"p-3 border-r border-gray-700 text-left w-32\">Voucher #</th>\n                                <th className=\"p-3 border-r border-gray-700 text-left\">Narration / Particulars</th>\n                                <th className=\"p-3 border-r border-gray-700 text-right w-32\">Debit (In)</th>\n                                <th className=\"p-3 border-r border-gray-700 text-right w-32\">Credit (Out)</th>\n                                <th className=\"p-3 text-right w-40 bg-gray-900\">Running Balance</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y-2 divide-black\">\n                            {loading ? (\n                                <tr>\n                                    <td colSpan={6} className=\"p-20 text-center font-black uppercase animate-pulse text-gray-400\">\n                                        Fetching Ledger Records...\n                                    </td>\n                                </tr>\n                            ) : rows.length <= 1 ? (\n                                <tr>\n                                    <td colSpan={6} className=\"p-20 text-center text-gray-400 uppercase italic\">\n                                        No transactions found for this period.\n                                    </td>\n                                </tr>\n                            ) : (\n                                /* rows.slice(1) اس لیے تاکہ اوپننگ بیلنس ٹیبل کے اندر دوبارہ نہ آئے */\n                                rows.slice(1).map((r, i) => (\n                                    <tr key={i} className=\"hover:bg-yellow-50 transition-colors group\">\n                                        <td className=\"p-3 border-r border-black font-medium text-gray-600\">\n                                            {r.date}\n                                        </td>\n                                        <td className=\"p-3 border-r border-black font-black text-blue-900 group-hover:underline\">\n                                            {r.voucherNo}\n                                        </td>\n                                        <td className=\"p-3 border-r border-black uppercase text-[11px] leading-tight font-bold text-gray-700\">\n                                            {r.narration}\n                                        </td>\n                                        <td className=\"p-3 border-r border-black text-right font-bold text-black\">\n                                            {r.debit ? r.debit.toLocaleString() : \"-\"}\n                                        </td>\n                                        <td className=\"p-3 border-r border-black text-right font-bold text-black\">\n                                            {r.credit ? r.credit.toLocaleString() : \"-\"}\n                                        </td>\n                                        <td className={`p-3 text-right font-black text-base ${r.balance >= 0 ? \"bg-green-50 text-green-900\" : \"bg-red-50 text-red-900\"}`}>\n                                            {r.balance >= 0 ? \"\" : \"-\"}{Math.abs(r.balance).toLocaleString()}{r.balance >= 0 ? \"Dr\" : \"Cr\"}\n                                        </td>\n                                    </tr>\n                                ))\n                            )}\n                        </tbody>\n\n                        {/* 🏆 PERIOD TOTALS FOOTER */}\n                        {!loading && rows.length > 1 && (\n                            <tfoot className=\"bg-black text-white font-black uppercase border-t-4 border-black\">\n                                <tr>\n                                    <td colSpan={3} className=\"p-4 text-right tracking-widest text-gray-400\">Period Totals</td>\n                                    <td className=\"p-4 text-right border-x border-gray-800\">\n                                        {rows.slice(1).reduce((s, r) => s + (r.debit || 0), 0).toLocaleString()}\n                                    </td>\n                                    <td className=\"p-4 text-right border-r border-gray-800\">\n                                        {rows.slice(1).reduce((s, r) => s + (r.credit || 0), 0).toLocaleString()}\n                                    </td>\n                                    <td className=\"p-4 text-right bg-blue-700 text-white text-lg italic\">\n                                        {rows[rows.length - 1].balance >= 0 ? \"\" : \"-\"}{Math.abs(rows[rows.length - 1].balance).toLocaleString()} {rows[rows.length - 1].balance >= 0 ? \"Dr\" : \"Cr\"}\n                                    </td>\n                                </tr>\n                            </tfoot>\n                        )}\n                    </table>\n                </div>\n            </div>\n\n            <div className=\"mt-6 flex gap-4 print:hidden\">\n                <button onClick={() => window.print()} className=\"border-2 border-black px-8 py-2 font-bold hover:bg-black hover:text-white transition-all\">\n                    PRINT LEDGER\n                </button>\n            </div>\n        </div>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\outward\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[446,449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[446,449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[493,496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[493,496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[861,864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[861,864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":51,"column":38,"nodeType":"ArrayExpression","endLine":51,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [loadReport]","fix":{"range":[1751,1753],"text":"[loadReport]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { exportToCSV } from \"@/lib/export\";\n\nexport default function OutwardReportPage() {\n  const today = new Date().toISOString().slice(0, 10);\n  const [fromDate, setFromDate] = useState(today);\n  const [toDate, setToDate] = useState(today);\n  const [customerId, setCustomerId] = useState(\"\");\n  const [customers, setCustomers] = useState<any[]>([]);\n  const [rows, setRows] = useState<any[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  // 🛠️ کسٹمرز لوڈ کرنا (With Safety Fix)\n  useEffect(() => {\n    fetch(\"/api/accounts\")\n      .then((r) => r.json())\n      .then((d) => {\n        // چیک کریں کہ d ایرے ہے، اگر نہیں تو خالی ایرے سیٹ کریں\n        const data = Array.isArray(d) ? d : (d.accounts || []);\n        setCustomers(data.filter((a: any) => a.partyType === \"CUSTOMER\"));\n      })\n      .catch(err => console.error(\"Customer fetch error:\", err));\n  }, []);\n\n  // 🛠️ رپورٹ ڈیٹا لوڈ کرنا (With Auth Headers)\n  async function loadReport() {\n    setLoading(true);\n    const user = getCurrentUser(); // رول حاصل کریں\n    try {\n      const res = await fetch(`/api/reports/outward?from=${fromDate}&to=${toDate}&customerId=${customerId}`, {\n        method: \"GET\",\n        headers: {\n          \"x-user-role\": user?.role || \"ADMIN\" // یہ ہیڈر لازمی ہے\n        },\n        cache: 'no-store'\n      });\n      const data = await res.json();\n      // اگر ڈیٹا ایرے نہیں ہے تو خالی ایرے سیٹ کریں تاکہ کریش نہ ہو\n      setRows(Array.isArray(data) ? data : []);\n    } catch (error) {\n      console.error(\"Report load error:\", error);\n      setRows([]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => { loadReport(); }, []);\n\n  const totalQty = rows.reduce((sum, r) => sum + (Number(r.qty) || 0), 0);\n\n  return (\n    <div className=\"p-6 max-w-7xl mx-auto space-y-6 bg-white min-h-screen font-bold\">\n      \n      {/* --- FILTERS --- */}\n      <div className=\"flex flex-wrap gap-4 bg-gray-50 p-6 border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] print:hidden\">\n        <div className=\"flex flex-col gap-1\">\n          <label className=\"text-[10px] font-bold uppercase text-gray-400\">From</label>\n          <input type=\"date\" className=\"border-2 border-black p-2 outline-none\" value={fromDate} onChange={(e) => setFromDate(e.target.value)} />\n        </div>\n        <div className=\"flex flex-col gap-1\">\n          <label className=\"text-[10px] font-bold uppercase text-gray-400\">To</label>\n          <input type=\"date\" className=\"border-2 border-black p-2 outline-none\" value={toDate} onChange={(e) => setToDate(e.target.value)} />\n        </div>\n        <div className=\"flex flex-col gap-1 min-w-[200px]\">\n          <label className=\"text-[10px] font-bold uppercase text-gray-400\">Customer</label>\n          <select className=\"border-2 border-black p-2 outline-none\" value={customerId} onChange={(e) => setCustomerId(e.target.value)}>\n            <option value=\"\">All Customers</option>\n            {customers.map((c) => (<option key={c.id} value={c.id}>{c.name}</option>))}\n          </select>\n        </div>\n        <div className=\"flex gap-2 mt-5\">\n          <button onClick={loadReport} className=\"bg-black text-white px-6 rounded-none font-black uppercase text-xs h-10 hover:bg-gray-800\">\n            {loading ? \"Loading...\" : \"Filter\"}\n          </button>\n          <button onClick={() => window.print()} className=\"bg-blue-600 text-white px-6 rounded-none font-black uppercase text-xs h-10\">Print</button>\n          {rows.length > 0 && (\n            <button \n              onClick={() => exportToCSV(rows, \"outward-report\")} \n              className=\"bg-green-600 text-white px-6 rounded-none font-black uppercase text-xs h-10\"\n            >\n              📥 CSV\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* --- REPORT VIEW --- */}\n      <div className=\"invoice-print\">\n        <div className=\"mb-6 border-b-4 border-black pb-4 text-center\">\n          <h1 className=\"text-4xl font-black uppercase italic\">US TRADERS</h1>\n          <p className=\"text-sm font-bold uppercase tracking-widest text-gray-600\">Outward Dispatch Report</p>\n          <p className=\"text-xs\">{fromDate} TO {toDate}</p>\n        </div>\n\n        <table className=\"w-full border-collapse border-2 border-black\">\n          <thead>\n            <tr className=\"bg-black text-white\">\n              <th className=\"p-2 border border-black text-xs uppercase\">GP #</th>\n              <th className=\"p-2 border border-black text-xs uppercase\">Date</th>\n              <th className=\"p-2 border border-black text-xs uppercase text-left\">Customer</th>\n              <th className=\"p-2 border border-black text-xs uppercase text-left\">Vehicle / Driver</th>\n              <th className=\"p-2 border border-black text-xs uppercase text-left\">Item Name</th>\n              <th className=\"p-2 border border-black text-xs uppercase\">Qty</th>\n            </tr>\n          </thead>\n          <tbody className=\"text-sm\">\n            {rows.length === 0 && !loading ? (\n              <tr><td colSpan={6} className=\"p-10 text-center font-bold italic text-gray-400 uppercase\">No Dispatch Records Found</td></tr>\n            ) : (\n              rows.map((r, i) => (\n                <tr key={i} className=\"border-b-2 border-black hover:bg-yellow-50\">\n                  <td className=\"p-2 border-r-2 border-black text-center font-black\">#{r.outwardNo}</td>\n                  <td className=\"p-2 border-r-2 border-black text-center\">{r.date}</td>\n                  <td className=\"p-2 border-r-2 border-black font-black uppercase text-blue-900\">{r.customerName}</td>\n                  <td className=\"p-2 border-r-2 border-black\">\n                    <div className=\"font-black uppercase\">{r.vehicleNo}</div>\n                    <div className=\"text-[9px] uppercase text-gray-500\">Driver: {r.driverName}</div>\n                  </td>\n                  <td className=\"p-2 border-r-2 border-black uppercase\">\n                    <div>{r.itemName}</div>\n                    <div className=\"text-[9px] text-gray-500 normal-case\">\n                      {r.description || \"\"}\n                    </div>\n                  </td>\n                  <td className=\"p-2 text-center font-black text-lg\">{r.qty}</td>\n                </tr>\n              ))\n            )}\n          </tbody>\n          <tfoot>\n            <tr className=\"bg-black text-white\">\n              <td colSpan={5} className=\"p-3 text-right font-black uppercase\">Total Dispatched Quantity:</td>\n              <td className=\"p-3 text-center font-black text-2xl\">{totalQty}</td>\n            </tr>\n          </tfoot>\n        </table>\n\n        {/* Signatures */}\n        <div className=\"hidden print:flex justify-between mt-24 px-10\">\n          <div className=\"text-center border-t-4 border-black w-48 pt-2 text-xs font-black uppercase\">Warehouse Manager</div>\n          <div className=\"text-center border-t-4 border-black w-48 pt-2 text-xs font-black uppercase\">Authorized Officer</div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\profit-loss\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[291,294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[291,294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'load'. Either include it or remove the dependency array.","line":25,"column":6,"nodeType":"ArrayExpression","endLine":25,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [load]","fix":{"range":[715,717],"text":"[load]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":63,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3678,3681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3678,3681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4588,4591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4588,4591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\nexport default function ProfitLossFinal() {\r\n  const [from, setFrom] = useState(\"2026-01-01\");\r\n  const [to, setTo] = useState(\"2026-01-08\");\r\n  const [report, setReport] = useState<any>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [sendingEmail, setSendingEmail] = useState(false);\r\n\r\n  const load = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(`/api/reports/profit-loss?from=${from}&to=${to}`);\r\n      const d = await res.json();\r\n      setReport(d);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    load();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-[1200px] mx-auto font-sans bg-white min-h-screen\">\r\n      <div className=\"flex justify-between items-center border-b-4 border-black pb-2 mb-4\">\r\n        <h1 className=\"text-3xl font-black italic uppercase tracking-tighter\">Trading & P&L Statement</h1>\r\n        <div className=\"flex gap-1 print:hidden\">\r\n          <input type=\"date\" value={from} onChange={e => setFrom(e.target.value)} className=\"border-2 border-black p-1 text-xs font-bold\" />\r\n          <input type=\"date\" value={to} onChange={e => setTo(e.target.value)} className=\"border-2 border-black p-1 text-xs font-bold\" />\r\n          <button onClick={load} className=\"bg-black text-white px-4 py-1 text-xs font-bold uppercase\">Search</button>\r\n          <button onClick={() => window.print()} className=\"bg-blue-600 text-white px-4 py-1 text-xs font-bold uppercase\">Print</button>\r\n          <button\r\n            onClick={async () => {\r\n              const email = window.prompt(\"Report email kis address par bhejni hai?\");\r\n              if (!email || !email.includes(\"@\")) return;\r\n              setSendingEmail(true);\r\n              try {\r\n                const user = getCurrentUser();\r\n                const res = await fetch(\"/api/email/send\", {\r\n                  method: \"POST\",\r\n                  headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    \"x-user-role\": user?.role || \"\",\r\n                    \"x-user-id\": user?.id || \"\",\r\n                  },\r\n                  body: JSON.stringify({\r\n                    type: \"custom\",\r\n                    to: email,\r\n                    subject: `Profit & Loss ${from} to ${to}`,\r\n                    message: \"Profit & Loss report from US TRADERS system.\",\r\n                  }),\r\n                });\r\n                const data = await res.json();\r\n                if (res.ok) {\r\n                  alert(\"Email bhej di gayi hai\");\r\n                } else {\r\n                  alert(data.error || \"Email send nahi ho saki\");\r\n                }\r\n              } catch (e) {\r\n                alert(\"Email send karte waqt error aayi\");\r\n              } finally {\r\n                setSendingEmail(false);\r\n              }\r\n            }}\r\n            disabled={sendingEmail}\r\n            className=\"bg-green-600 text-white px-4 py-1 text-xs font-bold uppercase disabled:bg-gray-400\"\r\n          >\r\n            {sendingEmail ? \"Sending...\" : \"Email\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 border-2 border-black\">\r\n        <div className=\"border-r-2 border-black min-h-[450px]\">\r\n          <div className=\"bg-black text-white p-2 font-bold uppercase text-center italic text-[11px] tracking-widest\">Expenses / Outwards</div>\r\n          <table className=\"w-full\">\r\n            <tbody className=\"divide-y divide-gray-100\">\r\n              {report?.expense && report.expense.length > 0 ? report.expense.map((item: any, i: number) => (\r\n                <tr key={i} className=\"hover:bg-red-50 transition-colors\">\r\n                  <td className=\"p-2 uppercase font-bold text-gray-700 text-[11px]\">{item.name}</td>\r\n                  <td className=\"p-2 text-right font-black text-[12px]\">{Math.abs(item.amount).toLocaleString()}</td>\r\n                </tr>\r\n              )) : (\r\n                <tr><td colSpan={2} className=\"p-2 text-center text-gray-400\">No expenses</td></tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div className=\"min-h-[450px]\">\r\n          <div className=\"bg-gray-800 text-white p-2 font-bold uppercase text-center italic text-[11px] tracking-widest\">Income / Inwards</div>\r\n          <table className=\"w-full\">\r\n            <tbody className=\"divide-y divide-gray-100\">\r\n              {report?.income && report.income.length > 0 ? report.income.map((item: any, i: number) => (\r\n                <tr key={i} className=\"hover:bg-green-50 transition-colors\">\r\n                  <td className=\"p-2 uppercase font-bold text-gray-700 text-[11px]\">{item.name}</td>\r\n                  <td className=\"p-2 text-right font-black text-[12px]\">{Math.abs(item.amount).toLocaleString()}</td>\r\n                </tr>\r\n              )) : (\r\n                <tr><td colSpan={2} className=\"p-2 text-center text-gray-400\">No income</td></tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-3 gap-4 mt-6\">\r\n        <div className=\"border-2 border-black p-3 bg-gray-50 flex justify-between items-center shadow-[3px_3px_0px_0px_rgba(0,0,0,1)]\">\r\n           <span className=\"text-[10px] font-black uppercase\">Total Revenue</span>\r\n           <span className=\"text-xl font-black\">{report?.totalIncome.toLocaleString()}</span>\r\n        </div>\r\n        <div className=\"border-2 border-black p-3 bg-gray-50 flex justify-between items-center shadow-[3px_3px_0px_0px_rgba(0,0,0,1)]\">\r\n           <span className=\"text-[10px] font-black uppercase\">Total Expenses</span>\r\n           <span className=\"text-xl font-black\">{report?.totalExpense.toLocaleString()}</span>\r\n        </div>\r\n        <div className={`border-2 border-black p-3 flex justify-between items-center shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] ${report?.netProfit >= 0 ? \"bg-green-400\" : \"bg-red-500 text-white\"}`}>\r\n           <span className=\"text-[10px] font-black uppercase italic\">Net Profit/Loss</span>\r\n           <span className=\"text-2xl font-black\">{report?.netProfit.toLocaleString()}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\profitability\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [groupBy, loadReport]","fix":{"range":[996,1005],"text":"[groupBy, loadReport]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { exportToCSV } from \"@/lib/export\";\r\nimport { exportToPDF } from \"@/lib/pdf-export\";\r\n\r\ntype ProfitabilityData = {\r\n  customerId?: string;\r\n  customerName?: string;\r\n  itemId?: string;\r\n  itemName?: string;\r\n  invoiceCount?: number;\r\n  quantitySold?: number;\r\n  totalSales: number;\r\n  totalCost: number;\r\n  totalProfit: number;\r\n  profitMargin: number;\r\n  averagePrice?: number;\r\n  averageCost?: number;\r\n};\r\n\r\nexport default function ProfitabilityPage() {\r\n  const today = new Date().toISOString().slice(0, 10);\r\n  const [from, setFrom] = useState(\"2026-01-01\");\r\n  const [to, setTo] = useState(today);\r\n  const [groupBy, setGroupBy] = useState<\"customer\" | \"product\">(\"customer\");\r\n  const [data, setData] = useState<ProfitabilityData[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const user = getCurrentUser();\r\n\r\n  useEffect(() => {\r\n    loadReport();\r\n  }, [groupBy]);\r\n\r\n  async function loadReport() {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\r\n        `/api/reports/profitability?from=${from}&to=${to}&groupBy=${groupBy}`,\r\n        {\r\n          headers: { \"x-user-role\": user?.role || \"ADMIN\" },\r\n        }\r\n      );\r\n      const result = await res.json();\r\n      if (Array.isArray(result)) {\r\n        setData(result);\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  const totalSales = data.reduce((sum, d) => sum + d.totalSales, 0);\r\n  const totalCost = data.reduce((sum, d) => sum + d.totalCost, 0);\r\n  const totalProfit = totalSales - totalCost;\r\n  const overallMargin = totalSales > 0 ? (totalProfit / totalSales) * 100 : 0;\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <h1 className=\"text-2xl font-bold\">Profitability Report</h1>\r\n\r\n      <div className=\"flex gap-4 items-end bg-white p-4 border rounded\">\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">Group By</label>\r\n          <select\r\n            className=\"border p-2 rounded\"\r\n            value={groupBy}\r\n            onChange={(e) =>\r\n              setGroupBy(e.target.value as \"customer\" | \"product\")\r\n            }\r\n          >\r\n            <option value=\"customer\">By Customer</option>\r\n            <option value=\"product\">By Product</option>\r\n          </select>\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">From</label>\r\n          <input\r\n            type=\"date\"\r\n            className=\"border p-2 rounded\"\r\n            value={from}\r\n            onChange={(e) => setFrom(e.target.value)}\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">To</label>\r\n          <input\r\n            type=\"date\"\r\n            className=\"border p-2 rounded\"\r\n            value={to}\r\n            onChange={(e) => setTo(e.target.value)}\r\n          />\r\n        </div>\r\n        <button\r\n          onClick={loadReport}\r\n          className=\"bg-blue-600 text-white px-6 py-2 rounded\"\r\n        >\r\n          {loading ? \"Loading...\" : \"Load Report\"}\r\n        </button>\r\n        {data.length > 0 && (\r\n          <>\r\n            <button\r\n              onClick={() => exportToCSV(data, \"profitability\")}\r\n              className=\"bg-green-600 text-white px-6 py-2 rounded\"\r\n            >\r\n              Export CSV\r\n            </button>\r\n            <button\r\n              onClick={() =>\r\n                exportToPDF(\r\n                  data,\r\n                  \"Profitability Report\",\r\n                  Object.keys(data[0] || {})\r\n                )\r\n              }\r\n              className=\"bg-red-600 text-white px-6 py-2 rounded\"\r\n            >\r\n              Export PDF\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {data.length > 0 && (\r\n        <div className=\"bg-white border rounded p-4\">\r\n          <div className=\"grid grid-cols-4 gap-4\">\r\n            <div className=\"bg-blue-50 p-4 rounded\">\r\n              <p className=\"text-sm text-gray-600\">Total Sales</p>\r\n              <p className=\"text-2xl font-bold\">{totalSales.toLocaleString()}</p>\r\n            </div>\r\n            <div className=\"bg-red-50 p-4 rounded\">\r\n              <p className=\"text-sm text-gray-600\">Total Cost</p>\r\n              <p className=\"text-2xl font-bold\">{totalCost.toLocaleString()}</p>\r\n            </div>\r\n            <div className=\"bg-green-50 p-4 rounded\">\r\n              <p className=\"text-sm text-gray-600\">Total Profit</p>\r\n              <p className=\"text-2xl font-bold\">{totalProfit.toLocaleString()}</p>\r\n            </div>\r\n            <div className=\"bg-yellow-50 p-4 rounded\">\r\n              <p className=\"text-sm text-gray-600\">Profit Margin</p>\r\n              <p className=\"text-2xl font-bold\">\r\n                {overallMargin.toFixed(2)}%\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"bg-white border rounded overflow-hidden\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-100\">\r\n            <tr>\r\n              {groupBy === \"customer\" ? (\r\n                <>\r\n                  <th className=\"p-3 text-left\">Customer</th>\r\n                  <th className=\"p-3 text-right\">Invoices</th>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <th className=\"p-3 text-left\">Product</th>\r\n                  <th className=\"p-3 text-right\">Qty Sold</th>\r\n                </>\r\n              )}\r\n              <th className=\"p-3 text-right\">Sales</th>\r\n              <th className=\"p-3 text-right\">Cost</th>\r\n              <th className=\"p-3 text-right\">Profit</th>\r\n              <th className=\"p-3 text-right\">Margin %</th>\r\n              {groupBy === \"product\" && (\r\n                <>\r\n                  <th className=\"p-3 text-right\">Avg Price</th>\r\n                  <th className=\"p-3 text-right\">Avg Cost</th>\r\n                </>\r\n              )}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {loading ? (\r\n              <tr>\r\n                <td colSpan={groupBy === \"customer\" ? 6 : 8} className=\"p-4 text-center\">\r\n                  Loading...\r\n                </td>\r\n              </tr>\r\n            ) : data.length === 0 ? (\r\n              <tr>\r\n                <td colSpan={groupBy === \"customer\" ? 6 : 8} className=\"p-4 text-center text-gray-400\">\r\n                  No data found\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              data.map((d, i) => (\r\n                <tr key={i} className=\"border-t\">\r\n                  <td className=\"p-3 font-bold\">\r\n                    {groupBy === \"customer\" ? d.customerName : d.itemName}\r\n                  </td>\r\n                  <td className=\"p-3 text-right\">\r\n                    {groupBy === \"customer\"\r\n                      ? d.invoiceCount\r\n                      : d.quantitySold}\r\n                  </td>\r\n                  <td className=\"p-3 text-right\">\r\n                    {d.totalSales.toLocaleString()}\r\n                  </td>\r\n                  <td className=\"p-3 text-right\">{d.totalCost.toLocaleString()}</td>\r\n                  <td className=\"p-3 text-right font-bold\">\r\n                    {d.totalProfit.toLocaleString()}\r\n                  </td>\r\n                  <td className=\"p-3 text-right\">\r\n                    <span\r\n                      className={`px-2 py-1 rounded ${\r\n                        d.profitMargin >= 20\r\n                          ? \"bg-green-100 text-green-800\"\r\n                          : d.profitMargin >= 10\r\n                          ? \"bg-yellow-100 text-yellow-800\"\r\n                          : \"bg-red-100 text-red-800\"\r\n                      }`}\r\n                    >\r\n                      {d.profitMargin.toFixed(2)}%\r\n                    </span>\r\n                  </td>\r\n                  {groupBy === \"product\" && (\r\n                    <>\r\n                      <td className=\"p-3 text-right\">\r\n                        {d.averagePrice?.toLocaleString() || \"N/A\"}\r\n                      </td>\r\n                      <td className=\"p-3 text-right\">\r\n                        {d.averageCost?.toLocaleString() || \"N/A\"}\r\n                      </td>\r\n                    </>\r\n                  )}\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\sales\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[976,979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[976,979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":60,"column":38,"nodeType":"ArrayExpression","endLine":60,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [loadReport]","fix":{"range":[1667,1669],"text":"[loadReport]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\nimport { exportToCSV } from \"@/lib/export\";\n\ntype Account = { id: string; name: string };\ntype Row = {\n  date: string;\n  invoiceNo: string;\n  customer: string;\n  item: string;\n  qty: number;\n  rate: number;\n  amount: number;\n};\n\nexport default function SalesReportPage() {\n  const today = new Date().toISOString().slice(0, 10);\n  const [customers, setCustomers] = useState<Account[]>([]);\n  const [customerId, setCustomerId] = useState(\"\");\n  const [from, setFrom] = useState(\"2026-01-01\");\n  const [to, setTo] = useState(today);\n  const [rows, setRows] = useState<Row[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    const user = getCurrentUser();\n    if (!user) return;\n    fetch(\"/api/accounts\", { headers: { \"x-user-role\": user.role } })\n      .then(r => r.json())\n      .then(d => setCustomers((Array.isArray(d) ? d : []).filter((a: any) => a.partyType === \"CUSTOMER\")))\n      .catch(err => console.error(\"Customer fetch error:\", err));\n  }, []);\n\n  async function loadReport() {\n    setLoading(true);\n    const user = getCurrentUser();\n    \n    const qs = new URLSearchParams({\n      from,\n      to,\n      ...(customerId && { customerId }),\n    });\n\n    try {\n      const res = await fetch(`/api/reports/sales?${qs}`, {\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" }\n      });\n      const data = await res.json();\n      setRows(Array.isArray(data) ? data : []);\n    } catch (e) {\n      console.error(e);\n      setRows([]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => { loadReport(); }, []);\n\n  // 📊 CALCULATE TOTALS\n  const totalQty = rows.reduce((s, r) => s + (Number(r.qty) || 0), 0);\n  const totalAmount = rows.reduce((s, r) => s + (Number(r.amount) || 0), 0);\n\n  return (\n    <div className=\"p-6 space-y-6 max-w-7xl mx-auto font-bold\">\n      <h1 className=\"text-3xl font-black uppercase italic border-b-4 border-black pb-2\">Sales Report</h1>\n\n      {/* FILTER BAR */}\n      <div className=\"flex gap-4 flex-wrap items-end bg-white p-4 border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] print:hidden\">\n        <div className=\"flex flex-col gap-1\">\n          <label className=\"text-xs uppercase\">Customer</label>\n          <select className=\"border-2 border-black px-3 py-2 outline-none w-48\" value={customerId} onChange={e => setCustomerId(e.target.value)}>\n            <option value=\"\">All Customers</option>\n            {customers.map(c => (<option key={c.id} value={c.id}>{c.name}</option>))}\n          </select>\n        </div>\n        <div className=\"flex flex-col gap-1\">\n          <label className=\"text-xs uppercase\">From</label>\n          <input type=\"date\" className=\"border-2 border-black px-3 py-2 outline-none\" value={from} onChange={e => setFrom(e.target.value)} />\n        </div>\n        <div className=\"flex flex-col gap-1\">\n          <label className=\"text-xs uppercase\">To</label>\n          <input type=\"date\" className=\"border-2 border-black px-3 py-2 outline-none\" value={to} onChange={e => setTo(e.target.value)} />\n        </div>\n        <button onClick={loadReport} className=\"bg-black text-white px-8 py-2.5 font-black uppercase hover:bg-gray-800 transition-all\">\n          {loading ? \"Loading...\" : \"Show Report\"}\n        </button>\n        {rows.length > 0 && (\n          <button \n            onClick={() => exportToCSV(rows, \"sales-report\")} \n            className=\"bg-green-600 text-white px-6 py-2.5 font-black uppercase hover:bg-green-700 transition-all\"\n          >\n            📥 Export CSV\n          </button>\n        )}\n      </div>\n\n      {/* TABLE */}\n      <div className=\"border-2 border-black bg-white overflow-hidden shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]\">\n        <table className=\"w-full text-sm border-collapse\">\n          <thead className=\"bg-black text-white\">\n            <tr>\n              <th className=\"p-3 text-left border-r border-gray-700\">DATE</th>\n              <th className=\"p-3 text-left border-r border-gray-700\">INVOICE</th>\n              <th className=\"p-3 text-left border-r border-gray-700\">CUSTOMER</th>\n              <th className=\"p-3 text-left border-r border-gray-700\">ITEM</th>\n              <th className=\"p-3 text-right border-r border-gray-700 w-24\">QTY</th>\n              <th className=\"p-3 text-right border-r border-gray-700 w-32\">RATE</th>\n              <th className=\"p-3 text-right w-40\">AMOUNT</th>\n            </tr>\n          </thead>\n\n          <tbody className=\"divide-y-2 divide-black uppercase\">\n            {loading ? (\n              <tr><td colSpan={7} className=\"p-10 text-center animate-pulse\">Fetching Data...</td></tr>\n            ) : rows.length === 0 ? (\n              <tr><td colSpan={7} className=\"p-10 text-center text-gray-400 italic\">No Sales Data Found</td></tr>\n            ) : (\n              rows.map((r, i) => (\n                <tr key={i} className=\"hover:bg-yellow-50\">\n                  <td className=\"p-3 border-r-2 border-black\">{r.date}</td>\n                  <td className=\"p-3 border-r-2 border-black\">#{r.invoiceNo}</td>\n                  <td className=\"p-3 border-r-2 border-black text-blue-900\">{r.customer}</td>\n                  <td className=\"p-3 border-r-2 border-black\">{r.item}</td>\n                  <td className=\"p-3 border-r-2 border-black text-right\">{(r.qty || 0).toLocaleString()}</td>\n                  <td className=\"p-3 border-r-2 border-black text-right\">{(r.rate || 0).toLocaleString()}</td>\n                  <td className=\"p-3 text-right font-black bg-gray-50\">{(r.amount || 0).toLocaleString()}</td>\n                </tr>\n              ))\n            )}\n          </tbody>\n\n          {/* 📊 FOOTER WITH QTY AND AMOUNT TOTAL */}\n          {rows.length > 0 && (\n            <tfoot className=\"bg-black text-white font-black\">\n              <tr>\n                <td colSpan={4} className=\"p-4 text-right uppercase tracking-widest border-r border-gray-800\">Grand Total</td>\n                <td className=\"p-4 text-right text-lg border-r border-gray-800 bg-gray-900\">\n                  {totalQty.toLocaleString()}\n                </td>\n                <td className=\"p-4 border-r border-gray-800 bg-gray-900\"></td>\n                <td className=\"p-4 text-right text-xl bg-gray-900\">\n                  {totalAmount.toLocaleString()}\n                </td>\n              </tr>\n            </tfoot>\n          )}\n        </table>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\stock-ledger\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\stock\\location\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\stock\\low\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\stock\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showDropdown' is assigned a value but never used.","line":21,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":22},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":122,"column":116,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4906,4926],"text":"No items found for &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4906,4926],"text":"No items found for &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4906,4926],"text":"No items found for &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4906,4926],"text":"No items found for &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":122,"column":130,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4939,4948],"text":"&quot; status."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4939,4948],"text":"&ldquo; status."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4939,4948],"text":"&#34; status."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4939,4948],"text":"&rdquo; status."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\ntype Row = {\r\n  itemId: string;\r\n  itemName: string;\r\n  unit: string;\r\n  description: string;\r\n  stockQty: number;\r\n  stockValue: number;\r\n};\r\n\r\nexport default function StockReportPage() {\r\n  const [rows, setRows] = useState<Row[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  // 👈 نیا فلٹر سٹیٹ: all, remaining, nill\r\n  const [stockStatus, setStockStatus] = useState(\"all\"); \r\n  const [showDropdown, setShowDropdown] = useState(false);\r\n\r\n  useEffect(() => {\r\n    loadStock();\r\n  }, []);\r\n\r\n  async function loadStock() {\r\n    setLoading(true);\r\n    const user = getCurrentUser();\r\n    try {\r\n      const res = await fetch(\"/api/reports/stock\", {\r\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" }\r\n      });\r\n      const data = await res.json();\r\n      setRows(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      console.error(\"Fetch error:\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  // 🔍 فائنل فلٹرنگ لاجک\r\n  const filteredRows = rows.filter((r) => {\r\n    const matchesSearch = r.itemName.toLowerCase().includes(searchTerm.toLowerCase());\r\n    \r\n    // اسٹاک اسٹیٹس فلٹر\r\n    let matchesStatus = true;\r\n    if (stockStatus === \"remaining\") {\r\n      matchesStatus = r.stockQty > 0;\r\n    } else if (stockStatus === \"nill\") {\r\n      matchesStatus = r.stockQty <= 0;\r\n    }\r\n\r\n    return matchesSearch && matchesStatus;\r\n  });\r\n\r\n  const totalQty = filteredRows.reduce((s, r) => s + r.stockQty, 0);\r\n  const totalValue = filteredRows.reduce((s, r) => s + r.stockValue, 0);\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6 max-w-7xl mx-auto font-bold\">\r\n      {/* HEADER */}\r\n      <div className=\"flex justify-between items-center border-b-4 border-black pb-4\">\r\n        <h1 className=\"text-3xl font-black uppercase italic text-gray-800 tracking-tighter text-shadow\">Inventory Stock Report</h1>\r\n        <button onClick={() => window.print()} className=\"bg-black text-white px-8 py-2 hover:bg-gray-800 transition print:hidden uppercase text-sm border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]\">\r\n          Print PDF\r\n        </button>\r\n      </div>\r\n\r\n      {/* FILTERS SECTION */}\r\n      <div className=\"flex gap-4 items-end bg-white p-4 border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] print:hidden\">\r\n        \r\n        {/* Search Item */}\r\n        <div className=\"flex-1 relative\">\r\n          <label className=\"block text-xs font-black uppercase mb-1 text-gray-500\">Search Item</label>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Type item name...\"\r\n            className=\"w-full border-2 border-black px-3 py-2 outline-none focus:bg-yellow-50\"\r\n            value={searchTerm}\r\n            onFocus={() => setShowDropdown(true)}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        {/* 👈 اسٹاک اسٹیٹس ڈراپ ڈاؤن */}\r\n        <div className=\"w-full md:w-48\">\r\n          <label className=\"block text-xs font-black uppercase mb-1 text-gray-500\">Stock Status</label>\r\n          <select \r\n            value={stockStatus} \r\n            onChange={(e) => setStockStatus(e.target.value)}\r\n            className=\"w-full border-2 border-black px-3 py-2 outline-none bg-white cursor-pointer hover:bg-gray-50\"\r\n          >\r\n            <option value=\"all\">ALL STOCK</option>\r\n            <option value=\"remaining\">REMAINING (Available)</option>\r\n            <option value=\"nill\">NILL (Out of Stock)</option>\r\n          </select>\r\n        </div>\r\n\r\n        <button onClick={() => {setSearchTerm(\"\"); setStockStatus(\"all\");}} className=\"bg-gray-200 border-2 border-black px-6 py-2 uppercase text-xs hover:bg-gray-300 w-full md:w-auto\">\r\n          Reset\r\n        </button>\r\n      </div>\r\n\r\n      {/* TABLE */}\r\n      <div className=\"border-2 border-black bg-white shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] overflow-x-auto\">\r\n        <table className=\"w-full text-sm border-collapse min-w-[800px]\">\r\n          <thead className=\"bg-black text-white\">\r\n            <tr className=\"uppercase italic\">\r\n              <th className=\"p-4 text-left border-r border-gray-700\">Item Name & Description</th>\r\n              <th className=\"p-4 text-right border-r border-gray-700\">Stock Qty</th>\r\n              <th className=\"p-4 text-left border-r border-gray-700\">Unit</th>\r\n              <th className=\"p-4 text-right\">Inventory Value</th>\r\n            </tr>\r\n          </thead>\r\n\r\n          <tbody className=\"divide-y-2 divide-black\">\r\n            {loading ? (\r\n              <tr><td colSpan={4} className=\"p-10 text-center animate-pulse\">FETCHING INVENTORY...</td></tr>\r\n            ) : filteredRows.length === 0 ? (\r\n              <tr><td colSpan={4} className=\"p-10 text-center text-gray-400 italic font-medium\">No items found for \"{stockStatus}\" status.</td></tr>\r\n            ) : (\r\n              filteredRows.map((r) => (\r\n                <tr key={r.itemId} className={`hover:bg-yellow-50 transition-colors uppercase ${r.stockQty <= 0 ? 'bg-red-50/30' : ''}`}>\r\n                  <td className=\"p-4 border-r-2 border-black\">\r\n                    <div className=\"font-black text-gray-800\">{r.itemName}</div>\r\n                    <div className=\"text-[10px] text-gray-500 italic\">{r.description || \"No Description\"}</div>\r\n                  </td>\r\n                  <td className={`p-4 text-right border-r-2 border-black font-black text-lg ${r.stockQty <= 0 ? \"text-red-600\" : \"text-green-700\"}`}>\r\n                    {r.stockQty.toLocaleString()}\r\n                  </td>\r\n                  <td className=\"p-4 border-r-2 border-black text-gray-600 italic\">{r.unit}</td>\r\n                  <td className=\"p-4 text-right font-black text-blue-900 bg-gray-50/50\">\r\n                    {r.stockValue.toLocaleString()}\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n\r\n          {!loading && filteredRows.length > 0 && (\r\n            <tfoot className=\"bg-black text-white\">\r\n              <tr>\r\n                <td className=\"p-4 text-right font-black uppercase italic\">Grand Totals:</td>\r\n                <td className=\"p-4 text-right text-xl font-black bg-gray-900 border-r border-gray-700\">\r\n                  {totalQty.toLocaleString()}\r\n                </td>\r\n                <td className=\"p-4 bg-gray-900 border-r border-gray-700\"></td>\r\n                <td className=\"p-4 text-right text-2xl font-black bg-blue-900\">\r\n                  {totalValue.toLocaleString()}\r\n                </td>\r\n              </tr>\r\n            </tfoot>\r\n          )}\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\tax-summary\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":30,"column":6,"nodeType":"ArrayExpression","endLine":30,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadReport]","fix":{"range":[800,802],"text":"[loadReport]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { exportToCSV } from \"@/lib/export\";\r\nimport { exportToPDF } from \"@/lib/pdf-export\";\r\n\r\ntype TaxSummary = {\r\n  taxType: string;\r\n  taxCode: string;\r\n  taxRate: number;\r\n  invoiceCount: number;\r\n  totalSubtotal: number;\r\n  totalTaxAmount: number;\r\n  totalAmount: number;\r\n  averageTaxRate: number;\r\n};\r\n\r\nexport default function TaxSummaryPage() {\r\n  const today = new Date().toISOString().slice(0, 10);\r\n  const [from, setFrom] = useState(\"2026-01-01\");\r\n  const [to, setTo] = useState(today);\r\n  const [data, setData] = useState<TaxSummary[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const user = getCurrentUser();\r\n\r\n  useEffect(() => {\r\n    loadReport();\r\n  }, []);\r\n\r\n  async function loadReport() {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\r\n        `/api/reports/tax-summary?from=${from}&to=${to}`,\r\n        {\r\n          headers: { \"x-user-role\": user?.role || \"ADMIN\" },\r\n        }\r\n      );\r\n      const result = await res.json();\r\n      if (Array.isArray(result)) {\r\n        setData(result);\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  const totalTax = data.reduce((sum, d) => sum + d.totalTaxAmount, 0);\r\n  const totalAmount = data.reduce((sum, d) => sum + d.totalAmount, 0);\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <h1 className=\"text-2xl font-bold\">Tax Summary Report</h1>\r\n\r\n      <div className=\"flex gap-4 items-end bg-white p-4 border rounded\">\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">From</label>\r\n          <input\r\n            type=\"date\"\r\n            className=\"border p-2 rounded\"\r\n            value={from}\r\n            onChange={(e) => setFrom(e.target.value)}\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-bold mb-1\">To</label>\r\n          <input\r\n            type=\"date\"\r\n            className=\"border p-2 rounded\"\r\n            value={to}\r\n            onChange={(e) => setTo(e.target.value)}\r\n          />\r\n        </div>\r\n        <button\r\n          onClick={loadReport}\r\n          className=\"bg-blue-600 text-white px-6 py-2 rounded\"\r\n        >\r\n          {loading ? \"Loading...\" : \"Load Report\"}\r\n        </button>\r\n        {data.length > 0 && (\r\n          <>\r\n            <button\r\n              onClick={() => exportToCSV(data, \"tax-summary\")}\r\n              className=\"bg-green-600 text-white px-6 py-2 rounded\"\r\n            >\r\n              Export CSV\r\n            </button>\r\n            <button\r\n              onClick={() =>\r\n                exportToPDF(\r\n                  data,\r\n                  \"Tax Summary Report\",\r\n                  Object.keys(data[0] || {})\r\n                )\r\n              }\r\n              className=\"bg-red-600 text-white px-6 py-2 rounded\"\r\n            >\r\n              Export PDF\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {data.length > 0 && (\r\n        <div className=\"bg-white border rounded p-4\">\r\n          <div className=\"grid grid-cols-3 gap-4 mb-4\">\r\n            <div className=\"bg-blue-50 p-4 rounded\">\r\n              <p className=\"text-sm text-gray-600\">Total Tax Amount</p>\r\n              <p className=\"text-2xl font-bold\">{totalTax.toLocaleString()}</p>\r\n            </div>\r\n            <div className=\"bg-green-50 p-4 rounded\">\r\n              <p className=\"text-sm text-gray-600\">Total Amount</p>\r\n              <p className=\"text-2xl font-bold\">\r\n                {totalAmount.toLocaleString()}\r\n              </p>\r\n            </div>\r\n            <div className=\"bg-yellow-50 p-4 rounded\">\r\n              <p className=\"text-sm text-gray-600\">Tax Types</p>\r\n              <p className=\"text-2xl font-bold\">{data.length}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"bg-white border rounded overflow-hidden\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-100\">\r\n            <tr>\r\n              <th className=\"p-3 text-left\">Tax Type</th>\r\n              <th className=\"p-3 text-left\">Tax Code</th>\r\n              <th className=\"p-3 text-right\">Tax Rate (%)</th>\r\n              <th className=\"p-3 text-right\">Invoices</th>\r\n              <th className=\"p-3 text-right\">Subtotal</th>\r\n              <th className=\"p-3 text-right\">Tax Amount</th>\r\n              <th className=\"p-3 text-right\">Total Amount</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {loading ? (\r\n              <tr>\r\n                <td colSpan={7} className=\"p-4 text-center\">\r\n                  Loading...\r\n                </td>\r\n              </tr>\r\n            ) : data.length === 0 ? (\r\n              <tr>\r\n                <td colSpan={7} className=\"p-4 text-center text-gray-400\">\r\n                  No tax data found\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              data.map((d, i) => (\r\n                <tr key={i} className=\"border-t\">\r\n                  <td className=\"p-3 font-bold\">{d.taxType}</td>\r\n                  <td className=\"p-3\">{d.taxCode}</td>\r\n                  <td className=\"p-3 text-right\">{d.taxRate}%</td>\r\n                  <td className=\"p-3 text-right\">{d.invoiceCount}</td>\r\n                  <td className=\"p-3 text-right\">\r\n                    {d.totalSubtotal.toLocaleString()}\r\n                  </td>\r\n                  <td className=\"p-3 text-right font-bold\">\r\n                    {d.totalTaxAmount.toLocaleString()}\r\n                  </td>\r\n                  <td className=\"p-3 text-right\">\r\n                    {d.totalAmount.toLocaleString()}\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\trial-balance\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[254,257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[254,257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totals' is assigned a value but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[306,309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[306,309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":30,"column":38,"nodeType":"ArrayExpression","endLine":30,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [loadReport]","fix":{"range":[1022,1024],"text":"[loadReport]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":85,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":85,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\nexport default function CategorizedTrialBalance() {\r\n   const today = new Date().toISOString().slice(0, 10);\r\n  const [rows, setRows] = useState<any[]>([]);\r\n  const [totals, setTotals] = useState<any>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [sendingEmail, setSendingEmail] = useState(false);\r\n\r\n  const [fromDate, setFromDate] = useState(\"2026-01-01\");\r\n    const [toDate, setToDate] = useState(today);\r\n  const loadReport = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const user = getCurrentUser();\r\n      const res = await fetch(\r\n        `/api/reports/trial-balance?from=${fromDate}&to=${toDate}`,\r\n        { headers: { \"x-user-role\": user?.role || \"\" } }\r\n      );\r\n      const data = await res.json();\r\n      setRows(data.rows || []);\r\n      setTotals(data.totals || null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => { loadReport(); }, []);\r\n\r\n  const categories = Array.from(new Set(rows.map(r => r.category)));\r\n\r\n  /* ================= GRAND TOTAL CALCULATION (All Columns) ================= */\r\n  const grand = rows.reduce(\r\n    (a, r) => ({\r\n      opD: a.opD + (r.opDebit || 0),\r\n      opC: a.opC + (r.opCredit || 0),\r\n      trD: a.trD + (r.transDebit || 0),\r\n      trC: a.trC + (r.transCredit || 0),\r\n      clD: a.clD + (r.clDebit || 0),\r\n      clC: a.clC + (r.clCredit || 0),\r\n    }),\r\n    { opD: 0, opC: 0, trD: 0, trC: 0, clD: 0, clC: 0 }\r\n  );\r\n\r\n  const difference = grand.clD - grand.clC;\r\n\r\n  return (\r\n    <div className=\"max-w-[1200px] mx-auto p-4 font-sans text-[11px] bg-white\">\r\n\r\n      {/* SEARCH FILTERS */}\r\n      <div className=\"flex flex-col sm:flex-row flex-wrap gap-4 mb-6 print:hidden border-b pb-4\">\r\n        <input type=\"date\" value={fromDate} onChange={e => setFromDate(e.target.value)} className=\"border p-1.5\" />\r\n        <input type=\"date\" value={toDate} onChange={e => setToDate(e.target.value)} className=\"border p-1.5\" />\r\n        <button onClick={loadReport} className=\"bg-black text-white px-6 py-1.5 font-bold uppercase\">Generate</button>\r\n        <button onClick={() => window.print()} className=\"bg-blue-600 text-white px-4 py-1.5 font-bold uppercase text-xs\">Print</button>\r\n        <button\r\n          onClick={async () => {\r\n            const email = window.prompt(\"Report email kis address par bhejni hai?\");\r\n            if (!email || !email.includes(\"@\")) return;\r\n            setSendingEmail(true);\r\n            try {\r\n              const user = getCurrentUser();\r\n              const res = await fetch(\"/api/email/send\", {\r\n                method: \"POST\",\r\n                headers: {\r\n                  \"Content-Type\": \"application/json\",\r\n                  \"x-user-role\": user?.role || \"\",\r\n                  \"x-user-id\": user?.id || \"\",\r\n                },\r\n                body: JSON.stringify({\r\n                  type: \"custom\",\r\n                  to: email,\r\n                  subject: `Trial Balance ${fromDate} to ${toDate}`,\r\n                  message: \"Trial Balance report attached from US TRADERS system.\",\r\n                }),\r\n              });\r\n              const data = await res.json();\r\n              if (res.ok) {\r\n                alert(\"Email bhej di gayi hai\");\r\n              } else {\r\n                alert(data.error || \"Email send nahi ho saki\");\r\n              }\r\n            } catch (e) {\r\n              alert(\"Email send karte waqt error aayi\");\r\n            } finally {\r\n              setSendingEmail(false);\r\n            }\r\n          }}\r\n          disabled={sendingEmail}\r\n          className=\"bg-green-600 text-white px-4 py-1.5 font-bold uppercase text-xs disabled:bg-gray-400\"\r\n        >\r\n          {sendingEmail ? \"Sending...\" : \"Email\"}\r\n        </button>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"p-20 text-center font-bold uppercase tracking-widest\">Loading Report...</div>\r\n      ) : (\r\n        <div className=\"space-y-8\">\r\n          {/* HEADER */}\r\n          <div className=\"text-center\">\r\n            <h1 className=\"text-2xl font-black\">US TRADERS</h1>\r\n            <h2 className=\"text-sm font-bold border-b-2 border-black inline-block px-10 pb-1 italic\">TRIAL BALANCE</h2>\r\n          </div>\r\n\r\n          {categories.map(cat => {\r\n            const list = rows.filter(r => r.category === cat);\r\n            return (\r\n              <div key={cat} className=\"border border-gray-300 overflow-x-auto\">\r\n                <div className=\"bg-gray-100 p-1.5 px-3 font-black text-blue-900 border-b border-gray-300 uppercase italic min-w-[800px]\">\r\n                  {cat}\r\n                </div>\r\n                <table className=\"w-full min-w-[800px]\">\r\n                  <thead>\r\n                    <tr className=\"bg-gray-50 text-[10px] uppercase font-bold border-b border-gray-300\">\r\n                      <th className=\"p-1 text-left w-20\">Code</th>\r\n                      <th className=\"p-1 text-left\">Description</th>\r\n                      <th className=\"p-1 text-right w-24\">Op Dr</th>\r\n                      <th className=\"p-1 text-right w-24\">Op Cr</th>\r\n                      <th className=\"p-1 text-right w-24\">Tr Dr</th>\r\n                      <th className=\"p-1 text-right w-24\">Tr Cr</th>\r\n                      <th className=\"p-1 text-right w-24 bg-gray-50\">Cl Dr</th>\r\n                      <th className=\"p-1 text-right w-24 bg-gray-50\">Cl Cr</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {list.map((r, i) => (\r\n                      <tr key={i} className=\"border-b border-gray-100 hover:bg-yellow-50\">\r\n                        <td className=\"p-1 text-gray-500\">{r.code}</td>\r\n                        <td className=\"p-1 font-bold uppercase\">{r.name}</td>\r\n                        <td className=\"p-1 text-right\">{r.opDebit?.toLocaleString() || \"0\"}</td>\r\n                        <td className=\"p-1 text-right\">{r.opCredit?.toLocaleString() || \"0\"}</td>\r\n                        <td className=\"p-1 text-right\">{r.transDebit?.toLocaleString() || \"0\"}</td>\r\n                        <td className=\"p-1 text-right\">{r.transCredit?.toLocaleString() || \"0\"}</td>\r\n                        <td className=\"p-1 text-right font-bold italic\">{r.clDebit?.toLocaleString() || \"0\"}</td>\r\n                        <td className=\"p-1 text-right font-bold italic\">{r.clCredit?.toLocaleString() || \"0\"}</td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            );\r\n          })}\r\n\r\n          {/* 🏁 FINAL TOTAL (ALL COLUMNS) */}\r\n          <div className=\"mt-10 overflow-x-auto\">\r\n            <div className=\"bg-black text-white p-2 font-black uppercase tracking-tighter italic min-w-[800px]\">\r\n              Grand Report Summary (Consolidated)\r\n            </div>\r\n            <table className=\"w-full border-2 border-black min-w-[800px]\">\r\n              <thead className=\"bg-gray-200 font-black text-[10px] uppercase border-b-2 border-black\">\r\n                <tr>\r\n                  <th className=\"p-2 text-left\">Total Summary</th>\r\n                  <th className=\"p-2 text-right w-24\">Op Dr</th>\r\n                  <th className=\"p-2 text-right w-24\">Op Cr</th>\r\n                  <th className=\"p-2 text-right w-24\">Tr Dr</th>\r\n                  <th className=\"p-2 text-right w-24\">Tr Cr</th>\r\n                  <th className=\"p-2 text-right w-24 bg-yellow-100 text-black\">Cl Dr</th>\r\n                  <th className=\"p-2 text-right w-24 bg-yellow-100 text-black\">Cl Cr</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                <tr className=\"font-black text-[13px] bg-white\">\r\n                  <td className=\"p-3 italic uppercase\">Final Grand Totals:</td>\r\n                  <td className=\"p-3 text-right\">{grand.opD.toLocaleString()}</td>\r\n                  <td className=\"p-3 text-right\">{grand.opC.toLocaleString()}</td>\r\n                  <td className=\"p-3 text-right text-blue-700\">{grand.trD.toLocaleString()}</td>\r\n                  <td className=\"p-3 text-right text-blue-700\">{grand.trC.toLocaleString()}</td>\r\n                  <td className=\"p-3 text-right bg-yellow-50\">{grand.clD.toLocaleString()}</td>\r\n                  <td className=\"p-3 text-right bg-yellow-50\">{grand.clC.toLocaleString()}</td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n\r\n            {/* Difference Section */}\r\n            <div className=\"flex justify-between items-center mt-4 border-t-2 border-black pt-2\">\r\n              <div className=\"text-[10px] font-bold uppercase text-gray-400 italic\">\r\n                Verified by: US TRADERS Accounting System\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <span className=\"text-sm font-bold uppercase mr-4\">Final Difference:</span>\r\n                <span className={`text-2xl font-black italic ${difference === 0 ? \"text-green-600\" : \"text-red-600\"}`}>\r\n                  {Math.abs(difference).toLocaleString()} PKR\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\reports\\year-end\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[293,296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[293,296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[906,909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[906,909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\n\r\nexport default function YearEndClosingPage() {\r\n  const today = new Date().toISOString().slice(0, 10);\r\n\r\n  const [date, setDate] = useState(today);\r\n  const [loading, setLoading] = useState(false);\r\n  const [result, setResult] = useState<any>(null);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  async function runClosing() {\r\n    if (!confirm(\"⚠️ Year end closing irreversible hai. Confirm?\")) return;\r\n\r\n    setLoading(true);\r\n    setError(\"\");\r\n    setResult(null);\r\n\r\n    try {\r\n      const res = await fetch(\"/api/reports/year-end\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ date }),\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (!res.ok) {\r\n        throw new Error(data.error || \"Closing failed\");\r\n      }\r\n\r\n      setResult(data);\r\n    } catch (e: any) {\r\n      setError(e.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  function format(val: number) {\r\n    return val >= 0\r\n      ? val.toLocaleString()\r\n      : `(${Math.abs(val).toLocaleString()})`;\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-3xl mx-auto space-y-6\">\r\n\r\n      <h1 className=\"text-2xl font-extrabold text-red-700\">\r\n        Year End Closing\r\n      </h1>\r\n\r\n      {/* WARNING */}\r\n      <div className=\"border border-red-400 bg-red-50 p-4 text-sm\">\r\n        ⚠️ <b>Warning:</b>  \r\n        <br />\r\n        Year end closing ek dafa hoti hai.  \r\n        Income & Expense zero ho jayenge aur result Capital me transfer ho ga.\r\n      </div>\r\n\r\n      {/* FORM */}\r\n      <div className=\"bg-white border p-6 space-y-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium\">\r\n            Closing Date (As On)\r\n          </label>\r\n          <input\r\n            type=\"date\"\r\n            className=\"border px-3 py-2\"\r\n            value={date}\r\n            onChange={(e) => setDate(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        <button\r\n          onClick={runClosing}\r\n          disabled={loading}\r\n          className=\"bg-red-700 text-white px-6 py-2 disabled:opacity-60\"\r\n        >\r\n          {loading ? \"Closing Year...\" : \"Run Year End Closing\"}\r\n        </button>\r\n\r\n        {error && (\r\n          <div className=\"text-red-600 font-semibold\">\r\n            ❌ {error}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* RESULT */}\r\n      {result && (\r\n        <div className=\"bg-green-50 border border-green-400 p-6 space-y-2\">\r\n          <h2 className=\"text-xl font-bold text-green-700\">\r\n            ✅ Year Closed Successfully\r\n          </h2>\r\n\r\n          <div className=\"flex justify-between\">\r\n            <span>Total Income:</span>\r\n            <span>{format(result.incomeTotal)}</span>\r\n          </div>\r\n\r\n          <div className=\"flex justify-between\">\r\n            <span>Total Expense:</span>\r\n            <span>{format(result.expenseTotal)}</span>\r\n          </div>\r\n\r\n          <div className=\"flex justify-between font-bold border-t pt-2\">\r\n            <span>\r\n              {result.profit >= 0 ? \"Net Profit:\" : \"Net Loss:\"}\r\n            </span>\r\n            <span>{format(result.profit)}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\roles-permissions\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[313,316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[313,316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1382,1385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1382,1385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1830,1833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1830,1833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\ninterface Role {\r\n  role: string;\r\n  permissions: string[];\r\n}\r\n\r\nexport default function RolePermissionManager() {\r\n  const [user, setUser] = useState<any | null>(null);\r\n  const [roles, setRoles] = useState<Role[]>([]);\r\n  const [selectedRole, setSelectedRole] = useState<string>(\"ADMIN\");\r\n  const [rolePermissions, setRolePermissions] = useState<string[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n\r\n  // Available permissions from lib/permissions.ts\r\n  const availablePermissions = Object.values(PERMISSIONS);\r\n\r\n  // Load current user and roles\r\n  useEffect(() => {\r\n    const u = getCurrentUser();\r\n    setUser(u);\r\n    if (u && u.role === \"ADMIN\") {\r\n      loadRoles(u);\r\n    }\r\n  }, []);\r\n\r\n  // When roles load, update selected role permissions\r\n  useEffect(() => {\r\n    if (roles && roles.length > 0) {\r\n      const selectedRoleData = roles.find(r => r.role === selectedRole);\r\n      if (selectedRoleData) {\r\n        console.log(`Setting permissions for ${selectedRole}:`, selectedRoleData.permissions);\r\n        setRolePermissions(selectedRoleData.permissions || []);\r\n      }\r\n    }\r\n  }, [roles, selectedRole]);\r\n\r\n  const loadRoles = async (u: any) => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/api/admin/roles\", {\r\n        headers: {\r\n          \"x-user-id\": u.id,\r\n          \"x-user-role\": u.role,\r\n        },\r\n      });\r\n      const data = await res.json();\r\n      console.log(\"Loaded roles:\", data);\r\n      \r\n      setRoles(data || []);\r\n      \r\n      // Set initial role permissions\r\n      if (data && data.length > 0) {\r\n        const adminRole = data.find((r: any) => r.role === \"ADMIN\");\r\n        if (adminRole) {\r\n          setRolePermissions(adminRole.permissions || []);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error loading roles:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const selectRole = (roleName: string) => {\r\n    setSelectedRole(roleName);\r\n    console.log(`Selected role: ${roleName}, All roles:`, roles);\r\n    \r\n    const role = roles.find(r => r.role === roleName);\r\n    console.log(`Found role:`, role);\r\n    \r\n    if (role) {\r\n      setRolePermissions(role.permissions || []);\r\n    } else {\r\n      setRolePermissions([]);\r\n    }\r\n  };\r\n\r\n  const toggle = (perm: string) => {\r\n    setRolePermissions(prev =>\r\n      prev.includes(perm)\r\n        ? prev.filter(p => p !== perm)\r\n        : [...prev, perm]\r\n    );\r\n  };\r\n\r\n  const save = async () => {\r\n    if (!user || user.role !== \"ADMIN\") {\r\n      alert(\"Only ADMIN can save permissions\");\r\n      return;\r\n    }\r\n\r\n    setSaving(true);\r\n    try {\r\n      const res = await fetch(\"/api/admin/roles\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-id\": user.id,\r\n          \"x-user-role\": user.role,\r\n        },\r\n        body: JSON.stringify({\r\n          role: selectedRole,\r\n          permissions: rolePermissions,\r\n        }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        alert(`✅ ${selectedRole} role permissions saved successfully!`);\r\n        loadRoles(user);\r\n      } else {\r\n        alert(\"Failed to save permissions\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving permissions:\", error);\r\n      alert(\"Error saving permissions\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  // Guard - Check authorization\r\n  if (!user) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center\">\r\n          <p className=\"text-yellow-700\">Loading session...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (user.role !== \"ADMIN\") {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\r\n          <h2 className=\"text-xl font-bold text-red-600 mb-2\">❌ رسائی مسترد</h2>\r\n          <p className=\"text-red-700\">صرف ADMIN صارفین رولز کو سنبھال سکتے ہیں</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-6xl mx-auto\">\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-3xl font-bold mb-2\">🎭 Roles & Permissions</h1>\r\n        <p className=\"text-gray-600\">Configure which permissions each role has</p>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"text-center py-8\">Loading roles...</div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\r\n          {/* Role Selector */}\r\n          <div className=\"bg-white border rounded-lg p-4\">\r\n            <h2 className=\"font-bold text-lg mb-4\">Roles</h2>\r\n            <div className=\"space-y-2\">\r\n              {[\"ADMIN\", \"ACCOUNTANT\", \"VIEWER\"].map(roleName => {\r\n                const roleData = roles.find(r => r.role === roleName);\r\n                const permCount = roleData?.permissions?.length || 0;\r\n                \r\n                return (\r\n                  <button\r\n                    key={roleName}\r\n                    onClick={() => selectRole(roleName)}\r\n                    className={`w-full text-left px-4 py-3 rounded transition ${\r\n                      selectedRole === roleName\r\n                        ? \"bg-blue-100 border-l-4 border-blue-600 font-semibold\"\r\n                        : \"bg-gray-50 hover:bg-gray-100\"\r\n                    }`}\r\n                  >\r\n                    <div className=\"font-semibold\">{roleName}</div>\r\n                    <div className=\"text-xs text-gray-600\">\r\n                      {permCount} permissions\r\n                    </div>\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Permissions Manager */}\r\n          <div className=\"lg:col-span-3 bg-white border rounded-lg p-6\">\r\n            <h2 className=\"text-2xl font-bold mb-2\">{selectedRole}</h2>\r\n            <p className=\"text-gray-600 mb-6\">\r\n              Select which permissions this role should have\r\n            </p>\r\n\r\n            {/* Quick Actions */}\r\n            <div className=\"flex gap-2 mb-6\">\r\n              <button\r\n                onClick={() => setRolePermissions([...availablePermissions])}\r\n                className=\"px-3 py-1 text-sm bg-gray-200 rounded hover:bg-gray-300\"\r\n              >\r\n                ✓ Select All\r\n              </button>\r\n              <button\r\n                onClick={() => setRolePermissions([])}\r\n                className=\"px-3 py-1 text-sm bg-gray-200 rounded hover:bg-gray-300\"\r\n              >\r\n                ✗ Clear All\r\n              </button>\r\n            </div>\r\n\r\n            {/* Permissions Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\r\n              {availablePermissions.map(p => (\r\n                <label\r\n                  key={p}\r\n                  className=\"flex items-center cursor-pointer p-3 rounded border hover:bg-blue-50\"\r\n                >\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={rolePermissions.includes(p)}\r\n                    onChange={() => toggle(p)}\r\n                    className=\"w-4 h-4 rounded\"\r\n                  />\r\n                  <span className=\"ml-3 text-sm font-medium\">{p}</span>\r\n                </label>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Save Button */}\r\n            <button\r\n              onClick={save}\r\n              disabled={saving}\r\n              className=\"px-6 py-2 bg-green-600 text-white rounded font-semibold hover:bg-green-700 disabled:opacity-50\"\r\n            >\r\n              {saving ? \"Saving...\" : \"💾 Save Permissions\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\sale-return\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1452,1455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1452,1455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`handleInvoiceChange` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nD:\\projects\\smart-business-accounts\\app\\dashboard\\sale-return\\page.tsx:67:15\n  65 |             );\n  66 |             if (foundInvoice) {\n> 67 |               handleInvoiceChange(foundInvoice.id);\n     |               ^^^^^^^^^^^^^^^^^^^ `handleInvoiceChange` accessed before it is declared\n  68 |             } else {\n  69 |               alert(`No invoice found matching \"${query}\"`);\n  70 |             }\n\nD:\\projects\\smart-business-accounts\\app\\dashboard\\sale-return\\page.tsx:133:3\n  131 |   }\n  132 |\n> 133 |   async function handleInvoiceChange(id: string) {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 134 |     setInvoiceId(id);\n      | ^^^^^^^^^^^^^^^^^^^^^\n> 135 |     if (!id) { \n      …\n      | ^^^^^^^^^^^^^^^^^^^^^\n> 177 |     }\n      | ^^^^^^^^^^^^^^^^^^^^^\n> 178 |   }\n      | ^^^^ `handleInvoiceChange` is declared here\n  179 |\n  180 |   const updateRow = <K extends keyof Row>(\n  181 |   index: number,","line":67,"column":15,"nodeType":null,"endLine":67,"endColumn":34},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleInvoiceChange'. Either include it or remove the dependency array.","line":77,"column":6,"nodeType":"ArrayExpression","endLine":77,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [today, showForm, preview, invoices, handleInvoiceChange]","fix":{"range":[2745,2781],"text":"[today, showForm, preview, invoices, handleInvoiceChange]"}}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadReturns` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nD:\\projects\\smart-business-accounts\\app\\dashboard\\sale-return\\page.tsx:80:5\n  78 |\n  79 |   useEffect(() => {\n> 80 |     loadReturns();\n     |     ^^^^^^^^^^^ `loadReturns` accessed before it is declared\n  81 |     const user = getCurrentUser();\n  82 |     if (!user) {\n  83 |       alert(\"Session expired. Please login again.\");\n\nD:\\projects\\smart-business-accounts\\app\\dashboard\\sale-return\\page.tsx:119:3\n  117 |   }, []);\n  118 |\n> 119 |   async function loadReturns() {\n      |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 120 |     try {\n      | ^^^^^^^^^\n> 121 |       const res = await fetch(\"/api/sale-return\", {\n      …\n      | ^^^^^^^^^\n> 130 |     }\n      | ^^^^^^^^^\n> 131 |   }\n      | ^^^^ `loadReturns` is declared here\n  132 |\n  133 |   async function handleInvoiceChange(id: string) {\n  134 |     setInvoiceId(id);","line":80,"column":5,"nodeType":null,"endLine":80,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3503,3506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3503,3506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReturns'. Either include it or remove the dependency array.","line":117,"column":6,"nodeType":"ArrayExpression","endLine":117,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadReturns]","fix":{"range":[3891,3893],"text":"[loadReturns]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5360,5363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5360,5363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":241,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7240,7243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7240,7243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":266,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":266,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":464,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":464,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17758,17761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17758,17761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\n\ntype Invoice = { id: string; invoiceNo: string; customerName: string; customerId: string; };\ntype Row = { itemId: string; name: string; qty: number | \"\"; rate: number; maxQty: number; };\n\ntype SaleReturn = {\n  id: string;\n  returnNo: string;\n  date: string;\n  customerId: string;\n  customer?: { name: string };\n  invoiceId: string;\n  invoice?: { invoiceNo: string };\n  total: number;\n  items: Array<{ item: { name: string }; qty: number; rate: number }>;\n};\n\nexport default function SalesReturnPage() {\n  const today = new Date().toISOString().slice(0, 10);\n  const user = getCurrentUser();\n\n  const [invoices, setInvoices] = useState<Invoice[]>([]);\n  const [returns, setReturns] = useState<SaleReturn[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<SaleReturn | null>(null);\n\n  const [invoiceId, setInvoiceId] = useState(\"\");\n  const [displayInvoiceNo, setDisplayInvoiceNo] = useState(\"\");\n  const [customerName, setCustomerName] = useState(\"\");\n  const [customerId, setCustomerId] = useState(\"\");\n  const [rows, setRows] = useState<Row[]>([]);\n  const [date, setDate] = useState(today);\n  const [freight, setFreight] = useState<number | \"\">(\"\");\n\n  const [preview, setPreview] = useState(false);\n  const [savedData, setSavedData] = useState<any>(null);\n\n  // Keyboard shortcuts - F7: Clear date/customer, F8: Query dialog\n  useEffect(() => {\n    function handleKeyPress(e: KeyboardEvent) {\n      if (e.code === \"F7\" || e.key === \"F7\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !preview) {\n          setDate(today);\n          setInvoiceId(\"\");\n          setCustomerId(\"\");\n          setCustomerName(\"\");\n          setDisplayInvoiceNo(\"\");\n        }\n      }\n      if (e.code === \"F8\" || e.key === \"F8\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !preview) {\n          const query = prompt(\"Enter search query (Invoice No, Customer Name, etc.):\");\n          if (query) {\n            const foundInvoice = invoices.find(inv => \n              inv.invoiceNo.toLowerCase().includes(query.toLowerCase()) ||\n              inv.customerName.toLowerCase().includes(query.toLowerCase())\n            );\n            if (foundInvoice) {\n              handleInvoiceChange(foundInvoice.id);\n            } else {\n              alert(`No invoice found matching \"${query}\"`);\n            }\n          }\n        }\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyPress, true);\n    return () => document.removeEventListener(\"keydown\", handleKeyPress, true);\n  }, [today, showForm, preview, invoices]);\n\n  useEffect(() => {\n    loadReturns();\n    const user = getCurrentUser();\n    if (!user) {\n      alert(\"Session expired. Please login again.\");\n      return;\n    }\n\n    fetch(\"/api/sales-invoice\", {\n      headers: {\n        \"x-user-role\": user.role || \"\",\n        \"x-user-id\": user.id || \"\"\n      }\n    })\n      .then((r) => {\n        if (!r.ok) {\n          if (r.status === 403) {\n            alert(\"You don't have permission to view sales invoices\");\n            return { invoices: [] };\n          }\n          throw new Error(`Failed to load invoices: ${r.status}`);\n        }\n        return r.json();\n      })\n      .then((d) => {\n        if (d?.invoices) {\n          const activeInvoices = d.invoices.filter((inv: any) => inv.status !== \"RETURNED\");\n          setInvoices(activeInvoices);\n        } else if (d?.error) {\n          alert(`Error: ${d.error}`);\n        } else {\n          console.error(\"Unexpected response format:\", d);\n        }\n      })\n      .catch((err) => {\n        console.error(\"Load invoices error:\", err);\n        alert(`Failed to load invoices: ${err.message}`);\n      });\n  }, []);\n\n  async function loadReturns() {\n    try {\n      const res = await fetch(\"/api/sale-return\", {\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n      });\n      const data = await res.json();\n      if (Array.isArray(data)) {\n        setReturns(data);\n      }\n    } catch (e) {\n      console.error(\"Load returns error:\", e);\n    }\n  }\n\n  async function handleInvoiceChange(id: string) {\n    setInvoiceId(id);\n    if (!id) { \n      setRows([]); \n      setCustomerName(\"\"); \n      setDisplayInvoiceNo(\"\"); \n      return; \n    }\n\n    const selectedInv = invoices.find(i => i.id === id);\n    if (selectedInv) setDisplayInvoiceNo(selectedInv.invoiceNo);\n\n    try {\n      const user = getCurrentUser();\n      const res = await fetch(`/api/sales-invoice/${id}`, {\n        headers: {\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        }\n      });\n\n      if (!res.ok) {\n        const errorData = await res.json();\n        alert(errorData.error || \"Failed to load invoice details\");\n        setInvoiceId(\"\");\n        setRows([]);\n        return;\n      }\n\n      const data = await res.json();\n\n      if (data.items && data.items.length === 0) {\n        alert(\"Ye Invoice pehle hi mukammal return ho chuki hai!\");\n        setInvoiceId(\"\");\n        setRows([]);\n        return;\n      }\n\n      setCustomerName(data.customerName || \"\");\n      setCustomerId(data.customerId || \"\");\n      setRows(data.items || []);\n    } catch (err: any) {\n      console.error(\"Load error:\", err);\n      alert(`Error loading invoice: ${err.message || \"Unknown error\"}`);\n    }\n  }\n\n  const updateRow = <K extends keyof Row>(\n  index: number,\n  key: K,\n  value: Row[K]\n) => {\n  const copy = [...rows];\n  copy[index] = {\n    ...copy[index],\n    [key]: value,\n  };\n  setRows(copy);\n};\n\n\n  const total = rows.reduce((s, r) => s + (Number(r.qty) || 0) * r.rate, 0);\n  const netTotal = total + (Number(freight) || 0);\n\n  async function saveReturn() {\n    const clean = rows.filter(r => r.itemId && Number(r.qty) > 0);\n    if (!invoiceId || !clean.length) return alert(\"Select items to return\");\n\n    const method = editing ? \"PUT\" : \"POST\";\n    const body = editing\n      ? { id: editing.id, customerId, invoiceId, date, freight: freight || 0, items: clean }\n      : { customerId, invoiceId, date, freight: freight || 0, items: clean };\n\n    const res = await fetch(\"/api/sale-return\", {\n      method,\n      headers: { \"Content-Type\": \"application/json\", \"x-user-role\": user?.role || \"ADMIN\" },\n      body: JSON.stringify(body)\n    });\n\n    const data = await res.json();\n    if (data.success) {\n      setSavedData({\n        returnNo: data.returnNo,\n        date,\n        customerName,\n        invoiceNo: displayInvoiceNo,\n        items: clean,\n        total,\n        freight: freight || 0,\n        netTotal\n      });\n      setPreview(true);\n      await loadReturns();\n      if (editing) {\n        setEditing(null);\n        setShowForm(false);\n        setShowList(true);\n      }\n    } else alert(data.error);\n  }\n\n  function startEdit(ret: SaleReturn) {\n    setEditing(ret);\n    setInvoiceId(ret.invoiceId);\n    setDisplayInvoiceNo(ret.invoice?.invoiceNo || \"\");\n    setCustomerId(ret.customerId);\n    setCustomerName(ret.customer?.name || \"\");\n    setDate(new Date(ret.date).toISOString().slice(0, 10));\n    setRows(ret.items.map((it: any) => ({\n      itemId: it.itemId || \"\",\n      name: it.item?.name || \"\",\n      qty: it.qty.toString(),\n      rate: it.rate,\n      maxQty: it.qty,\n    })));\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deleteReturn(id: string) {\n    if (!confirm(\"Are you sure you want to delete this return?\")) return;\n    try {\n      const res = await fetch(`/api/sale-return?id=${id}`, {\n        method: \"DELETE\",\n        headers: { \"x-user-role\": user?.role || \"ADMIN\" },\n      });\n      if (res.ok) {\n        alert(\"Return deleted successfully\");\n        await loadReturns();\n      } else {\n        const err = await res.json();\n        alert(err.error || \"Delete failed\");\n      }\n    } catch (e) {\n      alert(\"Delete failed\");\n    }\n  }\n\n  function resetForm() {\n    setEditing(null);\n    setInvoiceId(\"\");\n    setDisplayInvoiceNo(\"\");\n    setCustomerId(\"\");\n    setCustomerName(\"\");\n    setDate(today);\n    setFreight(\"\");\n    setRows([]);\n    setPreview(false);\n  }\n\n  return (\n    <div className=\"p-6 max-w-5xl mx-auto\">\n      <div className=\"flex justify-between items-center mb-4\">\n        <h1 className=\"text-xl font-bold text-red-600\">Sales Return</h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => { setShowList(!showList); setShowForm(!showForm); setEditing(null); }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => { setShowForm(true); setShowList(false); resetForm(); }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New Return\n          </button>\n        </div>\n      </div>\n\n      {/* LIST VIEW */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-hidden mb-4\">\n          <table className=\"w-full text-sm\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">Return No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Customer</th>\n                <th className=\"p-3 text-left\">Invoice No</th>\n                <th className=\"p-3 text-right\">Total</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {returns.length === 0 ? (\n                <tr>\n                  <td colSpan={6} className=\"p-4 text-center text-gray-400\">No returns found</td>\n                </tr>\n              ) : (\n                returns.map(ret => (\n                  <tr key={ret.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">{ret.returnNo}</td>\n                    <td className=\"p-3\">{new Date(ret.date).toLocaleDateString()}</td>\n                    <td className=\"p-3\">{ret.customer?.name || \"N/A\"}</td>\n                    <td className=\"p-3\">{ret.invoice?.invoiceNo || \"N/A\"}</td>\n                    <td className=\"p-3 text-right\">{ret.total.toLocaleString()}</td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(ret)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deleteReturn(ret.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <>\n          {!preview ? (\n            <div className=\"space-y-4 border p-6 bg-white rounded shadow\">\n              <div className=\"mb-2 text-xs text-gray-500 italic\">\n                💡 Keyboard Shortcuts: <strong>F7</strong> = Clear Date & Invoice | <strong>F8</strong> = Search Query\n              </div>\n              <div className=\"flex justify-between items-center border-b pb-2\">\n                <h1 className=\"text-xl font-bold text-red-600\">{editing ? \"Edit Sales Return\" : \"Sales Return Form\"}</h1>\n                <div className=\"flex gap-2\">\n                  <button onClick={saveReturn} className=\"bg-red-600 hover:bg-red-700 text-white px-6 py-2 font-black rounded uppercase\">\n                    {editing ? \"Update Return\" : \"Confirm Sales Return\"}\n                  </button>\n                  <button onClick={() => { setShowForm(false); setEditing(null); resetForm(); }} className=\"bg-gray-600 text-white px-6 py-2 rounded\">\n                    Cancel\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"flex flex-col\">\n                  <label className=\"text-xs font-bold uppercase\">Select Invoice (F7: Clear, F8: Query)</label>\n                  <select className=\"border p-2 rounded\" value={invoiceId} onChange={e => handleInvoiceChange(e.target.value)}>\n                    <option value=\"\">-- Choose Invoice --</option>\n                    {invoices.map(i => <option key={i.id} value={i.id}>{i.invoiceNo} - {i.customerName}</option>)}\n                  </select>\n                </div>\n                <div className=\"flex flex-col\">\n                  <label className=\"text-xs font-bold uppercase\">Return Date (F7: Clear)</label>\n                  <input type=\"date\" className=\"border p-2 rounded\" value={date} onChange={e => setDate(e.target.value)} />\n                </div>\n              </div>\n\n              <div className=\"p-3 bg-gray-800 text-white font-bold rounded\">\n                Customer: {customerName || \"Not Selected\"}\n              </div>\n\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full border text-sm mt-4 min-w-[600px]\">\n                  <thead className=\"bg-gray-100\">\n                  <tr>\n                    <th className=\"border p-2 text-left\">Item Name</th>\n                    <th className=\"border p-2 w-24 text-center\">Remaining</th>\n                    <th className=\"border p-2 w-24 text-center\">Return Qty</th>\n                    <th className=\"border p-2 w-32 text-center\">Rate</th>\n                    <th className=\"border p-2 w-32 text-right\">Amount</th>\n                    <th className=\"border p-1 w-10\"></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rows.map((r, i) => (\n                    <tr key={i} className=\"hover:bg-red-50\">\n                      <td className=\"border p-2 font-semibold\">{r.name}</td>\n                      <td className=\"border p-2 text-center text-blue-600 font-bold\">{r.maxQty}</td>\n                      <td className=\"border p-2\">\n                        <input type=\"number\" className=\"w-full text-center border p-1 rounded font-bold bg-yellow-50\"\n                          value={r.qty}\n                          onChange={e => {\n                            const v = Number(e.target.value);\n                            updateRow(i, \"qty\", v > r.maxQty ? r.maxQty : v);\n                          }}\n                        />\n                      </td>\n                      <td className=\"border p-2 text-center font-mono\">{r.rate}</td>\n                      <td className=\"border p-2 text-right font-bold\">{(Number(r.qty) * r.rate).toLocaleString()}</td>\n                      <td className=\"border p-2 text-center text-red-500 cursor-pointer\" onClick={() => setRows(rows.filter((_, idx) => idx !== i))}>✕</td>\n                    </tr>\n                  ))}\n                </tbody>\n                </table>\n              </div>\n\n              <div className=\"flex flex-col items-end gap-2 border-t pt-4\">\n                <div className=\"w-64 flex justify-between\"><span>Subtotal:</span> <span className=\"font-mono\">{total.toLocaleString()}</span></div>\n                <div className=\"w-64 flex justify-between items-center py-1\">\n                  <span>Freight:</span>\n                  <input type=\"number\" className=\"border p-1 w-24 text-right rounded\" value={freight} onChange={e => setFreight(e.target.value === \"\" ? \"\" : Number(e.target.value))} />\n                </div>\n                <div className=\"w-64 flex justify-between font-bold text-xl text-red-600 border-t-2 pt-2\">\n                  <span>Net Total:</span> <span>{netTotal.toLocaleString()}</span>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"invoice-print space-y-6\">\n              <div className=\"flex gap-4 no-print bg-gray-100 p-4 rounded\">\n                <button onClick={() => window.print()} className=\"bg-blue-600 text-white px-8 py-2 rounded font-bold shadow\">Print Voucher</button>\n                <button onClick={() => { setPreview(false); resetForm(); }} className=\"bg-white border border-gray-300 px-8 py-2 rounded font-bold\">New Return</button>\n              </div>\n\n              <div className=\"print-voucher bg-white p-10 border shadow-sm mx-auto\">\n                <div className=\"text-center mb-8 border-b-2 border-black pb-4\">\n                  <h1 className=\"text-3xl font-black uppercase\">Sales Return Voucher</h1>\n                  <p className=\"text-sm\">Date: {savedData.date} | Voucher No: {savedData.returnNo}</p>\n                </div>\n\n                <div className=\"mb-6 grid grid-cols-1 md:grid-cols-2\">\n                  <p><strong>Customer:</strong> {savedData.customerName}</p>\n                  <p className=\"text-right\"><strong>Ref Invoice:</strong> {savedData.invoiceNo}</p>\n                </div>\n\n                <table className=\"w-full border-collapse border border-black text-sm\">\n                  <thead>\n                    <tr className=\"bg-gray-100 uppercase\">\n                      <th className=\"border border-black p-2 text-left\">Item Description</th>\n                      <th className=\"border border-black p-2 text-center w-24\">Qty</th>\n                      <th className=\"border border-black p-2 text-center w-32\">Rate</th>\n                      <th className=\"border border-black p-2 text-right w-32\">Amount</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {savedData.items.map((it: any, idx: number) => (\n                      <tr key={idx}>\n                        <td className=\"border border-black p-2\">{it.name}</td>\n                        <td className=\"border border-black p-2 text-center\">{it.qty}</td>\n                        <td className=\"border border-black p-2 text-center\">{it.rate.toLocaleString()}</td>\n                        <td className=\"border border-black p-2 text-right\">{(it.qty * it.rate).toLocaleString()}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n\n                <div className=\"mt-6 flex flex-col items-end font-bold space-y-1\">\n                  <p>Subtotal: {savedData.total.toLocaleString()}</p>\n                  <p>Freight: {savedData.freight.toLocaleString()}</p>\n                  <p className=\"text-xl border-t-2 border-black pt-2\">Net Total: {savedData.netTotal.toLocaleString()}</p>\n                </div>\n              </div>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\sales-invoice\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":3,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useRef"},"fix":{"range":[43,51],"text":""},"desc":"Remove unused variable \"useRef\"."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":64,"column":37,"nodeType":"Identifier","endLine":64,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":65,"column":29,"nodeType":"Identifier","endLine":65,"endColumn":37},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":66,"column":35,"nodeType":"Identifier","endLine":66,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":67,"column":35,"nodeType":"Identifier","endLine":67,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":68,"column":35,"nodeType":"Identifier","endLine":68,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":69,"column":33,"nodeType":"Identifier","endLine":69,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":71,"column":37,"nodeType":"Identifier","endLine":71,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":72,"column":39,"nodeType":"Identifier","endLine":72,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":73,"column":43,"nodeType":"Identifier","endLine":73,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":74,"column":27,"nodeType":"Identifier","endLine":74,"endColumn":35},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":75,"column":35,"nodeType":"Identifier","endLine":75,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":76,"column":39,"nodeType":"Identifier","endLine":76,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":77,"column":37,"nodeType":"Identifier","endLine":77,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":78,"column":27,"nodeType":"Identifier","endLine":78,"endColumn":35},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":81,"column":33,"nodeType":"Identifier","endLine":81,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":82,"column":31,"nodeType":"Identifier","endLine":82,"endColumn":39},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":83,"column":33,"nodeType":"Identifier","endLine":83,"endColumn":41},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":84,"column":43,"nodeType":"Identifier","endLine":84,"endColumn":51},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2564,2567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2564,2567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":85,"column":43,"nodeType":"Identifier","endLine":85,"endColumn":51},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":86,"column":41,"nodeType":"Identifier","endLine":86,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSearchTerm' is assigned a value but never used.","line":87,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":87,"endColumn":35},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":87,"column":39,"nodeType":"Identifier","endLine":87,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":88,"column":35,"nodeType":"Identifier","endLine":88,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":89,"column":31,"nodeType":"Identifier","endLine":89,"endColumn":39},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":91,"column":3,"nodeType":"Identifier","endLine":91,"endColumn":12},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":96,"column":35,"nodeType":"Identifier","endLine":96,"endColumn":43},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":97,"column":45,"nodeType":"Identifier","endLine":97,"endColumn":53},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":98,"column":29,"nodeType":"Identifier","endLine":98,"endColumn":37},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":101,"column":3,"nodeType":"Identifier","endLine":101,"endColumn":12},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":135,"column":3,"nodeType":"Identifier","endLine":135,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4643,4646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4643,4646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":170,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":170,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadInvoices' and 'user'. Either include them or remove the dependency array.","line":171,"column":6,"nodeType":"ArrayExpression","endLine":171,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadInvoices, user]","fix":{"range":[5425,5427],"text":"[loadInvoices, user]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":173,"column":3,"nodeType":"Identifier","endLine":173,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'invoiceNo'. Either include it or remove the dependency array. You can also do a functional update 'setInvoiceNo(i => ...)' if you only need 'invoiceNo' in the 'setInvoiceNo' call.","line":193,"column":6,"nodeType":"ArrayExpression","endLine":193,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [invoiceNo, queryId, user]","fix":{"range":[6059,6074],"text":"[invoiceNo, queryId, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10598,10601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10598,10601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":366,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11076,11079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11076,11079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":395,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":395,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":449,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":449,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":468,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":468,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13897,13900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13897,13900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'shareOnSMS' is assigned a value but never used.","line":478,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":478,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":824,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":824,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31516,31519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31516,31519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":30,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { Suspense, useEffect, useRef, useState } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport toast from \"react-hot-toast\";\nimport dynamic from \"next/dynamic\";\nimport { getCurrentUser } from \"@/lib/auth\";\n\nconst Barcode = dynamic(() => import(\"react-barcode\"), { \n  ssr: false,\n  loading: () => <p>Loading Barcode...</p>\n});\nimport { QRCodeSVG } from \"qrcode.react\";\nimport { hasPermission } from \"@/lib/hasPermission\";\nimport { PERMISSIONS } from \"@/lib/permissions\";\n\ntype Account = { id: string; name: string };\ntype Item = {\n  id: string;\n  name: string;\n  description?: string;\n  availableQty: number;\n  barcode?: string;\n};\ntype Row = {\n  itemId: string;\n  name: string;\n  description: string;\n  availableQty: number;\n  qty: number | \"\";\n  rate: number | \"\";\n};\n\ntype SalesInvoice = {\n  id: string;\n  invoiceNo: string;\n  date: string;\n  customerId: string;\n  customer?: { name: string };\n  total: number;\n  items: Array<{ item: { name: string; description?: string }; qty: number; rate: number }>;\n  driverName?: string;\n  vehicleNo?: string;\n};\n\ntype TaxConfig = {\n  id: string;\n  taxType: string;\n  taxCode: string;\n  taxRate: number;\n  description?: string;\n};\n\nfunction SalesInvoiceContent() {\n  const searchParams = useSearchParams();\n  const queryId = searchParams.get(\"id\");\n  const today = new Date().toISOString().slice(0, 10);\n  const user = getCurrentUser();\n\n  if (!hasPermission(user, PERMISSIONS.CREATE_SALES_INVOICE)) {\n    return <div>Access Denied</div>;\n  }\n\n  const [customers, setCustomers] = useState<Account[]>([]);\n  const [items, setItems] = useState<Item[]>([]);\n  const [invoices, setInvoices] = useState<SalesInvoice[]>([]);\n  const [showList, setShowList] = useState(false);\n  const [showForm, setShowForm] = useState(true);\n  const [editing, setEditing] = useState<SalesInvoice | null>(null);\n\n  const [invoiceNo, setInvoiceNo] = useState(\"\");\n  const [customerId, setCustomerId] = useState(\"\");\n  const [customerName, setCustomerName] = useState(\"\");\n  const [date, setDate] = useState(today);\n  const [location, setLocation] = useState(\"MAIN\");\n  const [driverName, setDriverName] = useState(\"\");\n  const [vehicleNo, setVehicleNo] = useState(\"\");\n  const [rows, setRows] = useState<Row[]>([{\n    itemId: \"\", name: \"\", description: \"\", availableQty: 0, qty: \"\", rate: \"\",\n  }]);\n  const [freight, setFreight] = useState<number | \"\">(\"\");\n  const [saving, setSaving] = useState(false);\n  const [preview, setPreview] = useState(false);\n  const [savedInvoice, setSavedInvoice] = useState<any>(null);\n  const [sendingEmail, setSendingEmail] = useState(false);\n  const [previewMode, setPreviewMode] = useState<\"INVOICE\" | \"DELIVERY\">(\"INVOICE\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [scanCode, setScanCode] = useState(\"\");\n  const [origin, setOrigin] = useState(\"\");\n\n  useEffect(() => {\n    setOrigin(window.location.origin);\n  }, []);\n\n  // Tax states\n  const [applyTax, setApplyTax] = useState(false);\n  const [selectedTaxId, setSelectedTaxId] = useState(\"\");\n  const [taxes, setTaxes] = useState<TaxConfig[]>([]);\n\n  // Keyboard shortcuts - F7: Clear date/customer, F8: Query dialog\n  useEffect(() => {\n    function handleKeyPress(e: KeyboardEvent) {\n      if (e.code === \"F7\" || e.key === \"F7\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !preview) {\n          setDate(today);\n          setCustomerId(\"\");\n          setCustomerName(\"\");\n        }\n      }\n      if (e.code === \"F8\" || e.key === \"F8\") {\n        e.preventDefault();\n        e.stopPropagation();\n        if (showForm && !preview) {\n          const query = prompt(\"Enter search query (Invoice No, Customer Name, etc.):\");\n          if (query) {\n            const foundCustomer = customers.find(c =>\n              c.name.toLowerCase().includes(query.toLowerCase())\n            );\n            if (foundCustomer) {\n              setCustomerId(foundCustomer.id);\n              setCustomerName(foundCustomer.name);\n            } else {\n              toast.error(`No customer found matching \"${query}\"`);\n            }\n          }\n        }\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyPress, true);\n    return () => document.removeEventListener(\"keydown\", handleKeyPress, true);\n  }, [today, showForm, preview, customers]);\n\n  useEffect(() => {\n    if (!user || !user.id) return;\n    loadInvoices();\n    fetch(\"/api/accounts\", {\n      headers: { \"x-user-role\": user.role },\n    })\n      .then(r => r.json())\n      .then(d => {\n        const list = Array.isArray(d) ? d : d.accounts || [];\n        setCustomers(list.filter((a: any) => a.partyType === \"CUSTOMER\"));\n      });\n\n    fetch(\"/api/stock-available-for-sale\")\n      .then(r => r.json())\n      .then(d => setItems(Array.isArray(d) ? d : []));\n\n    // Load tax configurations\n    fetch(\"/api/tax-configuration\")\n      .then(r => r.json())\n      .then(d => setTaxes(Array.isArray(d) ? d : []))\n      .catch(err => console.log(\"Tax config error:\", err));\n\n    fetch(\"/api/sales-invoice\", {\n      headers: {\n        \"x-user-role\": user.role || \"\",\n        \"x-user-id\": user.id || \"\"\n      }\n    })\n      .then(r => {\n        if (r.status === 403) throw new Error(\"No Permission\");\n        return r.json();\n      })\n      .then(d => {\n        if (d?.nextNo) setInvoiceNo(d.nextNo);\n      })\n      .catch(err => console.log(\"Access Denied or Error\"));\n  }, []);\n\n  useEffect(() => {\n    if (!queryId || !user) return;\n    fetch(`/api/sales-invoice?id=${queryId}`, {\n      headers: {\n        \"x-user-role\": user.role || \"\",\n        \"x-user-id\": user.id || \"\"\n      }\n    })\n      .then(r => r.json())\n      .then(inv => {\n        if (inv && !inv.error) {\n          setSavedInvoice(inv);\n          setInvoiceNo(inv.invoiceNo || invoiceNo);\n          setCustomerName(inv.customer?.name || inv.customerName || \"\");\n          setPreview(true);\n          setShowForm(true);\n          setShowList(false);\n        }\n      })\n      .catch(e => console.error(\"Error loading sales invoice:\", e));\n  }, [queryId, user]);\n\n  async function loadInvoices() {\n    try {\n      const res = await fetch(\"/api/sales-invoice\", {\n        headers: {\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        }\n      });\n      const data = await res.json();\n      if (data?.invoices) {\n        setInvoices(data.invoices);\n      }\n    } catch (e) {\n      console.error(\"Load invoices error:\", e);\n    }\n  }\n\n  function handleScan(e: React.KeyboardEvent<HTMLInputElement>) {\n    if (e.key === \"Enter\") {\n      e.preventDefault(); // Prevent form submission\n      if (!scanCode) return;\n\n      const found = items.find(\n        (i) => i.barcode === scanCode || i.id === scanCode // Fallback to ID if needed\n      );\n\n      if (found) {\n        // Add to rows\n        const newRow: Row = {\n          itemId: found.id,\n          name: found.name,\n          description: found.description || \"\",\n          availableQty: found.availableQty,\n          qty: 1,\n          rate: \"\", // or fetch default rate if available\n        };\n\n        // If the last row is empty, replace it. Otherwise append.\n        const lastRow = rows[rows.length - 1];\n        if (!lastRow.itemId) {\n          const newRows = [...rows];\n          newRows[rows.length - 1] = newRow;\n          setRows(newRows);\n        } else {\n          setRows([...rows, newRow]);\n        }\n\n        toast.success(`Added ${found.name}`);\n        setScanCode(\"\");\n      } else {\n        toast.error(\"Item not found\");\n        setScanCode(\"\");\n      }\n    }\n  }\n\n  function addRow() {\n    setRows(r => [\n      ...r,\n      { itemId: \"\", name: \"\", description: \"\", availableQty: 0, qty: \"\", rate: \"\" },\n    ]);\n  }\n\n  function selectItem(index: number, itemId: string) {\n    const item = items.find(i => i.id === itemId);\n    if (!item) return;\n    const copy = [...rows];\n    copy[index] = {\n      ...copy[index],\n      itemId: item.id,\n      name: item.name,\n      description: item.description || \"\",\n      availableQty: item.availableQty,\n      qty: \"\",\n    };\n    setRows(copy);\n  }\n\n  function updateRow(index: number, key: \"qty\" | \"rate\", val: string) {\n    const copy = [...rows];\n    const num = val === \"\" ? \"\" : Number(val);\n    if (key === \"qty\" && num !== \"\" && num > copy[index].availableQty) return;\n    copy[index][key] = num;\n    setRows(copy);\n  }\n\n  const total = rows.reduce((s, r) => s + (Number(r.qty) * Number(r.rate) || 0), 0);\n  const selectedTax = taxes.find(t => t.id === selectedTaxId);\n  const taxAmount = applyTax && selectedTax ? (total * (selectedTax.taxRate / 100)) : 0;\n  const netTotal = total + (freight === \"\" ? 0 : Number(freight)) + taxAmount;\n\n  const filteredInvoices = invoices.filter(inv => {\n    const term = searchTerm.toLowerCase();\n    return (\n      inv.invoiceNo.toLowerCase().includes(term) ||\n      (inv.customer?.name || \"\").toLowerCase().includes(term) ||\n      inv.total.toString().includes(term)\n    );\n  });\n\n  async function saveInvoice() {\n    const clean = rows.filter(r => r.itemId && r.qty && r.rate);\n    if (!customerId || !clean.length) {\n      toast.error(\"Customer aur items zaroori hain\");\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const method = editing ? \"PUT\" : \"POST\";\n      const baseBody = {\n        invoiceNo,\n        customerId,\n        date,\n        location,\n        driverName,\n        vehicleNo,\n        freight: freight || 0,\n        items: clean.map(r => ({ itemId: r.itemId, qty: Number(r.qty), rate: Number(r.rate) })),\n        applyTax,\n        taxConfigId: applyTax ? selectedTaxId : null,\n      };\n      const body = editing ? { id: editing.id, ...baseBody } : baseBody;\n\n      const res = await fetch(\"/api/sales-invoice\", {\n        method,\n        credentials: \"include\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        },\n        body: JSON.stringify(body),\n      });\n\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || \"Save failed\");\n      }\n\n      const data = await res.json();\n\n      if (data.invoice) {\n        setSavedInvoice(data.invoice);\n        setInvoiceNo(data.invoiceNo || invoiceNo);\n        setCustomerName(data.invoice.customer?.name || customerName);\n      }\n\n      setPreview(true);\n      await loadInvoices();\n      if (editing) {\n        setEditing(null);\n        setShowForm(false);\n        setShowList(true);\n      }\n      toast.success(\"Invoice saved successfully!\");\n    } catch (e: any) {\n      toast.error(\"Saving failed: \" + (e.message || \"Unknown error\"));\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  function startEdit(inv: SalesInvoice) {\n    setEditing(inv);\n    setInvoiceNo(inv.invoiceNo);\n    setCustomerId(inv.customerId);\n    setCustomerName(inv.customer?.name || \"\");\n    setDate(new Date(inv.date).toISOString().slice(0, 10));\n    setDriverName(inv.driverName || \"\");\n    setVehicleNo(inv.vehicleNo || \"\");\n    setRows(inv.items.map((it: any) => ({\n      itemId: it.itemId || \"\",\n      name: it.item?.name || \"\",\n      description: it.item?.description || \"\",\n      availableQty: it.qty || 0,\n      qty: it.qty.toString(),\n      rate: it.rate.toString(),\n    })));\n    setShowForm(true);\n    setShowList(false);\n  }\n\n  async function deleteInvoice(id: string) {\n    if (!confirm(\"Are you sure you want to delete this invoice?\")) return;\n    try {\n      const res = await fetch(`/api/sales-invoice?id=${id}`, {\n        method: \"DELETE\",\n        headers: {\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\"\n        },\n      });\n      if (res.ok) {\n        toast.success(\"Invoice deleted successfully\");\n        await loadInvoices();\n      } else {\n        const err = await res.json();\n        toast.error(err.error || \"Delete failed\");\n      }\n    } catch (e) {\n      toast.error(\"Delete failed\");\n    }\n  }\n\n  function resetForm() {\n    setEditing(null);\n    setCustomerId(\"\");\n    setCustomerName(\"\");\n    setDate(today);\n    setLocation(\"MAIN\");\n    setDriverName(\"\");\n    setVehicleNo(\"\");\n    setFreight(\"\");\n    setRows([{ itemId: \"\", name: \"\", description: \"\", availableQty: 0, qty: \"\", rate: \"\" }]);\n    setApplyTax(false);\n    setSelectedTaxId(\"\");\n    setPreview(false);\n  }\n\n  async function sendInvoiceEmail() {\n    if (!savedInvoice || !savedInvoice.id) {\n      alert(\"Please save the invoice first\");\n      return;\n    }\n\n    const customerEmail = prompt(\"Enter customer email address:\");\n    if (!customerEmail || !customerEmail.includes(\"@\")) {\n      alert(\"Please enter a valid email address\");\n      return;\n    }\n\n    setSendingEmail(true);\n    try {\n      const res = await fetch(\"/api/email/send\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-user-role\": user?.role || \"\",\n          \"x-user-id\": user?.id || \"\",\n        },\n        body: JSON.stringify({\n          type: \"sales-invoice\",\n          invoiceId: savedInvoice.id,\n          to: customerEmail,\n        }),\n      });\n\n      const data = await res.json();\n      if (res.ok) {\n        alert(\"✅ Email sent successfully!\");\n      } else {\n        alert(`❌ Failed to send email: ${data.error || \"Unknown error\"}`);\n      }\n    } catch (error) {\n      alert(\"❌ Failed to send email. Please check email configuration.\");\n    } finally {\n      setSendingEmail(false);\n    }\n  }\n\n  const shareOnWhatsApp = () => {\n    if (!savedInvoice) {\n      toast.error(\"Please save the invoice first\");\n      return;\n    }\n\n    // Construct a message\n    let message = `*Sales Invoice: ${savedInvoice.invoiceNo}*\\n`;\n    message += `Date: ${new Date(savedInvoice.date).toLocaleDateString()}\\n`;\n    message += `Customer: ${customerName}\\n\\n`;\n    message += `*Items:*\\n`;\n\n    savedInvoice.items.forEach((item: any, index: number) => {\n      message += `${index + 1}. ${item.item.name} x ${item.qty} @ ${item.rate} = ${(item.qty * item.rate).toLocaleString()}\\n`;\n    });\n\n    message += `\\n*Total Amount: ${savedInvoice.total.toLocaleString()}*`;\n\n    const url = `https://wa.me/?text=${encodeURIComponent(message)}`;\n    window.open(url, '_blank');\n  };\n\n  const shareOnSMS = () => {\n    if (!savedInvoice) {\n      toast.error(\"Please save the invoice first\");\n      return;\n    }\n\n    // Construct a message (shorter for SMS)\n    let message = `Invoice: ${savedInvoice.invoiceNo}\\n`;\n    message += `Date: ${new Date(savedInvoice.date).toLocaleDateString()}\\n`;\n    message += `Customer: ${customerName}\\n`;\n    message += `Total: ${savedInvoice.total.toLocaleString()}`;\n\n    const url = `sms:?body=${encodeURIComponent(message)}`;\n    window.open(url, '_blank');\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-2xl font-bold\">Sales Invoice</h1>\n        <div className=\"flex gap-2\">\n          <button\n            onClick={() => { setShowList(!showList); setShowForm(!showForm); setEditing(null); }}\n            className=\"bg-gray-600 text-white px-4 py-2 rounded\"\n          >\n            {showList ? \"Hide List\" : \"Show List\"}\n          </button>\n          <button\n            onClick={() => { setShowForm(true); setShowList(false); resetForm(); loadInvoices(); }}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          >\n            + New Invoice\n          </button>\n        </div>\n      </div>\n\n      {/* LIST VIEW */}\n      {showList && (\n        <div className=\"bg-white border rounded overflow-hidden\">\n          {/* <div className=\"p-4 border-b bg-gray-50\">\n            <input\n              type=\"text\"\n              placeholder=\"Search by Invoice No, Customer, Amount...\"\n              className=\"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n            />\n          </div> */}\n          <table className=\"w-full text-sm\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-3 text-left\">Invoice No</th>\n                <th className=\"p-3 text-left\">Date</th>\n                <th className=\"p-3 text-left\">Customer</th>\n                <th className=\"p-3 text-right\">Total</th>\n                <th className=\"p-3 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredInvoices.length === 0 ? (\n                <tr>\n                  <td colSpan={5} className=\"p-4 text-center text-gray-400\">No invoices found</td>\n                </tr>\n              ) : (\n                filteredInvoices.map(inv => (\n                  <tr key={inv.id} className=\"border-t hover:bg-gray-50\">\n                    <td className=\"p-3 font-bold\">{inv.invoiceNo}</td>\n                    <td className=\"p-3\">{new Date(inv.date).toLocaleDateString()}</td>\n                    <td className=\"p-3\">{inv.customer?.name || \"N/A\"}</td>\n                    <td className=\"p-3 text-right\">{inv.total.toLocaleString()}</td>\n                    <td className=\"p-3 text-center space-x-2\">\n                      <button\n                        onClick={() => startEdit(inv)}\n                        className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => deleteInvoice(inv.id)}\n                        className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                      >\n                        Delete\n                      </button>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* FORM */}\n      {showForm && (\n        <>\n          <div className=\"flex flex-col md:flex-row justify-between items-center bg-gray-50 p-4 border rounded print:hidden gap-4\">\n            <div>\n              <h1 className=\"text-2xl font-bold\">Sales Invoice ({invoiceNo})</h1>\n              {(invoiceNo && invoiceNo !== \"SI-1\") && (\n                 <div className=\"mt-1\">\n                   <Barcode value={invoiceNo} width={1} height={30} fontSize={12} displayValue={true} />\n                 </div>\n              )}\n            </div>\n            {!preview ? (\n              <div className=\"flex flex-wrap gap-2\">\n                <button onClick={saveInvoice} disabled={saving} className=\"bg-blue-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  {saving ? \"Saving...\" : editing ? \"Update Invoice\" : \"Save & Preview\"}\n                </button>\n                <button onClick={() => { setShowForm(false); setEditing(null); resetForm(); }} className=\"bg-gray-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  Cancel\n                </button>\n              </div>\n            ) : (\n              <div className=\"flex flex-wrap gap-2\">\n                <button onClick={() => window.print()} className=\"bg-green-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  Print\n                </button>\n                <button\n                  onClick={() => setPreviewMode(prev => prev === \"INVOICE\" ? \"DELIVERY\" : \"INVOICE\")}\n                  className=\"bg-purple-600 text-white px-6 py-2 rounded flex-1 md:flex-none\"\n                >\n                  {previewMode === \"DELIVERY\" ? \"Show Rates\" : \"Hide Rates\"}\n                </button>\n                <button\n                  onClick={sendInvoiceEmail}\n                  disabled={sendingEmail}\n                  className=\"bg-blue-600 text-white px-6 py-2 rounded disabled:bg-gray-400 flex-1 md:flex-none\"\n                >\n                  {sendingEmail ? \"Sending...\" : \"📧 Email\"}\n                </button>\n                <button\n                  onClick={shareOnWhatsApp}\n                  className=\"bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 flex-1 md:flex-none\"\n                >\n                  📱 WhatsApp\n                </button>\n                <button onClick={() => setPreview(false)} className=\"bg-yellow-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  Edit\n                </button>\n                <button onClick={() => { setPreview(false); resetForm(); }} className=\"bg-gray-600 text-white px-6 py-2 rounded flex-1 md:flex-none\">\n                  New Invoice\n                </button>\n              </div>\n            )}\n          </div>\n\n          {!preview && (\n            <div className=\"bg-white border p-6 rounded space-y-4\">\n              <div className=\"mb-2 text-xs text-gray-500 italic\">\n                💡 Keyboard Shortcuts: <strong>F7</strong> = Clear Date & Customer | <strong>F8</strong> = Search Query\n              </div>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n                <input value={invoiceNo} readOnly className=\"border p-2 bg-gray-100\" />\n                <div>\n                  <label className=\"text-xs font-bold\">Customer (F7: Clear, F8: Query)</label>\n                  <select className=\"border p-2 w-full\" value={customerId} onChange={e => {\n                    setCustomerId(e.target.value);\n                    setCustomerName(customers.find(c => c.id === e.target.value)?.name || \"\");\n                  }}>\n                    <option value=\"\">Select Customer</option>\n                    {customers.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}\n                  </select>\n                </div>\n                <div>\n                  <label className=\"text-xs font-bold\">Date (F7: Clear)</label>\n                  <input type=\"date\" className=\"border p-2 w-full\" value={date} onChange={e => setDate(e.target.value)} />\n                </div>\n                <div className=\"flex flex-col\">\n                  <label className=\"text-xs font-bold\">Location</label>\n                  <select className=\"border p-2\" value={location} onChange={e => setLocation(e.target.value)}>\n                    <option value=\"MAIN\">Main</option>\n                    <option value=\"SHOP\">Shop</option>\n                  </select>\n                </div>\n                <div className=\"flex flex-col\">\n                  <label className=\"text-xs font-bold\">Driver Name</label>\n                  <input type=\"text\" className=\"border p-2\" value={driverName} onChange={e => setDriverName(e.target.value)} placeholder=\"Driver Name\" />\n                </div>\n                <div className=\"flex flex-col\">\n                  <label className=\"text-xs font-bold\">Vehicle No</label>\n                  <input type=\"text\" className=\"border p-2\" value={vehicleNo} onChange={e => setVehicleNo(e.target.value)} placeholder=\"Vehicle No\" />\n                </div>\n              </div>\n\n              {/* 📟 BARCODE SCANNER SECTION */}\n              <div className=\"flex items-center gap-4 bg-blue-50 p-4 rounded border border-blue-200 shadow-sm\">\n                <span className=\"text-3xl\">📟</span>\n                <div className=\"flex-1\">\n                  <label className=\"text-xs font-bold text-blue-800 block mb-1\">SCAN BARCODE / SKU TO ADD ITEM</label>\n                  <input\n                    value={scanCode}\n                    onChange={(e) => setScanCode(e.target.value)}\n                    onKeyDown={handleScan}\n                    placeholder=\"Click here and scan barcode...\"\n                    className=\"border-2 border-blue-400 p-2 w-full rounded text-lg font-mono focus:ring-4 focus:ring-blue-200 outline-none transition-all\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full border mt-4 text-sm min-w-[600px]\">\n                  <thead className=\"bg-gray-100\">\n                    <tr>\n                      <th className=\"border p-2 text-left\">Item</th>\n                      <th className=\"border p-2 w-24\">Qty</th>\n                      <th className=\"border p-2 w-32\">Rate</th>\n                      <th className=\"border p-2 w-32 text-right\">Amount</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {rows.map((r, i) => (\n                      <tr key={i}>\n                        <td className=\"border p-2\">\n                          <select className=\"w-full\" value={r.itemId} onChange={e => selectItem(i, e.target.value)}>\n                            <option value=\"\">Select Item</option>\n                            {items.map(it => (\n                              <option key={it.id} value={it.id}>\n                                {it.name} ({it.description}) — Stock {it.availableQty}\n                              </option>\n                            ))}\n                          </select>\n                        </td>\n                        <td className=\"border p-2\">\n                          <input type=\"number\" value={r.qty} className=\"w-full text-center\" onChange={e => updateRow(i, \"qty\", e.target.value)} />\n                        </td>\n                        <td className=\"border p-2\">\n                          <input type=\"number\" value={r.rate} className=\"w-full text-center\" onChange={e => updateRow(i, \"rate\", e.target.value)} />\n                        </td>\n                        <td className=\"border p-2 text-right\">\n                          {(Number(r.qty) * Number(r.rate) || 0).toLocaleString()}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n              <button onClick={addRow} className=\"bg-gray-100 px-4 py-1 rounded\">+ Add Row</button>\n\n              <div className=\"flex justify-end pt-4\">\n                <div className=\"w-full md:w-64 space-y-2\">\n                  <div className=\"flex justify-between\"><span>Total</span><span>{total.toLocaleString()}</span></div>\n                  <div className=\"flex justify-between items-center\">\n                    <span>Freight</span>\n                    <input type=\"number\" value={freight} onChange={e => setFreight(e.target.value === \"\" ? \"\" : Number(e.target.value))} className=\"border w-32 text-right p-1\" />\n                  </div>\n\n                  {/* Tax Section */}\n                  <div className=\"border-t pt-2 space-y-2\">\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        setApplyTax(!applyTax);\n                        if (!applyTax) setSelectedTaxId(\"\");\n                      }}\n                      className={`w-full py-1 px-2 rounded font-semibold text-sm ${applyTax ? \"bg-blue-600 text-white\" : \"bg-gray-200 text-gray-700\"\n                        }`}\n                    >\n                      {applyTax ? \"✓ Tax Applied\" : \"+ Add Tax\"}\n                    </button>\n\n                    {applyTax && (\n                      <div className=\"space-y-2\">\n                        <select\n                          value={selectedTaxId}\n                          onChange={e => setSelectedTaxId(e.target.value)}\n                          className=\"w-full border p-1 text-sm\"\n                        >\n                          <option value=\"\">Select Tax</option>\n                          {taxes.map(tax => (\n                            <option key={tax.id} value={tax.id}>\n                              {tax.taxType} ({tax.taxCode}) - {tax.taxRate}%\n                            </option>\n                          ))}\n                        </select>\n                        {selectedTax && (\n                          <div className=\"flex justify-between text-sm text-blue-600\">\n                            <span>{selectedTax.taxType} ({selectedTax.taxRate}%)</span>\n                            <span>{taxAmount.toLocaleString()}</span>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"flex justify-between font-bold border-t pt-2 text-lg\"><span>Net Total</span><span>{netTotal.toLocaleString()}</span></div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* PREVIEW */}\n          {preview && (\n            <div className=\"invoice-print bg-white p-10 border shadow-lg mx-auto print:border-0 print:p-0 print:shadow-none min-h-[297mm]\">\n              <div className=\"flex justify-between items-start border-b-2 border-black pb-4 mb-6\">\n                <div>\n                  <h1 className=\"text-4xl font-black\">{previewMode === \"DELIVERY\" ? \"DELIVERY NOTE\" : \"SALES INVOICE\"}</h1>\n                  <p className=\"text-gray-600\">US Traders</p>\n                </div>\n                <div className=\"text-right\">\n                  <p><b>Invoice #:</b> {savedInvoice?.invoiceNo || invoiceNo}</p>\n                  <p><b>Date:</b> {savedInvoice?.date ? new Date(savedInvoice.date).toISOString().slice(0, 10) : date}</p>\n                  <p><b>Location:</b> {location}</p>\n                  {(savedInvoice?.invoiceNo || invoiceNo) && (\n                    <div className=\"flex flex-col items-end gap-2 mt-2\">\n                      <div className=\"text-center\">\n                        <Barcode value={savedInvoice?.invoiceNo || invoiceNo} width={1.5} height={40} fontSize={14} displayValue={false} />\n                        <span className=\"text-[10px] font-bold\">INV ID: {savedInvoice?.invoiceNo || invoiceNo}</span>\n                      </div>\n\n                      {origin && (\n                        <div className=\"flex flex-col items-center mt-2 border-t pt-2\">\n                          <QRCodeSVG value={`${origin}/view/sales-invoice?id=${savedInvoice?.id || queryId}`} size={80} />\n                          <span className=\"text-[10px] font-bold mt-1 bg-black text-white px-1\">SCAN FOR ONLINE BILL</span>\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"mb-8 grid grid-cols-2\">\n                <div>\n                  <h3 className=\"text-gray-500 uppercase text-xs font-bold mb-1\">Bill To:</h3>\n                  <p className=\"text-xl font-bold\">{savedInvoice?.customer?.name || customerName || \"Not Selected\"}</p>\n                </div>\n                <div className=\"text-right\">\n                  {(savedInvoice?.driverName || driverName) && (\n                    <p><b>Driver:</b> {savedInvoice?.driverName || driverName}</p>\n                  )}\n                  {(savedInvoice?.vehicleNo || vehicleNo) && (\n                    <p><b>Vehicle:</b> {savedInvoice?.vehicleNo || vehicleNo}</p>\n                  )}\n                </div>\n              </div>\n\n              <table className=\"w-full border-collapse mb-8\">\n                <thead>\n                  <tr className=\"border-y-2 border-black\">\n                    <th className=\"py-2 text-left\">Description</th>\n                    <th className=\"py-2 text-center w-24\">Qty</th>\n                    {previewMode === \"INVOICE\" && <th className=\"py-2 text-right w-32\">Rate</th>}\n                    {previewMode === \"INVOICE\" && <th className=\"py-2 text-right w-32\">Amount</th>}\n                  </tr>\n                </thead>\n                <tbody>\n                  {(savedInvoice?.items || rows.filter(r => r.itemId)).map((r: any, i: number) => {\n                    const itemName = r.item?.name || r.name || \"Unknown\";\n                    const itemDesc = r.item?.description || r.description || \"\";\n                    const qty = r.qty || 0;\n                    const rate = r.rate || 0;\n                    const amount = qty * rate;\n\n                    return (\n                      <tr key={i} className=\"border-b border-gray-200\">\n                        <td className=\"py-3\">\n                          <p className=\"font-bold\">{itemName}</p>\n                          {itemDesc && <p className=\"text-sm text-gray-600\">{itemDesc}</p>}\n                        </td>\n                        <td className=\"py-3 text-center\">{qty}</td>\n                        {previewMode === \"INVOICE\" && <td className=\"py-3 text-right\">{Number(rate).toLocaleString()}</td>}\n                        {previewMode === \"INVOICE\" && <td className=\"py-3 text-right font-semibold\">{amount.toLocaleString()}</td>}\n                      </tr>\n                    );\n                  })}\n                </tbody>\n              </table>\n\n              {previewMode === \"INVOICE\" && (\n                <div className=\"flex justify-end\">\n                  <div className=\"w-72 space-y-2\">\n                    <div className=\"flex justify-between\">\n                      <span>Subtotal:</span>\n                      <span>{total.toLocaleString()}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>Freight:</span>\n                      <span>{Number(freight || 0).toLocaleString()}</span>\n                    </div>\n                    {selectedTax && (\n                      <div className=\"flex justify-between\">\n                        <span>{selectedTax.taxType.toUpperCase()} ({selectedTax.taxRate}%):</span>\n                        <span>{taxAmount.toLocaleString()}</span>\n                      </div>\n                    )}\n                    <div className=\"flex justify-between border-t-2 border-black pt-2 text-xl font-bold\">\n                      <span>Net Total:</span>\n                      <span>{netTotal.toLocaleString()}</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              <div>\n                <span className=\"font-bold\">Prepared by</span>\n                <span className=\"w-72\">_____________________</span>\n              </div>\n              <div>\n                <span className=\"font-bold\">Recieved by</span>\n                <span className=\"w-72\">_____________________</span>\n              </div>\n\n              <div className=\"mt-20 border-t pt-4 text-center text-gray-400 text-sm\">\n                Thank you for your business!\n              </div>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function SalesInvoicePage() {\n  return (\n    <Suspense fallback={<div className=\"p-4 text-center\">Loading Invoice...</div>}>\n      <SalesInvoiceContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\stock-rate\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'headers' and 'loadRates'. Either include them or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [headers, loadRates]","fix":{"range":[1089,1091],"text":"[headers, loadRates]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":111,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":111,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport toast from \"react-hot-toast\";\n\ntype Item = {\n  id: string;\n  name: string;\n  description?: string;\n};\n\ntype Rate = {\n  id: string;\n  rate: number;\n  date: string;\n  item: Item;\n  itemId: string;\n};\n\nexport default function StockRatePage() {\n  const today = new Date().toISOString().slice(0, 10);\n\n  const [items, setItems] = useState<Item[]>([]);\n  const [rates, setRates] = useState<Rate[]>([]);\n  const [editingId, setEditingId] = useState<string | null>(null);\n\n  const [itemId, setItemId] = useState(\"\");\n  const [rate, setRate] = useState(\"\");\n  const [date, setDate] = useState(today);\n\n  const headers = {\n    \"Content-Type\": \"application/json\",\n    \"x-user-role\": \"ADMIN\", // 🔴 REQUIRED\n  };\n\n  function loadRates() {\n    fetch(\"/api/stock-rate\", { headers })\n      .then(r => r.json())\n      .then(d => setRates(Array.isArray(d) ? d : []));\n  }\n\n  useEffect(() => {\n    fetch(\"/api/items-new\", { headers })\n      .then(r => r.json())\n      .then(d => setItems(Array.isArray(d) ? d : []));\n\n    loadRates();\n  }, []);\n\n  async function saveRate() {\n    if (!itemId || !rate) {\n      toast.error(\"Item aur rate zaroori hai\");\n      return;\n    }\n\n    const method = editingId ? \"PUT\" : \"POST\";\n    const body = editingId \n      ? { id: editingId, itemId, rate, date }\n      : { itemId, rate, date };\n\n    const res = await fetch(\"/api/stock-rate\", {\n      method,\n      headers,\n      body: JSON.stringify(body),\n    });\n\n    if (!res.ok) {\n      const err = await res.json();\n      toast.error(err.error || \"Save failed\");\n      return;\n    }\n\n    toast.success(editingId ? \"Rate updated\" : \"Rate saved\");\n    resetForm();\n    loadRates();\n  }\n\n  function handleEdit(r: Rate) {\n    setEditingId(r.id);\n    setItemId(r.itemId);\n    setRate(r.rate.toString());\n    setDate(new Date(r.date).toISOString().slice(0, 10));\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  }\n\n  function resetForm() {\n    setEditingId(null);\n    setItemId(\"\");\n    setRate(\"\");\n    setDate(today);\n  }\n\n  async function handleDelete(id: string) {\n    if (!confirm(\"Are you sure you want to delete this rate?\")) {\n      return;\n    }\n\n    try {\n      const res = await fetch(`/api/stock-rate?id=${id}`, {\n        method: \"DELETE\",\n        headers: { \"x-user-role\": \"ADMIN\" },\n      });\n\n      if (res.ok) {\n        toast.success(\"Rate deleted successfully\");\n        loadRates();\n      } else {\n        const err = await res.json();\n        toast.error(err.error || \"Delete failed\");\n      }\n    } catch (err) {\n      toast.error(\"Delete failed\");\n    }\n  }\n\n  return (\n    <div className=\"p-4 md:p-6 max-w-3xl space-y-6\">\n\n      <h1 className=\"text-xl md:text-2xl font-semibold\">Stock Rate</h1>\n\n      {/* FORM */}\n      <div className=\"border p-4 bg-white space-y-3 rounded-lg shadow-sm\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n          <select\n            className=\"border p-2 w-full\"\n            value={itemId}\n            onChange={e => setItemId(e.target.value)}\n          >\n            <option value=\"\">Select Item</option>\n            {items.map(i => (\n              <option key={i.id} value={i.id}>\n                {i.name} ({i.description})\n              </option>\n            ))}\n          </select>\n\n          <input\n            className=\"border p-2 w-full\"\n            placeholder=\"Rate\"\n            value={rate}\n            onChange={e => setRate(e.target.value)}\n          />\n\n          <input\n            type=\"date\"\n            className=\"border p-2 w-full\"\n            value={date}\n            onChange={e => setDate(e.target.value)}\n          />\n        </div>\n\n        <div className=\"flex gap-2\">\n          <button\n            onClick={saveRate}\n            className=\"bg-blue-600 text-white px-4 py-2 flex-1\"\n          >\n            {editingId ? \"Update Rate\" : \"Save Rate\"}\n          </button>\n          {editingId && (\n            <button\n              onClick={resetForm}\n              className=\"bg-gray-600 text-white px-4 py-2\"\n            >\n              Cancel\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* LIST */}\n      <div className=\"bg-white border rounded overflow-x-auto\">\n        <table className=\"w-full text-sm min-w-[600px]\">\n          <thead className=\"bg-gray-100\">\n            <tr>\n              <th className=\"border p-2 text-left\">Date</th>\n              <th className=\"border p-2 text-left\">Item</th>\n              <th className=\"border p-2 text-right\">Rate</th>\n              <th className=\"border p-2 text-center\">Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {rates.length === 0 ? (\n              <tr>\n                <td colSpan={4} className=\"p-4 text-center text-gray-400\">\n                  No rates found\n                </td>\n              </tr>\n            ) : (\n              rates.map(r => (\n                <tr key={r.id} className=\"border-t hover:bg-gray-50\">\n                  <td className=\"border p-2\">\n                    {new Date(r.date).toLocaleDateString()}\n                  </td>\n                  <td className=\"border p-2\">\n                    {r.item.name} {r.item.description ? `(${r.item.description})` : \"\"}\n                  </td>\n                  <td className=\"border p-2 text-right font-bold\">{r.rate.toLocaleString()}</td>\n                  <td className=\"border p-2 text-center space-x-2\">\n                    <button\n                      onClick={() => handleEdit(r)}\n                      className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\n                    >\n                      Edit\n                    </button>\n                    <button\n                      onClick={() => handleDelete(r.id)}\n                      className=\"text-red-600 hover:text-red-800 font-medium text-sm\"\n                    >\n                      Delete\n                    </button>\n                  </td>\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\stock-report\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalStockValue' is assigned a value but never used.","line":37,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\ntype StockItem = {\n  id: string;\n  name: string;\n  description?: string;\n  availableQty: number;\n  avgRate?: number;\n};\n\nexport default function StockReportPage() {\n  const [items, setItems] = useState<StockItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [search, setSearch] = useState(\"\");\n\n  useEffect(() => {\n    fetch(\"/api/stock-available-for-sale\")\n      .then((r) => r.json())\n      .then((d) => {\n        setItems(Array.isArray(d) ? d : []);\n        setLoading(false);\n      })\n      .catch((e) => {\n        console.error(e);\n        setLoading(false);\n      });\n  }, []);\n\n  const filtered = items.filter((i) =>\n    i.name.toLowerCase().includes(search.toLowerCase()) ||\n    (i.description && i.description.toLowerCase().includes(search.toLowerCase()))\n  );\n\n  const totalStockQty = filtered.reduce((acc, item) => acc + (item.availableQty || 0), 0);\n  const totalStockValue = filtered.reduce((acc, item) => acc + ((item.availableQty || 0) * (item.avgRate || 0)), 0);\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6 max-w-6xl mx-auto\">\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-800\">Stock Report</h1>\n          <p className=\"text-sm text-gray-500\">Current available stock levels</p>\n        </div>\n        <div className=\"w-full md:w-64\">\n          <input\n            type=\"text\"\n            placeholder=\"Search items...\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n        <div className=\"bg-white p-4 rounded-lg shadow border border-gray-100\">\n          <div className=\"text-gray-500 text-sm font-medium\">Total Items</div>\n          <div className=\"text-2xl font-bold text-blue-600\">{filtered.length}</div>\n        </div>\n        <div className=\"bg-white p-4 rounded-lg shadow border border-gray-100\">\n          <div className=\"text-gray-500 text-sm font-medium\">Total Quantity</div>\n          <div className=\"text-2xl font-bold text-green-600\">{totalStockQty.toLocaleString()}</div>\n        </div>\n        {/* Optional: Value Card if rate is available */}\n        {/* <div className=\"bg-white p-4 rounded-lg shadow border border-gray-100\">\n          <div className=\"text-gray-500 text-sm font-medium\">Total Value (Approx)</div>\n          <div className=\"text-2xl font-bold text-purple-600\">{totalStockValue.toLocaleString()}</div>\n        </div> */}\n      </div>\n\n      <div className=\"bg-white border rounded-lg shadow overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-sm min-w-[600px]\">\n            <thead className=\"bg-gray-50 border-b\">\n              <tr>\n                <th className=\"px-4 py-3 text-left font-semibold text-gray-600\">Item Name</th>\n                <th className=\"px-4 py-3 text-left font-semibold text-gray-600\">Description</th>\n                <th className=\"px-4 py-3 text-right font-semibold text-gray-600\">Available Qty</th>\n                <th className=\"px-4 py-3 text-center font-semibold text-gray-600\">Status</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-100\">\n              {loading ? (\n                <tr>\n                  <td colSpan={4} className=\"p-8 text-center text-gray-500\">\n                    Loading stock data...\n                  </td>\n                </tr>\n              ) : filtered.length === 0 ? (\n                <tr>\n                  <td colSpan={4} className=\"p-8 text-center text-gray-400\">\n                    No items found\n                  </td>\n                </tr>\n              ) : (\n                filtered.map((item) => (\n                  <tr key={item.id} className=\"hover:bg-gray-50 transition-colors\">\n                    <td className=\"px-4 py-3 font-medium text-gray-800\">{item.name}</td>\n                    <td className=\"px-4 py-3 text-gray-500\">{item.description || \"-\"}</td>\n                    <td className=\"px-4 py-3 text-right font-bold text-gray-700\">\n                      {item.availableQty}\n                    </td>\n                    <td className=\"px-4 py-3 text-center\">\n                      {item.availableQty <= 0 ? (\n                        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\n                          Out of Stock\n                        </span>\n                      ) : item.availableQty < 10 ? (\n                        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\n                          Low Stock\n                        </span>\n                      ) : (\n                        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                          In Stock\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\tax-configuration\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\test-enter\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\trial-balance\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\users\\UsersPageContent.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\projects\\smart-business-accounts\\app\\dashboard\\users\\UsersPageContent.tsx:56:5\n  54 |   useEffect(() => {\n  55 |     const u = getCurrentUser();\n> 56 |     setCurrentUser(u);\n     |     ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  57 |\n  58 |     if (u?.role === \"ADMIN\") {\n  59 |       reload();","line":56,"column":5,"nodeType":null,"endLine":56,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\nimport { getCurrentUser } from \"@/lib/auth\";\n\ntype User = {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n  active: boolean;\n};\n\ntype CurrentUser = {\n  id: string;\n  role: string;\n  name?: string;\n  email?: string;\n};\n\ntype UserForm = {\n  id: string | null;\n  name: string;\n  email: string;\n  password: string;\n  role: string;\n  active: boolean;\n};\n\nexport default function UsersPage() {\n  const [users, setUsers] = useState<User[]>([]);\n  const [currentUser, setCurrentUser] = useState<CurrentUser | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  const [form, setForm] = useState<UserForm>({\n    id: null,\n    name: \"\",\n    email: \"\",\n    password: \"\",\n    role: \"ACCOUNTANT\",\n    active: true,\n  });\n  const [editing, setEditing] = useState(false);\n\n  function reload() {\n    setLoading(true);\n    fetch(\"/api/users\", {\n      headers: { \"x-user-role\": \"ADMIN\" },\n    })\n      .then((r) => r.json())\n      .then((data) => setUsers(Array.isArray(data) ? data : []))\n      .finally(() => setLoading(false));\n  }\n\n  useEffect(() => {\n    const u = getCurrentUser();\n    setCurrentUser(u);\n\n    if (u?.role === \"ADMIN\") {\n      reload();\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  async function save() {\r\n    if (!form.name || !form.email) return alert(\"Please fill required fields\");\r\n    \r\n    await fetch(\"/api/users\", {\r\n      method: editing ? \"PUT\" : \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"x-user-role\": \"ADMIN\",\r\n      },\r\n      body: JSON.stringify(form),\r\n    });\r\n\r\n    reset();\r\n    reload();\r\n  }\r\n\r\n  async function remove(id: string) {\r\n    if (!confirm(\"Are you sure?\")) return;\r\n    await fetch(`/api/users?id=${id}`, {\r\n      method: \"DELETE\",\r\n      headers: { \"x-user-role\": \"ADMIN\" },\r\n    });\r\n    reload();\r\n  }\r\n\r\n  function edit(u: User) {\n    setForm({ ...u, password: \"\" });\n    setEditing(true);\n  }\n\r\n  function reset() {\r\n    setForm({\r\n      id: null,\r\n      name: \"\",\r\n      email: \"\",\r\n      password: \"\",\r\n      role: \"ACCOUNTANT\",\r\n      active: true,\r\n    });\r\n    setEditing(false);\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!currentUser || currentUser.role !== \"ADMIN\") {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[80vh]\">\r\n        <div className=\"bg-white p-8 rounded-xl shadow-lg border border-red-100 text-center max-w-md\">\r\n          <div className=\"text-red-500 text-5xl mb-4 text-center justify-center flex\">⚠️</div>\r\n          <h2 className=\"text-2xl font-bold text-gray-800\">Access Denied</h2>\r\n          <p className=\"text-gray-500 mt-2\">صرف ADMIN اس پیج تک رسائی حاصل کر سکتا ہے۔</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-8 max-w-6xl mx-auto space-y-8 bg-gray-50 min-h-screen\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-3xl font-extrabold text-gray-900\">User Management</h1>\r\n        <span className=\"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium\">\r\n          Admin Portal\r\n        </span>\r\n      </div>\r\n\r\n      {/* Form Card */}\r\n      <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-200\">\r\n        <h2 className=\"text-lg font-semibold mb-4 text-gray-700\">\r\n          {editing ? \"Edit User Details\" : \"Create New User\"}\r\n        </h2>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n          <input\r\n            placeholder=\"Full Name\"\r\n            className=\"border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-all\"\r\n            value={form.name}\r\n            onChange={(e) => setForm({ ...form, name: e.target.value })}\r\n          />\r\n          <input\r\n            placeholder=\"Email Address\"\r\n            className=\"border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-all\"\r\n            value={form.email}\r\n            onChange={(e) => setForm({ ...form, email: e.target.value })}\r\n          />\r\n          <input\r\n            type=\"password\"\r\n            placeholder=\"Password\"\r\n            className=\"border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-all\"\r\n            value={form.password}\r\n            onChange={(e) => setForm({ ...form, password: e.target.value })}\r\n          />\r\n          <select\r\n            className=\"border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-all bg-white\"\r\n            value={form.role}\r\n            onChange={(e) => setForm({ ...form, role: e.target.value })}\r\n          >\r\n            <option value=\"ADMIN\">Admin</option>\r\n            <option value=\"ACCOUNTANT\">Accountant</option>\r\n            <option value=\"VIEWER\">Viewer</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div className=\"mt-4 flex gap-2\">\r\n          <button\r\n            onClick={save}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-medium transition-colors\"\r\n          >\r\n            {editing ? \"Update User\" : \"Add User\"}\r\n          </button>\r\n          {editing && (\r\n            <button\r\n              onClick={reset}\r\n              className=\"bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-2.5 rounded-lg font-medium transition-colors\"\r\n            >\r\n              Cancel\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Users Table */}\r\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\r\n        <table className=\"w-full text-left border-collapse\">\r\n          <thead>\r\n            <tr className=\"bg-gray-50 border-b border-gray-200\">\r\n              <th className=\"p-4 font-semibold text-gray-600\">Name</th>\r\n              <th className=\"p-4 font-semibold text-gray-600\">Email</th>\r\n              <th className=\"p-4 font-semibold text-gray-600\">Role</th>\r\n              <th className=\"p-4 font-semibold text-gray-600\">Status</th>\r\n              <th className=\"p-4 font-semibold text-gray-600 text-right\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"divide-y divide-gray-100\">\r\n            {users.length > 0 ? (\r\n              users.map((u) => (\r\n                <tr key={u.id} className=\"hover:bg-gray-50 transition-colors\">\r\n                  <td className=\"p-4 text-gray-800 font-medium\">{u.name}</td>\r\n                  <td className=\"p-4 text-gray-600\">{u.email}</td>\r\n                  <td className=\"p-4\">\r\n                    <span className={`px-2.5 py-0.5 rounded-full text-xs font-semibold ${\r\n                      u.role === 'ADMIN' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'\r\n                    }`}>\r\n                      {u.role}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"p-4\">\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <div className={`h-2 w-2 rounded-full ${u.active ? 'bg-green-500' : 'bg-gray-400'}`}></div>\r\n                      <span className=\"text-sm text-gray-600\">{u.active ? \"Active\" : \"Disabled\"}</span>\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"p-4 text-right space-x-3\">\r\n                    <button\r\n                      onClick={() => edit(u)}\r\n                      className=\"text-blue-600 hover:text-blue-800 font-medium text-sm\"\r\n                    >\r\n                      Edit\r\n                    </button>\r\n                    <button\r\n                      onClick={() => remove(u.id)}\r\n                      className=\"text-red-500 hover:text-red-700 font-medium text-sm\"\r\n                    >\r\n                      Delete\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            ) : (\r\n              <tr>\r\n                <td colSpan={5} className=\"p-8 text-center text-gray-500 italic\">\r\n                  No users found.\r\n                </td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\users\\addusers\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\users\\logs\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[358,361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[358,361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1216,1219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1216,1219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { Loader2, AlertCircle, History } from \"lucide-react\"; \r\nimport { hasPermission } from \"@/lib/hasPermission\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\nexport default function ActivityLogsPage() {\r\n  const [logs, setLogs] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchLogs = async () => {\r\n      try {\r\n        const u = getCurrentUser();\r\n\r\n        if (!u || !hasPermission(u, PERMISSIONS.VIEW_LOGS)) {\r\n          setError(\"Access Denied: Logs permission required.\");\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        const response = await fetch(\"/api/logs\", {\r\n          headers: {\r\n            \"x-user-role\": u.role,\r\n            \"x-user-id\": u.id,\r\n          },\r\n        });\r\n\r\n        if (!response.ok) {\r\n          const errorData = await response.json();\r\n          throw new Error(errorData.message || \"ڈیٹا لوڈ کرنے میں ناکامی\");\r\n        }\r\n\r\n        const data = await response.json();\r\n        setLogs(data);\r\n\r\n      } catch (err: any) {\r\n        setError(err.message || \"Error Loading Logs\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchLogs();\r\n  }, []);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex flex-col h-[60vh] items-center justify-center space-y-4\">\r\n        <Loader2 className=\"animate-spin text-blue-600\" size={48} />\r\n        <p className=\"text-gray-500 font-medium italic\">Loading..........</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-4xl mx-auto mt-10 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center text-red-700\">\r\n        <AlertCircle className=\"mr-3 shrink-0\" />\r\n        <p className=\"font-medium\">{error}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto p-8 animate-in fade-in duration-500\">\r\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8\">\r\n        <div>\r\n          <div className=\"flex items-center gap-2 mb-1\">\r\n            <History className=\"text-blue-600\" size={28} />\r\n            <h1 className=\"text-3xl font-extrabold text-gray-900 tracking-tight\">System Activity Logs</h1>\r\n          </div>\r\n          <p className=\"text-gray-500\">All Activity Logs</p>\r\n        </div>\r\n        \r\n        <div className=\"bg-white shadow-sm border px-4 py-2 rounded-lg\">\r\n          <span className=\"text-sm text-gray-500\">Total Entries: </span>\r\n          <span className=\"text-lg font-bold text-blue-600\">{logs.length}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\r\n        <table className=\"w-full text-sm text-right\">\r\n          <thead className=\"bg-gray-50 text-gray-600 font-semibold uppercase tracking-wider\">\r\n            <tr>\r\n              <th className=\"p-4 border-b\">Action</th>\r\n              <th className=\"p-4 border-b\">Details</th>\r\n              <th className=\"p-4 border-b text-center\">User</th>\r\n              <th className=\"p-4 border-b\">Date & Time</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"divide-y divide-gray-100\">\r\n            {logs.length === 0 ? (\r\n              <tr>\r\n                <td colSpan={4} className=\"p-10 text-center text-gray-400 italic\">\r\n                 No Record Found\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              logs.map((log) => (\r\n                <tr key={log.id} className=\"hover:bg-blue-50/30 transition-colors group\">\r\n                  <td className=\"p-4\">\r\n                    <span className=\"bg-gray-100 group-hover:bg-blue-100 text-gray-700 group-hover:text-blue-700 px-3 py-1 rounded-md font-bold text-xs uppercase\">\r\n                      {log.action}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"p-4 text-gray-600 leading-relaxed\">{log.details}</td>\r\n                  <td className=\"p-4 text-center\">\r\n                    <div className=\"flex flex-col items-center\">\r\n                      <span className=\"font-medium text-gray-800\">{log.user?.name || \"System\"}</span>\r\n                      <span className=\"text-[10px] text-gray-400\">{log.user?.email || \"Auto-generated\"}</span>\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"p-4 text-gray-500 font-mono text-xs\">\r\n                    {new Date(log.createdAt).toLocaleString(\"en-PK\", {\r\n                       dateStyle: 'medium',\r\n                       timeStyle: 'short'\r\n                    })}\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\users\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1047,1050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1047,1050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'authorized' is assigned a value but never used.","line":31,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1324,1327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1324,1327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4242,4245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4242,4245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4760,4763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4760,4763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5142,5145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5142,5145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":400,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12227,12230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12227,12230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport toast from \"react-hot-toast\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\n\r\n// Helper: always check permission as string, case-insensitive, and handle both string/object arrays\r\nfunction userHasPerm(\r\n  user: {\r\n    role?: string;\r\n    permissions?: (string | { permission?: string })[];\r\n    rolePermissions?: (string | { permission?: string })[];\r\n  } | null,\r\n  perm: string\r\n) {\r\n  if (!user) return false;\r\n  const p = perm.toUpperCase();\r\n  if (user.role === \"ADMIN\") return true;\r\n  if (user.permissions?.some((x) => (typeof x === \"string\" ? x.toUpperCase() : (x.permission||\"\").toUpperCase()) === p)) return true;\r\n  if (user.rolePermissions?.some((x) => (typeof x === \"string\" ? x.toUpperCase() : (x.permission||\"\").toUpperCase()) === p)) return true;\r\n  return false;\r\n}\r\n\r\ninterface Role {\r\n  role: string;\r\n  permissions: string[];\r\n}\r\n\r\nexport default function UsersMasterPage() {\r\n  const [me, setMe] = useState<any>(null);\r\n  const [authorized, setAuthorized] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // TAB STATE\r\n  const [activeTab, setActiveTab] = useState(\"users\"); // \"users\" یا \"permissions\"\r\n\r\n  // USERS STATE\r\n  const [users, setUsers] = useState<any[]>([]);\r\n  const [editing, setEditing] = useState(false);\r\n  const [userForm, setUserForm] = useState({\r\n    id: null,\r\n    name: \"\",\r\n    email: \"\",\r\n    password: \"\",\r\n    role: \"ACCOUNTANT\",\r\n    active: true,\r\n  });\r\n\r\n  // PERMISSIONS STATE\r\n  const [roles, setRoles] = useState<Role[]>([]);\r\n  const [selectedRole, setSelectedRole] = useState<string>(\"ADMIN\");\r\n  const [rolePermissions, setRolePermissions] = useState<string[]>([]);\r\n  const [savingPerms, setSavingPerms] = useState(false);\r\n\r\n  const availablePermissions = Object.values(PERMISSIONS);\r\n\r\n  // ============ INITIAL LOAD ============\r\n  useEffect(() => {\r\n    const user = getCurrentUser();\r\n    setMe(user);\r\n\r\n    if (!user) {\r\n      setAuthorized(false);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // صرف ADMIN access کر سکتا ہے\r\n    if (user.role === \"ADMIN\") {\r\n      setAuthorized(true);\r\n      loadUsers();\r\n      loadRoles(user);\r\n    } else {\r\n      setAuthorized(false);\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // ============ USERS TAB FUNCTIONS ============\r\n  const loadUsers = async () => {\r\n    try {\r\n      const res = await fetch(\"/api/users\", {\r\n        headers: { \"x-user-role\": \"ADMIN\" },\r\n      });\r\n      const data = await res.json();\r\n      setUsers(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      console.error(\"Load users error:\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const saveUser = async () => {\r\n    if (!userForm.name || !userForm.email)\r\n      return toast.error(\"Name and Email required!\");\r\n\r\n    try {\r\n      const res = await fetch(\"/api/users\", {\r\n        method: editing ? \"PUT\" : \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": \"ADMIN\",\r\n        },\r\n        body: JSON.stringify({\r\n          id: userForm.id,\r\n          name: userForm.name,\r\n          email: userForm.email,\r\n          password: userForm.password,\r\n          role: userForm.role,\r\n          active: userForm.active,\r\n        }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        toast.success(editing ? \"✅ User updated!\" : \"✅ User created!\");\r\n        resetUserForm();\r\n        loadUsers();\r\n      } else {\r\n        toast.error(\"Failed to save user\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Save error:\", err);\r\n      toast.error(\"Error saving user\");\r\n    }\r\n  };\r\n\r\n  const deleteUser = async (id: string) => {\r\n    if (!confirm(\"Are you sure ?\")) return;\r\n    try {\r\n      const res = await fetch(\"/api/users\", {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-role\": \"ADMIN\",\r\n        },\r\n        body: JSON.stringify({ id }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        toast.success(\"✅ User deleted!\");\r\n        loadUsers();\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Delete error:\", err);\r\n    }\r\n  };\r\n\r\n  const editUser = (user: any) => {\r\n    setUserForm({\r\n      id: user.id,\r\n      name: user.name,\r\n      email: user.email,\r\n      password: \"\",\r\n      role: user.role,\r\n      active: user.active,\r\n    });\r\n    setEditing(true);\r\n  };\r\n\r\n  const resetUserForm = () => {\r\n    setUserForm({\r\n      id: null,\r\n      name: \"\",\r\n      email: \"\",\r\n      password: \"\",\r\n      role: \"ACCOUNTANT\",\r\n      active: true,\r\n    });\r\n    setEditing(false);\r\n  };\r\n\r\n  // ============ PERMISSIONS TAB FUNCTIONS ============\r\n  const loadRoles = async (user: any) => {\r\n    try {\r\n      const res = await fetch(\"/api/admin/roles\", {\r\n        headers: {\r\n          \"x-user-id\": user.id,\r\n          \"x-user-role\": user.role,\r\n        },\r\n      });\r\n      const data = await res.json();\r\n      console.log(\"📊 Loaded roles:\", data);\r\n      setRoles(data || []);\r\n\r\n      // Set initial ADMIN permissions\r\n      const adminRole = data?.find((r: any) => r.role === \"ADMIN\");\r\n      if (adminRole) {\r\n        setRolePermissions(adminRole.permissions || []);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error loading roles:\", error);\r\n    }\r\n  };\r\n\r\n  const selectRole = (roleName: string) => {\r\n    setSelectedRole(roleName);\r\n    const role = roles.find((r) => r.role === roleName);\r\n    if (role) {\r\n      setRolePermissions(role.permissions || []);\r\n    } else {\r\n      setRolePermissions([]);\r\n    }\r\n  };\r\n\r\n  const togglePermission = (perm: string) => {\r\n    setRolePermissions((prev) =>\r\n      prev.includes(perm) ? prev.filter((p) => p !== perm) : [...prev, perm]\r\n    );\r\n  };\r\n\r\n  const selectAllPermissions = () => {\r\n    setRolePermissions([...availablePermissions]);\r\n  };\r\n\r\n  const clearAllPermissions = () => {\r\n    setRolePermissions([]);\r\n  };\r\n\r\n  const savePermissions = async () => {\r\n    if (!me || me.role !== \"ADMIN\") {\r\n      toast.error(\"Only ADMIN can save permissions\");\r\n      return;\r\n    }\r\n\r\n    setSavingPerms(true);\r\n    try {\r\n      const res = await fetch(\"/api/admin/roles\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"x-user-id\": me.id,\r\n          \"x-user-role\": me.role,\r\n        },\r\n        body: JSON.stringify({\r\n          role: selectedRole,\r\n          permissions: rolePermissions,\r\n        }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        toast.success(`✅ ${selectedRole} Permissions saved!`);\r\n        loadRoles(me);\r\n      } else {\r\n        toast.error(\"Failed to save permissions\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving permissions:\", error);\r\n      toast.error(\"Error saving permissions\");\r\n    } finally {\r\n      setSavingPerms(false);\r\n    }\r\n  };\r\n\r\n  // ============ AUTHORIZATION CHECK ============\r\n  // Only show if user has MANAGE_USERS\r\n  if (!userHasPerm(me, 'MANAGE_USERS')) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\r\n          <h2 className=\"text-xl font-bold text-red-600 mb-2\">\r\n            ❌ Access Denied\r\n          </h2>\r\n          <p className=\"text-red-700\">You do not have permission to manage users or permissions.</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6 text-center\">\r\n        <div className=\"animate-pulse text-gray-500\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 max-w-6xl mx-auto\">\r\n      {/* TAB BUTTONS */}\r\n      <div className=\"flex flex-wrap gap-2 md:gap-4 mb-6 border-b border-gray-300\">\r\n        <button\r\n          onClick={() => setActiveTab(\"users\")}\r\n          className={`flex-1 sm:flex-none text-center px-4 py-2 font-semibold text-sm md:text-base ${\r\n            activeTab === \"users\"\r\n              ? \"text-blue-600 border-b-2 border-blue-600\"\r\n              : \"text-gray-600 hover:text-gray-800\"\r\n          }`}\r\n        >\r\n          👥 Users\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab(\"permissions\")}\r\n          className={`flex-1 sm:flex-none text-center px-4 py-2 font-semibold text-sm md:text-base ${\r\n            activeTab === \"permissions\"\r\n              ? \"text-blue-600 border-b-2 border-blue-600\"\r\n              : \"text-gray-600 hover:text-gray-800\"\r\n          }`}\r\n        >\r\n          🎭 Permissions\r\n        </button>\r\n      </div>\r\n\r\n      {/* ============ USERS TAB ============ */}\r\n      {activeTab === \"users\" && (\r\n        <div>\r\n          <h1 className=\"text-2xl md:text-3xl font-bold mb-6\">👥 Users Managment</h1>\r\n\r\n          {/* USER FORM */}\r\n          <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6 mb-6\">\r\n            <h2 className=\"text-xl md:text-2xl font-bold mb-4\">\r\n              {editing ? \"✏️ Edit User\" : \"➕ Add New User\"}\r\n            </h2>\r\n\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Name\"\r\n                value={userForm.name}\r\n                onChange={(e) =>\r\n                  setUserForm({ ...userForm, name: e.target.value })\r\n                }\r\n                className=\"border rounded px-3 py-2\"\r\n              />\r\n              <input\r\n                type=\"email\"\r\n                placeholder=\"Email\"\r\n                value={userForm.email}\r\n                onChange={(e) =>\r\n                  setUserForm({ ...userForm, email: e.target.value })\r\n                }\r\n                className=\"border rounded px-3 py-2\"\r\n              />\r\n              <input\r\n                type=\"password\"\r\n                placeholder=\"Password\"\r\n                value={userForm.password}\r\n                onChange={(e) =>\r\n                  setUserForm({ ...userForm, password: e.target.value })\r\n                }\r\n                className=\"border rounded px-3 py-2\"\r\n              />\r\n              <select\r\n                value={userForm.role}\r\n                onChange={(e) =>\r\n                  setUserForm({ ...userForm, role: e.target.value })\r\n                }\r\n                className=\"border rounded px-3 py-2\"\r\n              >\r\n                <option value=\"ADMIN\">ADMIN</option>\r\n                <option value=\"ACCOUNTANT\">ACCOUNTANT</option>\r\n                <option value=\"VIEWER\">VIEWER</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2 mb-4\">\r\n              <label className=\"flex items-center gap-2\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={userForm.active}\r\n                  onChange={(e) =>\r\n                    setUserForm({ ...userForm, active: e.target.checked })\r\n                  }\r\n                />\r\n                Active\r\n              </label>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={saveUser}\r\n                className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\r\n              >\r\n                {editing ? \"✏️ Edit User\" : \"✅ Add User\"}\r\n              </button>\r\n              {editing && (\r\n                <button\r\n                  onClick={resetUserForm}\r\n                  className=\"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700\"\r\n                >\r\n                  منسوخ کریں\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* USERS TABLE */}\r\n          <div className=\"bg-white rounded-lg shadow-md overflow-x-auto\">\r\n            <table className=\"w-full text-sm min-w-[800px]\">\r\n              <thead className=\"bg-gray-200\">\r\n                <tr>\r\n                  <th className=\"p-3 text-left\">Name</th>\r\n                  <th className=\"p-3 text-left\">Email</th>\r\n                  <th className=\"p-3 text-left\">Role</th>\r\n                  <th className=\"p-3 text-left\">Status</th>\r\n                  <th className=\"p-3 text-left\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {users.map((user: any) => (\r\n                  <tr\r\n                    key={user.id}\r\n                    className=\"border-t hover:bg-gray-50 text-xs\"\r\n                  >\r\n                    <td className=\"p-3\">{user.name}</td>\r\n                    <td className=\"p-3\">{user.email}</td>\r\n                    <td className=\"p-3\">\r\n                      <span className=\"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-semibold\">\r\n                        {user.role}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"p-3\">\r\n                      {user.active ? (\r\n                        <span className=\"text-green-600\">✓ Active</span>\r\n                      ) : (\r\n                        <span className=\"text-red-600\">✗ Inactive</span>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"p-3 space-x-2 whitespace-nowrap\">\r\n                      <button\r\n                        onClick={() => editUser(user)}\r\n                        className=\"bg-blue-100 text-blue-600 hover:bg-blue-200 px-3 py-1 rounded text-xs transition-colors\"\r\n                      >\r\n                        ✏️ Edit\r\n                      </button>\r\n                      <button\r\n                        onClick={() => deleteUser(user.id)}\r\n                        className=\"bg-red-100 text-red-600 hover:bg-red-200 px-3 py-1 rounded text-xs transition-colors\"\r\n                      >\r\n                        🗑️ Delete\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* ============ PERMISSIONS TAB ============ */}\r\n      {activeTab === \"permissions\" && (\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold mb-6\">🎭 Role Permissions</h1>\r\n\r\n          {/* ROLE SELECTOR */}\r\n          <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\r\n            <h2 className=\"text-xl font-bold mb-4\">Select Role:</h2>\r\n            <div className=\"flex gap-2 flex-wrap\">\r\n              {[\"ADMIN\", \"ACCOUNTANT\", \"VIEWER\"].map((role) => (\r\n                <button\r\n                  key={role}\r\n                  onClick={() => selectRole(role)}\r\n                  className={`px-4 py-2 rounded font-semibold ${\r\n                    selectedRole === role\r\n                      ? \"bg-blue-600 text-white\"\r\n                      : \"bg-gray-200 text-gray-800 hover:bg-gray-300\"\r\n                  }`}\r\n                >\r\n                  {role}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* PERMISSIONS GRID */}\r\n          <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h2 className=\"text-xl font-bold\">\r\n                {selectedRole} Permissions ({rolePermissions.length})\r\n              </h2>\r\n              <div className=\"space-x-2\">\r\n                <button\r\n                  onClick={selectAllPermissions}\r\n                  className=\"bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600\"\r\n                >\r\n                  ✓ Select All\r\n                </button>\r\n                <button\r\n                  onClick={clearAllPermissions}\r\n                  className=\"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600\"\r\n                >\r\n                   Clear All ✗\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mb-6\">\r\n              {availablePermissions.map((perm) => (\r\n                <label\r\n                  key={perm}\r\n                  className=\"flex items-center gap-2 p-2 hover:bg-gray-100 rounded cursor-pointer\"\r\n                >\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={rolePermissions.includes(perm)}\r\n                    onChange={() => togglePermission(perm)}\r\n                    className=\"w-4 h-4\"\r\n                  />\r\n                  <span className=\"text-sm\">{perm}</span>\r\n                </label>\r\n              ))}\r\n            </div>\r\n\r\n            <button\r\n              onClick={savePermissions}\r\n              disabled={savingPerms}\r\n              className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400\"\r\n            >\r\n              {savingPerms ? \"Saving...\" : \"✅ Save Permissions\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\dashboard\\users\\roles\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'me'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [isAdmin, me, me.id, me.role]","fix":{"range":[884,911],"text":"[isAdmin, me, me.id, me.role]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { PERMISSIONS } from \"@/lib/permissions\";\r\nimport { getCurrentUser } from \"@/lib/auth\";\r\n\r\ntype User = {\r\n  id: string;\r\n  name: string;\r\n  permissions: { permission: string }[];\r\n};\r\n\r\nexport default function AdminPermissionsPage() {\n  const me = getCurrentUser();\n  const isAdmin = me?.role === \"ADMIN\";\n\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [selected, setSelected] = useState<User | null>(null);\r\n  const [checked, setChecked] = useState<string[]>([]);\r\n\r\n  // 🔐 load session ONCE\r\n  // 🔐 fetch users AFTER auth\r\n  useEffect(() => {\n    if (!me || !isAdmin) return;\n\n    fetch(\"/api/admin/user-permissions\", {\n      headers: {\n        \"x-user-role\": me.role,\n        \"x-user-id\": me.id,\n      },\n    })\n      .then(r => r.json())\n      .then(setUsers)\n      .catch(console.error);\n  }, [isAdmin, me?.id, me?.role]);\n\r\n  // ⛔ nothing renders until ready\r\n  if (!me || !isAdmin) {\r\n    return <div className=\"p-6 text-red-600\">Access denied</div>;\r\n  }\r\n\r\n  // ================= actions =================\r\n\r\n  const selectUser = (u: User) => {\r\n    setSelected(u);\r\n    setChecked(u.permissions.map(p => p.permission));\r\n  };\r\n\r\n  const toggle = (p: string) => {\r\n    setChecked(prev =>\r\n      prev.includes(p) ? prev.filter(x => x !== p) : [...prev, p]\r\n    );\r\n  };\r\n\r\n  const save = async () => {\r\n    if (!selected) return alert(\"Select a user\");\r\n\r\n    await fetch(\"/api/admin/user-permissions\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"x-user-role\": me.role,\r\n        \"x-user-id\": me.id,\r\n      },\r\n      body: JSON.stringify({\r\n        userId: selected.id,\r\n        permissions: checked,\r\n      }),\r\n    });\r\n\r\n    alert(\"Permissions saved\");\r\n  };\r\n\r\n  // ================= UI =================\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-3 gap-6 p-6\">\r\n\r\n      {/* USERS */}\r\n      <div className=\"border rounded p-4\">\r\n        <h2 className=\"font-bold mb-3\">Users</h2>\r\n\r\n        {users.map(u => (\r\n          <div\r\n            key={u.id}\r\n            onClick={() => selectUser(u)}\r\n            className={`p-2 mb-1 cursor-pointer rounded\r\n              ${selected?.id === u.id ? \"bg-gray-200\" : \"hover:bg-gray-100\"}`}\r\n          >\r\n            {u.name}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* PERMISSIONS */}\r\n      <div className=\"col-span-2 border rounded p-4\">\r\n        {!selected ? (\r\n          <div className=\"text-gray-500\">Select a user</div>\r\n        ) : (\r\n          <>\r\n            <h2 className=\"font-bold mb-3\">\r\n              Permissions: {selected.name}\r\n            </h2>\r\n\r\n            {Object.values(PERMISSIONS).map(p => (\r\n              <label key={p} className=\"block\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={checked.includes(p)}\r\n                  onChange={() => toggle(p)}\r\n                />\r\n                <span className=\"ml-2\">{p}</span>\r\n              </label>\r\n            ))}\r\n\r\n            <button\r\n              onClick={save}\r\n              className=\"mt-4 px-4 py-2 bg-black text-white\"\r\n            >\r\n              Save\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1124,1127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1124,1127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2856,2859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2856,2859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":208,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8392,8395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8392,8395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport toast from \"react-hot-toast\";\r\n\r\ninterface UserType {\r\n  id: string;\r\n  email: string;\r\n  name: string;\r\n  role: string;\r\n}\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function LoginPage() {\r\n  const router = useRouter();\r\n  const [username, setUsername] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [usersList, setUsersList] = useState<UserType[]>([]);\r\n  const [selectedRole, setSelectedRole] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    async function fetchUsers() {\r\n      try {\r\n        const res = await fetch(\"/api/users\");\r\n        const data = await res.json();\r\n        if (res.ok) {\r\n          const users = Array.isArray(data) ? data : [];\r\n          setUsersList(users);\r\n          if (users.length === 0) {\r\n            setError(\"No users found. Please create a user first.\");\r\n          }\r\n        } else {\r\n          setError(data.error || \"Failed to load users\");\r\n        }\r\n      } catch (err: any) {\r\n        console.error(\"Users fetch error:\", err);\r\n        setError(\"Connection Error: \" + (err.message || \"Cannot connect to server\"));\r\n      }\r\n    }\r\n    fetchUsers();\r\n  }, []);\r\n\r\n  const handleUserChange = (email: string) => {\r\n    setUsername(email);\r\n    const user = usersList.find((u) => u.email === email);\r\n    setSelectedRole(user ? user.role : \"\");\r\n  };\r\n\r\n  async function handleLogin() {\r\n    if (!username || !password) {\r\n      setError(\"Please select user and enter password\");\r\n      return;\r\n    }\r\n    setError(\"\");\r\n    setLoading(true);\r\n\r\n    try {\r\n      const res = await fetch(\"/api/login\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ email: username.trim(), password }),\r\n      });\r\n\r\n      let data;\r\n      try {\r\n        const text = await res.text();\r\n        data = text ? JSON.parse(text) : {};\r\n      } catch (parseError) {\r\n        console.error(\"Response parse error:\", parseError);\r\n        setError(\"Invalid server response\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (res.ok && data.user) {\r\n        // Save user to localStorage (getCurrentUser() expects this format)\r\n        localStorage.setItem(\"user\", JSON.stringify(data.user));\r\n        console.log(\"✅ User saved to localStorage:\", data.user);\r\n        \r\n        // Small delay to ensure localStorage is set\r\n        setTimeout(() => {\r\n          router.push(\"/dashboard\");\r\n        }, 100);\r\n      } else {\r\n        const errorMsg = data.message || data.error || \"Login failed. Please check your credentials.\";\r\n        setError(errorMsg);\r\n        console.error(\"❌ Login failed:\", errorMsg, data);\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"Login error:\", err);\r\n      setError(err.message || \"Network error. Please check your connection.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen w-full bg-blue-300 flex items-center justify-center font-sans p-4\">\r\n      <div className=\"w-full max-w-md bg-white border border-gray-600 shadow-lg my-8\">\r\n        <div className=\"flex justify-between px-6 py-3\">\r\n          <span className=\"font-bold text-blue-800 text-lg\">US Traders</span>\r\n          <span className=\"text-sm font-semibold\">FAISALABAD</span>\r\n        </div>\r\n        <div className=\"border-t border-b border-blue-800 py-2 text-center font-semibold tracking-widest text-sm uppercase\">\r\n          User Information\r\n        </div>\r\n        <div className=\"flex justify-center py-6 px-4\">\r\n          <div className=\"bg-blue-900 text-white p-6 w-full border\">\r\n            <p className=\"text-sm mb-3 font-semibold\">Please Login Here...</p>\r\n            {error && (\r\n              <div className=\"text-[10px] bg-red-600 text-white p-1 mb-2 text-center\">\r\n                {error}\r\n                <br />\r\n                <button\r\n                  onClick={async () => {\r\n                    try {\r\n                      const res = await fetch(\"/api/test-login\");\r\n                      const data = await res.json();\r\n                      alert(JSON.stringify(data, null, 2));\r\n                    } catch (e) {\r\n                      alert(\"Test failed: \" + e);\r\n                    }\r\n                  }}\r\n                  className=\"mt-1 text-xs underline\"\r\n                >\r\n                  Check Database\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"space-y-3 text-sm\">\r\n              <div className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\r\n                <label className=\"w-24 font-semibold sm:font-normal\">User Name:</label>\r\n                <select \r\n                  className=\"flex-1 bg-gray-300 text-black px-1 py-0.5 outline-none w-full\"\r\n                  value={username}\r\n                  onChange={(e) => handleUserChange(e.target.value)}\r\n                  onKeyDown={(e) => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      const passwordInput = document.querySelector('input[type=\"password\"]') as HTMLInputElement;\r\n                      if (passwordInput) passwordInput.focus();\r\n                    }\r\n                  }}\r\n                >\r\n                  <option value=\"\">-- Select User --</option>\r\n                  {usersList.map((u) => (\r\n                    <option key={u.id} value={u.email}>{u.name}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\r\n                <label className=\"w-24 font-semibold sm:font-normal\">Password:</label>\r\n                <input \r\n                  type=\"password\" \r\n                  className=\"flex-1 bg-gray-300 text-black px-1 py-0.5 outline-none w-full\"\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                  onKeyDown={(e) => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleLogin();\r\n                    }\r\n                  }}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\r\n                <label className=\"w-24 font-semibold sm:font-normal\">User Role:</label>\r\n                <input \r\n                  type=\"text\" \r\n                  readOnly \r\n                  className=\"flex-1 text-black px-1 py-0.5 bg-gray-300 font-bold outline-none w-full\"\r\n                  value={selectedRole}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex justify-center gap-6 mt-6\">\r\n              <button onClick={handleLogin} disabled={loading} className=\"px-6 py-1 bg-gray-200 text-black border border-gray-500 text-sm active:bg-gray-400\">\r\n                {loading ? \"...\" : \"OK\"}\r\n              </button>\r\n              <button className=\"px-6 py-1 bg-gray-200 text-black border border-gray-500 text-sm\">Cancel</button>\r\n            </div>\r\n            {usersList.length === 0 && (\r\n              <div className=\"mt-4 text-[10px] text-yellow-600 bg-yellow-100 p-2 border border-yellow-400\">\r\n                <p className=\"font-bold mb-1\">⚠️ No users found!</p>\r\n                <button\r\n                  onClick={async () => {\r\n                    try {\r\n                      setLoading(true);\r\n                      const res = await fetch(\"/api/create-default-user\", {\r\n                        method: \"POST\",\r\n                        headers: { \"Content-Type\": \"application/json\" },\r\n                        body: JSON.stringify({ password: \"us786\" }),\r\n                      });\r\n                      const data = await res.json();\r\n                      if (res.ok) {\r\n                        toast.success(`✅ ${data.message}\\nEmail: ${data.email}\\nPassword: ${data.password}`, { duration: 6000 });\r\n                        // Reload users list\r\n                        setTimeout(() => window.location.reload(), 2000);\r\n                      } else {\r\n                        toast.error(\"Error: \" + (data.error || \"Failed to create user\"));\r\n                      }\r\n                    } catch (e: any) {\r\n                      toast.error(\"Error: \" + e.message);\r\n                    } finally {\r\n                      setLoading(false);\r\n                    }\r\n                  }}\r\n                  disabled={loading}\r\n                  className=\"mt-2 bg-green-600 text-white px-3 py-1 rounded text-xs font-bold disabled:bg-gray-400\"\r\n                >\r\n                  {loading ? \"Creating...\" : \"Create Default Admin User\"}\r\n                </button>\r\n                <p className=\"mt-2 text-xs\">Or run: <code>npm run seed</code></p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className=\"flex justify-between px-4 py-2 text-[10px] border-t border-gray-500\">\r\n          <span className=\"text-blue-700 underline\">For further detail.</span>\r\n          <span className=\"text-right\">US DEVELOPERS.<br />Umer Sajjad 0304-76536939</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\view\\purchase-invoice\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\smart-business-accounts\\app\\view\\sales-invoice\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
